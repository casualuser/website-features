{
  "log": {
    "version": "1.1",
    "creator": {
      "name": "Firebug",
      "version": "1.9"
    },
    "browser": {
      "name": "Firefox",
      "version": "12.0"
    },
    "pages": [
      {
        "startedDateTime": "2012-05-30T13:51:38.671+04:00",
        "id": "page_36651",
        "title": "Не найден лицензионный ключ!",
        "pageTimings": {
          "onContentLoad": 531,
          "onLoad": 749
        }
      }
    ],
    "entries": [
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:38.671+04:00",
        "time": 59,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/admin/index.php"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 705,
          "bodySize": -1
        },
        "response": {
          "status": 503,
          "statusText": "Service Unavailable",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Content-Type",
              "value": "text/html; charset=UTF-8"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "X-Powered-By",
              "value": "HostCMS 2120076242 -186917087 -2118050029"
            },
            {
              "name": "Expires",
              "value": "Thu, 19 Nov 1981 08:52:00 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "no-store, no-cache, must-revalidate, post-check=0, pre-check=0"
            },
            {
              "name": "Pragma",
              "value": "no-cache"
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Content-Length",
              "value": "3356"
            }
          ],
          "content": {
            "mimeType": "text/html",
            "size": 8253,
            "text": "<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01//EN\" \"http://www.w3.org/TR/html4/strict.dtd\">\r\n<html>\r\n<head>\r\n<title>Не найден лицензионный ключ!</title>\r\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=EmulateIE7\"></meta>\r\n<meta content=\"text/html; charset=UTF-8\" http-equiv=\"Content-Type\"></meta>\r\n<link rel=\"stylesheet\" type=\"text/css\" href=\"/admin/css/style.css?-936011871\"></link>\r\n<link rel=\"shortcut icon\" href=\"/admin/favicon.ico\"></link>\r\n\r\n<script type=\"text/javascript\">\r\n// Хранит текущий путь\r\ncmslocation = '';\r\n\r\n// Запрос был отправлен\r\nsended_request = false;\r\n\r\nfunction saveLocation(location)\r\n{\r\n\tcmslocation = location;\r\n}\r\n\r\n// Возвращает атрибут #cmsurl=\r\nfunction getCmsUrl()\r\n{\r\n\treturn new String(document.location.hash).replace('#cmsurl=', '').replace('%3F','?');\r\n}\r\n\r\n// Сохраняем текущий путь\r\nsaveLocation(getCmsUrl());\r\n\r\n// При обновлении страницы указан анкор\r\nif(document.location.hash && document.location.hash.indexOf('cmsurl=') > -1)\r\n{\r\n\t//document.location = unescape(getCmsUrl());\r\n\tdocument.location = getCmsUrl();\r\n}\r\n\r\n// Устанавливает #\r\nfunction setLocation(location)\r\n{\r\n\tif (location.indexOf('?') >= 0)\r\n\t{\r\n\t\tlocation = location.substring(0, location.indexOf('?'))\r\n\t\t+ '%3F' + HostcmsEscape(location.substring(location.indexOf('?') + 1));\r\n\t}\r\n\tdocument.location.hash = 'cmsurl=' + location;\r\n}\r\n\r\n// Проверям изменение пути при назад-вперед\r\nfunction checkLocation()\r\n{\r\n\tvar curr_location = getCmsUrl();\r\n\r\n\tif (curr_location != cmslocation && sended_request == false)\r\n\t{\r\n\t\tsended_request = true;\r\n\t\t//document.location = curr_location;\r\n\t\tcmsrequest = '';\r\n\r\n\t\t//sendRequest(unescape(curr_location), 'get', callbackfunction_DoLoadAjax);\r\n\t\tsendRequest(curr_location, 'get', callbackfunction_DoLoadAjax);\r\n\t}\r\n}\r\n\r\nsetInterval(checkLocation, 500);\r\n</script>\r\n\r\n<script type=\"text/javascript\" src=\"/admin/js/codepress/codepress.js\"></script>\r\n<!--[if IE 7]> \r\n\t<link rel=\"stylesheet\" type=\"text/css\" href=\"/admin/css/ie_hacks.css\" />\r\n<![endif]-->\r\n\r\n<script type=\"text/javascript\" src=\"/admin/js/jquery/jquery.js\"></script>\r\n<script type=\"text/javascript\" src=\"/admin/js/JsHttpRequest.js\"></script>\r\n<script type=\"text/javascript\" src=\"/admin/js/jquery/jquery.elastic.js?-936011871\"></script>\r\n<script type=\"text/javascript\" src=\"/admin/js/tools/jquery.tools.js?-936011871\"></script>\r\n<script type=\"text/javascript\" src=\"/admin/wysiwyg/fm/fm.js?-936011871\"></script>\r\n<script type=\"text/javascript\" src=\"/admin/js/main.js?-936011871\"></script>\r\n<script type=\"text/javascript\" src=\"/admin/js/ajax.js?-936011871\"></script>\r\n<script type=\"text/javascript\" src=\"/admin/js/fieldcheck.js?-936011871\"></script>\r\n<script type=\"text/javascript\" src=\"/admin/js/lng/ru/ru.js?-936011871\"></script>\r\n\r\n<!-- Calendar -->\r\n<link rel=\"stylesheet\" type=\"text/css\" media=\"all\" href=\"/admin/calendar/calendar.css\" title=\"win2k-cold-1\" />\r\n<script type=\"text/javascript\" src=\"/admin/calendar/calendar.js\"></script>\r\n<script type=\"text/javascript\" src=\"/admin/calendar/lang/calendar-ru.js\"></script>\r\n<script type=\"text/javascript\" src=\"/admin/calendar/calendar-setup.js\"></script>\r\n\r\n<script type=\"text/javascript\">\r\n$(function() {\r\n\tapplyTooltip();\r\n\tformatTable();\r\n\tformatTextarea();\r\n\tCreateWindow('copyright', '', '310', '80');\r\n\ttimeout_copiright = 0;\r\n});\r\n</script>\r\n\r\n<script type=\"text/javascript\" src=\"/admin/wysiwyg/tiny_mce_gzip.js\"></script>\r\n<script type=\"text/javascript\">\r\ntinyMCE_GZ.init({\r\n\tplugins : 'safari,pagebreak,style,layer,table,save,advhr,advimage,advlink,emotions,iespell,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,xhtmlxtras,template,inlinepopups',\r\n\tthemes : 'advanced',\r\n\tlanguages : 'ru',\r\n\tdisk_cache : true,\r\n\tcompress : true,\r\n\tsuffix : '_src',\r\n\tdebug : false\r\n});\r\n</script>\r\n<script type=\"text/javascript\">\r\n\tvar FM = new FM('');\r\n\t</script>\r\n\r\n</head>\r\n<body>\r\n<div id=\"header\">\r\n<div class=\"left_box\">\r\n\r\n<div class=\"logo\"><a href=\"/admin/\"\r\nonclick=\"DoLoadAjax('/admin/index.php', '', 0, 'load_data', 0, 0, 0, 1); return false;\"><img\r\n\tsrc=\"/admin/images/logo.gif\" alt=\"(^) HostCMS\"\r\n\ttitle=\"HostCMS v. 5.9.31\" /></a>\r\n</div>\r\n\r\n<div class=\"box3\" style=\"float: right; margin: 0px 10px 10px 0px;\"><img\r\n\tclass=\"left_img\" src=\"/admin/images/language.gif\" /> <select\r\n\tstyle=\"margin-right: 10px;\" name=\"lng_value\"\r\n\tonchange=\"window.location=('?lng_value='+this.options[this.selectedIndex].value)\">\r\n\t<option value=\"ru\" selected>Русский</option><option value=\"en\">English</option></select></div>\r\n\r\n<div class=\"box3\" style=\"float: right; margin: 0px 10px 0px 0px;\"><img\r\n\tclass=\"left_img\" src=\"/admin/images/sites.gif\" /> <select\r\n\tname=\"current_site_id_value\"\r\n\tonchange=\"window.location=('?current_site_id_value='+this.options[this.selectedIndex].value)\">\r\n\t<option value=\"1\"  selected>Демонстрационный сайт</option></select><a href=\"http://atceli.bget.ru\" target=\"_blank\" title=\"Посмотреть сайт в новом окне\"><img class=\"right_img\" src=\"/admin/images/eye.gif\" alt=\"<&bull;>\" title=\"<&bull;>\" /></a></div></div><div class=\"right_box\">\r\n<div class=\"box3\" style=\"float: left; margin-bottom: 8px\">\r\n<div style=\"margin: 4px 0px\"><img class=\"left_img\" src=\"/admin/images/superuser.gif\" /> admin<a href=\"/admin/logout.php\"><img class=\"right_img\" src=\"/admin/images/exit.gif\" alt=\"&rarr;\" title=\"&rarr;\" style=\"margin-left: 10px\" /></a></div>\r\n</div>\r\n\r\n\t<div class=\"box3\" style=\"float: left; width: 180px;\">\r\n<img class=\"left_img\" src=\"/admin/images/buy.gif\" /> <a href=\"http://www.hostcms.ru/orders/\" class=\"order\" target=\"_blank\">Купить полную версию</a></div>\r\n</div>\r\n</div>\r\n\r\n<div id=\"body\"><!-- Левый блок -->\r\n<div class=\"left_box\" id=\"body_left_box\" style=\"margin-right: 0px; border-right: 0px\">\r\n<div style=\"padding-right: 30px\"><div id=\"id_content\">\r\n\t\t<div id=\"id_message\"></div>\r\n\t\t<h1>Не найден лицензионный ключ!</h1>\r\n\t\t<h2>Получение ключа</h2><p>После установки системы управления необходимо зарегистрироваться на нашем сайте в разделе «<a href=\"http://www.hostcms.ru/users/\" target=\"_blank\">Личный кабинет</a>»</p><p>После подтверждения регистрации пользователя и входа в личный кабинет, в разделе «Лицензии» доступен список выданных лицензий:<br/><img src=\"http://www.hostcms.ru/images/news/user-orders/img1.gif\" class=\"screen\" /></p><p>Коммерческие пользователи могут узнать свой номер договора и PIN-код из таблицы в разделе «Лицензии» личного кабинета, пользователи HostCMS.Халява могут добавить новую лицензию.</p><p>Узнав номер договора и PIN-код можно вернуться в <a href=\"/admin/\" target=\"_blank\">центр администрирования</a> и ввести эти данные в разделе «Сайты» — «Настройки» — «Регистрационные данные».</p><p>Далее можно получать ключи в <a href=\"/admin/\" target=\"_blank\">центре администрирования</a> системы управления (начиная с версии 5.1.1), перейдя в раздел «Сайты» — «Домены»:<br/><img src=\"http://www.hostcms.ru/images/keys/domain_list.gif\" class=\"screen\" /></p><p>При нажатии на пиктограмму «Ключ» система запросит ключ для выбранного домена по вашей лицензии и внесет его в список ключей сайта.<h2>Вход в центр администрирования</h2><p>Перейдите в <a href=\"/admin/\" target=\"_blank\">центр администрирования</a>, далее действуйте по инструкции.</p>\t</div></div>\r\n</div><div id=\"body_right_box\" class=\"right_box\"><div id=\"MainMenu\"></div>\r\n\r\n</div>\r\n\r\n</div>\r\n\r\n<div id=\"copyright\" onmousemove=\"clear_timeout_copiright();\"\r\n\tonmouseout=\"set_timeout_copyright();\" style=\"white-space: nowrap;\">\r\n<div class=\"shadow_tail\"><img src=\"/admin/images/shadow_tail.gif\"></div>\r\n<strong>Система управления сайтом HostCMS v. 5</strong>\r\n<br />\r\n<br />\r\nОфициальный сайт:  <a href=\"http://www.hostcms.ru\" target=\"_blank\">www.hostcms.ru</a>\r\n<br />\r\nСлужба технической поддержки:  <a href=\"mailto:support@hostcms.ru\">support@hostcms.ru</a>\r\n<br />\r\nОтдел продаж:  <a href=\"mailto:sales@hostcms.ru\">sales@hostcms.ru</a>\r\n</div>\r\n\r\n<div id=\"footer\">\r\n\t<div>Copyright &copy; 2005&ndash;2011 <span onmousemove=\"ShowWindow('copyright'); copyright_position('copyright');\" onmouseout=\"set_timeout_copyright();\">ООО &laquo;Хостмэйк&raquo;</span></div>\r\n</div>\r\n\r\n<!--[if lte IE 6]>\r\n<script type=\"text/javascript\" src=\"/admin/js/ie_resize.js\"></script>\r\n<![endif]-->\r\n\r\n</body>\r\n</html>\r\n"
          },
          "redirectURL": "",
          "headersSize": 445,
          "bodySize": 3356
        },
        "cache": {},
        "timings": {
          "blocked": 0,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 58,
          "receive": 1
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:38.785+04:00",
        "time": 5,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/css/style.css?-936011871",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "text/css,*/*;q=0.1"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Thu, 15 Sep 2011 12:16:13 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [
            {
              "name": "-936011871",
              "value": ""
            }
          ],
          "headersSize": 725,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Thu, 15 Sep 2011 12:16:13 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Thu, 31 May 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=86400"
            }
          ],
          "content": {
            "mimeType": "text/css",
            "size": 29069,
            "text": "html\r\n{\r\n\theight: 100%;\r\n\tmargin: 0px;\r\n\tpadding: 0px;\r\n}\r\n\r\nbody\r\n{\r\n\tfont-family: Arial, Verdana, 'MS Sans Serif', sans-serif;\r\n\tbackground-color: #FFFFFF;\r\n\tfont-size: 75%;\r\n\t\r\n\theight: auto !important;\r\n\t/* для Firefox и Opera — чтобы не сработало следующее объявление */\r\n\t\r\n\t/*height: 100%;\r\n\t/* для IE (работает некорректно, что обеспечивает нужный результат) */\r\n\t\r\n\tmin-height: 100%;\r\n\t/* для Firefox и Opera (в IE 7 делает то же, что предыдущее объявление) */\r\n\r\n\tmargin: 0px;\r\n\tpadding: 0px;\r\n\tcolor: #333333;\r\n\tposition: relative;\r\n\t/* чтобы потомки элемента body позиционировались по отношению к body */\r\n}\r\n\r\nimg\r\n{\r\n\tborder: 0px;\r\n}\r\n\r\n.img_line\r\n{\r\n\tmargin-bottom: -3px;\r\n}\r\n\r\n.logo \r\n{\r\n\tposition: relative; float: left; width: 200px;\r\n}\r\n\r\n.logo a\r\n{\r\n\tfont-size: 17pt;\r\n\tfont-family: Verdana;\r\n\ttext-decoration: none;\r\n\tletter-spacing: 2px;\r\n}\r\n\r\n.logo img\r\n{\r\n\tcolor: #db1905;\r\n}\r\n\r\na:visited, a:link, a:hover\r\n{\r\n\tcolor: #0070BD;\r\n}\r\n\r\nol li, ul li\r\n{\r\n\tmargin-bottom: 3pt;\r\n\tmargin-top: 3pt;\r\n}\r\n\r\n.table_style\r\n{\r\n\tmargin-top: 10px;\r\n}\r\n\r\n.footer_logo\r\n{\r\n\tmargin-left: 10px;\r\n\tmargin-right: 10px; \r\n}\r\n\r\n.left_td\r\n{\r\n\tpadding-right: 20px;\r\n}\r\n\r\n.main_td\r\n{\r\n\tpadding-right: 20px;\r\n}\r\n\r\n.left_td p\r\n{\r\n\tpadding-left:10px;\r\n}\r\n\r\nacronym\r\n{\r\n\tborder-bottom: 1px dashed #C0C0C0;\r\n\tcursor: help;\r\n}\r\n\r\n#footer_line1\r\n{\r\n\tbackground: #FF5500;\r\n\theight: 2px;\r\n\toverflow: hidden;\r\n\tposition: relative;\r\n\tmargin-top: 30px;\r\n}\r\n\r\n#footer_line2\r\n{\r\n\tbackground: #0072B2;\r\n\theight: 2px;\r\n\toverflow: hidden;\r\n\tposition: relative;\r\n\tmargin-top: 15px;\r\n}\r\n\r\n#title\r\n{\r\n\tcolor: #333333;\r\n\tfont: menu;\r\n\tmargin:0px;\r\n\tpadding:0px;\r\n\tposition:absolute;\r\n\tvisibility:hidden;\r\n}\r\n\r\nform\r\n{\r\n\tmargin-bottom:0;\r\n\tmargin-top:0;\r\n}\r\n\r\n.bg_1\r\n{\r\n\tbackground-color: #F1F1F1;\r\n\tpadding-left:10px;\r\n}\r\n\r\n.bg_2\r\n{\r\n\tbackground-color: #FF5500;\r\n}\r\n\r\n.menu_over\r\n{\r\n\tbackground-color: #DDDDDD;\r\n}\r\n\r\n.menu_out\r\n{\r\n\tbackground-color: #F1F1F1;\r\n}\r\n\r\ntable\r\n{\r\n\tempty-cells: show;\r\n} \r\n\r\n.admin_table_title\r\n{\r\n\tcolor: #000000;\r\n\tfont-weight: bold;\r\n\ttext-align: left;\r\n\theight: 25px\r\n}\r\n\r\n.admin_table_title td\r\n{\r\n\tpadding-left: 5px;\r\n\tpadding-right: 5px;\r\n\tpadding-bottom: 2px;\r\n\tbackground-color: #EAEAEA;\r\n\tborder-top: #D9D9D9 solid 1px;\r\n\tborder-bottom: #D9D9D9 solid 1px;\r\n\t/*white-space: nowrap;*/\r\n}\r\n\r\n.admin_table_title .hl\r\n{\r\n\tbackground-color: #E0E0E0;\r\n}\r\n\r\n.admin_table_main_title td\r\n{\r\n\tbackground-color: #CACACA;\t\r\n}\r\n\r\n\r\n.admin_table_sub td\r\n{\r\n\tpadding-right: 5px;\r\n\tpadding-left: 5px;\r\n\t/*border-bottom: 1px solid #AAA;*/\r\n}\r\n\r\n.admin_table_sub_title td\r\n{\r\n\tfont-weight: bold;\r\n\tfont-size: 120%;\r\n}\r\n\r\n.admin_table_filter td\r\n{\r\n\tbackground-color: #F2F0EB;\r\n\tborder-bottom: #CEC3A3 solid 1px;\r\n\tpadding-right: 6px;\r\n\tpadding-left: 4px;\r\n}\r\n\r\n.admin_table_filter .hl\r\n{\r\n\tbackground-color: #E9E7E2;\r\n}\r\n\r\n.admin_table\r\n{\r\n\tborder: 1px solid #eeeeee;\r\n\tmargin-top: 5px;\r\n}\r\n\r\n.admin_table td\r\n{\r\n/*\theight: 25px; */\r\n\tempty-cells: show;\r\n\tborder-bottom: 1px;\r\n\tborder-bottom-style: solid;\r\n\tborder-color: #dddddd;\r\n}\r\n\r\n.top td, .footer td\r\n{\r\n\tline-height: 1.1em; \r\n\tfont-size: 7.5pt;\r\n\tpadding-left: 7px;\r\n\tpadding-right:7px;\r\n\tvertical-align: top;\r\n}\r\n\r\nhr\r\n{\r\n\tborder-top: 1px solid #e2d1ba;\r\n\tborder-bottom: 1px solid #FFF;\r\n\tborder-left: none;\r\n\tborder-right: none;\r\n\theight: 0px !important;\r\n\theight: 2px;\r\n\tmargin: 25px 0px 10px 0px !important;\r\n\tpadding: 0px;\r\n\tmargin: 0px 0px 5px 0px\r\n}\r\n\r\n\r\n/* Стили для групбоксов на главной */\r\n.main_div\r\n{\r\n\t/*width: 100%;*/\r\n\theight: 100%;\r\n\tmargin: 0px 0px 10px 0px;\r\n\t/* border: 1px solid #000000; */\r\n}\r\n\r\n.div_title\r\n{\r\n\tposition: absolute;\r\n\tbackground-color: #ffffff;\r\n\tpadding: 0px 4px 0px 4px;\r\n\tmargin: -8px 0px 0px 20px;\r\n\tfont-weight: bold;\r\n}\r\n\r\n.div_content\r\n{\r\n\tborder: 1px solid #dddddd;\r\n\tpadding: 10px 5px 10px 5px;\r\n\theight: 100%;\r\n}\r\n/* / Стили для групбоксов на главной */\r\n\r\ninput, textarea, select, input:focus, select:focus\r\n{\r\n\tfont-family: Tahoma, Verdana, 'MS Sans Serif', Arial, sans-serif;\r\n\tfont-size: 10pt;\r\n\toutline: none;\r\n\tmargin-top: 2px;\r\n}\r\n\r\ninput\r\n{\r\n\tpadding: 3px;\r\n\tvertical-align: middle;\r\n\tbehavior: url('/admin/css/input_readonly.htc');\r\n}\r\n\r\ntextarea\r\n{\r\n\tpadding: 5px 5px;\r\n}\r\n\r\ninput[type=text],\r\ninput[type=password],\r\ntextarea,\r\nselect\r\n{\r\n\tbackground: none repeat scroll 0 0 #FFFFFF;\r\n\tborder-radius: 5px;\r\n\t-moz-border-radius: 5px;\r\n\t-webkit-border-radius: 5px;\r\n\t-moz-box-sizing: padding-box;\r\n\t-webkit-box-sizing: padding-box;\r\n}\r\n\r\ninput[type=text]:focus,\r\ninput[type=password]:focus,\r\ntextarea:focus,\r\nselect:focus\r\n{\r\n\tbox-shadow: 0 0 7px rgba(10,10,10,.5);\r\n\t-moz-box-shadow: 0 0 7px rgba(10,10,10,.5);\r\n\t-webkit-box-shadow: 0 0 7px rgba(10,10,10,.5);\r\n}\r\n\r\nselect\r\n{\r\n\t/*margin: 0px;*/\r\n\tpadding: 2px;\r\n}\r\n\r\n/*option {\r\nmargin: 2px;\r\n}*/\r\n\r\ninput[readonly], .read_only_input\r\n{\r\n\tbackground-color: #F9F9F9;\r\n\tcolor: #333333;\r\n}\r\n\r\ninput[type=\"checkbox\"]\r\n{\r\n\tpadding: 1px;\r\n\tborder: 0px;\r\n}\r\n\r\ninput[type=\"submit\"],\r\ninput[type=\"button\"]\r\n{\r\n\tcursor: pointer;\r\n\tpadding: 2px;\r\n\tmargin-top: 0 !important;\r\n}\r\n\r\n/* Большое поле ввода центра администрирования */\r\ninput.large, div.large, input.calendar_field_large, select.large\r\n{\r\n\tfont-size: 14pt;\r\n}\r\n\r\nbutton\r\n{\r\n\tfont-family: Verdana, 'MS Sans Serif', Arial, sans-serif;\r\n\tborder: 1px solid #777777;\r\n\tbackground-color:#f7f7f7;\r\n\tcursor: pointer;\r\n\tmargin-right: 8px;\r\n\tcolor: #000000;\r\n\tfont-size: 9pt;\r\n\tmargin-top: 10px;\r\n}\r\n\r\nbutton img\r\n{\r\n\tborder: 0;\r\n\tmargin-right: 5px;\r\n\tmargin-top: 2px;\r\n\tmargin-bottom: 1px;\r\n\tvertical-align: middle;\r\n}\r\n\r\n/* Поля загрузки файлов */\r\n.load_file {\r\n\tmargin-bottom: 10px\r\n}\r\n\r\n.load_file .input_field {\r\n\tfloat: left;\r\n\tmargin-right: 7px\r\n}\r\n\r\n.load_file .input_field input {\r\n\tmargin-left: 7px\r\n}\r\n\r\n.load_file .input_button input {\r\n\tposition: relative;\r\n}\r\n/* END Поля загрузки файлов */\r\n\r\nh1\r\n{\r\n\tposition: relative;\r\n\tfont-weight: normal;\r\n\tfont-size: 18pt;\r\n\tcolor: #000000;\r\n\tborder-left: 6px solid #db1905;\r\n\tpadding-bottom: 0em;\r\n\tpadding-left: 34px;\r\n\tleft: -40px;\r\n\tmargin-top: 15px;\r\n}\r\n\r\nh2\r\n{\r\n\tcolor: #000000;\r\n\tfont-size: 15pt;\r\n\tfont-weight: normal;\r\n\tpadding-top: 2pt;\r\n\tpadding-bottom: 1pt;\r\n}\r\n\r\n.button_image {margin-left: -8px;}\r\n\r\n.table_filling\r\n{\r\n\tbackground-color: #555555;\r\n\tcolor: #ffffff;\r\n\tfont-size: 8pt;\r\n\tpadding-left: 7px;\r\n\tpadding-right: 7px;\r\n}\r\n\r\n.table_filling td\r\n{\r\n\tcolor: #ffffff;\r\n}\r\n\r\n.table_filling a:link, .table_filling a:visited\r\n{\r\n\tcolor: #ffffff;\r\n\tfont-size: 8pt;\r\n\tmargin: 0px;\r\n\ttext-decoration: none;\r\n}\r\n\r\n.table_filling a:hover\r\n{\t\r\n\tcolor: #ffffff;\r\n\ttext-decoration: underline;\r\n}\r\n\r\n.table_border, .table_border td\r\n{\r\n\tborder-collapse: collapse;\r\n\tempty-cells: show;\r\n\tborder-width:1px;\r\n\tborder-color: #222222;\r\n\tborder-style: solid;\r\n}\r\n\r\n#message, #error_message\r\n{\r\n\tz-index: 1;\r\n\tmargin-top: 5px;\r\n\tmargin-bottom: 5px;\r\n\tpadding: 5px 5px 5px 25px;\r\n\tfont-size: 8pt;\r\n\tborder-collapse: collapse;\r\n\tbackground-color: #FFFFFF;\r\n\tborder-radius: 5px;\r\n\t-moz-border-radius: 5px;\r\n\t-webkit-border-radius: 5px;\r\n}\r\n\r\n#message\r\n{\r\n\tborder: 1px solid #3A7E34;\r\n\tcolor: #3A7E34;\r\n\tbackground: url('/admin/images/attention.gif') no-repeat 5px 50%;\r\n}\r\n\r\n#error_message\r\n{\r\n\tborder: 1px solid #CA1D13;\r\n\tcolor: #CA1D13;\r\n\tbackground: url('/admin/images/error.gif') no-repeat 5px 50%;\r\n}\r\n\r\n.table_border_file, td.table_border_file\r\n{\r\n\tborder-collapse: collapse;\r\n\tempty-cells: show;\r\n\tborder-width:1px;\r\n\tborder-color: #eeeeee;\r\n\tborder-style: solid;\r\n\tbackground-color: #f5f5f5;\r\n}\r\n\r\n.row_table_over\r\n{\r\n\tbackground-color: #E5E5E5;\r\n}\r\n\r\n.row_table_over .hl\r\n{\r\n\tbackground-color: #DCDCDC;\r\n}\r\n\r\n.row_table_over_odd\r\n{\r\n\tbackground-color: #E5E5E5;\r\n}\r\n\r\n.row_table_over_odd .hl\r\n{\r\n\tbackground-color: #D6D5D5;\r\n}\r\n\r\n.row_table\r\n{\r\n\tbackground-color: #FFFFFF;\r\n}\r\n\r\n.row_table .hl\r\n{\r\n\tbackground-color: #F6F6F6;\r\n}\r\n\r\n.row_table_odd\r\n{\r\n\tbackground-color: #F5F5F5;\r\n}\r\n\r\n.row_table_odd .hl\r\n{\r\n\tbackground-color: #EEEEEE;\r\n}\r\n\r\n.Highlight_row_table\r\n{\r\n\tbackground-color: #F2F0EB;\r\n}\r\n\r\n.Highlight_row_table_odd\r\n{\r\n\tbackground-color: #E2E0DB;\r\n}\r\n\r\n.admin_table\r\n{\r\n\t/*table-layout: fixed;*/\r\n}\r\n\r\n.row_table td,\r\n.row_table_over td,\r\n.admin_td,\r\n.row_table_odd td,\r\n.row_table_over_odd td,\r\n.Highlight_row_table td,\r\n.Highlight_row_table_odd td\r\n{\r\n\tpadding-left: 3px;\r\n\tpadding-right: 3px;\r\n\tpadding-bottom: 2px;\r\n\tborder-bottom: 1px;\r\n\tborder-bottom-style: solid;\r\n\tborder-color: #dddddd;\r\n\toverflow: hidden;\r\n\twhitespace: nowrap;\r\n}\r\n\r\n.admin_table td div\r\n{\r\n\tclear: both;\r\n\tposition: relative;\r\n\tmargin: 0;\r\n\tpadding: 0;\r\n}\r\n\r\n.admin_table td div.dl\r\n{\r\n\toverflow: hidden;\r\n}\r\n\r\n.report_height td\r\n{\r\n\theight: 25px;\r\n}\r\n\r\n.success\r\n{\r\n\tcolor: #339933;\r\n}\r\n\r\n.warning\r\n{\r\n\tcolor: #EBB100;\r\n}\r\n\r\n.error\r\n{\r\n\tcolor: #CC0000;\r\n\tfont-weight: bold;\r\n\ttext-decoration: blink;\r\n}\r\n\r\n.short_title\r\n{\r\n\tcolor: #000000;\r\n\tfont-weight: bold;\r\n\tfont-size: 110%;\r\n}\r\n\r\n\r\n#index_gray_div\r\n{\r\n\tposition: relative;\r\n/*\tbackground-color: #F1F1F1; */\r\n\tborder: 1px solid #E0E0E0;\r\n\r\n\theight: 100%;\r\n}\r\n\r\n.index_table_td\r\n{\r\n/*\tborder: 1px solid #E0E0E0; */\r\n\tcolor: #000000;\r\n/*\tpadding: 0px 5px 0px 5px;*/\r\n\tmargin: 0px;\r\n\tcolor: #000000;\r\n}\r\n\r\n.order:link, .order:visited, .order:hover\r\n{\r\n\tcolor: #DB1905;\r\n\ttext-decoration: none;\r\n\tfont-weight: bold;\r\n\tborder-bottom: 1px dotted #FF5500;\r\n}\r\n\r\ntable.no_border, table.no_border td\r\n{\r\n\tborder: 0px;\r\n}\r\n\r\n/* Стили для show_link */\r\n.current, .page_link, .arrow_span\r\n{\r\n\t/*border: 1px dashed #bbbbbb;*/\r\n\tborder: 1px solid #E1E1E1;\r\n\tpadding: 0.2em 0.5em 0.3em 0.5em;\r\n\tfloat: left;\r\n\tdisplay: block;\r\n\tmargin-right: 0.3em;\r\n\tbackground: #FFFFFF;\r\n\tfloat: left;\r\n}\r\n\r\n.current\r\n{\r\n\tfont-weight: bold;\r\n\tcolor: #000000;\r\n\t/* background-color: #F2F0EB; */\r\n}\r\n\r\n.arrow_span\r\n{\r\n\tcolor: #777777;\r\n\tbackground-color: #FFF;\r\n}\r\n/* Конец стилей для show_link */\r\n\r\n\r\n/* Стили для admin_forms_fields */\r\n.item_div\r\n{\r\n\tpadding-right: 10px;\r\n\tmargin-bottom: 7px;\r\n}\r\n\r\n/* Span заголовка поля внутри закладки */\r\ndiv.item_div .caption\r\n{\r\n\t/* color: #777777; */\r\n\tdisplay: block;\r\n\tmargin: 0px 0px 3px 0px;\r\n\t/* padding: 0px 0px 20px 0px; */\r\n\tpadding: 0px;\r\n\t/*font-weight: bold;*/\r\n}\r\n\r\n.item_div_as_is\r\n{\r\n\tfloat: left; margin-right: 10px; margin-top: 20px; \r\n}\r\n\r\n.arrow_path \r\n{\r\n\t/* color: #CEC3A3; */\r\n\tcolor: #0070BD;\r\n}\r\n/* Конец стилей для admin_forms_fields */\r\n\r\n.main_ul\r\n{\r\n\tlist-style-type: none;\t\r\n\tfont-family: verdana, arial, sans-serif;\r\n\tcolor: #303030;\t\r\n\tpadding: 0px;\r\n\tmargin-left: 0px;\t\r\n\tposition: relative;\r\n\tmargin-bottom: 11px;\t\r\n}\r\n\r\n.main_ul .shadowed\r\n{\r\n\t/* Только для IE */\r\n\t// left: 0px;\r\n\t// top: 25px;\r\n} \r\n\r\n.main_ul a,\r\n.main_ul a:visited,\r\n.main_ul a:hover\r\n{\r\n\ttext-decoration: none;\r\n\tcolor: #303030;\t\r\n}\r\n\r\n.main_ul ul a:hover\r\n{\r\n\ttext-decoration: underline;\r\n\tcolor: #303030;\t\r\n}\r\n\r\n.main_ul img\r\n{\r\n\tmargin: 0px 4px 0px 0px;\r\n}\r\n\r\n.li_lev_1\r\n{\r\n\tpadding: 0px 15px 0px 0px;\r\n\tmargin: 0px 0px 0px 0px;\r\n\theight: 25px;\r\n\tbackground: url('/admin/images/line1.gif') repeat-x 0 100%;\r\n\twhite-space: nowrap;\r\n\tpadding: 0px 10px 4px 2px;\r\n\tposition: relative;\r\n}\r\n\r\n.li_lev_1 span\r\n{\r\n\tcursor: pointer;\r\n}\r\n\r\n/* Первый UL выпадающего меню */\r\n.li_lev_1 div ul\r\n{\r\n\tmargin: 3px 0px 0px -2px;\r\n\tpadding: 0px 0px 0px 0px;\r\n\tlist-style-type: none;\r\n\t\r\n\t/* Только для IE */\r\n\t// margin-left: 0px;\r\n}\r\n\r\n.li_lev_1 ul img\r\n{\r\n\tposition: absolute;\r\n\tmargin: 0px 0px 0px -25px;\r\n}\r\n\r\n.li_lev_1 ul a\r\n{\t\r\n\tposition: relative;\r\n\tleft: 28px;\r\n}\r\n\r\n.arrow_img\r\n{\r\n\tposition: relative;\r\n\tmargin: 0px 0px 0px -24px;\t\r\n}\r\n\r\n.li_lev_1 ul ul\r\n{\r\n\tposition: absolute;\r\n\tborder: 0px solid #CEC3A3;\r\n\tmargin: 0px;\t\r\n\tpadding: 0px;\r\n\ttop: 0px;\r\n\tleft: 100%;\r\n\tborder-bottom: 1px solid #CEC3A3;\r\n\tborder-top: 1px solid #CEC3A3;\r\n\tbackground-color: #fff;\r\n}\r\n\r\n.li_lev_1 ul li\r\n{\t\r\n\tpadding: 4px 40px 4px 0px;\r\n\tmargin: 0px;\r\n\tbackground-color: #fff;\r\n}\r\n\r\n.light_table, .light_table td\r\n{\r\n\tborder-collapse: collapse;\r\n\tempty-cells: show;\r\n\tborder: 1px solid #E1E1E1;\r\n\tmargin: 0px 2px;\r\n}\r\n\r\n.from_ie\r\n{\t\r\n\tbackground: url(/admin/images/fon_li.png) repeat-y 0 0;\r\n}\r\n\r\n.div_message_error\r\n{\r\n\tcolor: #777777;\r\n\t/* font-size: 90%; */\r\n}\r\n\r\n/*.shadowed *\r\n{\r\n\tfont-family: serif;\r\n\tfont-size:100%;\r\n\tfont-weight:normal;\r\n\tfont-style:normal !important;\r\n\tcolor:#000000;\r\n\ttext-transform:none;\r\n\ttext-decoration:none !important;\r\n\tletter-spacing:normal;\r\n\tword-spacing:0;\r\n\tline-height:20px;\r\n\ttext-align:start;\r\n\tvertical-align:baseline;\r\n\tdirection:ltr;\r\n\tbackground-color:transparent;\r\n\tbackground-image:none;\r\n\tbackground-repeat:repeat;\r\n\tbackground-position:0 0;\r\n\tbackground-attachment:scroll;\r\n\topacity:1;\r\n\twidth:auto;\r\n\theight:auto;\r\n\ttop:auto;\r\n\tright:auto;\r\n\tbottom:auto;\r\n\tleft:auto;\r\n\tmargin-top:0;\r\n\tmargin-right:0;\r\n\tmargin-bottom:0;\r\n\tmargin-left:0;\r\n\tpadding-top:0;\r\n\tpadding-right:0;\r\n\tpadding-bottom:0;\r\n\tpadding-left:0;\r\n\tborder-top-width:0;\r\n\tborder-right-width:0;\r\n\tborder-bottom-width:0;\r\n\tborder-left-width:0;\r\n\tborder-top-color:'#000000';\r\n\tborder-right-color:'#000000';\r\n\tborder-bottom-color:'#000000';\r\n\tborder-left-color:'#000000';\r\n\tborder-top-style:none;\r\n\tborder-right-style:none;\r\n\tborder-bottom-style:none;\r\n\tborder-left-style:none;\r\n\tposition:static;\r\n\tdisplay:block;\r\n\tvisibility:visible;\r\n\tz-index:auto;\r\n\toverflow-x:visible;\r\n\toverflow-y:visible;\r\n\twhite-space:normal;\r\n\tclip:auto;\r\n\tfloat:none;\r\n\tclear:none;\r\n\tcursor:auto;\r\n\tlist-style-image:none;\r\n\tlist-style-position:outside;\r\n\tlist-style-type:disc;\r\n\tmarker-offset:auto;\r\n}*/\r\n\r\n/* End стилей для меню центра администрирования */\r\n.shadowed\r\n{\r\n\tzoom: 1;\r\n\tz-index: 99;\r\n\tposition: absolute !important;\r\n\tmargin-top: 10px;\r\n\tbackground-color: #FFF;\r\n\tfont-size: 9pt;\r\n\t/*border: 1px solid #f00;*/\r\n} \r\n\r\n.shadowed .tl\r\n{\r\n\tposition: absolute;\r\n\tfont-size: 0;\r\n\ttop: -15px;\r\n\tleft: -17px;\r\n\tbackground: url('/admin/images/shadow-lt.png') 0 0 no-repeat !important;\r\n\tbackground: none;\r\n\tfilter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='/admin/images/shadow-lt.png');\r\n\twidth: 17px;\r\n\theight: 15px;\r\n}\r\n\r\n.shadowed .t\r\n{\r\n\tposition: absolute;\r\n\tfont-size: 0;\r\n\ttop: -15px;\r\n\tleft: 0;\r\n\tbackground: url('/admin/images/shadow-t.png') 0 0 repeat-x !important;\r\n\tbackground: url('/admin/images/spacer.gif');\r\n\tfilter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='/admin/images/shadow-t.png', sizingmethod='scale');\r\n\twidth: 100%;\r\n\theight: 15px;\r\n\t/* border: 1px solid; */\r\n}\r\n\r\n.shadowed .tr\r\n{\r\n\tposition: absolute;\r\n\tfont-size: 0;\r\n\ttop: -15px;\r\n\tleft: 100%;\r\n\tbackground: url('/admin/images/shadow-rt.png') 0 0 no-repeat !important;\r\n\tbackground: none;\r\n\tfilter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='/admin/images/shadow-rt.png');\r\n\twidth: 17px;\r\n\theight: 15px;\r\n}\r\n\r\n.shadowed .r\r\n{\r\n\tposition: absolute;\r\n\tfont-size: 0;\r\n\ttop: 0;\r\n\tleft: 100%;\r\n\tbackground: url('/admin/images/shadow-r.png') 0 0 repeat-y !important;\r\n\tbackground: none;\r\n\tfilter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='/admin/images/shadow-r.png', sizingmethod='scale');\r\n\twidth: 17px;\r\n\theight: 100%;\r\n\r\n}\r\n\r\n.shadowed .br\r\n{\r\n\tposition: absolute;\r\n\tfont-size: 0;\r\n\ttop: 100%;\r\n\tleft: 100%;\r\n\tbackground: url('/admin/images/shadow-rb.png') 0 0 no-repeat !important;\r\n\tbackground: none;\r\n\tfilter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='/admin/images/shadow-rb.png');\r\n\twidth: 17px;\r\n\theight: 21px;\r\n}\r\n\r\n.shadowed .b\r\n{\r\n\tposition: absolute;\r\n\tfont-size: 0;\r\n\ttop: 100%;\r\n\tleft: 0;\r\n\tbackground: url('/admin/images/shadow-b.png') 0 0 repeat-x !important;\r\n\tbackground: url('/admin/images/spacer.gif');\r\n\tfilter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='/admin/images/shadow-b.png', sizingmethod='scale');\r\n\twidth: 100%;\r\n\theight: 21px;\r\n}\r\n\r\n.shadowed .bl\r\n{\r\n\tposition: absolute;\r\n\tfont-size: 0;\r\n\ttop: 100%;\r\n\tleft: -17px;\r\n\tbackground: url('/admin/images/shadow-lb.png') 0 0 no-repeat !important;\r\n\tbackground: none;\r\n\tfilter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='/admin/images/shadow-lb.png');\r\n\twidth: 17px;\r\n\theight: 21px;\r\n}\r\n\r\n.shadowed .l\r\n{\r\n\tposition: absolute;\r\n\tfont-size: 0;\r\n\ttop: 0;\r\n\tleft: -17px;\r\n\tbackground: url('/admin/images/shadow-l.png') 0 0 repeat-y !important;\r\n\tbackground: none;\r\n\tfilter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='/admin/images/shadow-l.png', sizingmethod='scale');\r\n\twidth: 17px;\r\n\theight: 100%;\r\n}\r\n\r\n.shadow_tail\r\n{\r\n\tposition: absolute;\r\n\tbottom: -30px;\r\n\t// bottom: -27px;\r\n\tright: 20px;\r\n\tz-index: 100;\r\n}\r\n\r\n.shadowed #subdiv\r\n{\r\n\toverflow: auto;\r\n\twidth: 600px;\r\n\theight: 400px;\r\n}\r\n\r\n#helpdesk_m_tree\r\n{\r\n\tborder: 1px solid #F2F0EB;\r\n\tpadding: 5px;\r\n\tmargin: 5px;\r\n}\r\n\r\n.helpdesk_span\r\n{\r\n\tcolor: #FFFFFF;\r\n\tpadding: 1px 5px;\r\n\tfont-weight: bold;\r\n}\r\n\r\n.helpdesk_critical_level\r\n{\r\n\tcolor: #777;\r\n\tcursor: pointer;\r\n\twhite-space: nowrap;\r\n}\r\n\r\n.helpdesk_img_line\r\n{\r\n\tmargin-bottom: -3px;\r\n\tmargin-right: 5px;\r\n}\r\n\r\n#helpdesk_additional_search\r\n{\r\n\tbackground-color:#F2F0EB;\r\n\tborder:1px solid #CEC3A3;\r\n\tfloat: left;\r\n\tborder-radius: 5px;\r\n\t-moz-border-radius: 5px;\r\n\t-webkit-border-radius: 5px;\r\n\tpadding: 3px;\t\r\n}\r\n\r\n/* --- */\r\n\r\n.admin_form_action img\r\n{\r\n\tmargin: 0px 2px -3px 5px;\r\n}\r\n\r\n.admin_form_action_link:link, .admin_form_action_link:hover, .admin_form_action_link:visited\r\n{\r\n\tcolor: #000000;\r\n\tmargin-right: 10px;\r\n\tfont-size: 9pt;\r\n}\r\n\r\n.admin_form_action_alert_link:link, .admin_form_action_alert_link:hover, .admin_form_action_alert_link:visited\r\n{\r\n\tcolor: #DB1905;\r\n\tmargin-right: 10px;\r\n\tfont-size: 9pt;\r\n}\r\n\r\ninput.calendar_field, input.calendar_field_large\r\n{\r\n\tpadding-right: 17px;\r\n\tbackground: url('/admin/images/calendar.gif') no-repeat 100% 50% #FFFFFF;\r\n}\r\n\r\n* html #header\r\n{\r\n\theight: 1%; /* So IE plays nice */\r\n}\r\n\r\n/* Шапка */\r\n#header\r\n{\r\n\t/*border: 1px solid #0f0; /**/\r\n\toverflow: hidden;\r\n\tpadding: 45px 245px 0px 40px; /* 245 - Ширина правой колонки */\r\n\tmargin: 0px 0px 0px 0px; /* 45 - отступ сверху */\r\n\tmin-width: 655px;\r\n}\r\n\r\n#header .left_box\r\n{\r\n\twidth: 100%;\r\n\tborder-right: 245px solid #fff; /* The width and color of the rail */\r\n\tmargin-right: -245px; /* Hat tip to Ryan Brill */\r\n\tfloat: left;\r\n}\r\n\r\n#header .right_box\r\n{\r\n\twidth: 245px;\r\n\tfloat: left;\r\n\tmargin-right: -245px;\r\n}\r\n/* /шапка */\r\n\r\n/* BODY */\r\n#body\r\n{\r\n\t/*border: 1px solid #f00; /**/\r\n\toverflow: hidden;\r\n\tpadding: 15px 245px 60px 40px; /* 245 - Ширина правой колонки */\r\n\tmin-width: 655px;\r\n}\r\n\r\n* html #body\r\n{\r\n\theight: 1%; /* So IE plays nice */\r\n}\r\n\r\n#body .left_box\r\n{\r\n\t/*border: 1px dashed #0f0;*/\r\n\twidth: 100%;\r\n\tborder-right: 245px solid #fff; /* The width and color of the rail */\r\n\tmargin-right: -245px; /* Hat tip to Ryan Brill */\r\n\tfloat: left;\r\n\t/*\r\n\toverflow: auto;\r\n\t_overflow-y: hidden;\r\n\tpadding-bottom: 25px;\r\n\t\r\n\tscrollbar-3dlight-color: #b0a78b; \r\n\tscrollbar-arrow-color: #b0a78b;\r\n\tscrollbar-highlight-color: #f2f0eb;\r\n\tscrollbar-face-color: #ebe8e0;\r\n\tscrollbar-shadow-color: #f2f0eb;\r\n\tscrollbar-darkshadow-color: #b0a78b;\r\n\tscrollbar-track-color: #f2f0eb;*/\r\n}\r\n\r\n#body .right_box\r\n{\r\n\t/* width: 245px; */\r\n\tfloat: left;\r\n\tmargin-right: -245px;\r\n\tpadding: 0px;\r\n\t/* overflow: auto */\r\n\t/*border: 1px solid #000; */\r\n}\r\n\r\n\r\n#body .right_box div a:link,\r\n#body .right_box div a:hover,\r\n#body .right_box div a:visited\r\n{\r\n\tcolor: #000000;\r\n}\r\n\r\n#body .right_box div ul li a:link,\r\n#body .right_box div ul li a:hover,\r\n#body .right_box div ul li a:visited\r\n{\r\n\tcolor: #000000;\r\n}\r\n\r\n#body .right_box div ul\r\n{\r\n\tmargin: 10px 0px 0px 40px;\r\n\tpadding: 0px;\r\n\t/* width: 100%; */\r\n}\r\n\r\n#body .right_box div ul li\r\n{\r\n\tlist-style-type: none;\r\n\tpadding-left: 15px;\r\n\tpadding-right: 15px;\r\n\tbackground: url('/admin/images/menu_li.gif') no-repeat 0px 5px;\r\n\t/* line-height: 1.5em; */\r\n}\r\n\r\n/* /BODY */\r\n\r\n.left_img\r\n{\r\n\tmargin: 0px 5px -3px 0px;\r\n\tpadding: 0px;\r\n}\r\n\r\n.right_img\r\n{\r\n\tmargin: 0px 0px -3px 3px;\r\n\tpadding: 0px 5px 0px 0px;\r\n\tcursor: pointer;\r\n}\r\n\r\n/* --- */\r\n.box3:before, .box3before\r\n{\r\n\tcontent: url('/admin/images/gray-lt.gif');\r\n\tbackground: url('/admin/images/gray-rt.gif') no-repeat 100% 0;\r\n\theight: 10px;\r\n\tdisplay: block;\r\n\tmargin: -5px -15px 0px -15px;\r\n\tfont-size: 0px;\r\n\tline-height: 0.1;\r\n}\r\n\r\n.box3:after, .box3after\r\n{\r\n\tcontent: url('/admin/images/gray-lb.gif');\r\n\tbackground: url('/admin/images/gray-rb.gif') no-repeat 100% 0;\r\n\theight: 10px; \r\n\tdisplay: block;\r\n\tmargin: 0px -15px -5px -15px;\r\n\tfont-size: 0px;\r\n\tline-height: 0.1;\r\n}\r\n\r\n.box3\r\n{\r\n\tposition: relative;\r\n\twhite-space: nowrap;\r\n\toverflow: hidden;\r\n\tzoom: 1;\r\n\tbackground-color: #EAEAEA;\r\n\tpadding: 5px 15px 5px 15px;\r\n\t\r\n\tbehavior: url('/admin/css/box3.htc');\r\n}\r\n\r\n/* --- */\r\n.box0:before, .box0before\r\n{\r\n\tcontent: url('/admin/images/brown-lt.gif');\r\n\tbackground: url('/admin/images/brown-rt.gif') no-repeat 100% 0;\r\n\theight: 10px;\r\n\tdisplay: block;\r\n\tmargin: -5px -15px 0px -15px;\r\n\tfont-size: 0px;\r\n\tline-height: 0.1;\r\n}\r\n\r\n.box0:after, .box0after\r\n{\r\n\tcontent: url('/admin/images/brown-lb.gif');\r\n\tbackground: url('/admin/images/brown-rb.gif') no-repeat 100% 0;\r\n\theight: 10px; \r\n\tdisplay: block;\r\n\tmargin: 0px -15px -5px -15px;\r\n\tfont-size: 0px;\r\n\tline-height: 0.1;\r\n}\r\n\r\n.box0\r\n{\r\n\tposition: relative;\r\n\twhite-space: nowrap;\r\n\toverflow: hidden;\r\n\tzoom: 1;\r\n\tbackground-color: #EAE7DA;\r\n\tpadding: 5px 15px 5px 15px;\r\n\r\n\tbehavior: url('/admin/css/box0.htc');\r\n}\r\n\r\n/* --- */\r\n.box1:before, .box1before\r\n{\r\n\tcontent: url('/admin/images/green-lt.gif');\r\n\tbackground: url('/admin/images/green-rt.gif') no-repeat 100% 0;\r\n\theight: 10px;\r\n\tdisplay: block;\r\n\tmargin: -5px -15px 0px -15px;\r\n\tfont-size: 0px;\r\n\tline-height: 0.1;\r\n}\r\n\r\n.box1:after, .box1after\r\n{\r\n\tcontent: url('/admin/images/green-lb.gif');\r\n\tbackground: url('/admin/images/green-rb.gif') no-repeat 100% 0;\r\n\theight: 10px; \r\n\tdisplay: block;\r\n\tmargin: 0px -15px -5px -15px;\r\n\tfont-size: 0px;\r\n\tline-height: 0.1;\r\n}\r\n\r\n.box1\r\n{\r\n\tbackground-color: #E0F4D3;\r\n\tpadding: 5px 15px 5px 15px;\r\n\tdisplay: block; \r\n\tzoom: 1;\r\n\tposition: relative;\r\n\twhite-space: nowrap;\r\n\toverflow: hidden;\r\n\t\r\n\tbehavior: url('/admin/css/box1.htc');\r\n}\r\n\r\n/* --- */\r\n.box2:before, .box2before\r\n{\r\n\tcontent: url('/admin/images/turquoise-lt.gif');\r\n\tbackground: url('/admin/images/turquoise-rt.gif') no-repeat 100% 0;\r\n\theight: 10px;\r\n\tdisplay: block;\r\n\tmargin: -5px -15px 0px -15px;\r\n\tfont-size: 0px;\r\n\tline-height: 0.1;\r\n}\r\n\r\n.box2:after, .box2after\r\n{\r\n\tcontent: url('/admin/images/turquoise-lb.gif');\r\n\tbackground: url('/admin/images/turquoise-rb.gif') no-repeat 100% 0;\r\n\theight: 10px; \r\n\tdisplay: block;\r\n\tmargin: 0px -15px -5px -15px;\r\n\tfont-size: 0px;\r\n\tline-height: 0.1;\r\n}\r\n\r\n.box2\r\n{\r\n\tbackground-color: #DFF3F4;\r\n\tpadding: 5px 15px 5px 15px;\r\n\tdisplay: block; \r\n\tzoom: 1;\r\n\tposition: relative;\r\n\twhite-space: nowrap;\r\n\toverflow: hidden;\r\n\tbehavior: url('/admin/css/box2.htc');\r\n}\r\n\r\n.box0 span, .box1 span, .box2 span, .box3 span { cursor:pointer; text-decoration:underline }\r\n\r\n.box0 select, .box1 select, .box2 select, .box3 select\r\n{\r\n\tmargin: 0px 0px -1px 0px;\r\n}\r\n\r\n.buy_hostcms:link,\r\n.buy_hostcms:hover,\r\n.buy_hostcms:visited\r\n{\r\n\tcolor: #DB1905;\r\n}\r\n\r\ninput.authorization\r\n{\r\n\tmargin: 5px 0px 3px 0px;\r\n\tpadding: 5px 20px 5px 35px;\r\n\tcolor: #776E47;\r\n\tbackground: url('/admin/images/authorization.gif') no-repeat 10px 50% #EAE7DA;\r\n\tborder: 1px solid #C1BBA3;\r\n}\r\n\r\n#footer\r\n{\r\n\tposition: absolute;\r\n\tbottom: 0px;\r\n\tleft: 0px;\r\n\twidth: 100%;\r\n\ttext-align: right;\r\n\tmargin: 0px 0px 5px 0px;\r\n\theight: 30px;\r\n\t/*border: 1px solid #00f; /**/\r\n}\r\n\r\n#footer div\r\n{\r\n\t/*margin: 30px 0px 0px 0px; /**/\r\n\tpadding: 5px 10px 5px 0px;\r\n\tborder-right: 6px solid #db1905;\r\n\tcolor: #595959;\r\n\tfont-size: 10pt;\r\n}\r\n\r\n#footer div span\r\n{\r\n\tborder-bottom: 1px dashed;\r\n\tcursor: pointer;\r\n}\r\n\r\n.t_authorization td\r\n{\r\n\tvertical-align: top;\r\n}\r\n\r\n.authorization_message\r\n{\r\n\tmargin: 50px 50px 0px 0px;\r\n}\r\n\r\ninput.checkbox_authorization\r\n{\r\n\tmargin: 7px 0px 3px 0px !important;\r\n\tmargin: 0px;\r\n\tzoom: 1;\r\n\tborder: 0px;\r\n}\r\n\r\nlabel\r\n{\r\n\tposition: relative;\r\n\ttop: 3px !important;\r\n\ttop: 0px;\r\n}\r\n\r\n#MainMenu\r\n{\r\n\tzoom: 1;\r\n\toverflow: hidden;\r\n\tvisitibility: hidden;\r\n\twidth: 215px; /**/\r\n\t/* border: 1px dashed #000; /**/\r\n}\r\n\r\n#MainMenu div\r\n{\r\n\t/* для box-ов */\r\n\twidth: 180px;\r\n\r\n\t/* use ie_hacks.css */\r\n}\r\n\r\n#MainMenuShowHide\r\n{\r\n\tposition: absolute;\r\n\tleft: 100%;\r\n\t/* top: 50%; */\r\n\ttop: 400px;\r\n\twidth: 10px;\r\n\tmargin-left: -20px;\r\n\t/* border: 1px dotted #0ff; */\r\n}\r\n\r\ndiv.sub_menu\r\n{\r\n\twidth: 215px !important;\r\n\t/* use ie_hacks.css */\r\n\t\r\n\toverflow: hidden;\r\n\t/* border: 1px dashed #000; */\r\n\tmargin-bottom: 10px;\r\n\t\r\n\t/* Только для IE */\r\n\t// padding-right: 1px;\r\n}\r\n\r\ndiv.sub_menu ul\r\n{\r\n\toverflow: hidden;\r\n\twidth: 100%;\r\n}\r\n\r\n/* fix bug IE button padding */\r\n#ControlElements input\r\n{\r\n\toverflow: visible;\r\n}\r\n\r\n.admin_forms_action_td\r\n{\r\n\twhite-space: nowrap;\r\n}\r\n\r\n/* Контейнер для ShowLoadingScreen() */\r\n.admin_forms_fade\r\n{\r\n\tposition: absolute;\r\n\tleft: 0px;\r\n\ttop: 0px;\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\t\r\n\t/* Только для IE */\r\n\t//top: expression( body.scrollTop ); /*for IE*/\r\n\t/*border: 5px solid #000; /**/\r\n}\r\n\r\n/* Слой, который становится прозрачным. Вложен в admin_forms_fade */\r\n.fill_div_layer\r\n{\r\n\tposition: absolute;\r\n\tleft: 0px;\r\n\ttop: 0px;\r\n\twidth: 100%;\r\n\theight: 100%;\r\n}\r\n\r\n/* Верхняя полосочка */\r\n.topbar\r\n{\r\n\tbackground-color: #F1F1F1;\r\n\theight: 20px;\r\n\tfont-size: 90%;\r\n\tpadding: 6px 0px 0px 5px;\r\n\tmargin-bottom: 5px;\r\n\tpadding-right: 20px;\r\n\tfont-weight: bold;\r\n}\r\n\r\n.topbar img\r\n{\r\n\tcursor: pointer;\r\n\tposition: absolute;\r\n\tleft: 100%;\r\n\tz-index: 1000;\r\n\tmargin-top: 3px;\r\n\tmargin-left: -15px;\r\n}\r\n\r\n/* TABs */\r\n#tab\r\n{\r\n\tfloat: left;\r\n\twidth: 100%;\r\n\tbackground: url(\"/admin/images/tab_top_fon_4_form.gif\") repeat-x bottom;\r\n\t/*font-size:93%; */\r\n\tline-height: normal;\r\n\tmargin: 0px 2px 20px 2px;\r\n\tposition: relative;\r\n\tborder: 0;\r\n}\r\n\r\n#tab ul\r\n{\r\n\tmargin: 0;\r\n\tpadding: 10px 10px 0 7px;\r\n\tlist-style: none;\t\r\n}\r\n\r\n#tab li\r\n{\r\n\tfloat: left;\r\n\tbackground: url('/admin/images/tab_l_no_active.gif') no-repeat left top;\r\n\tmargin: 0;\r\n\tpadding: 0 0 0 3px;\r\n\tposition: relative;\r\n\tmargin-left: -3px;\t\r\n}\r\n\r\n#tab span\r\n{\r\n\tfloat: left;\r\n\tdisplay: block;\r\n\tbackground: url('/admin/images/tab_fon_no_active.gif') no-repeat right top;\r\n\tpadding: 8px 18px 7px 12px;\r\n\ttext-decoration: none;\r\n\tcolor: #606060;\r\n\tfloat: none;\r\n\tcursor: pointer;\r\n}\r\n\r\n#tab .current_li\r\n{\r\n\tbackground-image: url('/admin/images/tab_l_active.gif');\r\n\tborder-width: 0;\r\n\tz-index: 2;\r\n}\r\n\r\n#tab .current_li span\r\n{\r\n\tbackground-image: url('/admin/images/tab_fon_active.gif');\r\n\tcolor: #262626;\r\n\tz-index: 2;\r\n}\r\n/* / TABs */\r\n\r\n.arrow_up\r\n{\r\n\tcolor: #6BC500;\r\n\tfont-size: 120%;\r\n\tpadding-bottom: 3px;\r\n}\r\n\r\n.arrow_down\r\n{\r\n\tcolor: #C51200;\r\n\tfont-size: 120%;\r\n\tpadding-bottom: 3px;\r\n}\r\n\r\n.screen\r\n{\r\n\tborder: #E1E1E1 1px solid;\r\n\tmargin: 10px 0px;\r\n}\r\n\r\n#gray \r\n{\r\n\tcolor: #777;\r\n}\r\n\r\n.shadowed #subdiv_small\r\n{\r\n\toverflow: auto;\r\n\twidth: 100%;\r\n\theight: 89%;\r\n}\r\n\r\n.typograph_result\r\n{\r\n\tborder-left: 3px solid #db1905;\r\n\tmargin: 15px 0px;\r\n\tpadding: 0px 0px 0px 15px;\r\n\tbackground-color: #F7F7F7;\r\n\tfont-size: 110%;\r\n\theight: 150px;\r\n\toverflow: auto;\r\n}\r\n\r\n.typograph_result span, .typograph_result nobr\r\n{\r\n\tbackground-color: #FFD79D;\r\n}\r\n\r\n\r\n.hidden\r\n{\r\n\tdisplay: none;\r\n}\r\n\r\n/* Templates install */\r\n.site_template_block\r\n{\r\n\twidth: 210px; float: left;\r\n}\r\n\r\n.bord_img {\r\n\tpadding: 6px;\r\n\tposition: relative;\r\n\tborder: 1px solid #e0e0e0;\r\n\tmargin-right: 12px;\r\n\tmargin-bottom: 12px;\r\n\tzoom: 1;\r\n\tfloat: left;\r\n}\r\n\r\n.bord_img .tl,\r\n.bord_img .tr,\r\n.bord_img .br,\r\n.bord_img .bl {\r\n\tz-index: 3;\r\n\tposition: absolute;\r\n\tfont-size: 1px;\r\n}\r\n\r\n.bord_img .t,\r\n.bord_img .r,\r\n.bord_img .b,\r\n.bord_img .l {\r\n\tz-index: 2;\r\n\tposition: absolute;\r\n\tfont-size: 1px;\r\n}\r\n\r\n.bord_img .t,\r\n.bord_img .b {\r\n\twidth: 100% !important;\r\n\twidth: auto;\r\n\twidth: expression((parentElement.clientWidth) + 'px');\r\n}\r\n\r\n.bord_img .r,\r\n.bord_img .l {\r\n\theight: 100% !important;\r\n\theight: auto;\r\n\theight: expression((parentElement.clientHeight) + \"px\");\r\n}\r\n\r\n.bord_img .tl {\r\n\tbackground: url('/admin/images/bord_img_tl.gif') no-repeat 0 0;\r\n\ttop: -7px;\r\n\tleft: -7px;\r\n\twidth: 13px;\r\n\theight: 14px;\r\n}\r\n\r\n.bord_img .t {\r\n\tbackground: url('/admin/images/bord_img_t.gif') repeat-x 0 0;\r\n\ttop: -7px;\r\n\tleft: 0;\r\n\theight: 7px;\r\n}\r\n\r\n.bord_img  .tr {\r\n\tbackground: url('/admin/images/bord_img_tr.gif') no-repeat 0 0;\r\n\ttop: -7px;\r\n\tright: -8px;\r\n\twidth: 15px;\r\n\theight: 14px;\r\n}\r\n\r\n.bord_img  .r {\r\n\tbackground: url('/admin/images/bord_img_r.gif') repeat-y 0 0;\r\n\ttop: 0px;\r\n\tright: -8px;\r\n\twidth: 8px;\r\n}\r\n\r\n.bord_img  .br {\r\n\tbackground: url('/admin/images/bord_img_br.gif') no-repeat 0 0;\r\n\tbottom: -9px;\r\n\tright: -8px;\r\n\twidth: 15px;\r\n\theight: 16px;\r\n}\r\n\r\n.bord_img  .b {\r\n\tbackground: url('/admin/images/bord_img_b.gif') repeat-x 0 0;\r\n\tbottom: -9px;\r\n\tleft: 0px;\r\n\theight: 9px;\r\n}\r\n\r\n.bord_img  .bl {\r\n\tbackground: url('/admin/images/bord_img_bl.gif') no-repeat 0 0;\r\n\tbottom: -9px;\r\n\tleft: -7px;\r\n\twidth: 13px;\r\n\theight: 16px;\r\n}\r\n\r\n.bord_img  .l {\r\n\tbackground: url('/admin/images/bord_img_l.gif') repeat-y 0 0;\r\n\ttop: 0px;\r\n\tleft: -7px;\r\n\twidth: 7px;\r\n}\r\n\r\n.bord_img .bottom\r\n{\r\n\tposition: absolute;\r\n\twidth: 100%;\r\n\tbottom: 5px;\r\n}\r\n\r\n.bord_img .bottom span\r\n{\r\n\tcolor: #777777;\r\n\tfont-size: 90%;\r\n\tfont-style: italic;\r\n}\r\n/* /end Templates install */"
          },
          "redirectURL": "",
          "headersSize": 251,
          "bodySize": 6567
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-05-31T09:51:38.000Z",
            "lastAccess": "2012-05-30T09:51:38.000Z",
            "eTag": "",
            "hitCount": 17
          }
        },
        "timings": {
          "blocked": 0,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 5,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:38.785+04:00",
        "time": 5,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/js/codepress/codepress.js",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Thu, 15 Sep 2011 12:16:13 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 711,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Thu, 15 Sep 2011 12:16:13 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Thu, 31 May 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=86400"
            }
          ],
          "content": {
            "mimeType": "application/x-javascript",
            "size": 5403,
            "text": "/*\r\n * CodePress - Real Time Syntax Highlighting Editor written in JavaScript - http://codepress.org/\r\n * \r\n * Copyright (C) 2006 Fernando M.A.d.S. <fermads@gmail.com>\r\n *\r\n * This program is free software; you can redistribute it and/or modify it under the terms of the \r\n * GNU Lesser General Public License as published by the Free Software Foundation.\r\n * \r\n * Read the full licence: http://www.opensource.org/licenses/lgpl-license.php\r\n */\r\n\r\nCodePress = function(obj) {\r\n\tvar self = document.createElement('iframe');\r\n\tself.textarea = obj;\r\n\t\r\n\t// edit Hostmake\r\n\t//self.textarea.disabled = true;\r\n\tself.textarea.style.overflow = 'hidden';\r\n\t\r\n\tif (self.textarea.clientHeight > 0)\r\n\t{\r\n\t\tself.style.height = self.textarea.clientHeight +'px';\r\n\t}\r\n\telse\r\n\t{\r\n\t\tself.style.height = self.textarea.style.height;\r\n\t}\r\n\t\r\n\tif (self.textarea.clientWidth > 0)\r\n\t{\r\n\t\tself.style.width = self.textarea.clientWidth +'px';\r\n\t}\r\n\telse\r\n\t{\r\n\t\tself.style.width = self.textarea.style.width;\r\n\t}\r\n\t\r\n\tself.textarea.style.overflow = 'auto';\r\n\tself.style.border = '1px solid gray';\r\n\tself.frameBorder = 0; // remove IE internal iframe border\r\n\tself.style.visibility = 'hidden';\r\n\tself.style.position = 'absolute';\r\n\tself.options = self.textarea.className;\r\n\t\r\n\tself.initialize = function() {\r\n\t\tself.editor = self.contentWindow.CodePress;\r\n\t\tself.editor.body = self.contentWindow.document.getElementsByTagName('body')[0];\r\n\t\tself.editor.setCode(self.textarea.value);\r\n\t\tself.setOptions();\r\n\t\tself.editor.syntaxHighlight('init');\r\n\t\tself.textarea.style.display = 'none';\r\n\t\tself.style.position = 'static';\r\n\t\tself.style.visibility = 'visible';\r\n\t\tself.style.display = 'inline';\r\n\t}\r\n\t\r\n\t// obj can by a textarea id or a string (code)\r\n\tself.edit = function(obj,language) {\r\n\t\tif(obj) self.textarea.value = document.getElementById(obj) ? document.getElementById(obj).value : obj;\r\n\t\t\r\n\t\t// edit Hostmake\r\n\t\t//if(!self.textarea.disabled) return;\r\n\t\t\r\n\t\tself.language = language ? language : self.getLanguage();\r\n\t\tself.src = CodePress.path+'codepress.html?language='+self.language+'&ts='+(new Date).getTime();\r\n\t\tif(self.attachEvent) self.attachEvent('onload',self.initialize);\r\n\t\telse self.addEventListener('load',self.initialize,false);\r\n\t}\r\n\r\n\tself.getLanguage = function() {\r\n\t\tfor (language in CodePress.languages) \r\n\t\t\tif(self.options.match('\\\\b'+language+'\\\\b')) \r\n\t\t\t\treturn CodePress.languages[language] ? language : 'generic';\r\n\t}\r\n\t\r\n\tself.setOptions = function() {\r\n\t\tif(self.options.match('autocomplete-off')) self.toggleAutoComplete();\r\n\t\tif(self.options.match('readonly-on')) self.toggleReadOnly();\r\n\t\tif(self.options.match('linenumbers-off')) self.toggleLineNumbers();\r\n\t}\r\n\t\r\n\tself.getCode = function() {\r\n\t\t// edit Hostmake\r\n\t\t//return self.textarea.disabled ? self.editor.getCode() : self.textarea.value;\r\n\t\treturn self.editor.getCode();\r\n\t}\r\n\r\n\tself.setCode = function(code) {\r\n\t\t// edit Hostmake\r\n\t\t//self.textarea.disabled ? self.editor.setCode(code) : self.textarea.value = code;\r\n\t\tself.editor.setCode(code);\r\n\t}\r\n\r\n\tself.toggleAutoComplete = function() {\r\n\t\tself.editor.autocomplete = (self.editor.autocomplete) ? false : true;\r\n\t}\r\n\t\r\n\tself.toggleReadOnly = function() {\r\n\t\tself.textarea.readOnly = (self.textarea.readOnly) ? false : true;\r\n\t\tif(self.style.display != 'none') // prevent exception on FF + iframe with display:none\r\n\t\t\tself.editor.readOnly(self.textarea.readOnly ? true : false);\r\n\t}\r\n\t\r\n\tself.toggleLineNumbers = function() {\r\n\t\tvar cn = self.editor.body.className;\r\n\t\tself.editor.body.className = (cn==''||cn=='show-line-numbers') ? 'hide-line-numbers' : 'show-line-numbers';\r\n\t}\r\n\t\r\n\tself.toggleEditor = function() {\r\n\t\t\r\n\t\t// edit Hostmake\r\n\t\t/*\r\n\t\tif(self.textarea.disabled) {\r\n\t\t\tself.textarea.value = self.getCode();\r\n\t\t\tself.textarea.disabled = false;\r\n\t\t\tself.style.display = 'none';\r\n\t\t\tself.textarea.style.display = 'inline';\r\n\t\t}\r\n\t\telse {\r\n\t\t\tself.textarea.disabled = true;\r\n\t\t\tself.setCode(self.textarea.value);\r\n\t\t\tself.editor.syntaxHighlight('init');\r\n\t\t\tself.style.display = 'inline';\r\n\t\t\tself.textarea.style.display = 'none';\r\n\t\t}*/\r\n\t\t\r\n\t\t// add Hostmake\r\n\t\tself.textarea.value = self.getCode();\r\n\t\t//self.textarea.disabled = false;\r\n\t\tself.style.display = 'none';\r\n\t\tself.textarea.style.display = 'inline';\r\n\t\t\r\n\t}\r\n\r\n\tself.edit();\r\n\treturn self;\r\n}\r\n\r\nCodePress.languages = {\t\r\n\tcsharp : 'C#', \r\n\tcss : 'CSS', \r\n\tgeneric : 'Generic',\r\n\thtml : 'HTML',\r\n\tjava : 'Java', \r\n\tjavascript : 'JavaScript', \r\n\tperl : 'Perl', \r\n\truby : 'Ruby',\t\r\n\tphp : 'PHP', \r\n\ttext : 'Text', \r\n\tsql : 'SQL',\r\n\txsl : 'XSL',\r\n\tvbscript : 'VBScript'\r\n}\r\n\r\n\r\nCodePress.run = function() {\r\n\tvar ua = navigator.userAgent;\r\n\r\n\t// add Hostmake\r\n\tif(ua.match('MSIE') || (ua.match('Gecko') && !ua.match('Chrome') && !ua.match('Safari')))\r\n\t{\r\n\t\ts = document.getElementsByTagName('script');\r\n\t\tfor(var i=0,n=s.length;i<n;i++) {\r\n\t\t\tif(s[i].src.match('codepress.js')) {\r\n\t\t\t\tCodePress.path = s[i].src.replace('codepress.js','');\r\n\t\t\t}\r\n\t\t}\r\n\t\tt = document.getElementsByTagName('textarea');\r\n\t\tfor(var i=0,n=t.length; i<n; i++) {\r\n\t\t\tif(t[i].className.match('codepress')) {\r\n\t\t\t\tid = t[i].id;\r\n\t\t\t\tt[i].id = id+'_cp';\r\n\t\t\t\teval(id+' = new CodePress(t[i])');\r\n\t\t\t\tt[i].parentNode.insertBefore(eval(id), t[i]);\r\n\t\t\t} \r\n\t\t}\r\n\t}\r\n}\r\n\r\n// remove Hostmake\r\n//if(window.attachEvent) window.attachEvent('onload',CodePress.run);\r\n//else window.addEventListener('DOMContentLoaded',CodePress.run,false);\r\n"
          },
          "redirectURL": "",
          "headersSize": 251,
          "bodySize": 1804
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-05-31T09:51:38.000Z",
            "lastAccess": "2012-05-30T09:51:38.000Z",
            "eTag": "",
            "hitCount": 18
          }
        },
        "timings": {
          "blocked": 0,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 5,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:38.785+04:00",
        "time": 5,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/js/jquery/jquery.js",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Thu, 15 Sep 2011 12:16:13 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 705,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Thu, 15 Sep 2011 12:16:13 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Thu, 31 May 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=86400"
            }
          ],
          "content": {
            "mimeType": "application/x-javascript",
            "size": 78601,
            "text": "/*!\n * jQuery JavaScript Library v1.4.4\n * http://jquery.com/\n *\n * Copyright 2010, John Resig\n * Dual licensed under the MIT or GPL Version 2 licenses.\n * http://jquery.org/license\n *\n * Includes Sizzle.js\n * http://sizzlejs.com/\n * Copyright 2010, The Dojo Foundation\n * Released under the MIT, BSD, and GPL Licenses.\n *\n * Date: Thu Nov 11 19:04:53 2010 -0500\n */\n(function(E,B){function ka(a,b,d){if(d===B&&a.nodeType===1){d=a.getAttribute(\"data-\"+b);if(typeof d===\"string\"){try{d=d===\"true\"?true:d===\"false\"?false:d===\"null\"?null:!c.isNaN(d)?parseFloat(d):Ja.test(d)?c.parseJSON(d):d}catch(e){}c.data(a,b,d)}else d=B}return d}function U(){return false}function ca(){return true}function la(a,b,d){d[0].type=a;return c.event.handle.apply(b,d)}function Ka(a){var b,d,e,f,h,l,k,o,x,r,A,C=[];f=[];h=c.data(this,this.nodeType?\"events\":\"__events__\");if(typeof h===\"function\")h=\nh.events;if(!(a.liveFired===this||!h||!h.live||a.button&&a.type===\"click\")){if(a.namespace)A=RegExp(\"(^|\\\\.)\"+a.namespace.split(\".\").join(\"\\\\.(?:.*\\\\.)?\")+\"(\\\\.|$)\");a.liveFired=this;var J=h.live.slice(0);for(k=0;k<J.length;k++){h=J[k];h.origType.replace(X,\"\")===a.type?f.push(h.selector):J.splice(k--,1)}f=c(a.target).closest(f,a.currentTarget);o=0;for(x=f.length;o<x;o++){r=f[o];for(k=0;k<J.length;k++){h=J[k];if(r.selector===h.selector&&(!A||A.test(h.namespace))){l=r.elem;e=null;if(h.preType===\"mouseenter\"||\nh.preType===\"mouseleave\"){a.type=h.preType;e=c(a.relatedTarget).closest(h.selector)[0]}if(!e||e!==l)C.push({elem:l,handleObj:h,level:r.level})}}}o=0;for(x=C.length;o<x;o++){f=C[o];if(d&&f.level>d)break;a.currentTarget=f.elem;a.data=f.handleObj.data;a.handleObj=f.handleObj;A=f.handleObj.origHandler.apply(f.elem,arguments);if(A===false||a.isPropagationStopped()){d=f.level;if(A===false)b=false;if(a.isImmediatePropagationStopped())break}}return b}}function Y(a,b){return(a&&a!==\"*\"?a+\".\":\"\")+b.replace(La,\n\"`\").replace(Ma,\"&\")}function ma(a,b,d){if(c.isFunction(b))return c.grep(a,function(f,h){return!!b.call(f,h,f)===d});else if(b.nodeType)return c.grep(a,function(f){return f===b===d});else if(typeof b===\"string\"){var e=c.grep(a,function(f){return f.nodeType===1});if(Na.test(b))return c.filter(b,e,!d);else b=c.filter(b,e)}return c.grep(a,function(f){return c.inArray(f,b)>=0===d})}function na(a,b){var d=0;b.each(function(){if(this.nodeName===(a[d]&&a[d].nodeName)){var e=c.data(a[d++]),f=c.data(this,\ne);if(e=e&&e.events){delete f.handle;f.events={};for(var h in e)for(var l in e[h])c.event.add(this,h,e[h][l],e[h][l].data)}}})}function Oa(a,b){b.src?c.ajax({url:b.src,async:false,dataType:\"script\"}):c.globalEval(b.text||b.textContent||b.innerHTML||\"\");b.parentNode&&b.parentNode.removeChild(b)}function oa(a,b,d){var e=b===\"width\"?a.offsetWidth:a.offsetHeight;if(d===\"border\")return e;c.each(b===\"width\"?Pa:Qa,function(){d||(e-=parseFloat(c.css(a,\"padding\"+this))||0);if(d===\"margin\")e+=parseFloat(c.css(a,\n\"margin\"+this))||0;else e-=parseFloat(c.css(a,\"border\"+this+\"Width\"))||0});return e}function da(a,b,d,e){if(c.isArray(b)&&b.length)c.each(b,function(f,h){d||Ra.test(a)?e(a,h):da(a+\"[\"+(typeof h===\"object\"||c.isArray(h)?f:\"\")+\"]\",h,d,e)});else if(!d&&b!=null&&typeof b===\"object\")c.isEmptyObject(b)?e(a,\"\"):c.each(b,function(f,h){da(a+\"[\"+f+\"]\",h,d,e)});else e(a,b)}function S(a,b){var d={};c.each(pa.concat.apply([],pa.slice(0,b)),function(){d[this]=a});return d}function qa(a){if(!ea[a]){var b=c(\"<\"+\na+\">\").appendTo(\"body\"),d=b.css(\"display\");b.remove();if(d===\"none\"||d===\"\")d=\"block\";ea[a]=d}return ea[a]}function fa(a){return c.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:false}var t=E.document,c=function(){function a(){if(!b.isReady){try{t.documentElement.doScroll(\"left\")}catch(j){setTimeout(a,1);return}b.ready()}}var b=function(j,s){return new b.fn.init(j,s)},d=E.jQuery,e=E.$,f,h=/^(?:[^<]*(<[\\w\\W]+>)[^>]*$|#([\\w\\-]+)$)/,l=/\\S/,k=/^\\s+/,o=/\\s+$/,x=/\\W/,r=/\\d/,A=/^<(\\w+)\\s*\\/?>(?:<\\/\\1>)?$/,\nC=/^[\\],:{}\\s]*$/,J=/\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g,w=/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g,I=/(?:^|:|,)(?:\\s*\\[)+/g,L=/(webkit)[ \\/]([\\w.]+)/,g=/(opera)(?:.*version)?[ \\/]([\\w.]+)/,i=/(msie) ([\\w.]+)/,n=/(mozilla)(?:.*? rv:([\\w.]+))?/,m=navigator.userAgent,p=false,q=[],u,y=Object.prototype.toString,F=Object.prototype.hasOwnProperty,M=Array.prototype.push,N=Array.prototype.slice,O=String.prototype.trim,D=Array.prototype.indexOf,R={};b.fn=b.prototype={init:function(j,\ns){var v,z,H;if(!j)return this;if(j.nodeType){this.context=this[0]=j;this.length=1;return this}if(j===\"body\"&&!s&&t.body){this.context=t;this[0]=t.body;this.selector=\"body\";this.length=1;return this}if(typeof j===\"string\")if((v=h.exec(j))&&(v[1]||!s))if(v[1]){H=s?s.ownerDocument||s:t;if(z=A.exec(j))if(b.isPlainObject(s)){j=[t.createElement(z[1])];b.fn.attr.call(j,s,true)}else j=[H.createElement(z[1])];else{z=b.buildFragment([v[1]],[H]);j=(z.cacheable?z.fragment.cloneNode(true):z.fragment).childNodes}return b.merge(this,\nj)}else{if((z=t.getElementById(v[2]))&&z.parentNode){if(z.id!==v[2])return f.find(j);this.length=1;this[0]=z}this.context=t;this.selector=j;return this}else if(!s&&!x.test(j)){this.selector=j;this.context=t;j=t.getElementsByTagName(j);return b.merge(this,j)}else return!s||s.jquery?(s||f).find(j):b(s).find(j);else if(b.isFunction(j))return f.ready(j);if(j.selector!==B){this.selector=j.selector;this.context=j.context}return b.makeArray(j,this)},selector:\"\",jquery:\"1.4.4\",length:0,size:function(){return this.length},\ntoArray:function(){return N.call(this,0)},get:function(j){return j==null?this.toArray():j<0?this.slice(j)[0]:this[j]},pushStack:function(j,s,v){var z=b();b.isArray(j)?M.apply(z,j):b.merge(z,j);z.prevObject=this;z.context=this.context;if(s===\"find\")z.selector=this.selector+(this.selector?\" \":\"\")+v;else if(s)z.selector=this.selector+\".\"+s+\"(\"+v+\")\";return z},each:function(j,s){return b.each(this,j,s)},ready:function(j){b.bindReady();if(b.isReady)j.call(t,b);else q&&q.push(j);return this},eq:function(j){return j===\n-1?this.slice(j):this.slice(j,+j+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(N.apply(this,arguments),\"slice\",N.call(arguments).join(\",\"))},map:function(j){return this.pushStack(b.map(this,function(s,v){return j.call(s,v,s)}))},end:function(){return this.prevObject||b(null)},push:M,sort:[].sort,splice:[].splice};b.fn.init.prototype=b.fn;b.extend=b.fn.extend=function(){var j,s,v,z,H,G=arguments[0]||{},K=1,Q=arguments.length,ga=false;\nif(typeof G===\"boolean\"){ga=G;G=arguments[1]||{};K=2}if(typeof G!==\"object\"&&!b.isFunction(G))G={};if(Q===K){G=this;--K}for(;K<Q;K++)if((j=arguments[K])!=null)for(s in j){v=G[s];z=j[s];if(G!==z)if(ga&&z&&(b.isPlainObject(z)||(H=b.isArray(z)))){if(H){H=false;v=v&&b.isArray(v)?v:[]}else v=v&&b.isPlainObject(v)?v:{};G[s]=b.extend(ga,v,z)}else if(z!==B)G[s]=z}return G};b.extend({noConflict:function(j){E.$=e;if(j)E.jQuery=d;return b},isReady:false,readyWait:1,ready:function(j){j===true&&b.readyWait--;\nif(!b.readyWait||j!==true&&!b.isReady){if(!t.body)return setTimeout(b.ready,1);b.isReady=true;if(!(j!==true&&--b.readyWait>0))if(q){var s=0,v=q;for(q=null;j=v[s++];)j.call(t,b);b.fn.trigger&&b(t).trigger(\"ready\").unbind(\"ready\")}}},bindReady:function(){if(!p){p=true;if(t.readyState===\"complete\")return setTimeout(b.ready,1);if(t.addEventListener){t.addEventListener(\"DOMContentLoaded\",u,false);E.addEventListener(\"load\",b.ready,false)}else if(t.attachEvent){t.attachEvent(\"onreadystatechange\",u);E.attachEvent(\"onload\",\nb.ready);var j=false;try{j=E.frameElement==null}catch(s){}t.documentElement.doScroll&&j&&a()}}},isFunction:function(j){return b.type(j)===\"function\"},isArray:Array.isArray||function(j){return b.type(j)===\"array\"},isWindow:function(j){return j&&typeof j===\"object\"&&\"setInterval\"in j},isNaN:function(j){return j==null||!r.test(j)||isNaN(j)},type:function(j){return j==null?String(j):R[y.call(j)]||\"object\"},isPlainObject:function(j){if(!j||b.type(j)!==\"object\"||j.nodeType||b.isWindow(j))return false;if(j.constructor&&\n!F.call(j,\"constructor\")&&!F.call(j.constructor.prototype,\"isPrototypeOf\"))return false;for(var s in j);return s===B||F.call(j,s)},isEmptyObject:function(j){for(var s in j)return false;return true},error:function(j){throw j;},parseJSON:function(j){if(typeof j!==\"string\"||!j)return null;j=b.trim(j);if(C.test(j.replace(J,\"@\").replace(w,\"]\").replace(I,\"\")))return E.JSON&&E.JSON.parse?E.JSON.parse(j):(new Function(\"return \"+j))();else b.error(\"Invalid JSON: \"+j)},noop:function(){},globalEval:function(j){if(j&&\nl.test(j)){var s=t.getElementsByTagName(\"head\")[0]||t.documentElement,v=t.createElement(\"script\");v.type=\"text/javascript\";if(b.support.scriptEval)v.appendChild(t.createTextNode(j));else v.text=j;s.insertBefore(v,s.firstChild);s.removeChild(v)}},nodeName:function(j,s){return j.nodeName&&j.nodeName.toUpperCase()===s.toUpperCase()},each:function(j,s,v){var z,H=0,G=j.length,K=G===B||b.isFunction(j);if(v)if(K)for(z in j){if(s.apply(j[z],v)===false)break}else for(;H<G;){if(s.apply(j[H++],v)===false)break}else if(K)for(z in j){if(s.call(j[z],\nz,j[z])===false)break}else for(v=j[0];H<G&&s.call(v,H,v)!==false;v=j[++H]);return j},trim:O?function(j){return j==null?\"\":O.call(j)}:function(j){return j==null?\"\":j.toString().replace(k,\"\").replace(o,\"\")},makeArray:function(j,s){var v=s||[];if(j!=null){var z=b.type(j);j.length==null||z===\"string\"||z===\"function\"||z===\"regexp\"||b.isWindow(j)?M.call(v,j):b.merge(v,j)}return v},inArray:function(j,s){if(s.indexOf)return s.indexOf(j);for(var v=0,z=s.length;v<z;v++)if(s[v]===j)return v;return-1},merge:function(j,\ns){var v=j.length,z=0;if(typeof s.length===\"number\")for(var H=s.length;z<H;z++)j[v++]=s[z];else for(;s[z]!==B;)j[v++]=s[z++];j.length=v;return j},grep:function(j,s,v){var z=[],H;v=!!v;for(var G=0,K=j.length;G<K;G++){H=!!s(j[G],G);v!==H&&z.push(j[G])}return z},map:function(j,s,v){for(var z=[],H,G=0,K=j.length;G<K;G++){H=s(j[G],G,v);if(H!=null)z[z.length]=H}return z.concat.apply([],z)},guid:1,proxy:function(j,s,v){if(arguments.length===2)if(typeof s===\"string\"){v=j;j=v[s];s=B}else if(s&&!b.isFunction(s)){v=\ns;s=B}if(!s&&j)s=function(){return j.apply(v||this,arguments)};if(j)s.guid=j.guid=j.guid||s.guid||b.guid++;return s},access:function(j,s,v,z,H,G){var K=j.length;if(typeof s===\"object\"){for(var Q in s)b.access(j,Q,s[Q],z,H,v);return j}if(v!==B){z=!G&&z&&b.isFunction(v);for(Q=0;Q<K;Q++)H(j[Q],s,z?v.call(j[Q],Q,H(j[Q],s)):v,G);return j}return K?H(j[0],s):B},now:function(){return(new Date).getTime()},uaMatch:function(j){j=j.toLowerCase();j=L.exec(j)||g.exec(j)||i.exec(j)||j.indexOf(\"compatible\")<0&&n.exec(j)||\n[];return{browser:j[1]||\"\",version:j[2]||\"0\"}},browser:{}});b.each(\"Boolean Number String Function Array Date RegExp Object\".split(\" \"),function(j,s){R[\"[object \"+s+\"]\"]=s.toLowerCase()});m=b.uaMatch(m);if(m.browser){b.browser[m.browser]=true;b.browser.version=m.version}if(b.browser.webkit)b.browser.safari=true;if(D)b.inArray=function(j,s){return D.call(s,j)};if(!/\\s/.test(\"\\u00a0\")){k=/^[\\s\\xA0]+/;o=/[\\s\\xA0]+$/}f=b(t);if(t.addEventListener)u=function(){t.removeEventListener(\"DOMContentLoaded\",u,\nfalse);b.ready()};else if(t.attachEvent)u=function(){if(t.readyState===\"complete\"){t.detachEvent(\"onreadystatechange\",u);b.ready()}};return E.jQuery=E.$=b}();(function(){c.support={};var a=t.documentElement,b=t.createElement(\"script\"),d=t.createElement(\"div\"),e=\"script\"+c.now();d.style.display=\"none\";d.innerHTML=\"   <link/><table></table><a href='/a' style='color:red;float:left;opacity:.55;'>a</a><input type='checkbox'/>\";var f=d.getElementsByTagName(\"*\"),h=d.getElementsByTagName(\"a\")[0],l=t.createElement(\"select\"),\nk=l.appendChild(t.createElement(\"option\"));if(!(!f||!f.length||!h)){c.support={leadingWhitespace:d.firstChild.nodeType===3,tbody:!d.getElementsByTagName(\"tbody\").length,htmlSerialize:!!d.getElementsByTagName(\"link\").length,style:/red/.test(h.getAttribute(\"style\")),hrefNormalized:h.getAttribute(\"href\")===\"/a\",opacity:/^0.55$/.test(h.style.opacity),cssFloat:!!h.style.cssFloat,checkOn:d.getElementsByTagName(\"input\")[0].value===\"on\",optSelected:k.selected,deleteExpando:true,optDisabled:false,checkClone:false,\nscriptEval:false,noCloneEvent:true,boxModel:null,inlineBlockNeedsLayout:false,shrinkWrapBlocks:false,reliableHiddenOffsets:true};l.disabled=true;c.support.optDisabled=!k.disabled;b.type=\"text/javascript\";try{b.appendChild(t.createTextNode(\"window.\"+e+\"=1;\"))}catch(o){}a.insertBefore(b,a.firstChild);if(E[e]){c.support.scriptEval=true;delete E[e]}try{delete b.test}catch(x){c.support.deleteExpando=false}a.removeChild(b);if(d.attachEvent&&d.fireEvent){d.attachEvent(\"onclick\",function r(){c.support.noCloneEvent=\nfalse;d.detachEvent(\"onclick\",r)});d.cloneNode(true).fireEvent(\"onclick\")}d=t.createElement(\"div\");d.innerHTML=\"<input type='radio' name='radiotest' checked='checked'/>\";a=t.createDocumentFragment();a.appendChild(d.firstChild);c.support.checkClone=a.cloneNode(true).cloneNode(true).lastChild.checked;c(function(){var r=t.createElement(\"div\");r.style.width=r.style.paddingLeft=\"1px\";t.body.appendChild(r);c.boxModel=c.support.boxModel=r.offsetWidth===2;if(\"zoom\"in r.style){r.style.display=\"inline\";r.style.zoom=\n1;c.support.inlineBlockNeedsLayout=r.offsetWidth===2;r.style.display=\"\";r.innerHTML=\"<div style='width:4px;'></div>\";c.support.shrinkWrapBlocks=r.offsetWidth!==2}r.innerHTML=\"<table><tr><td style='padding:0;display:none'></td><td>t</td></tr></table>\";var A=r.getElementsByTagName(\"td\");c.support.reliableHiddenOffsets=A[0].offsetHeight===0;A[0].style.display=\"\";A[1].style.display=\"none\";c.support.reliableHiddenOffsets=c.support.reliableHiddenOffsets&&A[0].offsetHeight===0;r.innerHTML=\"\";t.body.removeChild(r).style.display=\n\"none\"});a=function(r){var A=t.createElement(\"div\");r=\"on\"+r;var C=r in A;if(!C){A.setAttribute(r,\"return;\");C=typeof A[r]===\"function\"}return C};c.support.submitBubbles=a(\"submit\");c.support.changeBubbles=a(\"change\");a=b=d=f=h=null}})();var ra={},Ja=/^(?:\\{.*\\}|\\[.*\\])$/;c.extend({cache:{},uuid:0,expando:\"jQuery\"+c.now(),noData:{embed:true,object:\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\",applet:true},data:function(a,b,d){if(c.acceptData(a)){a=a==E?ra:a;var e=a.nodeType,f=e?a[c.expando]:null,h=\nc.cache;if(!(e&&!f&&typeof b===\"string\"&&d===B)){if(e)f||(a[c.expando]=f=++c.uuid);else h=a;if(typeof b===\"object\")if(e)h[f]=c.extend(h[f],b);else c.extend(h,b);else if(e&&!h[f])h[f]={};a=e?h[f]:h;if(d!==B)a[b]=d;return typeof b===\"string\"?a[b]:a}}},removeData:function(a,b){if(c.acceptData(a)){a=a==E?ra:a;var d=a.nodeType,e=d?a[c.expando]:a,f=c.cache,h=d?f[e]:e;if(b){if(h){delete h[b];d&&c.isEmptyObject(h)&&c.removeData(a)}}else if(d&&c.support.deleteExpando)delete a[c.expando];else if(a.removeAttribute)a.removeAttribute(c.expando);\nelse if(d)delete f[e];else for(var l in a)delete a[l]}},acceptData:function(a){if(a.nodeName){var b=c.noData[a.nodeName.toLowerCase()];if(b)return!(b===true||a.getAttribute(\"classid\")!==b)}return true}});c.fn.extend({data:function(a,b){var d=null;if(typeof a===\"undefined\"){if(this.length){var e=this[0].attributes,f;d=c.data(this[0]);for(var h=0,l=e.length;h<l;h++){f=e[h].name;if(f.indexOf(\"data-\")===0){f=f.substr(5);ka(this[0],f,d[f])}}}return d}else if(typeof a===\"object\")return this.each(function(){c.data(this,\na)});var k=a.split(\".\");k[1]=k[1]?\".\"+k[1]:\"\";if(b===B){d=this.triggerHandler(\"getData\"+k[1]+\"!\",[k[0]]);if(d===B&&this.length){d=c.data(this[0],a);d=ka(this[0],a,d)}return d===B&&k[1]?this.data(k[0]):d}else return this.each(function(){var o=c(this),x=[k[0],b];o.triggerHandler(\"setData\"+k[1]+\"!\",x);c.data(this,a,b);o.triggerHandler(\"changeData\"+k[1]+\"!\",x)})},removeData:function(a){return this.each(function(){c.removeData(this,a)})}});c.extend({queue:function(a,b,d){if(a){b=(b||\"fx\")+\"queue\";var e=\nc.data(a,b);if(!d)return e||[];if(!e||c.isArray(d))e=c.data(a,b,c.makeArray(d));else e.push(d);return e}},dequeue:function(a,b){b=b||\"fx\";var d=c.queue(a,b),e=d.shift();if(e===\"inprogress\")e=d.shift();if(e){b===\"fx\"&&d.unshift(\"inprogress\");e.call(a,function(){c.dequeue(a,b)})}}});c.fn.extend({queue:function(a,b){if(typeof a!==\"string\"){b=a;a=\"fx\"}if(b===B)return c.queue(this[0],a);return this.each(function(){var d=c.queue(this,a,b);a===\"fx\"&&d[0]!==\"inprogress\"&&c.dequeue(this,a)})},dequeue:function(a){return this.each(function(){c.dequeue(this,\na)})},delay:function(a,b){a=c.fx?c.fx.speeds[a]||a:a;b=b||\"fx\";return this.queue(b,function(){var d=this;setTimeout(function(){c.dequeue(d,b)},a)})},clearQueue:function(a){return this.queue(a||\"fx\",[])}});var sa=/[\\n\\t]/g,ha=/\\s+/,Sa=/\\r/g,Ta=/^(?:href|src|style)$/,Ua=/^(?:button|input)$/i,Va=/^(?:button|input|object|select|textarea)$/i,Wa=/^a(?:rea)?$/i,ta=/^(?:radio|checkbox)$/i;c.props={\"for\":\"htmlFor\",\"class\":\"className\",readonly:\"readOnly\",maxlength:\"maxLength\",cellspacing:\"cellSpacing\",rowspan:\"rowSpan\",\ncolspan:\"colSpan\",tabindex:\"tabIndex\",usemap:\"useMap\",frameborder:\"frameBorder\"};c.fn.extend({attr:function(a,b){return c.access(this,a,b,true,c.attr)},removeAttr:function(a){return this.each(function(){c.attr(this,a,\"\");this.nodeType===1&&this.removeAttribute(a)})},addClass:function(a){if(c.isFunction(a))return this.each(function(x){var r=c(this);r.addClass(a.call(this,x,r.attr(\"class\")))});if(a&&typeof a===\"string\")for(var b=(a||\"\").split(ha),d=0,e=this.length;d<e;d++){var f=this[d];if(f.nodeType===\n1)if(f.className){for(var h=\" \"+f.className+\" \",l=f.className,k=0,o=b.length;k<o;k++)if(h.indexOf(\" \"+b[k]+\" \")<0)l+=\" \"+b[k];f.className=c.trim(l)}else f.className=a}return this},removeClass:function(a){if(c.isFunction(a))return this.each(function(o){var x=c(this);x.removeClass(a.call(this,o,x.attr(\"class\")))});if(a&&typeof a===\"string\"||a===B)for(var b=(a||\"\").split(ha),d=0,e=this.length;d<e;d++){var f=this[d];if(f.nodeType===1&&f.className)if(a){for(var h=(\" \"+f.className+\" \").replace(sa,\" \"),\nl=0,k=b.length;l<k;l++)h=h.replace(\" \"+b[l]+\" \",\" \");f.className=c.trim(h)}else f.className=\"\"}return this},toggleClass:function(a,b){var d=typeof a,e=typeof b===\"boolean\";if(c.isFunction(a))return this.each(function(f){var h=c(this);h.toggleClass(a.call(this,f,h.attr(\"class\"),b),b)});return this.each(function(){if(d===\"string\")for(var f,h=0,l=c(this),k=b,o=a.split(ha);f=o[h++];){k=e?k:!l.hasClass(f);l[k?\"addClass\":\"removeClass\"](f)}else if(d===\"undefined\"||d===\"boolean\"){this.className&&c.data(this,\n\"__className__\",this.className);this.className=this.className||a===false?\"\":c.data(this,\"__className__\")||\"\"}})},hasClass:function(a){a=\" \"+a+\" \";for(var b=0,d=this.length;b<d;b++)if((\" \"+this[b].className+\" \").replace(sa,\" \").indexOf(a)>-1)return true;return false},val:function(a){if(!arguments.length){var b=this[0];if(b){if(c.nodeName(b,\"option\")){var d=b.attributes.value;return!d||d.specified?b.value:b.text}if(c.nodeName(b,\"select\")){var e=b.selectedIndex;d=[];var f=b.options;b=b.type===\"select-one\";\nif(e<0)return null;var h=b?e:0;for(e=b?e+1:f.length;h<e;h++){var l=f[h];if(l.selected&&(c.support.optDisabled?!l.disabled:l.getAttribute(\"disabled\")===null)&&(!l.parentNode.disabled||!c.nodeName(l.parentNode,\"optgroup\"))){a=c(l).val();if(b)return a;d.push(a)}}return d}if(ta.test(b.type)&&!c.support.checkOn)return b.getAttribute(\"value\")===null?\"on\":b.value;return(b.value||\"\").replace(Sa,\"\")}return B}var k=c.isFunction(a);return this.each(function(o){var x=c(this),r=a;if(this.nodeType===1){if(k)r=\na.call(this,o,x.val());if(r==null)r=\"\";else if(typeof r===\"number\")r+=\"\";else if(c.isArray(r))r=c.map(r,function(C){return C==null?\"\":C+\"\"});if(c.isArray(r)&&ta.test(this.type))this.checked=c.inArray(x.val(),r)>=0;else if(c.nodeName(this,\"select\")){var A=c.makeArray(r);c(\"option\",this).each(function(){this.selected=c.inArray(c(this).val(),A)>=0});if(!A.length)this.selectedIndex=-1}else this.value=r}})}});c.extend({attrFn:{val:true,css:true,html:true,text:true,data:true,width:true,height:true,offset:true},\nattr:function(a,b,d,e){if(!a||a.nodeType===3||a.nodeType===8)return B;if(e&&b in c.attrFn)return c(a)[b](d);e=a.nodeType!==1||!c.isXMLDoc(a);var f=d!==B;b=e&&c.props[b]||b;var h=Ta.test(b);if((b in a||a[b]!==B)&&e&&!h){if(f){b===\"type\"&&Ua.test(a.nodeName)&&a.parentNode&&c.error(\"type property can't be changed\");if(d===null)a.nodeType===1&&a.removeAttribute(b);else a[b]=d}if(c.nodeName(a,\"form\")&&a.getAttributeNode(b))return a.getAttributeNode(b).nodeValue;if(b===\"tabIndex\")return(b=a.getAttributeNode(\"tabIndex\"))&&\nb.specified?b.value:Va.test(a.nodeName)||Wa.test(a.nodeName)&&a.href?0:B;return a[b]}if(!c.support.style&&e&&b===\"style\"){if(f)a.style.cssText=\"\"+d;return a.style.cssText}f&&a.setAttribute(b,\"\"+d);if(!a.attributes[b]&&a.hasAttribute&&!a.hasAttribute(b))return B;a=!c.support.hrefNormalized&&e&&h?a.getAttribute(b,2):a.getAttribute(b);return a===null?B:a}});var X=/\\.(.*)$/,ia=/^(?:textarea|input|select)$/i,La=/\\./g,Ma=/ /g,Xa=/[^\\w\\s.|`]/g,Ya=function(a){return a.replace(Xa,\"\\\\$&\")},ua={focusin:0,focusout:0};\nc.event={add:function(a,b,d,e){if(!(a.nodeType===3||a.nodeType===8)){if(c.isWindow(a)&&a!==E&&!a.frameElement)a=E;if(d===false)d=U;else if(!d)return;var f,h;if(d.handler){f=d;d=f.handler}if(!d.guid)d.guid=c.guid++;if(h=c.data(a)){var l=a.nodeType?\"events\":\"__events__\",k=h[l],o=h.handle;if(typeof k===\"function\"){o=k.handle;k=k.events}else if(!k){a.nodeType||(h[l]=h=function(){});h.events=k={}}if(!o)h.handle=o=function(){return typeof c!==\"undefined\"&&!c.event.triggered?c.event.handle.apply(o.elem,\narguments):B};o.elem=a;b=b.split(\" \");for(var x=0,r;l=b[x++];){h=f?c.extend({},f):{handler:d,data:e};if(l.indexOf(\".\")>-1){r=l.split(\".\");l=r.shift();h.namespace=r.slice(0).sort().join(\".\")}else{r=[];h.namespace=\"\"}h.type=l;if(!h.guid)h.guid=d.guid;var A=k[l],C=c.event.special[l]||{};if(!A){A=k[l]=[];if(!C.setup||C.setup.call(a,e,r,o)===false)if(a.addEventListener)a.addEventListener(l,o,false);else a.attachEvent&&a.attachEvent(\"on\"+l,o)}if(C.add){C.add.call(a,h);if(!h.handler.guid)h.handler.guid=\nd.guid}A.push(h);c.event.global[l]=true}a=null}}},global:{},remove:function(a,b,d,e){if(!(a.nodeType===3||a.nodeType===8)){if(d===false)d=U;var f,h,l=0,k,o,x,r,A,C,J=a.nodeType?\"events\":\"__events__\",w=c.data(a),I=w&&w[J];if(w&&I){if(typeof I===\"function\"){w=I;I=I.events}if(b&&b.type){d=b.handler;b=b.type}if(!b||typeof b===\"string\"&&b.charAt(0)===\".\"){b=b||\"\";for(f in I)c.event.remove(a,f+b)}else{for(b=b.split(\" \");f=b[l++];){r=f;k=f.indexOf(\".\")<0;o=[];if(!k){o=f.split(\".\");f=o.shift();x=RegExp(\"(^|\\\\.)\"+\nc.map(o.slice(0).sort(),Ya).join(\"\\\\.(?:.*\\\\.)?\")+\"(\\\\.|$)\")}if(A=I[f])if(d){r=c.event.special[f]||{};for(h=e||0;h<A.length;h++){C=A[h];if(d.guid===C.guid){if(k||x.test(C.namespace)){e==null&&A.splice(h--,1);r.remove&&r.remove.call(a,C)}if(e!=null)break}}if(A.length===0||e!=null&&A.length===1){if(!r.teardown||r.teardown.call(a,o)===false)c.removeEvent(a,f,w.handle);delete I[f]}}else for(h=0;h<A.length;h++){C=A[h];if(k||x.test(C.namespace)){c.event.remove(a,r,C.handler,h);A.splice(h--,1)}}}if(c.isEmptyObject(I)){if(b=\nw.handle)b.elem=null;delete w.events;delete w.handle;if(typeof w===\"function\")c.removeData(a,J);else c.isEmptyObject(w)&&c.removeData(a)}}}}},trigger:function(a,b,d,e){var f=a.type||a;if(!e){a=typeof a===\"object\"?a[c.expando]?a:c.extend(c.Event(f),a):c.Event(f);if(f.indexOf(\"!\")>=0){a.type=f=f.slice(0,-1);a.exclusive=true}if(!d){a.stopPropagation();c.event.global[f]&&c.each(c.cache,function(){this.events&&this.events[f]&&c.event.trigger(a,b,this.handle.elem)})}if(!d||d.nodeType===3||d.nodeType===\n8)return B;a.result=B;a.target=d;b=c.makeArray(b);b.unshift(a)}a.currentTarget=d;(e=d.nodeType?c.data(d,\"handle\"):(c.data(d,\"__events__\")||{}).handle)&&e.apply(d,b);e=d.parentNode||d.ownerDocument;try{if(!(d&&d.nodeName&&c.noData[d.nodeName.toLowerCase()]))if(d[\"on\"+f]&&d[\"on\"+f].apply(d,b)===false){a.result=false;a.preventDefault()}}catch(h){}if(!a.isPropagationStopped()&&e)c.event.trigger(a,b,e,true);else if(!a.isDefaultPrevented()){var l;e=a.target;var k=f.replace(X,\"\"),o=c.nodeName(e,\"a\")&&k===\n\"click\",x=c.event.special[k]||{};if((!x._default||x._default.call(d,a)===false)&&!o&&!(e&&e.nodeName&&c.noData[e.nodeName.toLowerCase()])){try{if(e[k]){if(l=e[\"on\"+k])e[\"on\"+k]=null;c.event.triggered=true;e[k]()}}catch(r){}if(l)e[\"on\"+k]=l;c.event.triggered=false}}},handle:function(a){var b,d,e,f;d=[];var h=c.makeArray(arguments);a=h[0]=c.event.fix(a||E.event);a.currentTarget=this;b=a.type.indexOf(\".\")<0&&!a.exclusive;if(!b){e=a.type.split(\".\");a.type=e.shift();d=e.slice(0).sort();e=RegExp(\"(^|\\\\.)\"+\nd.join(\"\\\\.(?:.*\\\\.)?\")+\"(\\\\.|$)\")}a.namespace=a.namespace||d.join(\".\");f=c.data(this,this.nodeType?\"events\":\"__events__\");if(typeof f===\"function\")f=f.events;d=(f||{})[a.type];if(f&&d){d=d.slice(0);f=0;for(var l=d.length;f<l;f++){var k=d[f];if(b||e.test(k.namespace)){a.handler=k.handler;a.data=k.data;a.handleObj=k;k=k.handler.apply(this,h);if(k!==B){a.result=k;if(k===false){a.preventDefault();a.stopPropagation()}}if(a.isImmediatePropagationStopped())break}}}return a.result},props:\"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which\".split(\" \"),\nfix:function(a){if(a[c.expando])return a;var b=a;a=c.Event(b);for(var d=this.props.length,e;d;){e=this.props[--d];a[e]=b[e]}if(!a.target)a.target=a.srcElement||t;if(a.target.nodeType===3)a.target=a.target.parentNode;if(!a.relatedTarget&&a.fromElement)a.relatedTarget=a.fromElement===a.target?a.toElement:a.fromElement;if(a.pageX==null&&a.clientX!=null){b=t.documentElement;d=t.body;a.pageX=a.clientX+(b&&b.scrollLeft||d&&d.scrollLeft||0)-(b&&b.clientLeft||d&&d.clientLeft||0);a.pageY=a.clientY+(b&&b.scrollTop||\nd&&d.scrollTop||0)-(b&&b.clientTop||d&&d.clientTop||0)}if(a.which==null&&(a.charCode!=null||a.keyCode!=null))a.which=a.charCode!=null?a.charCode:a.keyCode;if(!a.metaKey&&a.ctrlKey)a.metaKey=a.ctrlKey;if(!a.which&&a.button!==B)a.which=a.button&1?1:a.button&2?3:a.button&4?2:0;return a},guid:1E8,proxy:c.proxy,special:{ready:{setup:c.bindReady,teardown:c.noop},live:{add:function(a){c.event.add(this,Y(a.origType,a.selector),c.extend({},a,{handler:Ka,guid:a.handler.guid}))},remove:function(a){c.event.remove(this,\nY(a.origType,a.selector),a)}},beforeunload:{setup:function(a,b,d){if(c.isWindow(this))this.onbeforeunload=d},teardown:function(a,b){if(this.onbeforeunload===b)this.onbeforeunload=null}}}};c.removeEvent=t.removeEventListener?function(a,b,d){a.removeEventListener&&a.removeEventListener(b,d,false)}:function(a,b,d){a.detachEvent&&a.detachEvent(\"on\"+b,d)};c.Event=function(a){if(!this.preventDefault)return new c.Event(a);if(a&&a.type){this.originalEvent=a;this.type=a.type}else this.type=a;this.timeStamp=\nc.now();this[c.expando]=true};c.Event.prototype={preventDefault:function(){this.isDefaultPrevented=ca;var a=this.originalEvent;if(a)if(a.preventDefault)a.preventDefault();else a.returnValue=false},stopPropagation:function(){this.isPropagationStopped=ca;var a=this.originalEvent;if(a){a.stopPropagation&&a.stopPropagation();a.cancelBubble=true}},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=ca;this.stopPropagation()},isDefaultPrevented:U,isPropagationStopped:U,isImmediatePropagationStopped:U};\nvar va=function(a){var b=a.relatedTarget;try{for(;b&&b!==this;)b=b.parentNode;if(b!==this){a.type=a.data;c.event.handle.apply(this,arguments)}}catch(d){}},wa=function(a){a.type=a.data;c.event.handle.apply(this,arguments)};c.each({mouseenter:\"mouseover\",mouseleave:\"mouseout\"},function(a,b){c.event.special[a]={setup:function(d){c.event.add(this,b,d&&d.selector?wa:va,a)},teardown:function(d){c.event.remove(this,b,d&&d.selector?wa:va)}}});if(!c.support.submitBubbles)c.event.special.submit={setup:function(){if(this.nodeName.toLowerCase()!==\n\"form\"){c.event.add(this,\"click.specialSubmit\",function(a){var b=a.target,d=b.type;if((d===\"submit\"||d===\"image\")&&c(b).closest(\"form\").length){a.liveFired=B;return la(\"submit\",this,arguments)}});c.event.add(this,\"keypress.specialSubmit\",function(a){var b=a.target,d=b.type;if((d===\"text\"||d===\"password\")&&c(b).closest(\"form\").length&&a.keyCode===13){a.liveFired=B;return la(\"submit\",this,arguments)}})}else return false},teardown:function(){c.event.remove(this,\".specialSubmit\")}};if(!c.support.changeBubbles){var V,\nxa=function(a){var b=a.type,d=a.value;if(b===\"radio\"||b===\"checkbox\")d=a.checked;else if(b===\"select-multiple\")d=a.selectedIndex>-1?c.map(a.options,function(e){return e.selected}).join(\"-\"):\"\";else if(a.nodeName.toLowerCase()===\"select\")d=a.selectedIndex;return d},Z=function(a,b){var d=a.target,e,f;if(!(!ia.test(d.nodeName)||d.readOnly)){e=c.data(d,\"_change_data\");f=xa(d);if(a.type!==\"focusout\"||d.type!==\"radio\")c.data(d,\"_change_data\",f);if(!(e===B||f===e))if(e!=null||f){a.type=\"change\";a.liveFired=\nB;return c.event.trigger(a,b,d)}}};c.event.special.change={filters:{focusout:Z,beforedeactivate:Z,click:function(a){var b=a.target,d=b.type;if(d===\"radio\"||d===\"checkbox\"||b.nodeName.toLowerCase()===\"select\")return Z.call(this,a)},keydown:function(a){var b=a.target,d=b.type;if(a.keyCode===13&&b.nodeName.toLowerCase()!==\"textarea\"||a.keyCode===32&&(d===\"checkbox\"||d===\"radio\")||d===\"select-multiple\")return Z.call(this,a)},beforeactivate:function(a){a=a.target;c.data(a,\"_change_data\",xa(a))}},setup:function(){if(this.type===\n\"file\")return false;for(var a in V)c.event.add(this,a+\".specialChange\",V[a]);return ia.test(this.nodeName)},teardown:function(){c.event.remove(this,\".specialChange\");return ia.test(this.nodeName)}};V=c.event.special.change.filters;V.focus=V.beforeactivate}t.addEventListener&&c.each({focus:\"focusin\",blur:\"focusout\"},function(a,b){function d(e){e=c.event.fix(e);e.type=b;return c.event.trigger(e,null,e.target)}c.event.special[b]={setup:function(){ua[b]++===0&&t.addEventListener(a,d,true)},teardown:function(){--ua[b]===\n0&&t.removeEventListener(a,d,true)}}});c.each([\"bind\",\"one\"],function(a,b){c.fn[b]=function(d,e,f){if(typeof d===\"object\"){for(var h in d)this[b](h,e,d[h],f);return this}if(c.isFunction(e)||e===false){f=e;e=B}var l=b===\"one\"?c.proxy(f,function(o){c(this).unbind(o,l);return f.apply(this,arguments)}):f;if(d===\"unload\"&&b!==\"one\")this.one(d,e,f);else{h=0;for(var k=this.length;h<k;h++)c.event.add(this[h],d,l,e)}return this}});c.fn.extend({unbind:function(a,b){if(typeof a===\"object\"&&!a.preventDefault)for(var d in a)this.unbind(d,\na[d]);else{d=0;for(var e=this.length;d<e;d++)c.event.remove(this[d],a,b)}return this},delegate:function(a,b,d,e){return this.live(b,d,e,a)},undelegate:function(a,b,d){return arguments.length===0?this.unbind(\"live\"):this.die(b,null,d,a)},trigger:function(a,b){return this.each(function(){c.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0]){var d=c.Event(a);d.preventDefault();d.stopPropagation();c.event.trigger(d,b,this[0]);return d.result}},toggle:function(a){for(var b=arguments,d=\n1;d<b.length;)c.proxy(a,b[d++]);return this.click(c.proxy(a,function(e){var f=(c.data(this,\"lastToggle\"+a.guid)||0)%d;c.data(this,\"lastToggle\"+a.guid,f+1);e.preventDefault();return b[f].apply(this,arguments)||false}))},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}});var ya={focus:\"focusin\",blur:\"focusout\",mouseenter:\"mouseover\",mouseleave:\"mouseout\"};c.each([\"live\",\"die\"],function(a,b){c.fn[b]=function(d,e,f,h){var l,k=0,o,x,r=h||this.selector;h=h?this:c(this.context);if(typeof d===\n\"object\"&&!d.preventDefault){for(l in d)h[b](l,e,d[l],r);return this}if(c.isFunction(e)){f=e;e=B}for(d=(d||\"\").split(\" \");(l=d[k++])!=null;){o=X.exec(l);x=\"\";if(o){x=o[0];l=l.replace(X,\"\")}if(l===\"hover\")d.push(\"mouseenter\"+x,\"mouseleave\"+x);else{o=l;if(l===\"focus\"||l===\"blur\"){d.push(ya[l]+x);l+=x}else l=(ya[l]||l)+x;if(b===\"live\"){x=0;for(var A=h.length;x<A;x++)c.event.add(h[x],\"live.\"+Y(l,r),{data:e,selector:r,handler:f,origType:l,origHandler:f,preType:o})}else h.unbind(\"live.\"+Y(l,r),f)}}return this}});\nc.each(\"blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error\".split(\" \"),function(a,b){c.fn[b]=function(d,e){if(e==null){e=d;d=null}return arguments.length>0?this.bind(b,d,e):this.trigger(b)};if(c.attrFn)c.attrFn[b]=true});E.attachEvent&&!E.addEventListener&&c(E).bind(\"unload\",function(){for(var a in c.cache)if(c.cache[a].handle)try{c.event.remove(c.cache[a].handle.elem)}catch(b){}});\n(function(){function a(g,i,n,m,p,q){p=0;for(var u=m.length;p<u;p++){var y=m[p];if(y){var F=false;for(y=y[g];y;){if(y.sizcache===n){F=m[y.sizset];break}if(y.nodeType===1&&!q){y.sizcache=n;y.sizset=p}if(y.nodeName.toLowerCase()===i){F=y;break}y=y[g]}m[p]=F}}}function b(g,i,n,m,p,q){p=0;for(var u=m.length;p<u;p++){var y=m[p];if(y){var F=false;for(y=y[g];y;){if(y.sizcache===n){F=m[y.sizset];break}if(y.nodeType===1){if(!q){y.sizcache=n;y.sizset=p}if(typeof i!==\"string\"){if(y===i){F=true;break}}else if(k.filter(i,\n[y]).length>0){F=y;break}}y=y[g]}m[p]=F}}}var d=/((?:\\((?:\\([^()]+\\)|[^()]+)+\\)|\\[(?:\\[[^\\[\\]]*\\]|['\"][^'\"]*['\"]|[^\\[\\]'\"]+)+\\]|\\\\.|[^ >+~,(\\[\\\\]+)+|[>+~])(\\s*,\\s*)?((?:.|\\r|\\n)*)/g,e=0,f=Object.prototype.toString,h=false,l=true;[0,0].sort(function(){l=false;return 0});var k=function(g,i,n,m){n=n||[];var p=i=i||t;if(i.nodeType!==1&&i.nodeType!==9)return[];if(!g||typeof g!==\"string\")return n;var q,u,y,F,M,N=true,O=k.isXML(i),D=[],R=g;do{d.exec(\"\");if(q=d.exec(R)){R=q[3];D.push(q[1]);if(q[2]){F=q[3];\nbreak}}}while(q);if(D.length>1&&x.exec(g))if(D.length===2&&o.relative[D[0]])u=L(D[0]+D[1],i);else for(u=o.relative[D[0]]?[i]:k(D.shift(),i);D.length;){g=D.shift();if(o.relative[g])g+=D.shift();u=L(g,u)}else{if(!m&&D.length>1&&i.nodeType===9&&!O&&o.match.ID.test(D[0])&&!o.match.ID.test(D[D.length-1])){q=k.find(D.shift(),i,O);i=q.expr?k.filter(q.expr,q.set)[0]:q.set[0]}if(i){q=m?{expr:D.pop(),set:C(m)}:k.find(D.pop(),D.length===1&&(D[0]===\"~\"||D[0]===\"+\")&&i.parentNode?i.parentNode:i,O);u=q.expr?k.filter(q.expr,\nq.set):q.set;if(D.length>0)y=C(u);else N=false;for(;D.length;){q=M=D.pop();if(o.relative[M])q=D.pop();else M=\"\";if(q==null)q=i;o.relative[M](y,q,O)}}else y=[]}y||(y=u);y||k.error(M||g);if(f.call(y)===\"[object Array]\")if(N)if(i&&i.nodeType===1)for(g=0;y[g]!=null;g++){if(y[g]&&(y[g]===true||y[g].nodeType===1&&k.contains(i,y[g])))n.push(u[g])}else for(g=0;y[g]!=null;g++)y[g]&&y[g].nodeType===1&&n.push(u[g]);else n.push.apply(n,y);else C(y,n);if(F){k(F,p,n,m);k.uniqueSort(n)}return n};k.uniqueSort=function(g){if(w){h=\nl;g.sort(w);if(h)for(var i=1;i<g.length;i++)g[i]===g[i-1]&&g.splice(i--,1)}return g};k.matches=function(g,i){return k(g,null,null,i)};k.matchesSelector=function(g,i){return k(i,null,null,[g]).length>0};k.find=function(g,i,n){var m;if(!g)return[];for(var p=0,q=o.order.length;p<q;p++){var u,y=o.order[p];if(u=o.leftMatch[y].exec(g)){var F=u[1];u.splice(1,1);if(F.substr(F.length-1)!==\"\\\\\"){u[1]=(u[1]||\"\").replace(/\\\\/g,\"\");m=o.find[y](u,i,n);if(m!=null){g=g.replace(o.match[y],\"\");break}}}}m||(m=i.getElementsByTagName(\"*\"));\nreturn{set:m,expr:g}};k.filter=function(g,i,n,m){for(var p,q,u=g,y=[],F=i,M=i&&i[0]&&k.isXML(i[0]);g&&i.length;){for(var N in o.filter)if((p=o.leftMatch[N].exec(g))!=null&&p[2]){var O,D,R=o.filter[N];D=p[1];q=false;p.splice(1,1);if(D.substr(D.length-1)!==\"\\\\\"){if(F===y)y=[];if(o.preFilter[N])if(p=o.preFilter[N](p,F,n,y,m,M)){if(p===true)continue}else q=O=true;if(p)for(var j=0;(D=F[j])!=null;j++)if(D){O=R(D,p,j,F);var s=m^!!O;if(n&&O!=null)if(s)q=true;else F[j]=false;else if(s){y.push(D);q=true}}if(O!==\nB){n||(F=y);g=g.replace(o.match[N],\"\");if(!q)return[];break}}}if(g===u)if(q==null)k.error(g);else break;u=g}return F};k.error=function(g){throw\"Syntax error, unrecognized expression: \"+g;};var o=k.selectors={order:[\"ID\",\"NAME\",\"TAG\"],match:{ID:/#((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)/,CLASS:/\\.((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)/,NAME:/\\[name=['\"]*((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)['\"]*\\]/,ATTR:/\\[\\s*((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)\\s*(?:(\\S?=)\\s*(['\"]*)(.*?)\\3|)\\s*\\]/,TAG:/^((?:[\\w\\u00c0-\\uFFFF\\*\\-]|\\\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\\((even|odd|[\\dn+\\-]*)\\))?/,\nPOS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\\((\\d*)\\))?(?=[^\\-]|$)/,PSEUDO:/:((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)(?:\\((['\"]?)((?:\\([^\\)]+\\)|[^\\(\\)]*)+)\\2\\))?/},leftMatch:{},attrMap:{\"class\":\"className\",\"for\":\"htmlFor\"},attrHandle:{href:function(g){return g.getAttribute(\"href\")}},relative:{\"+\":function(g,i){var n=typeof i===\"string\",m=n&&!/\\W/.test(i);n=n&&!m;if(m)i=i.toLowerCase();m=0;for(var p=g.length,q;m<p;m++)if(q=g[m]){for(;(q=q.previousSibling)&&q.nodeType!==1;);g[m]=n||q&&q.nodeName.toLowerCase()===\ni?q||false:q===i}n&&k.filter(i,g,true)},\">\":function(g,i){var n,m=typeof i===\"string\",p=0,q=g.length;if(m&&!/\\W/.test(i))for(i=i.toLowerCase();p<q;p++){if(n=g[p]){n=n.parentNode;g[p]=n.nodeName.toLowerCase()===i?n:false}}else{for(;p<q;p++)if(n=g[p])g[p]=m?n.parentNode:n.parentNode===i;m&&k.filter(i,g,true)}},\"\":function(g,i,n){var m,p=e++,q=b;if(typeof i===\"string\"&&!/\\W/.test(i)){m=i=i.toLowerCase();q=a}q(\"parentNode\",i,p,g,m,n)},\"~\":function(g,i,n){var m,p=e++,q=b;if(typeof i===\"string\"&&!/\\W/.test(i)){m=\ni=i.toLowerCase();q=a}q(\"previousSibling\",i,p,g,m,n)}},find:{ID:function(g,i,n){if(typeof i.getElementById!==\"undefined\"&&!n)return(g=i.getElementById(g[1]))&&g.parentNode?[g]:[]},NAME:function(g,i){if(typeof i.getElementsByName!==\"undefined\"){for(var n=[],m=i.getElementsByName(g[1]),p=0,q=m.length;p<q;p++)m[p].getAttribute(\"name\")===g[1]&&n.push(m[p]);return n.length===0?null:n}},TAG:function(g,i){return i.getElementsByTagName(g[1])}},preFilter:{CLASS:function(g,i,n,m,p,q){g=\" \"+g[1].replace(/\\\\/g,\n\"\")+\" \";if(q)return g;q=0;for(var u;(u=i[q])!=null;q++)if(u)if(p^(u.className&&(\" \"+u.className+\" \").replace(/[\\t\\n]/g,\" \").indexOf(g)>=0))n||m.push(u);else if(n)i[q]=false;return false},ID:function(g){return g[1].replace(/\\\\/g,\"\")},TAG:function(g){return g[1].toLowerCase()},CHILD:function(g){if(g[1]===\"nth\"){var i=/(-?)(\\d*)n((?:\\+|-)?\\d*)/.exec(g[2]===\"even\"&&\"2n\"||g[2]===\"odd\"&&\"2n+1\"||!/\\D/.test(g[2])&&\"0n+\"+g[2]||g[2]);g[2]=i[1]+(i[2]||1)-0;g[3]=i[3]-0}g[0]=e++;return g},ATTR:function(g,i,n,\nm,p,q){i=g[1].replace(/\\\\/g,\"\");if(!q&&o.attrMap[i])g[1]=o.attrMap[i];if(g[2]===\"~=\")g[4]=\" \"+g[4]+\" \";return g},PSEUDO:function(g,i,n,m,p){if(g[1]===\"not\")if((d.exec(g[3])||\"\").length>1||/^\\w/.test(g[3]))g[3]=k(g[3],null,null,i);else{g=k.filter(g[3],i,n,true^p);n||m.push.apply(m,g);return false}else if(o.match.POS.test(g[0])||o.match.CHILD.test(g[0]))return true;return g},POS:function(g){g.unshift(true);return g}},filters:{enabled:function(g){return g.disabled===false&&g.type!==\"hidden\"},disabled:function(g){return g.disabled===\ntrue},checked:function(g){return g.checked===true},selected:function(g){return g.selected===true},parent:function(g){return!!g.firstChild},empty:function(g){return!g.firstChild},has:function(g,i,n){return!!k(n[3],g).length},header:function(g){return/h\\d/i.test(g.nodeName)},text:function(g){return\"text\"===g.type},radio:function(g){return\"radio\"===g.type},checkbox:function(g){return\"checkbox\"===g.type},file:function(g){return\"file\"===g.type},password:function(g){return\"password\"===g.type},submit:function(g){return\"submit\"===\ng.type},image:function(g){return\"image\"===g.type},reset:function(g){return\"reset\"===g.type},button:function(g){return\"button\"===g.type||g.nodeName.toLowerCase()===\"button\"},input:function(g){return/input|select|textarea|button/i.test(g.nodeName)}},setFilters:{first:function(g,i){return i===0},last:function(g,i,n,m){return i===m.length-1},even:function(g,i){return i%2===0},odd:function(g,i){return i%2===1},lt:function(g,i,n){return i<n[3]-0},gt:function(g,i,n){return i>n[3]-0},nth:function(g,i,n){return n[3]-\n0===i},eq:function(g,i,n){return n[3]-0===i}},filter:{PSEUDO:function(g,i,n,m){var p=i[1],q=o.filters[p];if(q)return q(g,n,i,m);else if(p===\"contains\")return(g.textContent||g.innerText||k.getText([g])||\"\").indexOf(i[3])>=0;else if(p===\"not\"){i=i[3];n=0;for(m=i.length;n<m;n++)if(i[n]===g)return false;return true}else k.error(\"Syntax error, unrecognized expression: \"+p)},CHILD:function(g,i){var n=i[1],m=g;switch(n){case \"only\":case \"first\":for(;m=m.previousSibling;)if(m.nodeType===1)return false;if(n===\n\"first\")return true;m=g;case \"last\":for(;m=m.nextSibling;)if(m.nodeType===1)return false;return true;case \"nth\":n=i[2];var p=i[3];if(n===1&&p===0)return true;var q=i[0],u=g.parentNode;if(u&&(u.sizcache!==q||!g.nodeIndex)){var y=0;for(m=u.firstChild;m;m=m.nextSibling)if(m.nodeType===1)m.nodeIndex=++y;u.sizcache=q}m=g.nodeIndex-p;return n===0?m===0:m%n===0&&m/n>=0}},ID:function(g,i){return g.nodeType===1&&g.getAttribute(\"id\")===i},TAG:function(g,i){return i===\"*\"&&g.nodeType===1||g.nodeName.toLowerCase()===\ni},CLASS:function(g,i){return(\" \"+(g.className||g.getAttribute(\"class\"))+\" \").indexOf(i)>-1},ATTR:function(g,i){var n=i[1];n=o.attrHandle[n]?o.attrHandle[n](g):g[n]!=null?g[n]:g.getAttribute(n);var m=n+\"\",p=i[2],q=i[4];return n==null?p===\"!=\":p===\"=\"?m===q:p===\"*=\"?m.indexOf(q)>=0:p===\"~=\"?(\" \"+m+\" \").indexOf(q)>=0:!q?m&&n!==false:p===\"!=\"?m!==q:p===\"^=\"?m.indexOf(q)===0:p===\"$=\"?m.substr(m.length-q.length)===q:p===\"|=\"?m===q||m.substr(0,q.length+1)===q+\"-\":false},POS:function(g,i,n,m){var p=o.setFilters[i[2]];\nif(p)return p(g,n,i,m)}}},x=o.match.POS,r=function(g,i){return\"\\\\\"+(i-0+1)},A;for(A in o.match){o.match[A]=RegExp(o.match[A].source+/(?![^\\[]*\\])(?![^\\(]*\\))/.source);o.leftMatch[A]=RegExp(/(^(?:.|\\r|\\n)*?)/.source+o.match[A].source.replace(/\\\\(\\d+)/g,r))}var C=function(g,i){g=Array.prototype.slice.call(g,0);if(i){i.push.apply(i,g);return i}return g};try{Array.prototype.slice.call(t.documentElement.childNodes,0)}catch(J){C=function(g,i){var n=0,m=i||[];if(f.call(g)===\"[object Array]\")Array.prototype.push.apply(m,\ng);else if(typeof g.length===\"number\")for(var p=g.length;n<p;n++)m.push(g[n]);else for(;g[n];n++)m.push(g[n]);return m}}var w,I;if(t.documentElement.compareDocumentPosition)w=function(g,i){if(g===i){h=true;return 0}if(!g.compareDocumentPosition||!i.compareDocumentPosition)return g.compareDocumentPosition?-1:1;return g.compareDocumentPosition(i)&4?-1:1};else{w=function(g,i){var n,m,p=[],q=[];n=g.parentNode;m=i.parentNode;var u=n;if(g===i){h=true;return 0}else if(n===m)return I(g,i);else if(n){if(!m)return 1}else return-1;\nfor(;u;){p.unshift(u);u=u.parentNode}for(u=m;u;){q.unshift(u);u=u.parentNode}n=p.length;m=q.length;for(u=0;u<n&&u<m;u++)if(p[u]!==q[u])return I(p[u],q[u]);return u===n?I(g,q[u],-1):I(p[u],i,1)};I=function(g,i,n){if(g===i)return n;for(g=g.nextSibling;g;){if(g===i)return-1;g=g.nextSibling}return 1}}k.getText=function(g){for(var i=\"\",n,m=0;g[m];m++){n=g[m];if(n.nodeType===3||n.nodeType===4)i+=n.nodeValue;else if(n.nodeType!==8)i+=k.getText(n.childNodes)}return i};(function(){var g=t.createElement(\"div\"),\ni=\"script\"+(new Date).getTime(),n=t.documentElement;g.innerHTML=\"<a name='\"+i+\"'/>\";n.insertBefore(g,n.firstChild);if(t.getElementById(i)){o.find.ID=function(m,p,q){if(typeof p.getElementById!==\"undefined\"&&!q)return(p=p.getElementById(m[1]))?p.id===m[1]||typeof p.getAttributeNode!==\"undefined\"&&p.getAttributeNode(\"id\").nodeValue===m[1]?[p]:B:[]};o.filter.ID=function(m,p){var q=typeof m.getAttributeNode!==\"undefined\"&&m.getAttributeNode(\"id\");return m.nodeType===1&&q&&q.nodeValue===p}}n.removeChild(g);\nn=g=null})();(function(){var g=t.createElement(\"div\");g.appendChild(t.createComment(\"\"));if(g.getElementsByTagName(\"*\").length>0)o.find.TAG=function(i,n){var m=n.getElementsByTagName(i[1]);if(i[1]===\"*\"){for(var p=[],q=0;m[q];q++)m[q].nodeType===1&&p.push(m[q]);m=p}return m};g.innerHTML=\"<a href='#'></a>\";if(g.firstChild&&typeof g.firstChild.getAttribute!==\"undefined\"&&g.firstChild.getAttribute(\"href\")!==\"#\")o.attrHandle.href=function(i){return i.getAttribute(\"href\",2)};g=null})();t.querySelectorAll&&\nfunction(){var g=k,i=t.createElement(\"div\");i.innerHTML=\"<p class='TEST'></p>\";if(!(i.querySelectorAll&&i.querySelectorAll(\".TEST\").length===0)){k=function(m,p,q,u){p=p||t;m=m.replace(/\\=\\s*([^'\"\\]]*)\\s*\\]/g,\"='$1']\");if(!u&&!k.isXML(p))if(p.nodeType===9)try{return C(p.querySelectorAll(m),q)}catch(y){}else if(p.nodeType===1&&p.nodeName.toLowerCase()!==\"object\"){var F=p.getAttribute(\"id\"),M=F||\"__sizzle__\";F||p.setAttribute(\"id\",M);try{return C(p.querySelectorAll(\"#\"+M+\" \"+m),q)}catch(N){}finally{F||\np.removeAttribute(\"id\")}}return g(m,p,q,u)};for(var n in g)k[n]=g[n];i=null}}();(function(){var g=t.documentElement,i=g.matchesSelector||g.mozMatchesSelector||g.webkitMatchesSelector||g.msMatchesSelector,n=false;try{i.call(t.documentElement,\"[test!='']:sizzle\")}catch(m){n=true}if(i)k.matchesSelector=function(p,q){q=q.replace(/\\=\\s*([^'\"\\]]*)\\s*\\]/g,\"='$1']\");if(!k.isXML(p))try{if(n||!o.match.PSEUDO.test(q)&&!/!=/.test(q))return i.call(p,q)}catch(u){}return k(q,null,null,[p]).length>0}})();(function(){var g=\nt.createElement(\"div\");g.innerHTML=\"<div class='test e'></div><div class='test'></div>\";if(!(!g.getElementsByClassName||g.getElementsByClassName(\"e\").length===0)){g.lastChild.className=\"e\";if(g.getElementsByClassName(\"e\").length!==1){o.order.splice(1,0,\"CLASS\");o.find.CLASS=function(i,n,m){if(typeof n.getElementsByClassName!==\"undefined\"&&!m)return n.getElementsByClassName(i[1])};g=null}}})();k.contains=t.documentElement.contains?function(g,i){return g!==i&&(g.contains?g.contains(i):true)}:t.documentElement.compareDocumentPosition?\nfunction(g,i){return!!(g.compareDocumentPosition(i)&16)}:function(){return false};k.isXML=function(g){return(g=(g?g.ownerDocument||g:0).documentElement)?g.nodeName!==\"HTML\":false};var L=function(g,i){for(var n,m=[],p=\"\",q=i.nodeType?[i]:i;n=o.match.PSEUDO.exec(g);){p+=n[0];g=g.replace(o.match.PSEUDO,\"\")}g=o.relative[g]?g+\"*\":g;n=0;for(var u=q.length;n<u;n++)k(g,q[n],m);return k.filter(p,m)};c.find=k;c.expr=k.selectors;c.expr[\":\"]=c.expr.filters;c.unique=k.uniqueSort;c.text=k.getText;c.isXMLDoc=k.isXML;\nc.contains=k.contains})();var Za=/Until$/,$a=/^(?:parents|prevUntil|prevAll)/,ab=/,/,Na=/^.[^:#\\[\\.,]*$/,bb=Array.prototype.slice,cb=c.expr.match.POS;c.fn.extend({find:function(a){for(var b=this.pushStack(\"\",\"find\",a),d=0,e=0,f=this.length;e<f;e++){d=b.length;c.find(a,this[e],b);if(e>0)for(var h=d;h<b.length;h++)for(var l=0;l<d;l++)if(b[l]===b[h]){b.splice(h--,1);break}}return b},has:function(a){var b=c(a);return this.filter(function(){for(var d=0,e=b.length;d<e;d++)if(c.contains(this,b[d]))return true})},\nnot:function(a){return this.pushStack(ma(this,a,false),\"not\",a)},filter:function(a){return this.pushStack(ma(this,a,true),\"filter\",a)},is:function(a){return!!a&&c.filter(a,this).length>0},closest:function(a,b){var d=[],e,f,h=this[0];if(c.isArray(a)){var l,k={},o=1;if(h&&a.length){e=0;for(f=a.length;e<f;e++){l=a[e];k[l]||(k[l]=c.expr.match.POS.test(l)?c(l,b||this.context):l)}for(;h&&h.ownerDocument&&h!==b;){for(l in k){e=k[l];if(e.jquery?e.index(h)>-1:c(h).is(e))d.push({selector:l,elem:h,level:o})}h=\nh.parentNode;o++}}return d}l=cb.test(a)?c(a,b||this.context):null;e=0;for(f=this.length;e<f;e++)for(h=this[e];h;)if(l?l.index(h)>-1:c.find.matchesSelector(h,a)){d.push(h);break}else{h=h.parentNode;if(!h||!h.ownerDocument||h===b)break}d=d.length>1?c.unique(d):d;return this.pushStack(d,\"closest\",a)},index:function(a){if(!a||typeof a===\"string\")return c.inArray(this[0],a?c(a):this.parent().children());return c.inArray(a.jquery?a[0]:a,this)},add:function(a,b){var d=typeof a===\"string\"?c(a,b||this.context):\nc.makeArray(a),e=c.merge(this.get(),d);return this.pushStack(!d[0]||!d[0].parentNode||d[0].parentNode.nodeType===11||!e[0]||!e[0].parentNode||e[0].parentNode.nodeType===11?e:c.unique(e))},andSelf:function(){return this.add(this.prevObject)}});c.each({parent:function(a){return(a=a.parentNode)&&a.nodeType!==11?a:null},parents:function(a){return c.dir(a,\"parentNode\")},parentsUntil:function(a,b,d){return c.dir(a,\"parentNode\",d)},next:function(a){return c.nth(a,2,\"nextSibling\")},prev:function(a){return c.nth(a,\n2,\"previousSibling\")},nextAll:function(a){return c.dir(a,\"nextSibling\")},prevAll:function(a){return c.dir(a,\"previousSibling\")},nextUntil:function(a,b,d){return c.dir(a,\"nextSibling\",d)},prevUntil:function(a,b,d){return c.dir(a,\"previousSibling\",d)},siblings:function(a){return c.sibling(a.parentNode.firstChild,a)},children:function(a){return c.sibling(a.firstChild)},contents:function(a){return c.nodeName(a,\"iframe\")?a.contentDocument||a.contentWindow.document:c.makeArray(a.childNodes)}},function(a,\nb){c.fn[a]=function(d,e){var f=c.map(this,b,d);Za.test(a)||(e=d);if(e&&typeof e===\"string\")f=c.filter(e,f);f=this.length>1?c.unique(f):f;if((this.length>1||ab.test(e))&&$a.test(a))f=f.reverse();return this.pushStack(f,a,bb.call(arguments).join(\",\"))}});c.extend({filter:function(a,b,d){if(d)a=\":not(\"+a+\")\";return b.length===1?c.find.matchesSelector(b[0],a)?[b[0]]:[]:c.find.matches(a,b)},dir:function(a,b,d){var e=[];for(a=a[b];a&&a.nodeType!==9&&(d===B||a.nodeType!==1||!c(a).is(d));){a.nodeType===1&&\ne.push(a);a=a[b]}return e},nth:function(a,b,d){b=b||1;for(var e=0;a;a=a[d])if(a.nodeType===1&&++e===b)break;return a},sibling:function(a,b){for(var d=[];a;a=a.nextSibling)a.nodeType===1&&a!==b&&d.push(a);return d}});var za=/ jQuery\\d+=\"(?:\\d+|null)\"/g,$=/^\\s+/,Aa=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\\w:]+)[^>]*)\\/>/ig,Ba=/<([\\w:]+)/,db=/<tbody/i,eb=/<|&#?\\w+;/,Ca=/<(?:script|object|embed|option|style)/i,Da=/checked\\s*(?:[^=]|=\\s*.checked.)/i,fb=/\\=([^=\"'>\\s]+\\/)>/g,P={option:[1,\n\"<select multiple='multiple'>\",\"</select>\"],legend:[1,\"<fieldset>\",\"</fieldset>\"],thead:[1,\"<table>\",\"</table>\"],tr:[2,\"<table><tbody>\",\"</tbody></table>\"],td:[3,\"<table><tbody><tr>\",\"</tr></tbody></table>\"],col:[2,\"<table><tbody></tbody><colgroup>\",\"</colgroup></table>\"],area:[1,\"<map>\",\"</map>\"],_default:[0,\"\",\"\"]};P.optgroup=P.option;P.tbody=P.tfoot=P.colgroup=P.caption=P.thead;P.th=P.td;if(!c.support.htmlSerialize)P._default=[1,\"div<div>\",\"</div>\"];c.fn.extend({text:function(a){if(c.isFunction(a))return this.each(function(b){var d=\nc(this);d.text(a.call(this,b,d.text()))});if(typeof a!==\"object\"&&a!==B)return this.empty().append((this[0]&&this[0].ownerDocument||t).createTextNode(a));return c.text(this)},wrapAll:function(a){if(c.isFunction(a))return this.each(function(d){c(this).wrapAll(a.call(this,d))});if(this[0]){var b=c(a,this[0].ownerDocument).eq(0).clone(true);this[0].parentNode&&b.insertBefore(this[0]);b.map(function(){for(var d=this;d.firstChild&&d.firstChild.nodeType===1;)d=d.firstChild;return d}).append(this)}return this},\nwrapInner:function(a){if(c.isFunction(a))return this.each(function(b){c(this).wrapInner(a.call(this,b))});return this.each(function(){var b=c(this),d=b.contents();d.length?d.wrapAll(a):b.append(a)})},wrap:function(a){return this.each(function(){c(this).wrapAll(a)})},unwrap:function(){return this.parent().each(function(){c.nodeName(this,\"body\")||c(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,true,function(a){this.nodeType===1&&this.appendChild(a)})},\nprepend:function(){return this.domManip(arguments,true,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,false,function(b){this.parentNode.insertBefore(b,this)});else if(arguments.length){var a=c(arguments[0]);a.push.apply(a,this.toArray());return this.pushStack(a,\"before\",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,false,function(b){this.parentNode.insertBefore(b,\nthis.nextSibling)});else if(arguments.length){var a=this.pushStack(this,\"after\",arguments);a.push.apply(a,c(arguments[0]).toArray());return a}},remove:function(a,b){for(var d=0,e;(e=this[d])!=null;d++)if(!a||c.filter(a,[e]).length){if(!b&&e.nodeType===1){c.cleanData(e.getElementsByTagName(\"*\"));c.cleanData([e])}e.parentNode&&e.parentNode.removeChild(e)}return this},empty:function(){for(var a=0,b;(b=this[a])!=null;a++)for(b.nodeType===1&&c.cleanData(b.getElementsByTagName(\"*\"));b.firstChild;)b.removeChild(b.firstChild);\nreturn this},clone:function(a){var b=this.map(function(){if(!c.support.noCloneEvent&&!c.isXMLDoc(this)){var d=this.outerHTML,e=this.ownerDocument;if(!d){d=e.createElement(\"div\");d.appendChild(this.cloneNode(true));d=d.innerHTML}return c.clean([d.replace(za,\"\").replace(fb,'=\"$1\">').replace($,\"\")],e)[0]}else return this.cloneNode(true)});if(a===true){na(this,b);na(this.find(\"*\"),b.find(\"*\"))}return b},html:function(a){if(a===B)return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(za,\"\"):null;\nelse if(typeof a===\"string\"&&!Ca.test(a)&&(c.support.leadingWhitespace||!$.test(a))&&!P[(Ba.exec(a)||[\"\",\"\"])[1].toLowerCase()]){a=a.replace(Aa,\"<$1></$2>\");try{for(var b=0,d=this.length;b<d;b++)if(this[b].nodeType===1){c.cleanData(this[b].getElementsByTagName(\"*\"));this[b].innerHTML=a}}catch(e){this.empty().append(a)}}else c.isFunction(a)?this.each(function(f){var h=c(this);h.html(a.call(this,f,h.html()))}):this.empty().append(a);return this},replaceWith:function(a){if(this[0]&&this[0].parentNode){if(c.isFunction(a))return this.each(function(b){var d=\nc(this),e=d.html();d.replaceWith(a.call(this,b,e))});if(typeof a!==\"string\")a=c(a).detach();return this.each(function(){var b=this.nextSibling,d=this.parentNode;c(this).remove();b?c(b).before(a):c(d).append(a)})}else return this.pushStack(c(c.isFunction(a)?a():a),\"replaceWith\",a)},detach:function(a){return this.remove(a,true)},domManip:function(a,b,d){var e,f,h,l=a[0],k=[];if(!c.support.checkClone&&arguments.length===3&&typeof l===\"string\"&&Da.test(l))return this.each(function(){c(this).domManip(a,\nb,d,true)});if(c.isFunction(l))return this.each(function(x){var r=c(this);a[0]=l.call(this,x,b?r.html():B);r.domManip(a,b,d)});if(this[0]){e=l&&l.parentNode;e=c.support.parentNode&&e&&e.nodeType===11&&e.childNodes.length===this.length?{fragment:e}:c.buildFragment(a,this,k);h=e.fragment;if(f=h.childNodes.length===1?h=h.firstChild:h.firstChild){b=b&&c.nodeName(f,\"tr\");f=0;for(var o=this.length;f<o;f++)d.call(b?c.nodeName(this[f],\"table\")?this[f].getElementsByTagName(\"tbody\")[0]||this[f].appendChild(this[f].ownerDocument.createElement(\"tbody\")):\nthis[f]:this[f],f>0||e.cacheable||this.length>1?h.cloneNode(true):h)}k.length&&c.each(k,Oa)}return this}});c.buildFragment=function(a,b,d){var e,f,h;b=b&&b[0]?b[0].ownerDocument||b[0]:t;if(a.length===1&&typeof a[0]===\"string\"&&a[0].length<512&&b===t&&!Ca.test(a[0])&&(c.support.checkClone||!Da.test(a[0]))){f=true;if(h=c.fragments[a[0]])if(h!==1)e=h}if(!e){e=b.createDocumentFragment();c.clean(a,b,e,d)}if(f)c.fragments[a[0]]=h?e:1;return{fragment:e,cacheable:f}};c.fragments={};c.each({appendTo:\"append\",\nprependTo:\"prepend\",insertBefore:\"before\",insertAfter:\"after\",replaceAll:\"replaceWith\"},function(a,b){c.fn[a]=function(d){var e=[];d=c(d);var f=this.length===1&&this[0].parentNode;if(f&&f.nodeType===11&&f.childNodes.length===1&&d.length===1){d[b](this[0]);return this}else{f=0;for(var h=d.length;f<h;f++){var l=(f>0?this.clone(true):this).get();c(d[f])[b](l);e=e.concat(l)}return this.pushStack(e,a,d.selector)}}});c.extend({clean:function(a,b,d,e){b=b||t;if(typeof b.createElement===\"undefined\")b=b.ownerDocument||\nb[0]&&b[0].ownerDocument||t;for(var f=[],h=0,l;(l=a[h])!=null;h++){if(typeof l===\"number\")l+=\"\";if(l){if(typeof l===\"string\"&&!eb.test(l))l=b.createTextNode(l);else if(typeof l===\"string\"){l=l.replace(Aa,\"<$1></$2>\");var k=(Ba.exec(l)||[\"\",\"\"])[1].toLowerCase(),o=P[k]||P._default,x=o[0],r=b.createElement(\"div\");for(r.innerHTML=o[1]+l+o[2];x--;)r=r.lastChild;if(!c.support.tbody){x=db.test(l);k=k===\"table\"&&!x?r.firstChild&&r.firstChild.childNodes:o[1]===\"<table>\"&&!x?r.childNodes:[];for(o=k.length-\n1;o>=0;--o)c.nodeName(k[o],\"tbody\")&&!k[o].childNodes.length&&k[o].parentNode.removeChild(k[o])}!c.support.leadingWhitespace&&$.test(l)&&r.insertBefore(b.createTextNode($.exec(l)[0]),r.firstChild);l=r.childNodes}if(l.nodeType)f.push(l);else f=c.merge(f,l)}}if(d)for(h=0;f[h];h++)if(e&&c.nodeName(f[h],\"script\")&&(!f[h].type||f[h].type.toLowerCase()===\"text/javascript\"))e.push(f[h].parentNode?f[h].parentNode.removeChild(f[h]):f[h]);else{f[h].nodeType===1&&f.splice.apply(f,[h+1,0].concat(c.makeArray(f[h].getElementsByTagName(\"script\"))));\nd.appendChild(f[h])}return f},cleanData:function(a){for(var b,d,e=c.cache,f=c.event.special,h=c.support.deleteExpando,l=0,k;(k=a[l])!=null;l++)if(!(k.nodeName&&c.noData[k.nodeName.toLowerCase()]))if(d=k[c.expando]){if((b=e[d])&&b.events)for(var o in b.events)f[o]?c.event.remove(k,o):c.removeEvent(k,o,b.handle);if(h)delete k[c.expando];else k.removeAttribute&&k.removeAttribute(c.expando);delete e[d]}}});var Ea=/alpha\\([^)]*\\)/i,gb=/opacity=([^)]*)/,hb=/-([a-z])/ig,ib=/([A-Z])/g,Fa=/^-?\\d+(?:px)?$/i,\njb=/^-?\\d/,kb={position:\"absolute\",visibility:\"hidden\",display:\"block\"},Pa=[\"Left\",\"Right\"],Qa=[\"Top\",\"Bottom\"],W,Ga,aa,lb=function(a,b){return b.toUpperCase()};c.fn.css=function(a,b){if(arguments.length===2&&b===B)return this;return c.access(this,a,b,true,function(d,e,f){return f!==B?c.style(d,e,f):c.css(d,e)})};c.extend({cssHooks:{opacity:{get:function(a,b){if(b){var d=W(a,\"opacity\",\"opacity\");return d===\"\"?\"1\":d}else return a.style.opacity}}},cssNumber:{zIndex:true,fontWeight:true,opacity:true,\nzoom:true,lineHeight:true},cssProps:{\"float\":c.support.cssFloat?\"cssFloat\":\"styleFloat\"},style:function(a,b,d,e){if(!(!a||a.nodeType===3||a.nodeType===8||!a.style)){var f,h=c.camelCase(b),l=a.style,k=c.cssHooks[h];b=c.cssProps[h]||h;if(d!==B){if(!(typeof d===\"number\"&&isNaN(d)||d==null)){if(typeof d===\"number\"&&!c.cssNumber[h])d+=\"px\";if(!k||!(\"set\"in k)||(d=k.set(a,d))!==B)try{l[b]=d}catch(o){}}}else{if(k&&\"get\"in k&&(f=k.get(a,false,e))!==B)return f;return l[b]}}},css:function(a,b,d){var e,f=c.camelCase(b),\nh=c.cssHooks[f];b=c.cssProps[f]||f;if(h&&\"get\"in h&&(e=h.get(a,true,d))!==B)return e;else if(W)return W(a,b,f)},swap:function(a,b,d){var e={},f;for(f in b){e[f]=a.style[f];a.style[f]=b[f]}d.call(a);for(f in b)a.style[f]=e[f]},camelCase:function(a){return a.replace(hb,lb)}});c.curCSS=c.css;c.each([\"height\",\"width\"],function(a,b){c.cssHooks[b]={get:function(d,e,f){var h;if(e){if(d.offsetWidth!==0)h=oa(d,b,f);else c.swap(d,kb,function(){h=oa(d,b,f)});if(h<=0){h=W(d,b,b);if(h===\"0px\"&&aa)h=aa(d,b,b);\nif(h!=null)return h===\"\"||h===\"auto\"?\"0px\":h}if(h<0||h==null){h=d.style[b];return h===\"\"||h===\"auto\"?\"0px\":h}return typeof h===\"string\"?h:h+\"px\"}},set:function(d,e){if(Fa.test(e)){e=parseFloat(e);if(e>=0)return e+\"px\"}else return e}}});if(!c.support.opacity)c.cssHooks.opacity={get:function(a,b){return gb.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||\"\")?parseFloat(RegExp.$1)/100+\"\":b?\"1\":\"\"},set:function(a,b){var d=a.style;d.zoom=1;var e=c.isNaN(b)?\"\":\"alpha(opacity=\"+b*100+\")\",f=\nd.filter||\"\";d.filter=Ea.test(f)?f.replace(Ea,e):d.filter+\" \"+e}};if(t.defaultView&&t.defaultView.getComputedStyle)Ga=function(a,b,d){var e;d=d.replace(ib,\"-$1\").toLowerCase();if(!(b=a.ownerDocument.defaultView))return B;if(b=b.getComputedStyle(a,null)){e=b.getPropertyValue(d);if(e===\"\"&&!c.contains(a.ownerDocument.documentElement,a))e=c.style(a,d)}return e};if(t.documentElement.currentStyle)aa=function(a,b){var d,e,f=a.currentStyle&&a.currentStyle[b],h=a.style;if(!Fa.test(f)&&jb.test(f)){d=h.left;\ne=a.runtimeStyle.left;a.runtimeStyle.left=a.currentStyle.left;h.left=b===\"fontSize\"?\"1em\":f||0;f=h.pixelLeft+\"px\";h.left=d;a.runtimeStyle.left=e}return f===\"\"?\"auto\":f};W=Ga||aa;if(c.expr&&c.expr.filters){c.expr.filters.hidden=function(a){var b=a.offsetHeight;return a.offsetWidth===0&&b===0||!c.support.reliableHiddenOffsets&&(a.style.display||c.css(a,\"display\"))===\"none\"};c.expr.filters.visible=function(a){return!c.expr.filters.hidden(a)}}var mb=c.now(),nb=/<script\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/script>/gi,\nob=/^(?:select|textarea)/i,pb=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,qb=/^(?:GET|HEAD)$/,Ra=/\\[\\]$/,T=/\\=\\?(&|$)/,ja=/\\?/,rb=/([?&])_=[^&]*/,sb=/^(\\w+:)?\\/\\/([^\\/?#]+)/,tb=/%20/g,ub=/#.*$/,Ha=c.fn.load;c.fn.extend({load:function(a,b,d){if(typeof a!==\"string\"&&Ha)return Ha.apply(this,arguments);else if(!this.length)return this;var e=a.indexOf(\" \");if(e>=0){var f=a.slice(e,a.length);a=a.slice(0,e)}e=\"GET\";if(b)if(c.isFunction(b)){d=b;b=null}else if(typeof b===\n\"object\"){b=c.param(b,c.ajaxSettings.traditional);e=\"POST\"}var h=this;c.ajax({url:a,type:e,dataType:\"html\",data:b,complete:function(l,k){if(k===\"success\"||k===\"notmodified\")h.html(f?c(\"<div>\").append(l.responseText.replace(nb,\"\")).find(f):l.responseText);d&&h.each(d,[l.responseText,k,l])}});return this},serialize:function(){return c.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?c.makeArray(this.elements):this}).filter(function(){return this.name&&\n!this.disabled&&(this.checked||ob.test(this.nodeName)||pb.test(this.type))}).map(function(a,b){var d=c(this).val();return d==null?null:c.isArray(d)?c.map(d,function(e){return{name:b.name,value:e}}):{name:b.name,value:d}}).get()}});c.each(\"ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend\".split(\" \"),function(a,b){c.fn[b]=function(d){return this.bind(b,d)}});c.extend({get:function(a,b,d,e){if(c.isFunction(b)){e=e||d;d=b;b=null}return c.ajax({type:\"GET\",url:a,data:b,success:d,dataType:e})},\ngetScript:function(a,b){return c.get(a,null,b,\"script\")},getJSON:function(a,b,d){return c.get(a,b,d,\"json\")},post:function(a,b,d,e){if(c.isFunction(b)){e=e||d;d=b;b={}}return c.ajax({type:\"POST\",url:a,data:b,success:d,dataType:e})},ajaxSetup:function(a){c.extend(c.ajaxSettings,a)},ajaxSettings:{url:location.href,global:true,type:\"GET\",contentType:\"application/x-www-form-urlencoded\",processData:true,async:true,xhr:function(){return new E.XMLHttpRequest},accepts:{xml:\"application/xml, text/xml\",html:\"text/html\",\nscript:\"text/javascript, application/javascript\",json:\"application/json, text/javascript\",text:\"text/plain\",_default:\"*/*\"}},ajax:function(a){var b=c.extend(true,{},c.ajaxSettings,a),d,e,f,h=b.type.toUpperCase(),l=qb.test(h);b.url=b.url.replace(ub,\"\");b.context=a&&a.context!=null?a.context:b;if(b.data&&b.processData&&typeof b.data!==\"string\")b.data=c.param(b.data,b.traditional);if(b.dataType===\"jsonp\"){if(h===\"GET\")T.test(b.url)||(b.url+=(ja.test(b.url)?\"&\":\"?\")+(b.jsonp||\"callback\")+\"=?\");else if(!b.data||\n!T.test(b.data))b.data=(b.data?b.data+\"&\":\"\")+(b.jsonp||\"callback\")+\"=?\";b.dataType=\"json\"}if(b.dataType===\"json\"&&(b.data&&T.test(b.data)||T.test(b.url))){d=b.jsonpCallback||\"jsonp\"+mb++;if(b.data)b.data=(b.data+\"\").replace(T,\"=\"+d+\"$1\");b.url=b.url.replace(T,\"=\"+d+\"$1\");b.dataType=\"script\";var k=E[d];E[d]=function(m){if(c.isFunction(k))k(m);else{E[d]=B;try{delete E[d]}catch(p){}}f=m;c.handleSuccess(b,w,e,f);c.handleComplete(b,w,e,f);r&&r.removeChild(A)}}if(b.dataType===\"script\"&&b.cache===null)b.cache=\nfalse;if(b.cache===false&&l){var o=c.now(),x=b.url.replace(rb,\"$1_=\"+o);b.url=x+(x===b.url?(ja.test(b.url)?\"&\":\"?\")+\"_=\"+o:\"\")}if(b.data&&l)b.url+=(ja.test(b.url)?\"&\":\"?\")+b.data;b.global&&c.active++===0&&c.event.trigger(\"ajaxStart\");o=(o=sb.exec(b.url))&&(o[1]&&o[1].toLowerCase()!==location.protocol||o[2].toLowerCase()!==location.host);if(b.dataType===\"script\"&&h===\"GET\"&&o){var r=t.getElementsByTagName(\"head\")[0]||t.documentElement,A=t.createElement(\"script\");if(b.scriptCharset)A.charset=b.scriptCharset;\nA.src=b.url;if(!d){var C=false;A.onload=A.onreadystatechange=function(){if(!C&&(!this.readyState||this.readyState===\"loaded\"||this.readyState===\"complete\")){C=true;c.handleSuccess(b,w,e,f);c.handleComplete(b,w,e,f);A.onload=A.onreadystatechange=null;r&&A.parentNode&&r.removeChild(A)}}}r.insertBefore(A,r.firstChild);return B}var J=false,w=b.xhr();if(w){b.username?w.open(h,b.url,b.async,b.username,b.password):w.open(h,b.url,b.async);try{if(b.data!=null&&!l||a&&a.contentType)w.setRequestHeader(\"Content-Type\",\nb.contentType);if(b.ifModified){c.lastModified[b.url]&&w.setRequestHeader(\"If-Modified-Since\",c.lastModified[b.url]);c.etag[b.url]&&w.setRequestHeader(\"If-None-Match\",c.etag[b.url])}o||w.setRequestHeader(\"X-Requested-With\",\"XMLHttpRequest\");w.setRequestHeader(\"Accept\",b.dataType&&b.accepts[b.dataType]?b.accepts[b.dataType]+\", */*; q=0.01\":b.accepts._default)}catch(I){}if(b.beforeSend&&b.beforeSend.call(b.context,w,b)===false){b.global&&c.active--===1&&c.event.trigger(\"ajaxStop\");w.abort();return false}b.global&&\nc.triggerGlobal(b,\"ajaxSend\",[w,b]);var L=w.onreadystatechange=function(m){if(!w||w.readyState===0||m===\"abort\"){J||c.handleComplete(b,w,e,f);J=true;if(w)w.onreadystatechange=c.noop}else if(!J&&w&&(w.readyState===4||m===\"timeout\")){J=true;w.onreadystatechange=c.noop;e=m===\"timeout\"?\"timeout\":!c.httpSuccess(w)?\"error\":b.ifModified&&c.httpNotModified(w,b.url)?\"notmodified\":\"success\";var p;if(e===\"success\")try{f=c.httpData(w,b.dataType,b)}catch(q){e=\"parsererror\";p=q}if(e===\"success\"||e===\"notmodified\")d||\nc.handleSuccess(b,w,e,f);else c.handleError(b,w,e,p);d||c.handleComplete(b,w,e,f);m===\"timeout\"&&w.abort();if(b.async)w=null}};try{var g=w.abort;w.abort=function(){w&&Function.prototype.call.call(g,w);L(\"abort\")}}catch(i){}b.async&&b.timeout>0&&setTimeout(function(){w&&!J&&L(\"timeout\")},b.timeout);try{w.send(l||b.data==null?null:b.data)}catch(n){c.handleError(b,w,null,n);c.handleComplete(b,w,e,f)}b.async||L();return w}},param:function(a,b){var d=[],e=function(h,l){l=c.isFunction(l)?l():l;d[d.length]=\nencodeURIComponent(h)+\"=\"+encodeURIComponent(l)};if(b===B)b=c.ajaxSettings.traditional;if(c.isArray(a)||a.jquery)c.each(a,function(){e(this.name,this.value)});else for(var f in a)da(f,a[f],b,e);return d.join(\"&\").replace(tb,\"+\")}});c.extend({active:0,lastModified:{},etag:{},handleError:function(a,b,d,e){a.error&&a.error.call(a.context,b,d,e);a.global&&c.triggerGlobal(a,\"ajaxError\",[b,a,e])},handleSuccess:function(a,b,d,e){a.success&&a.success.call(a.context,e,d,b);a.global&&c.triggerGlobal(a,\"ajaxSuccess\",\n[b,a])},handleComplete:function(a,b,d){a.complete&&a.complete.call(a.context,b,d);a.global&&c.triggerGlobal(a,\"ajaxComplete\",[b,a]);a.global&&c.active--===1&&c.event.trigger(\"ajaxStop\")},triggerGlobal:function(a,b,d){(a.context&&a.context.url==null?c(a.context):c.event).trigger(b,d)},httpSuccess:function(a){try{return!a.status&&location.protocol===\"file:\"||a.status>=200&&a.status<300||a.status===304||a.status===1223}catch(b){}return false},httpNotModified:function(a,b){var d=a.getResponseHeader(\"Last-Modified\"),\ne=a.getResponseHeader(\"Etag\");if(d)c.lastModified[b]=d;if(e)c.etag[b]=e;return a.status===304},httpData:function(a,b,d){var e=a.getResponseHeader(\"content-type\")||\"\",f=b===\"xml\"||!b&&e.indexOf(\"xml\")>=0;a=f?a.responseXML:a.responseText;f&&a.documentElement.nodeName===\"parsererror\"&&c.error(\"parsererror\");if(d&&d.dataFilter)a=d.dataFilter(a,b);if(typeof a===\"string\")if(b===\"json\"||!b&&e.indexOf(\"json\")>=0)a=c.parseJSON(a);else if(b===\"script\"||!b&&e.indexOf(\"javascript\")>=0)c.globalEval(a);return a}});\nif(E.ActiveXObject)c.ajaxSettings.xhr=function(){if(E.location.protocol!==\"file:\")try{return new E.XMLHttpRequest}catch(a){}try{return new E.ActiveXObject(\"Microsoft.XMLHTTP\")}catch(b){}};c.support.ajax=!!c.ajaxSettings.xhr();var ea={},vb=/^(?:toggle|show|hide)$/,wb=/^([+\\-]=)?([\\d+.\\-]+)(.*)$/,ba,pa=[[\"height\",\"marginTop\",\"marginBottom\",\"paddingTop\",\"paddingBottom\"],[\"width\",\"marginLeft\",\"marginRight\",\"paddingLeft\",\"paddingRight\"],[\"opacity\"]];c.fn.extend({show:function(a,b,d){if(a||a===0)return this.animate(S(\"show\",\n3),a,b,d);else{d=0;for(var e=this.length;d<e;d++){a=this[d];b=a.style.display;if(!c.data(a,\"olddisplay\")&&b===\"none\")b=a.style.display=\"\";b===\"\"&&c.css(a,\"display\")===\"none\"&&c.data(a,\"olddisplay\",qa(a.nodeName))}for(d=0;d<e;d++){a=this[d];b=a.style.display;if(b===\"\"||b===\"none\")a.style.display=c.data(a,\"olddisplay\")||\"\"}return this}},hide:function(a,b,d){if(a||a===0)return this.animate(S(\"hide\",3),a,b,d);else{a=0;for(b=this.length;a<b;a++){d=c.css(this[a],\"display\");d!==\"none\"&&c.data(this[a],\"olddisplay\",\nd)}for(a=0;a<b;a++)this[a].style.display=\"none\";return this}},_toggle:c.fn.toggle,toggle:function(a,b,d){var e=typeof a===\"boolean\";if(c.isFunction(a)&&c.isFunction(b))this._toggle.apply(this,arguments);else a==null||e?this.each(function(){var f=e?a:c(this).is(\":hidden\");c(this)[f?\"show\":\"hide\"]()}):this.animate(S(\"toggle\",3),a,b,d);return this},fadeTo:function(a,b,d,e){return this.filter(\":hidden\").css(\"opacity\",0).show().end().animate({opacity:b},a,d,e)},animate:function(a,b,d,e){var f=c.speed(b,\nd,e);if(c.isEmptyObject(a))return this.each(f.complete);return this[f.queue===false?\"each\":\"queue\"](function(){var h=c.extend({},f),l,k=this.nodeType===1,o=k&&c(this).is(\":hidden\"),x=this;for(l in a){var r=c.camelCase(l);if(l!==r){a[r]=a[l];delete a[l];l=r}if(a[l]===\"hide\"&&o||a[l]===\"show\"&&!o)return h.complete.call(this);if(k&&(l===\"height\"||l===\"width\")){h.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY];if(c.css(this,\"display\")===\"inline\"&&c.css(this,\"float\")===\"none\")if(c.support.inlineBlockNeedsLayout)if(qa(this.nodeName)===\n\"inline\")this.style.display=\"inline-block\";else{this.style.display=\"inline\";this.style.zoom=1}else this.style.display=\"inline-block\"}if(c.isArray(a[l])){(h.specialEasing=h.specialEasing||{})[l]=a[l][1];a[l]=a[l][0]}}if(h.overflow!=null)this.style.overflow=\"hidden\";h.curAnim=c.extend({},a);c.each(a,function(A,C){var J=new c.fx(x,h,A);if(vb.test(C))J[C===\"toggle\"?o?\"show\":\"hide\":C](a);else{var w=wb.exec(C),I=J.cur()||0;if(w){var L=parseFloat(w[2]),g=w[3]||\"px\";if(g!==\"px\"){c.style(x,A,(L||1)+g);I=(L||\n1)/J.cur()*I;c.style(x,A,I+g)}if(w[1])L=(w[1]===\"-=\"?-1:1)*L+I;J.custom(I,L,g)}else J.custom(I,C,\"\")}});return true})},stop:function(a,b){var d=c.timers;a&&this.queue([]);this.each(function(){for(var e=d.length-1;e>=0;e--)if(d[e].elem===this){b&&d[e](true);d.splice(e,1)}});b||this.dequeue();return this}});c.each({slideDown:S(\"show\",1),slideUp:S(\"hide\",1),slideToggle:S(\"toggle\",1),fadeIn:{opacity:\"show\"},fadeOut:{opacity:\"hide\"},fadeToggle:{opacity:\"toggle\"}},function(a,b){c.fn[a]=function(d,e,f){return this.animate(b,\nd,e,f)}});c.extend({speed:function(a,b,d){var e=a&&typeof a===\"object\"?c.extend({},a):{complete:d||!d&&b||c.isFunction(a)&&a,duration:a,easing:d&&b||b&&!c.isFunction(b)&&b};e.duration=c.fx.off?0:typeof e.duration===\"number\"?e.duration:e.duration in c.fx.speeds?c.fx.speeds[e.duration]:c.fx.speeds._default;e.old=e.complete;e.complete=function(){e.queue!==false&&c(this).dequeue();c.isFunction(e.old)&&e.old.call(this)};return e},easing:{linear:function(a,b,d,e){return d+e*a},swing:function(a,b,d,e){return(-Math.cos(a*\nMath.PI)/2+0.5)*e+d}},timers:[],fx:function(a,b,d){this.options=b;this.elem=a;this.prop=d;if(!b.orig)b.orig={}}});c.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this);(c.fx.step[this.prop]||c.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null))return this.elem[this.prop];var a=parseFloat(c.css(this.elem,this.prop));return a&&a>-1E4?a:0},custom:function(a,b,d){function e(l){return f.step(l)}\nvar f=this,h=c.fx;this.startTime=c.now();this.start=a;this.end=b;this.unit=d||this.unit||\"px\";this.now=this.start;this.pos=this.state=0;e.elem=this.elem;if(e()&&c.timers.push(e)&&!ba)ba=setInterval(h.tick,h.interval)},show:function(){this.options.orig[this.prop]=c.style(this.elem,this.prop);this.options.show=true;this.custom(this.prop===\"width\"||this.prop===\"height\"?1:0,this.cur());c(this.elem).show()},hide:function(){this.options.orig[this.prop]=c.style(this.elem,this.prop);this.options.hide=true;\nthis.custom(this.cur(),0)},step:function(a){var b=c.now(),d=true;if(a||b>=this.options.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();this.options.curAnim[this.prop]=true;for(var e in this.options.curAnim)if(this.options.curAnim[e]!==true)d=false;if(d){if(this.options.overflow!=null&&!c.support.shrinkWrapBlocks){var f=this.elem,h=this.options;c.each([\"\",\"X\",\"Y\"],function(k,o){f.style[\"overflow\"+o]=h.overflow[k]})}this.options.hide&&c(this.elem).hide();if(this.options.hide||\nthis.options.show)for(var l in this.options.curAnim)c.style(this.elem,l,this.options.orig[l]);this.options.complete.call(this.elem)}return false}else{a=b-this.startTime;this.state=a/this.options.duration;b=this.options.easing||(c.easing.swing?\"swing\":\"linear\");this.pos=c.easing[this.options.specialEasing&&this.options.specialEasing[this.prop]||b](this.state,a,0,1,this.options.duration);this.now=this.start+(this.end-this.start)*this.pos;this.update()}return true}};c.extend(c.fx,{tick:function(){for(var a=\nc.timers,b=0;b<a.length;b++)a[b]()||a.splice(b--,1);a.length||c.fx.stop()},interval:13,stop:function(){clearInterval(ba);ba=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){c.style(a.elem,\"opacity\",a.now)},_default:function(a){if(a.elem.style&&a.elem.style[a.prop]!=null)a.elem.style[a.prop]=(a.prop===\"width\"||a.prop===\"height\"?Math.max(0,a.now):a.now)+a.unit;else a.elem[a.prop]=a.now}}});if(c.expr&&c.expr.filters)c.expr.filters.animated=function(a){return c.grep(c.timers,function(b){return a===\nb.elem}).length};var xb=/^t(?:able|d|h)$/i,Ia=/^(?:body|html)$/i;c.fn.offset=\"getBoundingClientRect\"in t.documentElement?function(a){var b=this[0],d;if(a)return this.each(function(l){c.offset.setOffset(this,a,l)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return c.offset.bodyOffset(b);try{d=b.getBoundingClientRect()}catch(e){}var f=b.ownerDocument,h=f.documentElement;if(!d||!c.contains(h,b))return d||{top:0,left:0};b=f.body;f=fa(f);return{top:d.top+(f.pageYOffset||c.support.boxModel&&\nh.scrollTop||b.scrollTop)-(h.clientTop||b.clientTop||0),left:d.left+(f.pageXOffset||c.support.boxModel&&h.scrollLeft||b.scrollLeft)-(h.clientLeft||b.clientLeft||0)}}:function(a){var b=this[0];if(a)return this.each(function(x){c.offset.setOffset(this,a,x)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return c.offset.bodyOffset(b);c.offset.initialize();var d,e=b.offsetParent,f=b.ownerDocument,h=f.documentElement,l=f.body;d=(f=f.defaultView)?f.getComputedStyle(b,null):b.currentStyle;\nfor(var k=b.offsetTop,o=b.offsetLeft;(b=b.parentNode)&&b!==l&&b!==h;){if(c.offset.supportsFixedPosition&&d.position===\"fixed\")break;d=f?f.getComputedStyle(b,null):b.currentStyle;k-=b.scrollTop;o-=b.scrollLeft;if(b===e){k+=b.offsetTop;o+=b.offsetLeft;if(c.offset.doesNotAddBorder&&!(c.offset.doesAddBorderForTableAndCells&&xb.test(b.nodeName))){k+=parseFloat(d.borderTopWidth)||0;o+=parseFloat(d.borderLeftWidth)||0}e=b.offsetParent}if(c.offset.subtractsBorderForOverflowNotVisible&&d.overflow!==\"visible\"){k+=\nparseFloat(d.borderTopWidth)||0;o+=parseFloat(d.borderLeftWidth)||0}d=d}if(d.position===\"relative\"||d.position===\"static\"){k+=l.offsetTop;o+=l.offsetLeft}if(c.offset.supportsFixedPosition&&d.position===\"fixed\"){k+=Math.max(h.scrollTop,l.scrollTop);o+=Math.max(h.scrollLeft,l.scrollLeft)}return{top:k,left:o}};c.offset={initialize:function(){var a=t.body,b=t.createElement(\"div\"),d,e,f,h=parseFloat(c.css(a,\"marginTop\"))||0;c.extend(b.style,{position:\"absolute\",top:0,left:0,margin:0,border:0,width:\"1px\",\nheight:\"1px\",visibility:\"hidden\"});b.innerHTML=\"<div style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;'><div></div></div><table style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>\";a.insertBefore(b,a.firstChild);d=b.firstChild;e=d.firstChild;f=d.nextSibling.firstChild.firstChild;this.doesNotAddBorder=e.offsetTop!==5;this.doesAddBorderForTableAndCells=\nf.offsetTop===5;e.style.position=\"fixed\";e.style.top=\"20px\";this.supportsFixedPosition=e.offsetTop===20||e.offsetTop===15;e.style.position=e.style.top=\"\";d.style.overflow=\"hidden\";d.style.position=\"relative\";this.subtractsBorderForOverflowNotVisible=e.offsetTop===-5;this.doesNotIncludeMarginInBodyOffset=a.offsetTop!==h;a.removeChild(b);c.offset.initialize=c.noop},bodyOffset:function(a){var b=a.offsetTop,d=a.offsetLeft;c.offset.initialize();if(c.offset.doesNotIncludeMarginInBodyOffset){b+=parseFloat(c.css(a,\n\"marginTop\"))||0;d+=parseFloat(c.css(a,\"marginLeft\"))||0}return{top:b,left:d}},setOffset:function(a,b,d){var e=c.css(a,\"position\");if(e===\"static\")a.style.position=\"relative\";var f=c(a),h=f.offset(),l=c.css(a,\"top\"),k=c.css(a,\"left\"),o=e===\"absolute\"&&c.inArray(\"auto\",[l,k])>-1;e={};var x={};if(o)x=f.position();l=o?x.top:parseInt(l,10)||0;k=o?x.left:parseInt(k,10)||0;if(c.isFunction(b))b=b.call(a,d,h);if(b.top!=null)e.top=b.top-h.top+l;if(b.left!=null)e.left=b.left-h.left+k;\"using\"in b?b.using.call(a,\ne):f.css(e)}};c.fn.extend({position:function(){if(!this[0])return null;var a=this[0],b=this.offsetParent(),d=this.offset(),e=Ia.test(b[0].nodeName)?{top:0,left:0}:b.offset();d.top-=parseFloat(c.css(a,\"marginTop\"))||0;d.left-=parseFloat(c.css(a,\"marginLeft\"))||0;e.top+=parseFloat(c.css(b[0],\"borderTopWidth\"))||0;e.left+=parseFloat(c.css(b[0],\"borderLeftWidth\"))||0;return{top:d.top-e.top,left:d.left-e.left}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||t.body;a&&!Ia.test(a.nodeName)&&\nc.css(a,\"position\")===\"static\";)a=a.offsetParent;return a})}});c.each([\"Left\",\"Top\"],function(a,b){var d=\"scroll\"+b;c.fn[d]=function(e){var f=this[0],h;if(!f)return null;if(e!==B)return this.each(function(){if(h=fa(this))h.scrollTo(!a?e:c(h).scrollLeft(),a?e:c(h).scrollTop());else this[d]=e});else return(h=fa(f))?\"pageXOffset\"in h?h[a?\"pageYOffset\":\"pageXOffset\"]:c.support.boxModel&&h.document.documentElement[d]||h.document.body[d]:f[d]}});c.each([\"Height\",\"Width\"],function(a,b){var d=b.toLowerCase();\nc.fn[\"inner\"+b]=function(){return this[0]?parseFloat(c.css(this[0],d,\"padding\")):null};c.fn[\"outer\"+b]=function(e){return this[0]?parseFloat(c.css(this[0],d,e?\"margin\":\"border\")):null};c.fn[d]=function(e){var f=this[0];if(!f)return e==null?null:this;if(c.isFunction(e))return this.each(function(l){var k=c(this);k[d](e.call(this,l,k[d]()))});if(c.isWindow(f))return f.document.compatMode===\"CSS1Compat\"&&f.document.documentElement[\"client\"+b]||f.document.body[\"client\"+b];else if(f.nodeType===9)return Math.max(f.documentElement[\"client\"+\nb],f.body[\"scroll\"+b],f.documentElement[\"scroll\"+b],f.body[\"offset\"+b],f.documentElement[\"offset\"+b]);else if(e===B){f=c.css(f,d);var h=parseFloat(f);return c.isNaN(h)?f:h}else return this.css(d,typeof e===\"string\"?e:e+\"px\")}})})(window);\n"
          },
          "redirectURL": "",
          "headersSize": 251,
          "bodySize": 27106
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-05-31T09:51:38.000Z",
            "lastAccess": "2012-05-30T09:51:38.000Z",
            "eTag": "",
            "hitCount": 18
          }
        },
        "timings": {
          "blocked": 0,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 5,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:38.785+04:00",
        "time": 5,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/js/JsHttpRequest.js",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Thu, 15 Sep 2011 12:16:13 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 705,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Thu, 15 Sep 2011 12:16:13 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Thu, 31 May 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=86400"
            }
          ],
          "content": {
            "mimeType": "application/x-javascript",
            "size": 27191,
            "text": "/**\r\n* JsHttpRequest: JavaScript \"AJAX\" data loader\r\n*\r\n* @license LGPL\r\n* @author Dmitry Koterov, http://en.dklab.ru/lib/JsHttpRequest/\r\n* @version 5.x $Id$\r\n*/\r\n\r\n// {{{\r\nfunction JsHttpRequest() {\r\n\t// Standard properties.\r\n\tvar t = this;\r\n\tt.onreadystatechange = null;\r\n\tt.readyState         = 0;\r\n\tt.responseText       = null;\r\n\tt.responseXML        = null;\r\n\tt.status             = 200;\r\n\tt.statusText         = \"OK\";\r\n\t// JavaScript response array/hash\r\n\tt.responseJS         = null;\r\n\r\n\t// Additional properties.\r\n\tt.caching            = false;        // need to use caching?\r\n\tt.loader             = null;         // loader to use ('form', 'script', 'xml'; null - autodetect)\r\n\tt.session_name       = \"PHPSESSID\";  // set to SID cookie or GET parameter name\r\n\r\n\t// Internals.\r\n\tt._ldObj              = null;  // used loader object\r\n\tt._reqHeaders        = [];    // collected request headers\r\n\tt._openArgs          = null;  // parameters from open()\r\n\tt._errors = {\r\n\t\tinv_form_el:        'Invalid FORM element detected: name=%, tag=%',\r\n\t\tmust_be_single_el:  'If used, <form> must be a single HTML element in the list.',\r\n\t\tjs_invalid:         'JavaScript code generated by backend is invalid!\\n%',\r\n\t\turl_too_long:       'Cannot use so long query with GET request (URL is larger than % bytes)',\r\n\t\tunk_loader:         'Unknown loader: %',\r\n\t\tno_loaders:         'No loaders registered at all, please check JsHttpRequest.LOADERS array',\r\n\t\tno_loader_matched:  'Cannot find a loader which may process the request. Notices are:\\n%'\r\n\t}\r\n\r\n\t/**\r\n\t* Aborts the request. Behaviour of this function for onreadystatechange()\r\n\t* is identical to IE (most universal and common case). E.g., readyState -> 4\r\n\t* on abort() after send().\r\n\t*/\r\n\tt.abort = function() { with (this) {\r\n\t\tif (_ldObj && _ldObj.abort) _ldObj.abort();\r\n\t\t_cleanup();\r\n\t\tif (readyState == 0) {\r\n\t\t\t// start->abort: no change of readyState (IE behaviour)\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (readyState == 1 && !_ldObj) {\r\n\t\t\t// open->abort: no onreadystatechange call, but change readyState to 0 (IE).\r\n\t\t\t// send->abort: change state to 4 (_ldObj is not null when send() is called)\r\n\t\t\treadyState = 0;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t_changeReadyState(4, true); // 4 in IE & FF on abort() call; Opera does not change to 4.\r\n\t}}\r\n\r\n\t/**\r\n\t* Prepares the object for data loading.\r\n\t* You may also pass URLs like \"GET url\" or \"script.GET url\".\r\n\t*/\r\n\tt.open = function(method, url, asyncFlag, username, password) { with (this) {\r\n\t\t\r\n\t\t// Extract methor and loader from the URL (if present).\r\n\t\tif (url.match(/^((\\w+)\\.)?(GET|POST)\\s+(.*)/i)) {\r\n\t\t\tthis.loader = RegExp.$2? RegExp.$2 : null;\r\n\t\t\tmethod = RegExp.$3;\r\n\t\t\turl = RegExp.$4;\r\n\t\t}\r\n\t\t// Append SID to original URL. Use try...catch for security problems.\r\n\t\ttry {\r\n\t\t\tif (\r\n\t\t\tdocument.location.search.match(new RegExp('[&?]' + session_name + '=([^&?]*)'))\r\n\t\t\t|| document.cookie.match(new RegExp('(?:;|^)\\\\s*' + session_name + '=([^;]*)'))\r\n\t\t\t) {\r\n\t\t\t\turl += (url.indexOf('?') >= 0? '&' : '?') + session_name + \"=\" + this.escape(RegExp.$1);\r\n\t\t\t}\r\n\t\t} catch (e) {}\r\n\t\t// Store open arguments to hash.\r\n\t\t_openArgs = {\r\n\t\t\tmethod:     (method || '').toUpperCase(),\r\n\t\t\turl:        url,\r\n\t\t\tasyncFlag:  asyncFlag,\r\n\t\t\tusername:   username != null? username : '',\r\n\t\t\tpassword:   password != null? password : ''\r\n\t\t}\r\n\t\t_ldObj = null;\r\n\t\t_changeReadyState(1, true); // compatibility with XMLHttpRequest\r\n\t\treturn true;\r\n\t}}\r\n\r\n\t/**\r\n\t* Sends a request to a server.\r\n\t*/\r\n\tt.send = function(content) {\r\n\t\tif (!this.readyState) {\r\n\t\t\t// send without open or after abort: no action (IE behaviour).\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._changeReadyState(1, true); // compatibility with XMLHttpRequest\r\n\t\tthis._ldObj = null;\r\n\r\n\t\t// Prepare to build QUERY_STRING from query hash.\r\n\t\tvar queryText = [];\r\n\t\tvar queryElem = [];\r\n\r\n\r\n\t\tif (!this._hash2query(content, null, queryText, queryElem)) return;\r\n\r\n\t\t// Solve the query hashcode & return on cache hit.\r\n\t\tvar hash = null;\r\n\t\tif (this.caching && !queryElem.length) {\r\n\t\t\thash = this._openArgs.username + ':' + this._openArgs.password + '@' + this._openArgs.url + '|' + queryText + \"#\" + this._openArgs.method;\r\n\t\t\tvar cache = JsHttpRequest.CACHE[hash];\r\n\t\t\tif (cache) {\r\n\t\t\t\tthis._dataReady(cache[0], cache[1]);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Try all the loaders.\r\n\t\tvar loader = (this.loader || '').toLowerCase();\r\n\t\tif (loader && !JsHttpRequest.LOADERS[loader]) return this._error('unk_loader', loader);\r\n\t\tvar errors = [];\r\n\t\tvar lds = JsHttpRequest.LOADERS;\r\n\t\tfor (var tryLoader in lds) {\r\n\t\t\tvar ldr = lds[tryLoader].loader;\r\n\t\t\tif (!ldr) continue; // exclude possibly derived prototype properties from \"for .. in\".\r\n\t\t\tif (loader && tryLoader != loader) continue;\r\n\t\t\t// Create sending context.\r\n\t\t\tvar ldObj = new ldr(this);\r\n\t\t\tJsHttpRequest.extend(ldObj, this._openArgs);\r\n\t\t\tJsHttpRequest.extend(ldObj, {\r\n\t\t\t\tqueryText:  queryText.join('&'),\r\n\t\t\t\tqueryElem:  queryElem,\r\n\t\t\t\tid:         (new Date().getTime()) + \"\" + JsHttpRequest.COUNT++,\r\n\t\t\t\thash:       hash,\r\n\t\t\t\tspan:       null\r\n\t\t\t});\r\n\t\t\tvar error = ldObj.load();\r\n\t\t\tif (!error) {\r\n\t\t\t\t// Save loading script.\r\n\t\t\t\tthis._ldObj = ldObj;\r\n\t\t\t\tJsHttpRequest.PENDING[ldObj.id] = this;\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tif (!loader) {\r\n\t\t\t\terrors[errors.length] = '- ' + tryLoader.toUpperCase() + ': ' + this._l(error);\r\n\t\t\t} else {\r\n\t\t\t\treturn this._error(error);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// If no loader matched, generate error message.\r\n\t\treturn tryLoader? this._error('no_loader_matched', errors.join('\\n')) : this._error('no_loaders');\r\n\t}\r\n\r\n\t/**\r\n\t* Returns all response headers (if supported).\r\n\t*/\r\n\tt.getAllResponseHeaders = function() { with (this) {\r\n\t\treturn _ldObj && _ldObj.getAllResponseHeaders? _ldObj.getAllResponseHeaders() : [];\r\n\t}}\r\n\r\n\t/**\r\n\t* Returns one response header (if supported).\r\n\t*/\r\n\tt.getResponseHeader = function(label) { with (this) {\r\n\t\treturn _ldObj && _ldObj.getResponseHeader? _ldObj.getResponseHeader(label) : null;\r\n\t}}\r\n\r\n\t/**\r\n\t* Adds a request header to a future query.\r\n\t*/\r\n\tt.setRequestHeader = function(label, value) { with (this) {\r\n\t\t_reqHeaders[_reqHeaders.length] = [label, value];\r\n\t}}\r\n\r\n\t//\r\n\t// Internal functions.\r\n\t//\r\n\r\n\t/**\r\n\t* Do all the work when a data is ready.\r\n\t*/\r\n\tt._dataReady = function(text, js) { with (this) {\r\n\t\tif (caching && _ldObj) JsHttpRequest.CACHE[_ldObj.hash] = [text, js];\r\n\t\tresponseText = responseXML = text;\r\n\t\tresponseJS = js;\r\n\t\tif (js !== null) {\r\n\t\t\tstatus = 200;\r\n\t\t\tstatusText = \"OK\";\r\n\t\t} else {\r\n\t\t\tstatus = 500;\r\n\t\t\tstatusText = \"Internal Server Error\";\r\n\t\t}\r\n\t\t_changeReadyState(2);\r\n\t\t_changeReadyState(3);\r\n\t\t_changeReadyState(4);\r\n\t\t_cleanup();\r\n\t}}\r\n\r\n\t/**\r\n\t* Analog of sprintf(), but translates the first parameter by _errors.\r\n\t*/\r\n\tt._l = function(args) {\r\n\t\tvar i = 0, p = 0, msg = this._errors[args[0]];\r\n\t\t// Cannot use replace() with a callback, because it is incompatible with IE5.\r\n\t\twhile ((p = msg.indexOf('%', p)) >= 0) {\r\n\t\t\tvar a = args[++i] + \"\";\r\n\t\t\tmsg = msg.substring(0, p) + a + msg.substring(p + 1, msg.length);\r\n\t\t\tp += 1 + a.length;\r\n\t\t}\r\n\t\treturn msg;\r\n\t}\r\n\r\n\t/**\r\n\t* Called on error.\r\n\t*/\r\n\tt._error = function(msg) {\r\n\t\tmsg = this._l(typeof(msg) == 'string'? arguments : msg)\r\n\t\tmsg = \"JsHttpRequest: \" + msg;\r\n\t\tif (!window.Error) {\r\n\t\t\t// Very old browser...\r\n\t\t\tthrow msg;\r\n\t\t} else if ((new Error(1, 'test')).description == \"test\") {\r\n\t\t\t// We MUST (!!!) pass 2 parameters to the Error() constructor for IE5.\r\n\t\t\tthrow new Error(1, msg);\r\n\t\t} else {\r\n\t\t\t// Mozilla does not support two-parameter call style.\r\n\t\t\tthrow new Error(msg);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t* Convert hash to QUERY_STRING.\r\n\t* If next value is scalar or hash, push it to queryText.\r\n\t* If next value is form element, push [name, element] to queryElem.\r\n\t*/\r\n\tt._hash2query = function(content, prefix, queryText, queryElem) {\r\n\t\tif (prefix == null) prefix = \"\";\r\n\t\tif((''+typeof(content)).toLowerCase() == 'object') {\r\n\t\t\tvar formAdded = false;\r\n\t\t\tif (content && content.parentNode && content.parentNode.appendChild && content.tagName && content.tagName.toUpperCase() == 'FORM') {\r\n\t\t\t\tcontent = { form: content };\r\n\t\t\t}\r\n\t\t\tfor (var k in content) {\r\n\t\t\t\tvar v = content[k];\r\n\t\t\t\tif (v instanceof Function) continue;\r\n\t\t\t\tvar curPrefix = prefix? prefix + '[' + this.escape(k) + ']' : this.escape(k);\r\n\t\t\t\tvar isFormElement = v && v.parentNode && v.parentNode.appendChild && v.tagName;\r\n\r\n\t\t\t\tif (isFormElement) {\r\n\t\t\t\t\tvar tn = v.tagName.toUpperCase();\r\n\r\n\t\t\t\t\tif (tn == 'FORM') {\r\n\t\t\t\t\t\t// FORM itself is passed.\r\n\t\t\t\t\t\tformAdded = true;\r\n\t\t\t\t\t} else if (tn == 'INPUT' || tn == 'TEXTAREA' || tn == 'SELECT') {\r\n\t\t\t\t\t\t// This is a single form elemenent.\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn this._error('inv_form_el', (v.name||''), v.tagName);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tqueryElem[queryElem.length] = { name: curPrefix, e: v };\r\n\t\t\t\t} else if (v instanceof Object) {\r\n\t\t\t\t\tthis._hash2query(v, curPrefix, queryText, queryElem);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// We MUST skip NULL values, because there is no method\r\n\t\t\t\t\t// to pass NULL's via GET or POST request in PHP.\r\n\t\t\t\t\tif (v === null) continue;\r\n\t\t\t\t\t// Convert JS boolean true and false to corresponding PHP values.\r\n\t\t\t\t\tif (v === true) v = 1;\r\n\t\t\t\t\tif (v === false) v = '';\r\n\t\t\t\t\tqueryText[queryText.length] = curPrefix + \"=\" + this.escape('' + v);\r\n\t\t\t\t}\r\n\t\t\t\tif (formAdded && queryElem.length > 1) {\r\n\t\t\t\t\treturn this._error('must_be_single_el');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tqueryText[queryText.length] = content;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t* Remove last used script element (clean memory).\r\n\t*/\r\n\tt._cleanup = function() {\r\n\t\tvar ldObj = this._ldObj;\r\n\t\tif (!ldObj) return;\r\n\t\t// Mark this loading as aborted.\r\n\t\tJsHttpRequest.PENDING[ldObj.id] = false;\r\n\t\tvar span = ldObj.span;\r\n\t\tif (!span) return;\r\n\t\tldObj.span = null;\r\n\t\tvar closure = function() {\r\n\t\t\tspan.parentNode.removeChild(span);\r\n\t\t}\r\n\t\t// IE5 crashes on setTimeout(function() {...}, ...) construction! Use tmp variable.\r\n\t\tJsHttpRequest.setTimeout(closure, 50);\r\n\t}\r\n\r\n\t/**\r\n\t* Change current readyState and call trigger method.\r\n\t*/\r\n\tt._changeReadyState = function(s, reset) { with (this) {\r\n\t\tif (reset) {\r\n\t\t\tstatus = statusText = responseJS = null;\r\n\t\t\tresponseText = '';\r\n\t\t}\r\n\t\treadyState = s;\r\n\t\tif (onreadystatechange) onreadystatechange();\r\n\t}}\r\n\r\n\t/**\r\n\t* JS escape() does not quote '+'.\r\n\t*/\r\n\tt.escape = function(s) {\r\n\t\treturn escape(s).replace(new RegExp('\\\\+','g'), '%2B');\r\n\t}\r\n}\r\n\r\n\r\n// Global library variables.\r\nJsHttpRequest.COUNT = 0;              // unique ID; used while loading IDs generation\r\nJsHttpRequest.MAX_URL_LEN = 2000;     // maximum URL length\r\nJsHttpRequest.CACHE = {};             // cached data\r\nJsHttpRequest.PENDING = {};           // pending loadings\r\nJsHttpRequest.LOADERS = {};           // list of supported data loaders (filled at the bottom of the file)\r\nJsHttpRequest._dummy = function() {}; // avoid memory leaks\r\n\r\n\r\n/**\r\n* These functions are dirty hacks for IE 5.0 which does not increment a\r\n* reference counter for an object passed via setTimeout(). So, if this\r\n* object (closure function) is out of scope at the moment of timeout\r\n* applying, IE 5.0 crashes.\r\n*/\r\n\r\n/**\r\n* Timeout wrappers storage. Used to avoid zeroing of referece counts in IE 5.0.\r\n* Please note that you MUST write \"window.setTimeout\", not \"setTimeout\", else\r\n* IE 5.0 crashes again. Strange, very strange...\r\n*/\r\nJsHttpRequest.TIMEOUTS = { s: window.setTimeout, c: window.clearTimeout };\r\n\r\n/**\r\n* Wrapper for IE5 buggy setTimeout.\r\n* Use this function instead of a usual setTimeout().\r\n*/\r\nJsHttpRequest.setTimeout = function(func, dt) {\r\n\t// Always save inside the window object before a call (for FF)!\r\n\twindow.JsHttpRequest_tmp = JsHttpRequest.TIMEOUTS.s;\r\n\tif (typeof(func) == \"string\") {\r\n\t\tid = window.JsHttpRequest_tmp(func, dt);\r\n\t} else {\r\n\t\tvar id = null;\r\n\t\tvar mediator = function() {\r\n\t\t\tfunc();\r\n\t\t\tdelete JsHttpRequest.TIMEOUTS[id]; // remove circular reference\r\n\t\t}\r\n\t\tid = window.JsHttpRequest_tmp(mediator, dt);\r\n\t\t// Store a reference to the mediator function to the global array\r\n\t\t// (reference count >= 1); use timeout ID as an array key;\r\n\t\tJsHttpRequest.TIMEOUTS[id] = mediator;\r\n\t}\r\n\twindow.JsHttpRequest_tmp = null; // no delete() in IE5 for window\r\n\treturn id;\r\n}\r\n\r\n/**\r\n* Complimental wrapper for clearTimeout.\r\n* Use this function instead of usual clearTimeout().\r\n*/\r\nJsHttpRequest.clearTimeout = function(id) {\r\n\twindow.JsHttpRequest_tmp = JsHttpRequest.TIMEOUTS.c;\r\n\tdelete JsHttpRequest.TIMEOUTS[id]; // remove circular reference\r\n\tvar r = window.JsHttpRequest_tmp(id);\r\n\twindow.JsHttpRequest_tmp = null; // no delete() in IE5 for window\r\n\treturn r;\r\n}\r\n\r\n\r\n/**\r\n* Global static function.\r\n* Simple interface for most popular use-cases.\r\n* You may also pass URLs like \"GET url\" or \"script.GET url\".\r\n*/\r\nJsHttpRequest.query = function(url, content, onready, nocache) {\r\n\tvar req = new this();\r\n\treq.caching = !nocache;\r\n\treq.onreadystatechange = function() {\r\n\t\tif (req.readyState == 4) {\r\n\t\t\tonready(req.responseJS, req.responseText);\r\n\t\t}\r\n\t}\r\n\treq.open(null, url, true);\r\n\treq.send(content);\r\n}\r\n\r\n\r\n/**\r\n* Global static function.\r\n* Called by server backend script on data load.\r\n*/\r\nJsHttpRequest.dataReady = function(d) {\r\n\tvar th = this.PENDING[d.id];\r\n\tdelete this.PENDING[d.id];\r\n\tif (th) {\r\n\t\tth._dataReady(d.text, d.js);\r\n\t} else if (th !== false) {\r\n\t\tthrow \"dataReady(): unknown pending id: \" + d.id;\r\n\t}\r\n}\r\n\r\n\r\n// Adds all the properties of src to dest.\r\nJsHttpRequest.extend = function(dest, src) {\r\n\tfor (var k in src) dest[k] = src[k];\r\n}\r\n\r\n/**\r\n* Each loader has the following properties which must be initialized:\r\n* - method\r\n* - url\r\n* - asyncFlag (ignored)\r\n* - username\r\n* - password\r\n* - queryText (string)\r\n* - queryElem (array)\r\n* - id\r\n* - hash\r\n* - span\r\n*/\r\n\r\n// }}}\r\n\r\n// {{{ xml\r\n// Loader: XMLHttpRequest or ActiveX.\r\n// [+] GET and POST methods are supported.\r\n// [+] Most native and memory-cheap method.\r\n// [+] Backend data can be browser-cached.\r\n// [-] Cannot work in IE without ActiveX.\r\n// [-] No support for loading from different domains.\r\n// [-] No uploading support.\r\n//\r\nJsHttpRequest.LOADERS.xml = { loader: function(req) {\r\n\tJsHttpRequest.extend(req._errors, {\r\n\t\txml_no:          'Cannot use XMLHttpRequest or ActiveX loader: not supported',\r\n\t\txml_no_diffdom:  'Cannot use XMLHttpRequest to load data from different domain %',\r\n\t\txml_no_headers:  'Cannot use XMLHttpRequest loader or ActiveX loader, POST method: headers setting is not supported, needed to work with encodings correctly',\r\n\t\txml_no_form_upl: 'Cannot use XMLHttpRequest loader: direct form elements using and uploading are not implemented'\r\n\t});\r\n\r\n\tthis.load = function() {\r\n\t\tif (this.queryElem.length) return ['xml_no_form_upl'];\r\n\r\n\t\t// XMLHttpRequest (and MS ActiveX'es) cannot work with different domains.\r\n\t\tif (this.url.match(new RegExp('^([a-z]+://[^\\\\/]+)(.*)', 'i'))) {\r\n\t\t\t// We MUST also check if protocols matched: cannot send from HTTP\r\n\t\t\t// to HTTPS and vice versa.\r\n\t\t\tif (RegExp.$1.toLowerCase() != document.location.protocol + '//' + document.location.hostname.toLowerCase()) {\r\n\t\t\t\treturn ['xml_no_diffdom', RegExp.$1];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Try to obtain a loader.\r\n\t\tvar xr = null;\r\n\t\tif (window.XMLHttpRequest) {\r\n\t\t\ttry { xr = new XMLHttpRequest() } catch(e) {}\r\n\t\t} else if (window.ActiveXObject) {\r\n\t\t\ttry { xr = new ActiveXObject(\"Microsoft.XMLHTTP\") } catch(e) {}\r\n\t\t\tif (!xr) try { xr = new ActiveXObject(\"Msxml2.XMLHTTP\") } catch (e) {}\r\n\t\t}\r\n\t\tif (!xr) return ['xml_no'];\r\n\r\n\t\t// Loading method detection. We cannot POST if we cannot set \"octet-stream\"\r\n\t\t// header, because we need to process the encoded data in the backend manually.\r\n\t\tvar canSetHeaders = window.ActiveXObject || xr.setRequestHeader;\r\n\t\tif (!this.method) this.method = canSetHeaders && this.queryText.length? 'POST' : 'GET';\r\n\r\n\t\t// Build & validate the full URL.\r\n\t\tif (this.method == 'GET') {\r\n\t\t\tif (this.queryText) this.url += (this.url.indexOf('?') >= 0? '&' : '?') + this.queryText;\r\n\t\t\tthis.queryText = '';\r\n\t\t\tif (this.url.length > JsHttpRequest.MAX_URL_LEN) return ['url_too_long', JsHttpRequest.MAX_URL_LEN];\r\n\t\t} else if (this.method == 'POST' && !canSetHeaders) {\r\n\t\t\treturn ['xml_no_headers'];\r\n\t\t}\r\n\r\n\t\t// Add ID to the url if we need to disable the cache.\r\n\t\tthis.url += (this.url.indexOf('?') >= 0? '&' : '?') + 'JsHttpRequest=' + (req.caching? '0' : this.id) + '-xml';\r\n\r\n\t\t// Assign the result handler.\r\n\t\tvar id = this.id;\r\n\t\txr.onreadystatechange = function() {\r\n\t\t\tif (xr.readyState != 4) return;\r\n\t\t\t// Avoid memory leak by removing the closure.\r\n\t\t\txr.onreadystatechange = JsHttpRequest._dummy;\r\n\t\t\treq.status = null;\r\n\t\t\ttry {\r\n\t\t\t\t// In case of abort() call, xr.status is unavailable and generates exception.\r\n\t\t\t\t// But xr.readyState equals to 4 in this case. Stupid behaviour. :-(\r\n\t\t\t\treq.status = xr.status;\r\n\t\t\t\treq.responseText = xr.responseText;\r\n\t\t\t} catch (e) {}\r\n\t\t\tif (!req.status) return;\r\n\t\t\ttry {\r\n\t\t\t\t// Prepare generator function & catch syntax errors on this stage.\r\n\t\t\t\teval('JsHttpRequest._tmp = function(id) { var d = ' + req.responseText + '; d.id = id; JsHttpRequest.dataReady(d); }');\r\n\t\t\t} catch (e) {\r\n\t\t\t\t// Note that FF 2.0 does not throw any error from onreadystatechange handler.\r\n\t\t\t\treturn req._error('js_invalid', req.responseText)\r\n\t\t\t}\r\n\t\t\t// Call associated dataReady() outside the try-catch block\r\n\t\t\t// to pass exceptions in onreadystatechange in usual manner.\r\n\t\t\tJsHttpRequest._tmp(id);\r\n\t\t\tJsHttpRequest._tmp = null;\r\n\t\t};\r\n\r\n\t\t// Open & send the request.\r\n\t\txr.open(this.method, this.url, true, this.username, this.password);\r\n\t\tif (canSetHeaders) {\r\n\t\t\t// Pass pending headers.\r\n\t\t\tfor (var i = 0; i < req._reqHeaders.length; i++) {\r\n\t\t\t\txr.setRequestHeader(req._reqHeaders[i][0], req._reqHeaders[i][1]);\r\n\t\t\t}\r\n\t\t\t// Set non-default Content-type. We cannot use\r\n\t\t\t// \"application/x-www-form-urlencoded\" here, because\r\n\t\t\t// in PHP variable HTTP_RAW_POST_DATA is accessible only when\r\n\t\t\t// enctype is not default (e.g., \"application/octet-stream\"\r\n\t\t\t// is a good start). We parse POST data manually in backend\r\n\t\t\t// library code. Note that Safari sets by default \"x-www-form-urlencoded\"\r\n\t\t\t// header, but FF sets \"text/xml\" by default.\r\n\t\t\txr.setRequestHeader('Content-Type', 'application/octet-stream');\r\n\t\t}\r\n\t\txr.send(this.queryText);\r\n\r\n\t\t// No SPAN is used for this loader.\r\n\t\tthis.span = null;\r\n\t\tthis.xr = xr; // save for later usage on abort()\r\n\r\n\t\t// Success.\r\n\t\treturn null;\r\n\t}\r\n\r\n\t// Override req.getAllResponseHeaders method.\r\n\tthis.getAllResponseHeaders = function() {\r\n\t\treturn this.xr.getAllResponseHeaders();\r\n\t}\r\n\r\n\t// Override req.getResponseHeader method.\r\n\tthis.getResponseHeader = function(label) {\r\n\t\treturn this.xr.getResponseHeader(label);\r\n\t}\r\n\r\n\tthis.abort = function() {\r\n\t\tthis.xr.abort();\r\n\t\tthis.xr = null;\r\n\t}\r\n}}\r\n// }}}\r\n\r\n\r\n// {{{ script\r\n// Loader: SCRIPT tag.\r\n// [+] Most cross-browser.\r\n// [+] Supports loading from different domains.\r\n// [-] Only GET method is supported.\r\n// [-] No uploading support.\r\n// [-] Backend data cannot be browser-cached.\r\n//\r\nJsHttpRequest.LOADERS.script = { loader: function(req) {\r\n\tJsHttpRequest.extend(req._errors, {\r\n\t\tscript_only_get:   'Cannot use SCRIPT loader: it supports only GET method',\r\n\t\tscript_no_form:    'Cannot use SCRIPT loader: direct form elements using and uploading are not implemented'\r\n\t})\r\n\r\n\tthis.load = function() {\r\n\t\t// Move GET parameters to the URL itself.\r\n\t\tif (this.queryText) this.url += (this.url.indexOf('?') >= 0? '&' : '?') + this.queryText;\r\n\t\tthis.url += (this.url.indexOf('?') >= 0? '&' : '?') + 'JsHttpRequest=' + this.id + '-' + 'script';\r\n\t\tthis.queryText = '';\r\n\r\n\t\tif (!this.method) this.method = 'GET';\r\n\t\tif (this.method !== 'GET') return ['script_only_get'];\r\n\t\tif (this.queryElem.length) return ['script_no_form'];\r\n\t\tif (this.url.length > JsHttpRequest.MAX_URL_LEN) return ['url_too_long', JsHttpRequest.MAX_URL_LEN];\r\n\r\n\t\tvar th = this, d = document, s = null, b = d.body;\r\n\t\tif (!window.opera) {\r\n\t\t\t// Safari, IE, FF, Opera 7.20.\r\n\t\t\tthis.span = s = d.createElement('SCRIPT');\r\n\t\t\tvar closure = function() {\r\n\t\t\t\ts.language = 'JavaScript';\r\n\t\t\t\tif (s.setAttribute) s.setAttribute('src', th.url); else s.src = th.url;\r\n\t\t\t\tb.insertBefore(s, b.lastChild);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Oh shit! Damned stupid Opera 7.23 does not allow to create SCRIPT\r\n\t\t\t// element over createElement (in HEAD or BODY section or in nested SPAN -\r\n\t\t\t// no matter): it is created deadly, and does not response the href assignment.\r\n\t\t\t// So - always create SPAN.\r\n\t\t\tthis.span = s = d.createElement('SPAN');\r\n\t\t\ts.style.display = 'none';\r\n\t\t\tb.insertBefore(s, b.lastChild);\r\n\t\t\ts.innerHTML = 'Workaround for IE.<s'+'cript></' + 'script>';\r\n\t\t\tvar closure = function() {\r\n\t\t\t\ts = s.getElementsByTagName('SCRIPT')[0]; // get with timeout!\r\n\t\t\t\ts.language = 'JavaScript';\r\n\t\t\t\tif (s.setAttribute) s.setAttribute('src', th.url); else s.src = th.url;\r\n\t\t\t}\r\n\t\t}\r\n\t\tJsHttpRequest.setTimeout(closure, 10);\r\n\r\n\t\t// Success.\r\n\t\treturn null;\r\n\t}\r\n}}\r\n// }}}\r\n\r\n\r\n// {{{ form\r\n// Loader: FORM & IFRAME.\r\n// [+] Supports file uploading.\r\n// [+] GET and POST methods are supported.\r\n// [+] Supports loading from different domains.\r\n// [-] Uses a lot of system resources.\r\n// [-] Backend data cannot be browser-cached.\r\n// [-] Pollutes browser history on some old browsers.\r\n//\r\nJsHttpRequest.LOADERS.form = { loader: function(req) {\r\n\tJsHttpRequest.extend(req._errors, {\r\n\t\tform_el_not_belong:  'Element \"%\" does not belong to any form!',\r\n\t\tform_el_belong_diff: 'Element \"%\" belongs to a different form. All elements must belong to the same form!',\r\n\t\tform_el_inv_enctype: 'Attribute \"enctype\" of the form must be \"%\" (for IE), \"%\" given.'\r\n\t})\r\n\r\n\tthis.load = function() {\r\n\t\tvar th = this;\r\n\r\n\t\tif (!th.method) th.method = 'POST';\r\n\t\tth.url += (th.url.indexOf('?') >= 0? '&' : '?') + 'JsHttpRequest=' + th.id + '-' + 'form';\r\n\r\n\t\t// If GET, build full URL. Then copy QUERY_STRING to queryText.\r\n\t\tif (th.method == 'GET') {\r\n\t\t\tif (th.queryText) th.url += (th.url.indexOf('?') >= 0? '&' : '?') + th.queryText;\r\n\t\t\tif (th.url.length > JsHttpRequest.MAX_URL_LEN) return ['url_too_long', JsHttpRequest.MAX_URL_LEN];\r\n\t\t\tvar p = th.url.split('?', 2);\r\n\t\t\tth.url = p[0];\r\n\t\t\tth.queryText = p[1] || '';\r\n\t\t}\r\n\r\n\t\t// Check if all form elements belong to same form.\r\n\t\tvar form = null;\r\n\t\tvar wholeFormSending = false;\r\n\t\tif (th.queryElem.length) {\r\n\t\t\tif (th.queryElem[0].e.tagName.toUpperCase() == 'FORM') {\r\n\t\t\t\t// Whole FORM sending.\r\n\t\t\t\tform = th.queryElem[0].e;\r\n\t\t\t\twholeFormSending = true;\r\n\t\t\t\tth.queryElem = [];\r\n\t\t\t} else {\r\n\t\t\t\t// If we have at least one form element, we use its FORM as a POST container.\r\n\t\t\t\tform = th.queryElem[0].e.form;\r\n\t\t\t\t// Validate all the elements.\r\n\t\t\t\tfor (var i = 0; i < th.queryElem.length; i++) {\r\n\t\t\t\t\tvar e = th.queryElem[i].e;\r\n\t\t\t\t\tif (!e.form) {\r\n\t\t\t\t\t\treturn ['form_el_not_belong', e.name];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (e.form != form) {\r\n\t\t\t\t\t\treturn ['form_el_belong_diff', e.name];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Check enctype of the form.\r\n\t\t\tif (th.method == 'POST') {\r\n\t\t\t\tvar need = \"multipart/form-data\";\r\n\t\t\t\tvar given = (form.attributes.encType && form.attributes.encType.nodeValue) || (form.attributes.enctype && form.attributes.enctype.value) || form.enctype;\r\n\t\t\t\tif (given != need) {\r\n\t\t\t\t\treturn ['form_el_inv_enctype', need, given];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Create invisible IFRAME with temporary form (form is used on empty queryElem).\r\n\t\t// We ALWAYS create th IFRAME in the document of the form - for Opera 7.20.\r\n\t\tvar d = form && (form.ownerDocument || form.document) || document;\r\n\t\tvar ifname = 'jshr_i_' + th.id;\r\n\t\tvar s = th.span = d.createElement('DIV');\r\n\t\ts.style.position = 'absolute';\r\n\t\ts.style.display = 'none';\r\n\t\ts.style.visibility = 'hidden';\r\n\t\ts.innerHTML =\r\n\t\t(form? '' : '<form' + (th.method == 'POST'? ' enctype=\"multipart/form-data\" method=\"post\"' : '') + '></form>') + // stupid IE, MUST use innerHTML assignment :-(\r\n\t\t'<iframe name=\"' + ifname + '\" id=\"' + ifname + '\" style=\"width:0px; height:0px; overflow:hidden; border:none\"></iframe>'\r\n\t\tif (!form) {\r\n\t\t\tform = th.span.firstChild;\r\n\t\t}\r\n\r\n\t\t// Insert generated form inside the document.\r\n\t\t// Be careful: don't forget to close FORM container in document body!\r\n\t\td.body.insertBefore(s, d.body.lastChild);\r\n\r\n\t\t// Function to safely set the form attributes. Parameter attr is NOT a hash\r\n\t\t// but an array, because \"for ... in\" may badly iterate over derived attributes.\r\n\t\tvar setAttributes = function(e, attr) {\r\n\t\t\tvar sv = [];\r\n\t\t\tvar form = e;\r\n\t\t\t// This strange algorythm is needed, because form may  contain element\r\n\t\t\t// with name like 'action'. In IE for such attribute will be returned\r\n\t\t\t// form element node, not form action. Workaround: copy all attributes\r\n\t\t\t// to new empty form and work with it, then copy them back. This is\r\n\t\t\t// THE ONLY working algorythm since a lot of bugs in IE5.0 (e.g.\r\n\t\t\t// with e.attributes property: causes IE crash).\r\n\t\t\tif (e.mergeAttributes) {\r\n\t\t\t\tvar form = d.createElement('form');\r\n\t\t\t\tform.mergeAttributes(e, false);\r\n\t\t\t}\r\n\t\t\tfor (var i = 0; i < attr.length; i++) {\r\n\t\t\t\tvar k = attr[i][0], v = attr[i][1];\r\n\t\t\t\t// TODO: http://forum.dklab.ru/viewtopic.php?p=129059#129059\r\n\t\t\t\tsv[sv.length] = [k, form.getAttribute(k)];\r\n\t\t\t\tform.setAttribute(k, v);\r\n\t\t\t}\r\n\t\t\tif (e.mergeAttributes) {\r\n\t\t\t\te.mergeAttributes(form, false);\r\n\t\t\t}\r\n\t\t\treturn sv;\r\n\t\t}\r\n\r\n\t\t// Run submit with delay - for old Opera: it needs some time to create IFRAME.\r\n\t\tvar closure = function() {\r\n\t\t\t// Save JsHttpRequest object to new IFRAME.\r\n\t\t\ttop.JsHttpRequestGlobal = JsHttpRequest;\r\n\r\n\t\t\t// Disable ALL the form elements.\r\n\t\t\tvar savedNames = [];\r\n\t\t\tif (!wholeFormSending) {\r\n\t\t\t\tfor (var i = 0, n = form.elements.length; i < n; i++) {\r\n\t\t\t\t\tsavedNames[i] = form.elements[i].name;\r\n\t\t\t\t\tform.elements[i].name = '';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Insert hidden fields to the form.\r\n\t\t\tvar qt = th.queryText.split('&');\r\n\t\t\tfor (var i = qt.length - 1; i >= 0; i--) {\r\n\t\t\t\tvar pair = qt[i].split('=', 2);\r\n\t\t\t\tvar e = d.createElement('INPUT');\r\n\t\t\t\te.type = 'hidden';\r\n\t\t\t\te.name = unescape(pair[0]);\r\n\t\t\t\te.value = pair[1] != null? unescape(pair[1]) : '';\r\n\t\t\t\tform.appendChild(e);\r\n\t\t\t}\r\n\r\n\r\n\t\t\t// Change names of along user-passed form elements.\r\n\t\t\tfor (var i = 0; i < th.queryElem.length; i++) {\r\n\t\t\t\tth.queryElem[i].e.name = th.queryElem[i].name;\r\n\t\t\t}\r\n\r\n\t\t\t// Temporary modify form attributes, submit form, restore attributes back.\r\n\t\t\tvar sv = setAttributes(\r\n\t\t\tform,\r\n\t\t\t[\r\n\t\t\t['action',   th.url],\r\n\t\t\t['method',   th.method],\r\n\t\t\t['onsubmit', null],\r\n\t\t\t['target',   ifname]\r\n\t\t\t]\r\n\t\t\t);\r\n\t\t\tform.submit();\r\n\t\t\tsetAttributes(form, sv);\r\n\r\n\t\t\t// Remove generated temporary hidden elements from the top of the form.\r\n\t\t\tfor (var i = 0; i < qt.length; i++) {\r\n\t\t\t\t// Use \"form.firstChild.parentNode\", not \"form\", or IE5 crashes!\r\n\t\t\t\tform.lastChild.parentNode.removeChild(form.lastChild);\r\n\t\t\t}\r\n\t\t\t// Enable all disabled elements back.\r\n\t\t\tif (!wholeFormSending) {\r\n\t\t\t\tfor (var i = 0, n = form.elements.length; i < n; i++) {\r\n\t\t\t\t\tform.elements[i].name = savedNames[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tJsHttpRequest.setTimeout(closure, 100);\r\n\r\n\t\t// Success.\r\n\t\treturn null;\r\n\t}\r\n}}\r\n// }}}\r\n\r\n"
          },
          "redirectURL": "",
          "headersSize": 251,
          "bodySize": 8931
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-05-31T09:51:38.000Z",
            "lastAccess": "2012-05-30T09:51:38.000Z",
            "eTag": "",
            "hitCount": 18
          }
        },
        "timings": {
          "blocked": 0,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 5,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:38.785+04:00",
        "time": 5,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/js/jquery/jquery.elastic.js?-936011871",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Thu, 15 Sep 2011 12:16:13 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [
            {
              "name": "-936011871",
              "value": ""
            }
          ],
          "headersSize": 724,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Thu, 15 Sep 2011 12:16:13 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Thu, 31 May 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=86400"
            }
          ],
          "content": {
            "mimeType": "application/x-javascript",
            "size": 4155,
            "text": "/**\n*\t@name\t\t\t\t\t\t\tElastic\n*\t@descripton\t\t\t\t\t\tElastic is Jquery plugin that grow and shrink your textareas automaticliy\n*\t@version\t\t\t\t\t\t1.6.4\n*\t@requires\t\t\t\t\t\tJquery 1.2.6+\n*\n*\t@author\t\t\t\t\t\t\tJan Jarfalk\n*\t@author-email\t\t\t\t\tjan.jarfalk@unwrongest.com\n*\t@author-website\t\t\t\t\thttp://www.unwrongest.com\n*\n*\t@licens\t\t\t\t\t\t\tMIT License - http://www.opensource.org/licenses/mit-license.php\n*/\n\n(function(jQuery){ \n\tjQuery.fn.extend({  \n\t\telastic: function() {\n\t\t\n\t\t\t//\tWe will create a div clone of the textarea\n\t\t\t//\tby copying these attributes from the textarea to the div.\n\t\t\tvar mimics = [\n\t\t\t\t'paddingTop',\n\t\t\t\t'paddingRight',\n\t\t\t\t'paddingBottom',\n\t\t\t\t'paddingLeft',\n\t\t\t\t'fontSize',\n\t\t\t\t'lineHeight',\n\t\t\t\t'fontFamily',\n\t\t\t\t'width',\n\t\t\t\t'fontWeight'];\n\t\t\t\n\t\t\t\treturn this.each( function() {\n\t\t\t\t\n\t\t\t\t// Elastic only works on textareas\n\t\t\t\tif ( this.type != 'textarea') {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (jQuery(this).data(\"elastic\") == 1)\n\t\t\t\t{\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvar $textarea\t=\tjQuery(this),\n\t\t\t\ttextareaMaxHeight = parseInt($textarea.css('max-height'),10);\n\t\t\t\t\n\t\t\t\t// Opera bugfix -1\n\t\t\t\tif (textareaMaxHeight = -1)\n\t\t\t\t{\n\t\t\t\t\ttextareaMaxHeight = 0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvar $twin\t\t=\tjQuery('<div />').css({'position': 'absolute','display':'none','word-wrap':'break-word'}),\n\t\t\t\t\tlineHeight\t=\tparseInt($textarea.css('line-height'),10) || parseInt($textarea.css('font-size'),'10'),\n\t\t\t\t\tminheight\t=\tparseInt($textarea.css('height'),10) || lineHeight*5,\n\t\t\t\t\tmaxheight\t=\ttextareaMaxHeight || $textarea.attr('rows')*lineHeight /*add hostcms*/ || Number.MAX_VALUE,\n\t\t\t\t\tgoalheight\t=\t0,\n\t\t\t\t\ti \t\t\t=\t0;\n\n\t\t\t\t$textarea.data(\"elastic\", 1);\n\t\t\t\t\n\t\t\t\t$textarea.unbind('input paste focus');\n\t\t\t\t\n\t\t\t\t// Opera returns max-height of -1 if not set\n\t\t\t\tif (maxheight < 0) { maxheight = Number.MAX_VALUE; }\n\t\t\t\t\t\n\t\t\t\t// Append the twin to the DOM\n\t\t\t\t// We are going to meassure the height of this, not the textarea.\n\t\t\t\t$twin.appendTo($textarea.parent());\n\t\t\t\t\n\t\t\t\t// Copy the essential styles (mimics) from the textarea to the twin\n\t\t\t\tvar i = mimics.length;\n\t\t\t\twhile(i--){\n\t\t\t\t\t$twin.css(mimics[i].toString(),$textarea.css(mimics[i].toString()));\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Sets a given height and overflow state on the textarea\n\t\t\t\tfunction setHeightAndOverflow(height, overflow){\n\t\t\t\t\tcurratedHeight = Math.floor(parseInt(height,10));\n\t\t\t\t\tif($textarea.height() != curratedHeight){\n\t\t\t\t\t\t$textarea.css({'height': curratedHeight + 'px','overflow':overflow});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// This function will update the height of the textarea if necessary \n\t\t\t\tfunction update() {\n\t\t\t\t\t// Get curated content from the textarea.\n\t\t\t\t\tvar textareaContent = $textarea.val().replace(/&/g,'&amp;').replace(/  /g, '&nbsp;').replace(/<|>/g, '&gt;').replace(/\\n/g, '<br />');\n\n\t\t\t\t\tvar twinContent = $twin.html();\n\n\t\t\t\t\tif(textareaContent+'&nbsp;' != twinContent){\n\n\t\t\t\t\t\t// Add an extra white space so new rows are added when you are at the end of a row.\n\t\t\t\t\t\t$twin.html(textareaContent+'&nbsp;');\n\t\t\t\t\t\t\n\t\t\t\t\t\t// DOM timeout\n\t\t\t\t\t\tsetTimeout( function() {\n\t\t\t\t\t\t\t// Change textarea height if twin plus the height of one line differs more than 3 pixel from textarea height\n\t\t\t\t\t\t\tif(Math.abs($twin.height()+lineHeight - $textarea.height()) > 3){\n\t\t\t\t\t\t\t\tvar goalheight = $twin.height()+lineHeight;\n\t\t\t\t\t\t\t\tif(goalheight >= maxheight) {\n\t\t\t\t\t\t\t\t\tsetHeightAndOverflow(maxheight,'auto');\n\t\t\t\t\t\t\t\t} else if(goalheight <= minheight) {\n\t\t\t\t\t\t\t\t\tsetHeightAndOverflow(minheight,'hidden');\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tsetHeightAndOverflow(goalheight,'hidden');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, 500);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Hide scrollbars\n\t\t\t\t//$textarea.css({'overflow':'hidden'});\n\t\t\t\t// hostcms\n\t\t\t\t$textarea.css({'overflow':'auto'});\n\t\t\t\t\n\t\t\t\ttimeoutID = null;\n\t\t\t\t\n\t\t\t\t// Update textarea size on keyup\n\t\t\t\t$textarea.keyup(function(){ clearTimeout(timeoutID); timeoutID = setTimeout( update, 300); });\n\t\t\t\t\n\t\t\t\t// And this line is to catch the browser paste event\n\t\t\t\t$textarea.bind('input paste focus',function(e){ clearTimeout(timeoutID); timeoutID = setTimeout( update, 300); });\t\t\t\t\n\t\t\t\t\n\t\t\t\t// Run update once when elastic is initialized\n\t\t\t\tupdate();\n\t\t\t});\n        }\n    }); \n})(jQuery);"
          },
          "redirectURL": "",
          "headersSize": 251,
          "bodySize": 1645
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-05-31T09:51:38.000Z",
            "lastAccess": "2012-05-30T09:51:38.000Z",
            "eTag": "",
            "hitCount": 18
          }
        },
        "timings": {
          "blocked": 0,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 5,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:38.785+04:00",
        "time": 6,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/js/tools/jquery.tools.js?-936011871",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Thu, 15 Sep 2011 12:16:13 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [
            {
              "name": "-936011871",
              "value": ""
            }
          ],
          "headersSize": 721,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Thu, 15 Sep 2011 12:16:13 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Thu, 31 May 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=86400"
            }
          ],
          "content": {
            "mimeType": "application/x-javascript",
            "size": 3563,
            "text": "/*\n * jQuery Tools 1.2.4 - The missing UI library for the Web\n * \n * [tooltip]\n * \n * NO COPYRIGHTS OR LICENSES. DO WHAT YOU LIKE.\n * \n * http://flowplayer.org/tools/\n * \n * File generated: Mon Aug 30 08:49:23 GMT 2010\n */\n(function(f){function p(a,b,c){var h=c.relative?a.position().top:a.offset().top,e=c.relative?a.position().left:a.offset().left,i=c.position[0];h-=b.outerHeight()-c.offset[0];e+=a.outerWidth()+c.offset[1];var j=b.outerHeight()+a.outerHeight();if(i==\"center\")h+=j/2;if(i==\"bottom\")h+=j;i=c.position[1];a=b.outerWidth()+a.outerWidth();if(i==\"center\")e-=a/2;if(i==\"left\")e-=a;return{top:h,left:e}}function u(a,b){var c=this,h=a.add(c),e,i=0,j=0,m=a.attr(\"title\"),q=a.attr(\"data-tooltip\"),r=n[b.effect],l,s=\na.is(\":input\"),v=s&&a.is(\":checkbox, :radio, select, :button, :submit\"),t=a.attr(\"type\"),k=b.events[t]||b.events[s?v?\"widget\":\"input\":\"def\"];if(!r)throw'Nonexistent effect \"'+b.effect+'\"';k=k.split(/,\\s*/);if(k.length!=2)throw\"Tooltip: bad events configuration for \"+t;a.bind(k[0],function(d){clearTimeout(i);if(b.predelay)j=setTimeout(function(){c.show(d)},b.predelay);else c.show(d)}).bind(k[1],function(d){clearTimeout(j);if(b.delay)i=setTimeout(function(){c.hide(d)},b.delay);else c.hide(d)});if(m&&\nb.cancelDefault){a.removeAttr(\"title\");a.data(\"title\",m)}f.extend(c,{show:function(d){if(!e){if(q)e=f(q);else if(m)e=f(b.layout).addClass(b.tipClass).appendTo(document.body).hide().append(m);else if(b.tip)e=f(b.tip).eq(0);else{e=a.next();e.length||(e=a.parent().next())}if(!e.length)throw\"Cannot find tooltip for \"+a;}if(c.isShown())return c;e.stop(true,true);var g=p(a,e,b);d=d||f.Event();d.type=\"onBeforeShow\";h.trigger(d,[g]);if(d.isDefaultPrevented())return c;g=p(a,e,b);e.css({position:\"absolute\",\ntop:g.top,left:g.left});l=true;r[0].call(c,function(){d.type=\"onShow\";l=\"full\";h.trigger(d)});g=b.events.tooltip.split(/,\\s*/);e.bind(g[0],function(){clearTimeout(i);clearTimeout(j)});g[1]&&!a.is(\"input:not(:checkbox, :radio), textarea\")&&e.bind(g[1],function(o){o.relatedTarget!=a[0]&&a.trigger(k[1].split(\" \")[0])});return c},hide:function(d){if(!e||!c.isShown())return c;d=d||f.Event();d.type=\"onBeforeHide\";h.trigger(d);if(!d.isDefaultPrevented()){l=false;n[b.effect][1].call(c,function(){d.type=\"onHide\";\nh.trigger(d)});return c}},isShown:function(d){return d?l==\"full\":l},getConf:function(){return b},getTip:function(){return e},getTrigger:function(){return a}});f.each(\"onHide,onBeforeShow,onShow,onBeforeHide\".split(\",\"),function(d,g){f.isFunction(b[g])&&f(c).bind(g,b[g]);c[g]=function(o){f(c).bind(g,o);return c}})}f.tools=f.tools||{version:\"1.2.4\"};f.tools.tooltip={conf:{effect:\"toggle\",fadeOutSpeed:\"fast\",predelay:0,delay:30,opacity:1,tip:0,position:[\"top\",\"center\"],offset:[0,0],relative:false,cancelDefault:true,\nevents:{def:\"mouseenter,mouseleave\",input:\"focus,blur\",widget:\"focus mouseenter,blur mouseleave\",tooltip:\"mouseenter,mouseleave\"},layout:\"<div/>\",tipClass:\"tooltip\"},addEffect:function(a,b,c){n[a]=[b,c]}};var n={toggle:[function(a){var b=this.getConf(),c=this.getTip();b=b.opacity;b<1&&c.css({opacity:b});c.show();a.call()},function(a){this.getTip().hide();a.call()}],fade:[function(a){var b=this.getConf();this.getTip().fadeTo(b.fadeInSpeed,b.opacity,a)},function(a){this.getTip().fadeOut(this.getConf().fadeOutSpeed,\na)}]};f.fn.tooltip=function(a){var b=this.data(\"tooltip\");if(b)return b;a=f.extend(true,{},f.tools.tooltip.conf,a);if(typeof a.position==\"string\")a.position=a.position.split(/,?\\s/);this.each(function(){b=new u(f(this),a);f(this).data(\"tooltip\",b)});return a.api?b:this}})(jQuery);\n"
          },
          "redirectURL": "",
          "headersSize": 251,
          "bodySize": 1617
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-05-31T09:51:38.000Z",
            "lastAccess": "2012-05-30T09:51:38.000Z",
            "eTag": "",
            "hitCount": 18
          }
        },
        "timings": {
          "blocked": 0,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 6,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:38.785+04:00",
        "time": 10,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/wysiwyg/fm/fm.js?-936011871",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Thu, 15 Sep 2011 12:16:16 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [
            {
              "name": "-936011871",
              "value": ""
            }
          ],
          "headersSize": 713,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Thu, 15 Sep 2011 12:16:16 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Thu, 31 May 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=86400"
            }
          ],
          "content": {
            "mimeType": "application/x-javascript",
            "size": 900,
            "text": "function FM (defaultpath)\r\n{\r\n\tthis.defaultpath = defaultpath;\r\n};\r\n\r\nFM.prototype.fileBrowserCallBack = function(field_name, url, type, win)\r\n{\r\n\tthis.field = field_name;\r\n\tthis.callerWindow = win;\r\n\r\n\tif (url == '')\r\n\t{\r\n\t\turl = this.defaultpath;\r\n\t}\r\n\r\n\tvar path = \"/admin/wysiwyg/fm/fm.php?field_name=\" + field_name + \"&cdir=\" + url + \"&type=\" + type;\r\n\r\n\tvar width = 700;\r\n\tvar height = 500;\r\n\r\n\tvar x = parseInt(screen.width / 2.0) - (width / 2.0);\r\n\tvar y = parseInt(screen.height / 2.0) - (height / 2.0);\r\n\r\n\tvar win = window.open(path, \"FM\", \"top=\" + y + \",left=\" + x + \",scrollbars=yes,width=\" + width + \",height=\" + height + \",resizable=yes\");\r\n}\r\n\r\nFM.prototype.insertFile = function(url)\r\n{\r\n\tvar url;\r\n\r\n\tthis.callerWindow.document.forms[0].elements[this.field].value = url;\r\n\r\n\ttry\r\n\t{\r\n\t\tthis.callerWindow.document.forms[0].elements[this.field].onchange();\r\n\t}\r\n\tcatch (e)\r\n\t{\r\n\t}\r\n};"
          },
          "redirectURL": "",
          "headersSize": 251,
          "bodySize": 448
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-05-31T09:51:38.000Z",
            "lastAccess": "2012-05-30T09:51:38.000Z",
            "eTag": "",
            "hitCount": 18
          }
        },
        "timings": {
          "blocked": 5,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 5,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:38.786+04:00",
        "time": 9,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/js/main.js?-936011871",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Thu, 15 Sep 2011 12:16:13 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [
            {
              "name": "-936011871",
              "value": ""
            }
          ],
          "headersSize": 707,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Thu, 15 Sep 2011 12:16:13 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Thu, 31 May 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=86400"
            }
          ],
          "content": {
            "mimeType": "application/x-javascript",
            "size": 53428,
            "text": "/**\r\n * HostCMS\r\n * \r\n * @author Hostmake LLC, http://www.hostcms.ru/\r\n * @version 5.x\r\n */\r\n\r\n(function($) {\r\n\t// Предварительная загрузка изображений\r\n\tvar cache = [];\r\n\t\r\n\t$.extend({\r\n\tpreLoadImages: function()\r\n\t{\r\n\t\tvar args_len = arguments.length;\r\n\r\n\t\tfor (var i = args_len; i--;)\r\n\t\t{\r\n\t\t\tvar cacheImage = document.createElement('img');\r\n\t\t\tcacheImage.src = arguments[i];\r\n\t\t\tcache.push(cacheImage);\r\n\t\t}\r\n\t}\r\n\t});\r\n  \r\n\t$.preLoadImages(\"/admin/images/shadow-b.png\",\r\n\t\"/admin/images/shadow-l.png\",\r\n\t\"/admin/images/shadow-lb.png\",\r\n\t\"/admin/images/shadow-lt.png\",\r\n\t\"/admin/images/shadow-r.png\",\r\n\t\"/admin/images/shadow-rb.png\",\r\n\t\"/admin/images/shadow-rt.png\",\r\n\t\"/admin/images/shadow-t.png\",\r\n\t\"/admin/images/ajax_loader.gif\");\r\n\r\n\t// Тень для окна\r\n\t$.fn.extend({\r\n\t\tapplyShadow: function()\r\n\t\t{\r\n\t\t\treturn this.each(function(index, object){\r\n\t\t\t\tvar obj = $(object);\r\n\t\t\t\t\r\n\t\t\t\t$('<div>').attr(\"class\", 'tl').appendTo(obj);\r\n\t\t    \t$('<div>').attr(\"class\", 't')\r\n\t\t    \t.height(15)\r\n\t\t    \t.appendTo(obj);\r\n\t\t    \t\r\n\t\t    \t$('<div>').attr(\"class\", 'tr').appendTo(obj);\r\n\t\t    \t$('<div>').attr(\"class\", 'l')\r\n\t\t    \t.width(17)\r\n\t\t    \t.appendTo(obj);\r\n\t\t    \t\r\n\t\t    \t$('<div>').attr(\"class\", 'r')\r\n\t\t    \t.width(17)\r\n\t\t    \t.appendTo(obj);\r\n\t\t    \t\r\n\t\t    \t$('<div>').attr(\"class\", 'bl').appendTo(obj);\r\n\t\t    \t\r\n\t\t    \t$('<div>').attr(\"class\", 'b')\r\n\t\t    \t.height(21)\r\n\t\t    \t.appendTo(obj);\r\n\t\t    \t\r\n\t\t    \t$('<div>').attr(\"class\", 'br').appendTo(obj);\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\t\r\n\t$.extend({\r\n\t\tappendInput: function(WindowId, ObjectId, InputName, InputValue)\r\n\t\t{\r\n\t\t\tWindowId = getWindowId(WindowId);\r\n\t\t\t\r\n\t\t\tvar obj = $('#'+WindowId+' #'+ObjectId);\r\n\t\t\t\r\n\t\t\tif (obj.length == 1\r\n\t\t\t&& obj.find(\"input[name='\"+InputName+\"']\").length == 0)\r\n\t\t\t{\r\n\t\t\t\t$('#'+WindowId+' #'+ObjectId).append(\r\n\t\t\t\t\t$('<input>')\r\n\t\t\t\t\t.attr('type', 'hidden')\r\n\t\t\t\t\t.attr('name', InputName)\r\n\t\t\t\t\t.val(InputValue));\r\n\t\t\t}\r\n\t\t}\r\n\t\t});\r\n})(jQuery)\r\n\r\nfunction applyTooltip()\r\n{\r\n\t$(\"acronym\").tooltip({\r\n\t\t'tipClass': 'shadowed',\r\n\t\t'offset': [-30, 10],\r\n\t\t'position': 'left center',\r\n\t\tpredelay: 500,\r\n\t\teffect: 'fade',\r\n\t\tlayout: '<div id=\"tooltip\"/>',\r\n\t\tslideOffset: 30,\r\n\t\tonBeforeShow: function(event, position)\r\n\t\t{\r\n\t    \tvar trigger = this.getTrigger();\r\n\t    \tvar obj = this.getTip();\r\n\t\t\tvar conf = this.getConf();\r\n\r\n\t\t\tvar triggerOuterWidth = trigger.outerWidth();\r\n\t\t\t\r\n\t\t\tvar delta = (obj.outerWidth() + triggerOuterWidth) / 2 - triggerOuterWidth + 10;\r\n\r\n\t\t\t// Заменяем смещение, чтобы подсказка была от начала строки\r\n\t\t\tconf.offset = [conf.offset[0], delta];\r\n    \t\t\r\n\t    \t// Оформление еще не было задано\r\n\t\t\tif (obj.find('.tl').size() == 0)\r\n\t\t\t{\r\n\t\t\t\tobj.applyShadow();\r\n\r\n\t\t\t\t// Tail\r\n\t\t    \t$('<div>').attr(\"class\", 'shadow_tail')\r\n\t\t    \t.css('left', \"3px\")\r\n\t\t    \t.css('bottom', \"-30px\")\r\n\t\t    \t.css('width', \"13px\")\r\n\t\t    \t.append($('<img>').attr(\"src\", '/admin/images/shadow_tail.gif'))\r\n\t\t    \t.appendTo(obj);\r\n\t\t\t}\r\n\t  \t}\r\n\t});\r\n}\r\n\r\n$.ajaxSetup({\r\n\tcache: false,\r\n\terror: function(XMLHttpRequest, textStatus, errorThrown) {\r\n\t\t\tHideLoadingScreen();\r\n\t\t\talert('Ajax error: ' + textStatus + ', ' + errorThrown);\r\n\t\t}\r\n});\r\n\r\nfunction formatTable(WindowId)\r\n{\r\n\tWindowId = getWindowId(WindowId);\r\n\t\r\n\t$(\"#\"+WindowId+\" table.admin_table tr:not(.admin_table_title, .admin_table_filter):nth-child(odd)\")\r\n\t.attr('class', 'row_table')\r\n\t.mouseover(function(){\r\n\t\t$(this).attr('class', 'row_table_over');\r\n\t})\r\n\t.mouseout(function(){\r\n\t\t$(this).attr('class', 'row_table');\r\n\t});\r\n\t\r\n\t$(\"#\"+WindowId+\" table.admin_table tr:not(.admin_table_title, .admin_table_filter):nth-child(even)\").attr('class', 'row_table_odd')\r\n\t.mouseover(function(){\r\n\t\t$(this).attr('class', 'row_table_over_odd');\r\n\t})\r\n\t.mouseout(function(){\r\n\t\t$(this).attr('class', 'row_table_odd');\r\n\t});\r\n}\r\n\r\nfunction formatTextarea(WindowId)\r\n{\r\n\tWindowId = getWindowId(WindowId);\r\n\t$('#'+WindowId+' textarea').elastic();\r\n}\r\n\r\n// Установка cookies\r\n// name - имя параметра\r\n// value - значение параметра\r\n// expires - время жизни куки в секундах\r\n// path - путь куки\r\n// domain - домен\r\nfunction setCookie(name, value, expires, path, domain, secure)\r\n{\r\n\t// если истечение передано - устанавливаем время истечения на expires секунд\r\n\t// вперед\r\n\tif (expires)\r\n\t{\r\n\t\tvar date = new Date();\r\n\t\texpires = (expires * 1000) + date.getTime();\r\n\t\tdate.setTime(expires);\r\n\t}\r\n\r\n\tVarCookie = name + \"=\" + HostcmsEscape(value) +\r\n\t((expires) ? \"; expires=\" + date.toGMTString() : \"\") +\r\n\t((path) ? \"; path=\" + path : \"\") +\r\n\t((domain) ? \"; domain=\" + domain : \"\") +\r\n\t((secure) ? \"; secure\" : \"\");\r\n\r\n\tdocument.cookie = VarCookie;\r\n}\r\n\r\n// Кроссбраузерная функция получения размеров экрана,\r\n// используется в функции ShowLoadingScreen.\r\nfunction getPageSize()\r\n{\r\n\tvar xScroll, yScroll;\r\n\r\n\tif (window.innerHeight && window.scrollMaxY)\r\n\t{\r\n\t\txScroll = window.innerWidth + window.scrollMaxX;\r\n\t\tyScroll = window.innerHeight + window.scrollMaxY;\r\n\t}\r\n\telse if (document.body.scrollHeight > document.body.offsetHeight)\r\n\t{ // all but Explorer Mac\r\n\t\txScroll = document.body.scrollWidth;\r\n\t\tyScroll = document.body.scrollHeight;\r\n\t}\r\n\telse\r\n\t{ // Explorer Mac...would also work in Explorer 6 Strict, Mozilla and\r\n\t\t// Safari\r\n\t\txScroll = document.body.offsetWidth;\r\n\t\tyScroll = document.body.offsetHeight;\r\n\t}\r\n\r\n\tvar windowWidth, windowHeight;\r\n\tif (self.innerHeight)\r\n\t{\t// all except Explorer\r\n\t\tif(document.documentElement.clientWidth)\r\n\t\t{\r\n\t\t\twindowWidth = document.documentElement.clientWidth;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\twindowWidth = self.innerWidth;\r\n\t\t}\r\n\t\twindowHeight = self.innerHeight;\r\n\t}\r\n\telse if (document.documentElement && document.documentElement.clientHeight)\r\n\t{ // Explorer 6 Strict Mode\r\n\t\twindowWidth = document.documentElement.clientWidth;\r\n\t\twindowHeight = document.documentElement.clientHeight;\r\n\t}\r\n\telse if (document.body)\r\n\t{ // other Explorers\r\n\t\twindowWidth = document.body.clientWidth;\r\n\t\twindowHeight = document.body.clientHeight;\r\n\t}\r\n\r\n\t// for small pages with total height less then height of the viewport\r\n\tif(yScroll < windowHeight)\r\n\t{\r\n\t\tpageHeight = windowHeight;\r\n\t}\r\n\telse\r\n\t{\r\n\t\tpageHeight = yScroll;\r\n\t}\r\n\r\n\t// for small pages with total width less then width of the viewport\r\n\tif(xScroll < windowWidth)\r\n\t{\r\n\t\tpageWidth = xScroll;\r\n\t}\r\n\telse\r\n\t{\r\n\t\tpageWidth = windowWidth;\r\n\t}\r\n\r\n\tarrayPageSize = new Array(pageWidth, pageHeight, windowWidth, windowHeight);\r\n\treturn arrayPageSize;\r\n\r\n}\r\n\r\n// Получение информации о позиции скрола\r\nfunction getScrollXY()\r\n{\r\n\tvar scrOfX = 0, scrOfY = 0;\r\n\r\n\tif (typeof(window.pageYOffset ) == 'number' )\r\n\t{\r\n\t\t// Netscape\r\n\t\tscrOfY = window.pageYOffset;\r\n\t\tscrOfX = window.pageXOffset;\r\n\t}\r\n\telse if (document.body && (document.body.scrollLeft || document.body.scrollTop))\r\n\t{\r\n\t\t// DOM\r\n\t\tscrOfY = document.body.scrollTop;\r\n\t\tscrOfX = document.body.scrollLeft;\r\n\t}\r\n\telse if (document.documentElement && (document.documentElement.scrollLeft || document.documentElement.scrollTop))\r\n\t{\r\n\t\t// IE6\r\n\t\tscrOfY = document.documentElement.scrollTop;\r\n\t\tscrOfX = document.documentElement.scrollLeft;\r\n\t}\r\n\r\n\treturn [ scrOfX, scrOfY ];\r\n}\r\n\r\n// Скрытие div-а\r\nfunction HideObject(obj)\r\n{\r\n\tobj.css('zoom', 1)\r\n\t\t.css('width', 0)\r\n\t\t.css('height', 0)\r\n\t\t.css('visibility', 'hidden')\r\n\t\t.css('overflow', 'hidden');\r\n}\r\n\r\n// Показ div-а\r\nfunction ShowObject(obj)\r\n{\r\n\tobj.css('zoom', 1)\r\n\t\t.css('width', 'auto')\r\n\t\t.css('height', 'auto')\r\n\t\t.css('visibility', 'visible')\r\n\t\t.css('overflow', 'visible');\r\n}\r\n\r\n// Показ закладок на странице администрирования\r\nfunction ShowLayer(WindowId, AItemId, ASpan, FormID)\r\n{\r\n\tWindowId = getWindowId(WindowId);\r\n\t\r\n\t// Получаем элемент формы\r\n\tvar FormElement = $(\"#\"+WindowId+\" #\"+FormID);\r\n\t\r\n\tif (FormElement.length > 0)\r\n\t{\r\n\t\t// div\r\n\t\tFormElement.find(\"div[id^='tab_page_'][id!='\"+AItemId+\"']\").each(function(){\r\n\t\t\tHideObject($(this));\r\n\t\t});\r\n\r\n\t\tFormElement.find(\"div[id='\"+AItemId+\"']\").each(function(){\r\n\t\t\tShowObject($(this));\r\n\t\t});\r\n\r\n\t\t// li\r\n\t\tFormElement.find(\"li[id^='id_tab_span_'][id!='\"+ASpan+\"']\").each(function(){\r\n\t\t\t$(this).attr('class', '');\r\n\t\t});\r\n\r\n\t\tFormElement.find(\"li[id='\"+ASpan+\"']\").each(function(){\r\n\t\t\t$(this).attr('class', 'current_li');\r\n\t\t});\r\n\t}\r\n\r\n\treturn true;\r\n}\r\n\r\n// =============================================\r\n// Функции работы с меню\r\n// =============================================\r\nchangeFontSizeTimer = new Array();\r\nmenuTimer = new Array();\r\n\r\nfunction HostCMSMenuOver(CurrenElementId, LevelMenu, ChildId)\r\n{\r\n\tclearTimeout(menuTimer[CurrenElementId]);\r\n\t\r\n\tCurrenElement = $(\"#\"+CurrenElementId);\r\n\r\n\tif (CurrenElement.length > 0)\r\n\t{\r\n\t\tvar jChild = $(\"#\"+ChildId);\r\n\r\n\t\t// Оформление еще не было задано\r\n\t\tif (jChild.find('.tl').size() == 0)\r\n\t\t{\r\n\t\t\tjChild.applyShadow();\r\n\t\t}\r\n\r\n\t\tdecor(CurrenElement, LevelMenu);\r\n\t\t\r\n\t\tjChild.css('display', 'block');\r\n\t}\r\n}\r\n\r\nfunction HostCMSMenuOut(CurrenElementId, LevelMenu, ChildId)\r\n{\r\n\tmenuTimer[CurrenElementId] = setTimeout(function(){\r\n\t\tCurrenElement = $(\"#\"+CurrenElementId);\r\n\r\n\t\tif (CurrenElement.length > 0)\r\n\t\t{\r\n\t\t\tunDecor(CurrenElement, LevelMenu);\r\n\t\t\r\n\t\t\tvar jChild = $(\"#\"+ChildId);\r\n\t\t\tjChild.css('display', 'none');\r\n\t\t}\r\n\t}, 50);\r\n}\r\n\r\n// Функция визуального оформления элементов меню\r\nfunction decor(CurrenElement, LevelMenu)\r\n{\r\n\tif (LevelMenu == 1) // для первого уровня вложенности\r\n\t{\r\n\t\tCurrenElement\r\n\t\t\t.css('background-image', \"url('/admin/images/line3.gif')\")\r\n\t\t\t.css('background-repeat', 'repeat-x')\r\n\t\t\t.css('background-position', '0 100%');\r\n\t\t\r\n\t\tvar child = CurrenElement.children;\r\n\t\tvar CurrenElementId = CurrenElement.attr('id');\r\n\t\t\r\n\t\tif (changeFontSizeTimer[CurrenElementId] != '')\r\n\t\t{\r\n\t\t\tclearTimeout(changeFontSizeTimer[CurrenElementId]);\r\n\t\t}\r\n\t\tchangeFontSize(CurrenElement.attr('id'), 1, 13);\r\n\t}\r\n}\r\n\r\n// Функция визуального оформления элементов меню\r\nfunction unDecor(CurrenElement, LevelMenu)\r\n{\r\n\tif (LevelMenu==1)\r\n\t{\r\n\t\tvar CurrenElementId = CurrenElement.attr('id');\r\n\t\t\r\n\t\tclearTimeout(changeFontSizeTimer[CurrenElementId]);\r\n\r\n\t\tCurrenElement\r\n\t\t\t.css('background-image', \"url('/admin/images/line1.gif')\")\r\n\t\t\t.css('background-repeat', 'repeat-x')\r\n\t\t\t.css('background-position', '0 100%');\r\n\t\t\r\n\t\tchangeFontSize(CurrenElement.attr('id'), -1, 10);\r\n\t}\r\n}\r\n\r\n// Функции оформления\r\nfunction changeFontSize(CurrenElementId, change, limit)\r\n{\r\n\tvar CurrenElement = document.getElementById(CurrenElementId);\r\n\r\n\tif (CurrenElement)\r\n\t{\r\n\t\tvar CurrFontSize = CurrenElement.style.fontSize ? parseInt(CurrenElement.style.fontSize) : 10;\r\n\t\tif (CurrFontSize != limit)\r\n\t\t{\r\n\t\t\tCurrenElement.style.fontSize = (CurrFontSize + change) + 'pt';\r\n\t\t\tchangeFontSizeTimer[CurrenElementId] = setTimeout('changeFontSize(\"'+CurrenElementId+'\", '+change+', '+limit+')', 1);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Создание окна\r\n * \r\n * @param windowId идентификатор окна\r\n * @param windowTitle заголовок окна\r\n * @param windowWidth ширина окна\r\n * @param windowHeight высота окна\r\n * @param type тип закрытия окна, 0 - скрыть, 1 - уничтожить\r\n */\r\nfunction CreateWindow(windowId, windowTitle, windowWidth, windowHeight, typeClose)\r\n{\r\n\tvar removeWindow = (typeof typeClose != 'undefined' && typeClose == 1);\r\n\t\t\r\n\tvar windowDiv = document.getElementById(windowId);\r\n\r\n\tif (windowDiv == undefined)\r\n\t{\r\n\t\t// Создаем div для окна\r\n\t\tvar fade_div = document.createElement(\"div\");\r\n\t\tfade_div.setAttribute(\"id\", windowId);\r\n\t\tvar body = document.getElementsByTagName(\"body\")[0];\r\n\t\twindowDiv = body.appendChild(fade_div);\r\n\t}\r\n\r\n\t// Тень\r\n\twindowDiv.className = \"shadowed\";\r\n\r\n\tif (windowWidth == '')\r\n\t{\r\n\t\twindowWidth = '300px';\r\n\t}\r\n\r\n\twindowDiv.style.width = windowWidth;\r\n\r\n\tif (windowHeight != '')\r\n\t{\r\n\t\twindowDiv.style.height = windowHeight;\r\n\t}\r\n\r\n\t$(windowDiv).applyShadow();\r\n\r\n\t// Верхняя полосочка(для отображения пустого заголовка передать пробел)\r\n\tif(windowTitle != '')\r\n\t{\r\n\t\tvar topbar = document.createElement(\"div\");\r\n\t\ttopbar.className = \"topbar\";\r\n\t\twindowDiv.insertBefore(topbar, windowDiv.childNodes[0]);\r\n\t}\r\n\r\n\twindowDiv.style.display = \"none\";\r\n\r\n\t// Закрыть\r\n\tvar wclose_img = document.createElement(\"img\");\r\n\twclose_img.src = '/admin/images/wclose.gif';\r\n\r\n\tif (removeWindow)\r\n\t{\r\n\t\twclose_img.onclick = function() { $(\"#\"+windowId).remove(); };\r\n\t}\r\n\telse\r\n\t{\r\n\t\twclose_img.onclick = function() {HideWindow(windowId); };\r\n\t}\r\n\r\n\tif(windowTitle != '')\r\n\t{\r\n\t\ttopbar.appendChild(wclose_img);\r\n\r\n\t\t// Заголовок окна\r\n\t\tvar textNode = document.createTextNode(windowTitle);\r\n\t\ttopbar.appendChild(textNode);\r\n\t}\r\n}\r\n\r\n// Отображает/скрывает окно\r\nfunction SlideWindow(windowId)\r\n{\r\n\tif ($(\"#\"+windowId).css(\"display\") == \"block\")\r\n\t{\r\n\t\tHideWindow(windowId);\r\n\t}\r\n\telse\r\n\t{\r\n\t\tShowWindow(windowId);\r\n\t}\r\n}\r\n\r\nvar prev_window = 0;\r\n\r\nfunction ShowWindow(windowId)\r\n{\r\n\tvar windowDiv = document.getElementById(windowId);\r\n\r\n\tif (windowDiv == undefined)\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\r\n\tif (prev_window && prev_window != windowId)\r\n\t{\r\n\t\tHideWindow(prev_window);\r\n\t}\r\n\r\n\tprev_window = windowId;\r\n\r\n\t// 0 - pageWidth, 1 - pageHeight, 2 - windowWidth, 3 - windowHeight\r\n\tvar arrayPageSize = getPageSize();\r\n\r\n\t// 0 - scrOfX, 1 - scrOfY\r\n\tvar arrayScrollXY = getScrollXY();\r\n\r\n\t// Отображаем до определения размеров div-а\r\n\twindowDiv.style.display = 'block';\r\n\r\n\tvar clientHeight = windowDiv.clientHeight;\r\n\tvar clientWidth = windowDiv.clientWidth;\r\n\t\r\n\t// Если высота div-а больше высоты окна\r\n\tif (clientHeight > arrayPageSize[3])\r\n\t{\r\n\t\t// Положим высоту равной 90% высоты окна\r\n\t\tclientHeight = Math.round(arrayPageSize[3] * 0.9);\r\n\t}\r\n\t\r\n\t// Если ширина div-а больше ширины окна\r\n\tif (clientWidth > arrayPageSize[2])\r\n\t{\r\n\t\t// Положим ширину равной 90% высоты окна\r\n\t\tclientWidth = Math.round(arrayPageSize[2] * 0.9);\r\n\t}\r\n\t\r\n\twindowDiv.style.top = ((arrayPageSize[3] - clientHeight) / 2 + arrayScrollXY[1]) + 'px';\r\n\twindowDiv.style.left = ((arrayPageSize[2] - clientWidth) / 2 + arrayScrollXY[0]) + 'px';\r\n}\r\n\r\nfunction HideWindow(windowId)\r\n{\r\n\t$(\"#\"+windowId).css('display', 'none');\r\n}\r\n\r\nfunction ShowAttentionWindow()\r\n{\r\n\tif(document.forms[\"EditAddItem\"].elements[\"shop_items_catalog_type\"][0].checked || document.forms[\"EditAddItem\"].elements[\"shop_items_catalog_type\"][2].checked)\r\n\t{\r\n\t\tres = confirm(\"ВНИМАНИЕ! Для данного товара указаны электронные товары, при изменении типа данного товара на \\\"Обычный\\\", электронные товары для данного товара будут УДАЛЕНЫ! Вы уверены что хотите сменить тип данного товара?\");\r\n\r\n\t\tif(res && document.forms[\"EditAddItem\"].elements[\"shop_items_catalog_type\"][0].checked)\r\n\t\t{\r\n\t\t\tdocument.forms[\"EditAddItem\"].elements[\"shop_items_catalog_type\"][0].checked = 1;\r\n\t\t}\r\n\t\telse if(res && document.forms[\"EditAddItem\"].elements[\"shop_items_catalog_type\"][2].checked)\r\n\t\t{\r\n\t\t\tdocument.forms[\"EditAddItem\"].elements[\"shop_items_catalog_type\"][2].checked;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tdocument.forms[\"EditAddItem\"].elements[\"shop_items_catalog_type\"][1].checked = 1;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Функции для всплывающего блока\r\nfunction copyright_position(copyright)\r\n{\r\n\tvar windowDiv = document.getElementById(copyright);\r\n\twindowDiv.style.top = 'auto';\r\n\twindowDiv.style.left = 'auto';\r\n\twindowDiv.style.bottom = 55 + 'px';\r\n\twindowDiv.style.right = 25 + 'px';\r\n\tclear_timeout_copiright();\r\n}\r\n\r\nfunction clear_timeout_copiright()\r\n{\r\n\tclearTimeout(timeout_copiright);\r\n}\r\n\r\nfunction set_timeout_copyright()\r\n{\r\n\ttimeout_copiright = setTimeout(function(){HideWindow('copyright')}, 500);\r\n}\r\n\r\nfunction InsertText(obj_id, text)\r\n{\r\n\tobj = document.getElementById(obj_id);\r\n\r\n\tobj.focus();\r\n\r\n\tif (typeof(obj.selectionStart) == \"number\")\r\n\t{\r\n\t\tvar start = obj.selectionStart;\r\n\t\tvar end = obj.selectionEnd;\r\n\r\n\t\tobj.value = obj.value.substr(0, start) + text + obj.value.substr(end, obj.textLength);\r\n\t\tobj.setSelectionRange(end, end);\r\n\t}\r\n}\r\n\r\n\r\n// Магазин\r\nfunction doSetLocation(shop_country_id)\r\n{\r\n\tvar req = new JsHttpRequest();\r\n\r\n\t// Отображаем экран загрузки\r\n\tShowLoadingScreen();\r\n\r\n\treq.onreadystatechange = function()\r\n\t{\r\n\t\tif (req.readyState == 4)\r\n\t\t{\r\n\t\t\t// Убираем затемнение.\r\n\t\t\tHideLoadingScreen();\r\n\r\n\t\t\tif (req.responseJS != undefined)\r\n\t\t\t{\r\n\t\t\t\t// Данные.\r\n\t\t\t\tif (req.responseJS.result != undefined)\r\n\t\t\t\t{\r\n\t\t\t\t\toSelect = document.getElementById(location_select_id);\r\n\r\n\t\t\t\t\t// Очищаем select\r\n\t\t\t\t\toSelect.options.length = 0;\r\n\r\n\t\t\t\t\t// Добавляем значение \" ... \"\r\n\t\t\t\t\toSelect.options[oSelect.options.length] = new Option(\" ... \", 0);\r\n\r\n\t\t\t\t\tfor (var key in req.responseJS.result)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\toSelect.options[oSelect.options.length] = new Option(req.responseJS.result[key], key);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Устанавливаем города\r\n\t\t\t\t\t// doSetCity(oSelect.options[oSelect.selectedIndex].value);\r\n\t\t\t\t\toCity = document.getElementById(city_select_id);\r\n\t\t\t\t\toCity.options.length = 0;\r\n\t\t\t\t\toCity.options[oCity.options.length] = new Option(\" ... \", 0);\r\n\r\n\t\t\t\t\toCityarea = document.getElementById(cityarea_select_id);\r\n\t\t\t\t\toCityarea.options.length = 0;\r\n\t\t\t\t\toCityarea.options[oCityarea.options.length] = new Option(\" ... \", 0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\r\n\treq.open('get', \"/admin/shop/shop.php?action=get_location&shop_country_id=\"+shop_country_id, true);\r\n\r\n\t// Отсылаем данные в обработчик.\r\n\treq.send(null);\r\n}\r\n\r\nfunction doSetCity(shop_location_id)\r\n{\r\n\tvar req = new JsHttpRequest();\r\n\r\n\t// Отображаем экран загрузки\r\n\tShowLoadingScreen();\r\n\r\n\treq.onreadystatechange = function()\r\n\t{\r\n\t\tif (req.readyState == 4)\r\n\t\t{\r\n\t\t\t// Убираем затемнение.\r\n\t\t\tHideLoadingScreen();\r\n\r\n\t\t\tif (req.responseJS != undefined)\r\n\t\t\t{\r\n\t\t\t\t// Данные.\r\n\t\t\t\tif (req.responseJS.result != undefined)\r\n\t\t\t\t{\r\n\t\t\t\t\toSelect = document.getElementById(city_select_id);\r\n\r\n\t\t\t\t\t// Очищаем select\r\n\t\t\t\t\toSelect.options.length = 0;\r\n\r\n\t\t\t\t\t// Добавляем значение \" ... \"\r\n\t\t\t\t\toSelect.options[oSelect.options.length] = new Option(\" ... \", 0);\r\n\r\n\t\t\t\t\tfor (var key in req.responseJS.result)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\toSelect.options[oSelect.options.length] = new Option(req.responseJS.result[key], key);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Устанавливаем районы\r\n\t\t\t\t\t// doSetCityArea(oSelect.options[oSelect.selectedIndex].value);\r\n\r\n\t\t\t\t\toCityarea = document.getElementById(cityarea_select_id);\r\n\t\t\t\t\toCityarea.options.length = 0;\r\n\t\t\t\t\toCityarea.options[oCityarea.options.length] = new Option(\" ... \", 0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\r\n\treq.open('get', \"/admin/shop/shop.php?action=get_city&shop_location_id=\"+shop_location_id, true);\r\n\r\n\t// Отсылаем данные в обработчик.\r\n\treq.send(null);\r\n}\r\n\r\nfunction doSetCityArea(shop_city_id)\r\n{\r\n\tvar req = new JsHttpRequest();\r\n\r\n\t// Отображаем экран загрузки\r\n\tShowLoadingScreen();\r\n\r\n\treq.onreadystatechange = function()\r\n\t{\r\n\t\tif (req.readyState == 4)\r\n\t\t{\r\n\t\t\t// Убираем затемнение.\r\n\t\t\tHideLoadingScreen();\r\n\r\n\t\t\tif (req.responseJS != undefined)\r\n\t\t\t{\r\n\t\t\t\t// Данные.\r\n\t\t\t\tif (req.responseJS.result != undefined)\r\n\t\t\t\t{\r\n\t\t\t\t\toSelect = document.getElementById(cityarea_select_id);\r\n\r\n\t\t\t\t\t// Очищаем select\r\n\t\t\t\t\toSelect.options.length = 0;\r\n\r\n\t\t\t\t\t// Добавляем значение \" ... \"\r\n\t\t\t\t\toSelect.options[oSelect.options.length] = new Option(\" ... \", 0);\r\n\r\n\t\t\t\t\tfor (var key in req.responseJS.result)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\toSelect.options[oSelect.options.length] = new Option(req.responseJS.result[key], key);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\r\n\treq.open('get', \"/admin/shop/shop.php?action=get_cityarea&shop_city_id=\"+shop_city_id, true);\r\n\r\n\t// Отсылаем данные в обработчик.\r\n\treq.send(null);\r\n}\r\n\r\n// Загружает полученные значения в список с Id = object_id\r\nfunction doSetList(request_path, object_id)\r\n{\r\n\tvar req = new JsHttpRequest();\r\n\r\n\t// Отображаем экран загрузки\r\n\tShowLoadingScreen();\r\n\r\n\treq.onreadystatechange = function()\r\n\t{\r\n\t\tif (req.readyState == 4)\r\n\t\t{\r\n\t\t\t// Убираем затемнение.\r\n\t\t\tHideLoadingScreen();\r\n\r\n\t\t\tif (req.responseJS != undefined)\r\n\t\t\t{\r\n\t\t\t\t// Данные.\r\n\t\t\t\tif (req.responseJS.result != undefined)\r\n\t\t\t\t{\r\n\t\t\t\t\toSelect = document.getElementById(object_id);\r\n\r\n\t\t\t\t\t// Очищаем select\r\n\t\t\t\t\toSelect.options.length = 0;\r\n\r\n\t\t\t\t\t// Добавляем значение \" ... \"\r\n\t\t\t\t\toSelect.options[oSelect.options.length] = new Option(\" ... \", 0);\r\n\r\n\t\t\t\t\tfor (var key in req.responseJS.result)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\toSelect.options[oSelect.options.length] = new Option(req.responseJS.result[key], key);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\r\n\treq.open('get', request_path, true);\r\n\r\n\t// Отсылаем данные в обработчик.\r\n\treq.send(null);\r\n}\r\n\r\n// Изменение статуса заказа товара\r\nfunction ChangeOrderStatus()\r\n{\r\n\tvar date = new Date(); \r\n\t\r\n\tChangeStatusDateTime = document.getElementById('order_change_status_date_time_id');\r\n\t\t\r\n\tday = date.getDate();\t\r\n\t\r\n\tif (day < 10)\r\n\t{\r\n\t\tday = '0' + month; \r\n\t}\r\n\t\r\n\tmonth = date.getMonth() + 1;\r\n\t\r\n\tif (month < 10)\r\n\t{\r\n\t\tmonth = '0' + month; \r\n\t}\r\n\t\r\n\thours = date.getHours()\r\n\t\t\r\n\tif (hours < 10)\r\n\t{\r\n\t\thours = '0' + hours;\r\n\t}\r\n\t\r\n\tminutes = date.getMinutes();\r\n\t\r\n\tif (minutes < 10)\r\n\t{\r\n\t\tminutes = '0' + minutes; \r\n\t}\t\t\r\n\t\r\n\tChangeStatusDateTime.value = day + '.' + month + '.' + date.getFullYear() + ' ' + hours + ':' + minutes + ':' + '00';  \t\r\n}\r\n\r\n/**\r\n * Вставка стандартного ответа в поле текста сообщения\r\n */\r\nfunction InsertTemplate(WindowId, template_id, helpdesk_id)\r\n{\r\n\tWindowId = getWindowId(WindowId);\r\n\t\r\n\t// Отображаем экран загрузки\r\n\tShowLoadingScreen();\r\n\t\r\n\tvar link = \"/admin/helpdesk/helpdesk.php?action=insert_template&template_id=\"+template_id+\"&helpdesk_id=\"+helpdesk_id;\r\n\t\r\n\t$.ajax({\r\n\t\tcontext: $(\"#\"+WindowId), // станет контекстом (this)\r\n\t\turl: link,\r\n\t\tdata: {'JsHttpRequest': Math.round(new Date().getTime() / 1000) + '-xml',\r\n\t\t'window_id': WindowId},\r\n\t\tdataType: 'json',\r\n\t\tsuccess: function(data, status, XMLHttpRequest)\r\n\t\t{\r\n\t\t\tif (typeof data.js != 'undefined')\r\n\t\t\t{\r\n\t\t\t\tif (typeof data.js.text != 'undefined')\r\n\t\t\t\t{\r\n\t\t\t\t\tid_textarea = 'helpdesk_message_message';\r\n\t\t\t\t\tvar jTextArea = $(this).find('#'+id_textarea);\r\n\t\t\t\t\t\r\n\t\t\t\t\tjTextArea.val(jTextArea.val() + data.js.text);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// Работу с визуальным редактором ведём\r\n\t\t\t\t\tif (typeof tinyMCE != 'undefined')\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (tinyMCE.getInstanceById(id_textarea + '_ID') != null)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttinyMCE.getInstanceById(id_textarea + '_ID').setContent(data.js.text);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Убираем затемнение.\r\n\t\t\tHideLoadingScreen();\r\n\t\t}\r\n\t});\r\n}\r\n\r\n/**\r\n * Показ истории сообщений\r\n * \r\n * @param int\r\n *            helpdesk_ticket_id идентификатор тикета\r\n */\r\nfunction ShowMessageHistory(helpdesk_ticket_id)\r\n{\r\n\tvar oWindowId = 'heldesk_m_history_'+helpdesk_ticket_id;\r\n\r\n\tif (document.getElementById(oWindowId) == undefined)\r\n\t{\r\n\t\t// Создаем окно\r\n\t\tCreateWindow(oWindowId, 'История переписки', '600px', '', 1);\r\n\r\n\t\tvar oWindow = document.getElementById(oWindowId);\r\n\r\n\t\t// <div id=\"subdiv\">\r\n\t\tvar ElementDiv = document.createElement(\"div\");\r\n\t\tElementDiv.setAttribute(\"id\", \"subdiv\");\r\n\t\tvar DivNode = oWindow.appendChild(ElementDiv);\r\n\r\n\t\t// Запрос backend-у\r\n\t\tvar req = new JsHttpRequest();\r\n\r\n\t\t// Отображаем экран загрузки\r\n\t\tShowLoadingScreen();\r\n\r\n\t\treq.onreadystatechange = function()\r\n\t\t{\r\n\t\t\tif (req.readyState == 4)\r\n\t\t\t{\r\n\t\t\t\t// Убираем затемнение.\r\n\t\t\t\tHideLoadingScreen();\r\n\r\n\t\t\t\tif (req.responseJS != undefined)\r\n\t\t\t\t{\r\n\t\t\t\t\t// Данные.\r\n\t\t\t\t\tif (req.responseJS.result != undefined)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// oMessageTextarea =\r\n\t\t\t\t\t\t// document.getElementById(oWindowId);\r\n\t\t\t\t\t\tDivNode.innerHTML = req.responseJS.result;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treq.open('get', \"/admin/helpdesk/helpdesk.php?action=get_message_history&helpdesk_ticket_id=\"+helpdesk_ticket_id, true);\r\n\r\n\t\t// Отсылаем данные в обработчик.\r\n\t\treq.send(null);\r\n\t}\r\n\r\n\tSlideWindow(oWindowId);\r\n}\r\n\r\n/**\r\n * Показ сообщения\r\n * \r\n * @param int\r\n *            helpdesk_ticket_id идентификатор тикета\r\n */\r\nfunction ShowMessage(helpdesk_message_id)\r\n{\r\n\tvar oWindowId = 'heldesk_message_'+helpdesk_message_id;\r\n\r\n\tif (document.getElementById(oWindowId) == undefined)\r\n\t{\r\n\t\t// Создаем окно\r\n\t\tCreateWindow(oWindowId, 'Сообщение № ' + helpdesk_message_id, '600px', '', 1);\r\n\r\n\t\tvar oWindow = document.getElementById(oWindowId);\r\n\r\n\t\t// <div id=\"subdiv\">\r\n\t\tvar ElementDiv = document.createElement(\"div\");\r\n\t\tElementDiv.setAttribute(\"id\", \"subdiv\");\r\n\t\tvar DivNode = oWindow.appendChild(ElementDiv);\r\n\r\n\t\t// Запрос backend-у\r\n\t\tvar req = new JsHttpRequest();\r\n\r\n\t\t// Отображаем экран загрузки\r\n\t\tShowLoadingScreen();\r\n\r\n\t\treq.onreadystatechange = function()\r\n\t\t{\r\n\t\t\tif (req.readyState == 4)\r\n\t\t\t{\r\n\t\t\t\t// Убираем затемнение.\r\n\t\t\t\tHideLoadingScreen();\r\n\r\n\t\t\t\tif (req.responseJS != undefined)\r\n\t\t\t\t{\r\n\t\t\t\t\t// Данные.\r\n\t\t\t\t\tif (req.responseJS.result != undefined)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// oMessageTextarea =\r\n\t\t\t\t\t\t// document.getElementById(oWindowId);\r\n\t\t\t\t\t\tDivNode.innerHTML = req.responseJS.result;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treq.open('get', \"/admin/helpdesk/helpdesk.php?action=get_message&helpdesk_message_id=\"+helpdesk_message_id, true);\r\n\r\n\t\t// Отсылаем данные в обработчик.\r\n\t\treq.send(null);\r\n\t}\r\n\r\n\tSlideWindow(oWindowId);\r\n}\r\n\r\n/**\r\n * Отправка формы helpdesk по Ctrl+Enter\r\n * \r\n * @param obj\r\n *            event объект события\r\n * @param obj\r\n *            formObj объект формы\r\n */\r\nfunction submitForm(event, formObj)\r\n{\r\n\tif (((event.keyCode == 13) || (event.keyCode == 10)) && (event.ctrlKey == true) && (formObj.send_message))\r\n\t{\r\n\t\tif (confirm(\"Вы действительно хотите отправить сообщение?\"))\r\n\t\t{\r\n\t\t\tformObj.send_message.click();\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Показ окна со списком флагов тикетов int helpdesk_ticket_id Идентификатор\r\n * тикета\r\n */\r\nfunction TicketFlagChangeWindow(helpdesk_ticket_id)\r\n{\r\n\tvar oWindowId = 'heldesk_ticket_'+helpdesk_ticket_id+'_flag';\r\n\r\n\tif (document.getElementById(oWindowId) == undefined)\r\n\t{\r\n\t\t// Создаем окно\r\n\t\tCreateWindow(oWindowId, 'Флаг', '215px', '215px', 1);\r\n\r\n\t\tvar oWindow = document.getElementById(oWindowId);\r\n\r\n\t\t// <div id=\"subdiv\">\r\n\t\tvar ElementDiv = document.createElement(\"div\");\r\n\t\tElementDiv.setAttribute(\"id\", \"subdiv_small\");\r\n\t\tvar DivNode = oWindow.appendChild(ElementDiv);\r\n\r\n\t\tvar ElementForm = document.createElement(\"form\");\r\n\t\tElementForm.setAttribute(\"id\", \"formFlag_\"+helpdesk_ticket_id);\r\n\t\tvar FormNode = ElementDiv.appendChild(ElementForm);\r\n\r\n\t\t// Запрос backend-у\r\n\t\tvar req = new JsHttpRequest();\r\n\r\n\t\t// Отображаем экран загрузки\r\n\t\tShowLoadingScreen();\r\n\r\n\t\treq.onreadystatechange = function()\r\n\t\t{\r\n\t\t\tif (req.readyState == 4)\r\n\t\t\t{\r\n\t\t\t\t// Убираем затемнение.\r\n\t\t\t\tHideLoadingScreen();\r\n\r\n\t\t\t\tif (req.responseJS != undefined)\r\n\t\t\t\t{\r\n\t\t\t\t\t// Данные.\r\n\t\t\t\t\tif (req.responseJS.result != undefined)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// oMessageTextarea =\r\n\t\t\t\t\t\t// document.getElementById(oWindowId);\r\n\t\t\t\t\t\tFormNode.innerHTML = req.responseJS.result;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treq.open('get', \"/admin/helpdesk/helpdesk.php?action=get_flags&helpdesk_ticket_id=\"+helpdesk_ticket_id, true);\r\n\r\n\t\t// Отсылаем данные в обработчик.\r\n\t\treq.send(null);\r\n\t}\r\n\r\n\tSlideWindow(oWindowId);\r\n}\r\n\r\n/**\r\n * Применение флага к тикету str windowId Идентификатор окна int ticketId\r\n * Идентификатр тикета\r\n */\r\nfunction SetFlag(windowId, ticketId)\r\n{\r\n\tcbItem = document.getElementById(windowId);\r\n\r\n\tif (cbItem)\r\n\t{\r\n\t\tflagId = GetRadioValue(cbItem.flag);\r\n\r\n\t\tif (flagId != null)\r\n\t\t{\r\n\t\t\t// Запрос backend-у\r\n\t\t\tvar req = new JsHttpRequest();\r\n\r\n\t\t\t// Отображаем экран загрузки\r\n\t\t\tShowLoadingScreen();\r\n\r\n\t\t\treq.onreadystatechange = function()\r\n\t\t\t{\r\n\t\t\t\tif (req.readyState == 4)\r\n\t\t\t\t{\r\n\t\t\t\t\t// Убираем затемнение.\r\n\t\t\t\t\tHideLoadingScreen();\r\n\r\n\t\t\t\t\tif (req.responseJS != undefined)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// Данные.\r\n\t\t\t\t\t\tif (req.responseJS.result != undefined)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tSlideWindow(prev_window);\r\n\t\t\t\t\t\t\tif (req.responseJS.result != 'null')\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tvar oImg = document.getElementById('image_' + ticketId);\r\n\t\t\t\t\t\t\t\toImg.src = req.responseJS.result;\r\n\t\t\t\t\t\t\t\toImg.alt = req.responseJS.alt;\r\n\t\t\t\t\t\t\t\toImg.title = req.responseJS.alt;\r\n\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treq.open('get', \"/admin/helpdesk/helpdesk.php?action=set_flag&helpdesk_ticket_id=\"+ticketId+\"&helpdesk_ticket_flags_id=\"+flagId, true);\r\n\r\n\t\t\t// Отсылаем данные в обработчик.\r\n\t\t\treq.send(null);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Определение выбранного переключателя Radio-объекта str radioObject Имя\r\n * Radio-группы\r\n */\r\nfunction GetRadioValue(radioObject)\r\n{\r\n\tvar value = null;\r\n\r\n\tfor (var i = 0; i < radioObject.length; i++)\r\n\t{\r\n\t\tif (radioObject[i].checked)\r\n\t\t{\r\n\t\t\tvalue = radioObject[i].value;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\treturn value;\r\n}\r\n\r\nfunction SetControlElementsStatus(WindowId, ControlElementsStatus)\r\n{\r\n\tWindowId = getWindowId(WindowId);\r\n\t\r\n\t$(\"#\"+WindowId+\" #ControlElements input\").attr('disabled', !ControlElementsStatus);\r\n}\r\n\r\nfunction cSelectFilter(WindowId, sObjectId)\r\n{\r\n\tthis.WindowId = getWindowId(WindowId);\r\n\tthis.sObjectId = sObjectId;\r\n\t\r\n\t// Игнорировать регистр\r\n\tthis.ignoreCase = true;\r\n\tthis.timeout = null;\r\n\tthis.pattern = '';\r\n\tthis.aOriginalOptions = null;\r\n\tthis.sSelectedValue = '';\r\n\t\r\n\t// Сейчас происходит фильтрация\r\n\tthis.is_filtering = false;\r\n\t\r\n\t// Установка требуемого шаблона фильтрации\r\n\tthis.Set = function(pattern) {\r\n\t\tthis.pattern = pattern;\r\n\t\tthis.is_filtering = (pattern.length != 0);\r\n\t}\r\n\r\n\t// Указывает регулярному выражению игнорировать регистр\r\n\tthis.SetIgnoreCase = function(value) {\r\n\t\tthis.ignoreCase = value;\r\n\t}\r\n\r\n\tthis.GetCurrentSelectObject = function() {\r\n\t\tthis.oCurrentSelectObject = $(\"#\"+this.WindowId+\" #\"+this.sObjectId);\r\n\t}\r\n\t\r\n\tthis.Init = function() {\r\n\r\n\t\tthis.GetCurrentSelectObject();\r\n\t\t\r\n\t\tif (this.oCurrentSelectObject.length == 1)\r\n\t\t{\r\n\t\t\tvar jOptions = this.oCurrentSelectObject.find(\"option\");\r\n\r\n\t\t\tif (jOptions.length > 0)\r\n\t\t\t{\r\n\t\t\t\t// Сохраняем установленное до фильтрации значение\r\n\t\t\t\tthis.sSelectedValue = this.oCurrentSelectObject.find(\"option:selected\").val();\r\n\t\t\t\t\r\n\t\t\t\tthis.aOriginalOptions = new Array();\r\n\r\n\t\t\t\tvar jOptionItem;\r\n\r\n\t\t\t\tfor (var i = 0, count = jOptions.length; i < count; i++) {\r\n\t\t\t\t\tjOptionItem = $(jOptions.get(i));\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.aOriginalOptions[i] = new Option(\r\n\t\t\t\t\t\t\tjOptionItem.text(),\r\n\t\t\t\t\t\t\tjOptionItem.text(), false);\r\n\t\t\t\r\n\t\t\t\t\t// Если есть значение, запишем его\r\n\t\t\t\t\tif (jOptionItem.val()) {\r\n\t\t\t\t\t\tthis.aOriginalOptions[i].value = jOptionItem.val();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tthis.Filter = function() {\r\n\t\t// Если фильтрация - получаем объект\r\n\t\tif (this.is_filtering)\r\n\t\t{\r\n\t\t\t// Заново получаем объект, т.к. при AJAX-запросе на момент Init-а\r\n\t\t\t// объект мог не существовать\r\n\t\t\tthis.GetCurrentSelectObject();\r\n\t\t}\r\n\t\t\r\n\t\tif (this.aOriginalOptions == null\r\n\t\t|| this.aOriginalOptions.length == 0)\r\n\t\t{\r\n\t\t\tthis.Init();\r\n\t\t}\r\n\r\n\t\tif (this.oCurrentSelectObject.length == 1)\r\n\t\t{\r\n\t\t\t// Сбрасываем все значения списка\r\n\t\t\tthis.oCurrentSelectObject.empty();\r\n\t\t\t\r\n\t\t\tif (this.ignoreCase) {\r\n\t\t\t\tvar attributes = 'i';\r\n\t\t\t} else {\r\n\t\t\t\tvar attributes = '';\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar regexp = new RegExp(this.pattern, attributes);\r\n\t\t\t\r\n\t\t\tvar iNewOptionsIndex = 0;\r\n\r\n\t\t\tfor (var i = 0; i < this.aOriginalOptions.length; i++)\r\n\t\t\t{\r\n\t\t\t\tif (regexp.test(' ' + this.aOriginalOptions[i].text))\r\n\t\t\t\t{\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.oCurrentSelectObject.append(\r\n\t\t\t\t\t\t$('<option>')\r\n\t\t\t\t\t\t\t.text(this.aOriginalOptions[i].text)\r\n\t\t\t\t\t\t\t.val(this.aOriginalOptions[i].value)\r\n\t\t\t\t\t\t\t.attr('selected', (this.aOriginalOptions[i].value == this.sSelectedValue))\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// --- [Menu] ---\r\n\r\nvar action = '';\r\nvar aHeights = new Array();\r\n\r\nfunction SubMenu(divId)\r\n{\r\n\tif (action == '')\r\n\t{\r\n\t\tvar subDivHeight = $(\"div[id=\"+divId+\"]\").height();\r\n\t\t\r\n\t\tif ($(\"div[id=\"+divId+\"]\").height() == 0)\r\n\t\t{\r\n\t\t\taction = 'showing';\r\n\t\t\tShowSubMenu(divId, aHeights[divId]);\r\n\r\n\t\t\t// Сохраняем состояние меню\r\n\t\t\tvar reg = /id_(\\d+)/;\r\n\t\t\tvar arr = reg.exec(divId);\r\n\r\n\t\t\t// Отправляем информацию Backend-у\r\n\t\t\tsendRequest('/admin/index.php?show_sub_menu=' + arr[1], 'get');\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\taHeights[divId] = subDivHeight;\r\n\t\t\taction = 'hiding';\r\n\r\n\t\t\tHideSubMenu(divId);\r\n\t\t\t\r\n\t\t\t// Сохраняем состояние меню\r\n\t\t\tvar reg = /id_(\\d+)/;\r\n\t\t\tvar arr = reg.exec(divId);\r\n\r\n\t\t\t// Отправляем информацию Backend-у\r\n\t\t\tsendRequest('/admin/index.php?hide_sub_menu=' + arr[1], 'get');\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction ShowSubMenu (divId, maxHeight)\r\n{\r\n\t$(\"div[id=\"+divId+\"]\").animate({\r\n\t\theight: maxHeight,\r\n\t\topacity: 1.0}, {\r\n\t\tduration: 'normal',\r\n\t\tcomplete: function(){\r\n\t\t\taction = '';\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction HideSubMenu(divId)\r\n{\r\n\t$(\"div[id=\"+divId+\"]\").animate({\r\n\t\theight: 0,\r\n\t\topacity: 0}, {\r\n\t\tduration: 'normal',\r\n\t\tcomplete: function(){\r\n\t\t\taction = '';\r\n\t\t}\r\n\t});\r\n}\r\n\r\n// -------------------------------------\r\nfunction MainMenu(divId)\r\n{\r\n\tif (action == '')\r\n\t{\r\n\t\tif ($(\"div[id=\"+divId+\"]\").width() == 0)\r\n\t\t{\r\n\t\t\taction = 'showing';\r\n\t\t\tShowMainMenu(divId);\r\n\t\t\t\r\n\t\t\t// Отправляем информацию Backend-у, 0 - показали\r\n\t\t\tsendRequest('/admin/index.php?main_menu=0', 'get');\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\taction = 'hiding';\r\n\t\t\tHideMainMenu(divId);\r\n\t\t\t\r\n\t\t\t// Отправляем информацию Backend-у, 1 - скрыли\r\n\t\t\tsendRequest('/admin/index.php?main_menu=1', 'get');\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction ShowMainMenu(divId)\r\n{\r\n\tvar RightMaxWidth = 215;\r\n\tvar RightPadding = 30;\r\n\t\r\n\t$(\"div[id=body_left_box]\")\r\n\t.css('border-right-style', \"solid\")\r\n\t.css('border-right-color', \"white\");\r\n\t\r\n\t$(\"div[id=body_left_box]\")\r\n\t.css('margin-right', -1 * RightMaxWidth)\r\n\t.css('border-right-width', RightMaxWidth);\r\n\r\n\t$(\"div[id=body]\")\r\n\t// Начинаем с 30, чтобы у IE не было горизонтальной полоски\r\n\t.css('padding-right', RightPadding)\r\n\t.animate({\r\n\t\tpaddingRight: RightMaxWidth + RightPadding\r\n\t\t}, {\r\n\t\tqueue: false,\r\n\t\tduration: 'normal',\r\n\t\tcomplete: function(){\r\n\t\t\t$(this).css('padding-right', '');\r\n\t\t}\r\n\t});\r\n\r\n\t$(\"div[id=\"+divId+\"]\")\r\n\t.css('display', 'block')\r\n\t.animate({\r\n\t\twidth: RightMaxWidth,\r\n\t\topacity: 1.0}, {\r\n\t\tduration: 'normal',\r\n\t\tcomplete: function(){\r\n\t\t\taction = '';\r\n\t\t\t$(\"img[id=MainMenuImg]\").attr('src', '/admin/images/menu_show.gif');\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction HideMainMenu(divId)\r\n{\r\n\tvar RightPadding = 30;\r\n\r\n\t$(\"div[id=body]\")\r\n\t.animate({\r\n\t\tpaddingRight: RightPadding\r\n\t\t}, {\r\n\t\tqueue: false,\r\n\t\tduration: 'normal',\r\n\t\tcomplete: function(){\r\n\t\t}\r\n\t});\r\n\t\r\n\t$(\"div[id=\"+divId+\"]\")\r\n\t.animate({\r\n\t\twidth: 0,\r\n\t\topacity: 0}, {\r\n\t\tduration: 'normal',\r\n\t\tcomplete: function(){\r\n\t\t\taction = '';\r\n\t\t\t$(this).css('display', 'none');\r\n\t\t\t// Убираем оставшиеся 30 пикселей после скрытия самого блока\r\n\t\t\t$(\"div[id=body]\").css('padding-right', 0);\r\n\t\t\t$(\"img[id=MainMenuImg]\").attr('src', '/admin/images/menu_show_reverse.gif');\r\n\t\t\t\r\n\t\t\t$(\"div[id=body_left_box]\")\r\n\t\t\t.css('margin-right', -1 * RightPadding)\r\n\t\t\t.css('border-right-width', 0);\r\n\t\t}\r\n\t});\r\n}\r\n\r\n// --- / [Menu] ---\r\n\r\n\r\n/**\r\n * Модуль \"Структура сайта\"\r\n * \r\n * @WindowId\r\n * @ASelectedItem код выбранного элемента\r\n * @structure_id идентификатор структуры\r\n * @lib_dir_id раздел типовых динамически страниц\r\n * @lib_id идентификатор типовых динамически страниц\r\n */\r\nfunction SetViewStructure(WindowId, ASelectedItem, iStructureId, iLibDirId, iLibId)\r\n{\r\n\tWindowId = getWindowId(WindowId);\r\n\t\r\n\tvar templates_id = \"none\",\r\n\t\tdocuments_dir_list_id = \"none\",\r\n\t\tdocuments_list_id = \"none\",\r\n\t\tdocuments_list_image_id = \"none\",\r\n\t\tstructure_external_link_id = \"none\",\r\n\t\tlib_dir_id = \"none\",\r\n\t\tlib_id = \"none\",\r\n\t\tlib_properties = \"none\";\r\n\t\r\n\tswitch (ASelectedItem)\r\n\t{\r\n\t\tdefault:\r\n\t\tcase 0: // Страница\r\n\t\t\tdocuments_dir_list_id = \"block\";\r\n\t\t\tdocuments_list_id = \"block\";\r\n\t\t\tdocuments_list_image_id = \"block\";\r\n\t\t\tstructure_external_link_id = \"block\";\r\n\t\t\tHideObject($(\"#\"+WindowId+\" #module_id\"));\r\n\t\t\tHideObject($(\"#\"+WindowId+\" #module_config_id\"));\r\n\t\tbreak;\r\n\r\n\t\tcase 1: // Динамическая страница\r\n\t\t\ttemplates_id = \"block\";\r\n\t\t\t// Для CodePress показываем таким образом\r\n\t\t\tShowObject($(\"#\"+WindowId+\" #module_id\"));\r\n\t\t\tShowObject($(\"#\"+WindowId+\" #module_config_id\"));\r\n\t\tbreak;\r\n\t\t\r\n\t\tcase 2: // Типовая дин. страница\r\n\t\t\ttemplates_id = \"block\";\r\n\t\t\tlib_dir_id = \"block\";\r\n\t\t\tlib_id = \"block\";\r\n\t\t\tlib_properties = \"block\";\r\n\t\t\tHideObject($(\"#\"+WindowId+\" #module_id\"));\r\n\t\t\tHideObject($(\"#\"+WindowId+\" #module_config_id\"));\r\n\t\t\t\r\n\t\t\t// Загружаем список типовых страниц.\r\n\t\t\tDoLoadLibs(iLibDirId, iLibId);\r\n\t\r\n\t\t\t// Получаем свойства для выбранной типовой динамической страницы.\r\n\t\t\tDoLoadLibProperties(iLibId, iStructureId);\r\n\t\tbreak;\r\n\t}\r\n\t\r\n\t$(\"#\"+WindowId+\" #templates_id\").css('display', templates_id);\r\n\t$(\"#\"+WindowId+\" #documents_dir_list_id\").css('display', documents_dir_list_id);\r\n\t$(\"#\"+WindowId+\" #documents_list_id\").css('display', documents_list_id);\r\n\t$(\"#\"+WindowId+\" #documents_list_image_id\").css('display', documents_list_image_id);\r\n\t$(\"#\"+WindowId+\" #structure_external_link_id\").css('display', structure_external_link_id);\r\n\t$(\"#\"+WindowId+\" #lib_dir_id\").css('display', lib_dir_id);\r\n\t$(\"#\"+WindowId+\" #lib_id\").css('display', lib_id);\r\n\t$(\"#\"+WindowId+\" #lib_properties\").css('display', lib_properties);\r\n}\r\n\r\nfunction ShowRows(WindowId, index)\r\n{\r\n\tWindowId = getWindowId(WindowId);\r\n\r\n\tvar structure_propertys_define_value = 'none',\r\n\t\tstructure_propertys_lists_id = 'none',\r\n\t\tstructure_propertys_information_systems_id = 'none',\r\n\t\tdefault_date_value_id = 'none',\r\n\t\tdefault_datetime_value_id = 'none',\r\n\t\tdefault_checked_value_id = 'none';\r\n\r\n\tindex = parseInt(index);\r\n\t\t\t\t\t\t\t\r\n\tswitch (index)\r\n\t{\r\n\t\tcase 0: // Число\r\n\t\tcase 1: // Строка\r\n\t\tcase 4: // Большое текстовое поле\r\n\t\tcase 6: // Визуальный редактор\r\n\t\t{\r\n\t\t\tstructure_propertys_define_value = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 2: // Файл\r\n\t\t{\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 3: // Список\r\n\t\t{\r\n\t\t\tstructure_propertys_lists_id = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 5: // Информационная система\r\n\t\t{\r\n\t\t\tstructure_propertys_information_systems_id = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 7: // Флажок\r\n\t\t{\r\n\t\t\tdefault_checked_value_id = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 8: // Дата\r\n\t\t{\r\n\t\t\tdefault_date_value_id = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 9: // ДатаВремя\r\n\t\t{\r\n\t\t\tdefault_datetime_value_id = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\t\r\n\t$(\"#\"+WindowId+\" #structure_propertys_define_value\").css('display', structure_propertys_define_value);\r\n\t$(\"#\"+WindowId+\" #structure_propertys_lists_id\").css('display', structure_propertys_lists_id);\r\n\t$(\"#\"+WindowId+\" #structure_propertys_information_systems_id\").css('display', structure_propertys_information_systems_id);\r\n\t$(\"#\"+WindowId+\" #default_date_value_id\").css('display', default_date_value_id);\r\n\t$(\"#\"+WindowId+\" #default_datetime_value_id\").css('display', default_datetime_value_id);\r\n\t$(\"#\"+WindowId+\" #default_checked_value_id\").css('display', default_checked_value_id);\r\n}\r\n\r\nfunction ShowRowsAdminForm(WindowId, index)\r\n{\r\n\tWindowId = getWindowId(WindowId);\r\n\r\n\tindex = parseInt(index);\r\n\t\r\n\tvar list_image_path_id = 'none',\r\n\t\tlist_values_id = 'none',\r\n\t\tlink_id = 'none',\r\n\t\tonclick_id = 'none';\r\n\t\r\n\tswitch (index)\r\n\t{\r\n\t\tcase 1: // Текст\r\n\t\tcase 4: // Ссылка\r\n\t\tcase 5: // Дата-время\r\n\t\tcase 6: // Дата\r\n\t\tcase 9: // Текст AS IS\r\n\t\tcase 10: // Вычисляемое поле\r\n\t\t{\r\n\t\t\tlink_id = 'block';\r\n\t\t\tonclick_id = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 7: // Картинка-ссылка\r\n\t\t{\r\n\t\t\tlist_image_path_id = 'block';\r\n\t\t\tlink_id = 'block';\r\n\t\t\tonclick_id = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 8: // Список\r\n\t\t{\r\n\t\t\tlist_values_id = 'block';\r\n\t\t\tlink_id = 'block';\r\n\t\t\tonclick_id = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\t\r\n\t$(\"#\"+WindowId+\" #list_image_path_id\").css('display', list_image_path_id);\r\n\t$(\"#\"+WindowId+\" #list_values_id\").css('display', list_values_id);\r\n\t$(\"#\"+WindowId+\" #link_id\").css('display', link_id);\r\n\t$(\"#\"+WindowId+\" #onclick_id\").css('display', onclick_id);\r\n}\r\n\r\nfunction ShowRowsBannerControl(WindowId, index)\r\n{\r\n\tWindowId = getWindowId(WindowId);\r\n\t\r\n\tindex = parseInt(index);\r\n\r\n\tvar advertisement_banner_swf_path = 'none',\r\n\t\tadvertisement_banner_image_path = 'none',\r\n\t\tadvertisement_banner_image_link = 'none',\r\n\t\tadvertisement_banner_structure_id = 'none',\r\n\t\tadvertisement_banner_text = 'none';\r\n\r\n\tswitch (index)\r\n\t{\r\n\t\tcase 0: // Изображение\r\n\t\t{\r\n\t\t\tadvertisement_banner_image_path = 'block';\r\n\t\t\tadvertisement_banner_image_link = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\t\t\t\t\t\r\n\t\tcase 1: // html\r\n\t\t{\r\n\t\t\tadvertisement_banner_text = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\t\r\n\t\tcase 2: // Всплывающий\r\n\t\t{\r\n\t\t\tadvertisement_banner_structure_id = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\t\r\n\t\tcase 3: // Флэш\r\n\t\t{\r\n\t\t\tadvertisement_banner_swf_path = 'block';\r\n\t\t\tadvertisement_banner_image_link = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\t\r\n\t$(\"#\"+WindowId+\" #advertisement_banner_swf_path\").css('display', advertisement_banner_swf_path);\r\n\t$(\"#\"+WindowId+\" #advertisement_banner_image_path\").css('display', advertisement_banner_image_path);\r\n\t$(\"#\"+WindowId+\" #advertisement_banner_image_link\").css('display', advertisement_banner_image_link);\r\n\t$(\"#\"+WindowId+\" #advertisement_banner_structure_id\").css('display', advertisement_banner_structure_id);\r\n\t$(\"#\"+WindowId+\" #advertisement_banner_text\").css('display', advertisement_banner_text);\r\n}\r\n\r\nfunction ShowRowsForms(WindowId, index)\r\n{\r\n\tWindowId = getWindowId(WindowId);\r\n\r\n\tindex = parseInt(index);\r\n\t\r\n\tvar list_id = 'none',\r\n\t\tcols_id = 'none',\r\n\t\trows_id = 'none',\r\n\t\tchecked_id = 'none',\r\n\t\tsize_id = 'none',\r\n\t\tdefault_value_id = 'none',\r\n\t\tobligatory_id = 'none';\r\n\t\r\n\tswitch (index)\r\n\t{\r\n\t \tcase 0: // Поле ввода.\r\n\t \tdefault:\r\n\t \t\tsize_id = 'block';\r\n\t \t\tdefault_value_id = 'block';\r\n\t \t\tobligatory_id = 'block';\r\n\t\t\tbreak;\r\n\t\t case 1: // Пароль.\r\n\t\t\tsize_id = 'block';\r\n\t \t\tdefault_value_id = 'block';\r\n\t \t\tobligatory_id = 'block';\r\n\t\t \tbreak;\r\n\t\t case 2: // Поле загрузки файла.\t \t\r\n\t\t\tsize_id = 'block';\r\n\t\t\tobligatory_id = 'block';\r\n\t\t\tbreak;\r\n\t\t case 3: // Переключатель.\r\n\t\t\tlist_id = 'block';\r\n\t\t\tobligatory_id = 'block';\r\n\t\t \tbreak;\r\n\t\t case 4: // Флажок.\r\n\t\t\tchecked_id = 'block';\r\n\t\t\tobligatory_id = 'block';\r\n\t\t\tbreak;\r\n\t\t case 5: // Большое текстовое поле.\r\n\t\t\tcols_id = 'block';\r\n\t\t\trows_id = 'block';\r\n\t\t\tdefault_value_id = 'block';\r\n\t\t\tobligatory_id = 'block';\r\n\t\t\tbreak;\r\n\t\t case 6: // Список.\r\n\t\t\tlist_id = 'block';\r\n\t\t\tobligatory_id = 'block';\r\n\t\t\tbreak;\r\n \t\tcase 7: // Скрытое поле.\r\n\t\t\tdefault_value_id = 'block';\r\n\t\t\tobligatory_id = 'block';\r\n\t\t\tbreak;\r\n\t\t case 8: // Надпись.\r\n\t\t\tdefault_value_id = 'block';\r\n\t\t\tobligatory_id = 'block';\r\n\t\t\tbreak;\r\n\t\tcase 9: // Список флажков\r\n\t\t\tlist_id = 'block';\r\n\t\t\tobligatory_id = 'block';\r\n\t\t\tbreak;\r\n\t}\r\n\t$(\"#\"+WindowId+\" #list_id\").css('display', list_id);\r\n\t$(\"#\"+WindowId+\" #cols_id\").css('display', cols_id);\r\n\t$(\"#\"+WindowId+\" #rows_id\").css('display', rows_id);\r\n\t$(\"#\"+WindowId+\" #checked_id\").css('display', checked_id);\r\n\t$(\"#\"+WindowId+\" #size_id\").css('display', size_id);\r\n\t$(\"#\"+WindowId+\" #default_value_id\").css('display', default_value_id);\r\n\t$(\"#\"+WindowId+\" #obligatory_id\").css('display', obligatory_id);\r\n}\r\n\r\nfunction ShowRowsGroupPropertys(WindowId, index)\r\n{\r\n\tWindowId = getWindowId(WindowId);\r\n\r\n\tindex = parseInt(index);\r\n\r\n\tvar list_id = 'none',\r\n\t\tdefault_value_id = 'none',\r\n\t\tdefault_date_value_id = 'none',\r\n\t\tdefault_datetime_value_id = 'none',\r\n\t\tinformation_system_id = 'none',\r\n\t\tdefault_checked_value_id = 'none',\r\n\t\tinformation_propertys_groups_big_width = 'none',\r\n\t\tinformation_propertys_groups_big_height = 'none',\r\n\t\tinformation_propertys_groups_small_width = 'none',\r\n\t\tinformation_propertys_groups_small_height = 'none';\r\n\r\n\tswitch (index)\r\n\t{\r\n\t\tcase 0: // Число\r\n\t\tcase 1: // Строка\r\n\t\tcase 4: // Большое текстовое поле\r\n\t\tcase 5: // Визуальный редактор\r\n\t\tdefault:\r\n\t\t{\r\n\t\t\tdefault_value_id = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 2: // Файл\r\n\t\t{\r\n\t\t\tinformation_propertys_groups_big_width = 'block';\r\n\t\t\tinformation_propertys_groups_big_height = 'block';\r\n\t\t\tinformation_propertys_groups_small_width = 'block';\r\n\t\t\tinformation_propertys_groups_small_height = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 3: // Список\r\n\t\t{\r\n\t\t\tlist_id = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 6: // Информационная система\r\n\t\t{\r\n\t\t\tinformation_system_id = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 7: // Флажок\r\n\t\t{\r\n\t\t\tdefault_checked_value_id = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 8: // Дата\r\n\t\t{\r\n\t\t\tdefault_date_value_id = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 9: // Дата-время\r\n\t\t{\r\n\t\t\tdefault_datetime_value_id = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\t\r\n\t$(\"#\"+WindowId+\" #list_id\").css('display', list_id);\r\n\t$(\"#\"+WindowId+\" #default_value_id\").css('display', default_value_id);\r\n\t$(\"#\"+WindowId+\" #default_date_value_id\").css('display', default_date_value_id);\r\n\t$(\"#\"+WindowId+\" #default_datetime_value_id\").css('display', default_datetime_value_id);\r\n\t$(\"#\"+WindowId+\" #information_system_id\").css('display', information_system_id);\r\n\t$(\"#\"+WindowId+\" #default_checked_value_id\").css('display', default_checked_value_id);\r\n\t$(\"#\"+WindowId+\" #information_propertys_groups_big_width\").css('display', information_propertys_groups_big_width);\r\n\t$(\"#\"+WindowId+\" #information_propertys_groups_big_height\").css('display', information_propertys_groups_big_height);\r\n\t$(\"#\"+WindowId+\" #information_propertys_groups_small_width\").css('display', information_propertys_groups_small_width);\r\n\t$(\"#\"+WindowId+\" #information_propertys_groups_small_height\").css('display', information_propertys_groups_small_height);\r\n}\r\n\r\nfunction ShowRowsItemPropertys(WindowId, index)\r\n{\r\n\tWindowId = getWindowId(WindowId);\r\n\r\n\tindex = parseInt(index);\r\n\t\r\n\tvar list_id = 'none',\r\n\t\tdefault_value_id = 'none',\r\n\t\tdefault_date_value_id = 'none',\r\n\t\tdefault_datetime_value_id = 'none',\r\n\t\tinformation_system_id = 'none',\r\n\t\tdefault_checked_value_id = 'none',\r\n\t\tinformation_propertys_default_big_width = 'none',\r\n\t\tinformation_propertys_default_small_width = 'none',\r\n\t\tinformation_propertys_default_big_height = 'none',\r\n\t\tinformation_propertys_default_small_height = 'none';\r\n\r\n\tswitch (index)\r\n\t{\r\n\t\tcase 0: // Число\r\n\t\tcase 1: // Строка\r\n\t\tcase 4: // Большое текстовое поле\r\n\t\tcase 6: // Визуальный редактор\r\n\t\tdefault:\r\n\t\t{\r\n\t\t\tdefault_value_id = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 2: // Файл\r\n\t\t{\r\n\t\t\tinformation_propertys_default_big_width = 'block';\r\n\t\t\tinformation_propertys_default_small_width = 'block';\r\n\t\t\tinformation_propertys_default_big_height = 'block';\r\n\t\t\tinformation_propertys_default_small_height = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 3: // Список\r\n\t\t{\r\n\t\t\tlist_id = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 5: // Информационная система\r\n\t\t{\r\n\t\t\tinformation_system_id = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 7: // Флажок\r\n\t\t{\r\n\t\t\tdefault_checked_value_id = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 8: // Дата\r\n\t\t{\r\n\t\t\tdefault_date_value_id = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 9: // Дата-время\r\n\t\t{\r\n\t\t\tdefault_datetime_value_id = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\t$(\"#\"+WindowId+\" #list_id\").css('display', list_id);\r\n\t$(\"#\"+WindowId+\" #default_value_id\").css('display', default_value_id);\r\n\t$(\"#\"+WindowId+\" #default_date_value_id\").css('display', default_date_value_id);\r\n\t$(\"#\"+WindowId+\" #default_datetime_value_id\").css('display', default_datetime_value_id);\r\n\t$(\"#\"+WindowId+\" #information_system_id\").css('display', information_system_id);\r\n\t$(\"#\"+WindowId+\" #default_checked_value_id\").css('display', default_checked_value_id);\r\n\t$(\"#\"+WindowId+\" #information_propertys_default_big_width\").css('display', information_propertys_default_small_height);\r\n\t$(\"#\"+WindowId+\" #information_propertys_default_small_width\").css('display', information_propertys_default_small_width);\r\n\t$(\"#\"+WindowId+\" #information_propertys_default_big_height\").css('display', information_propertys_default_big_height);\r\n\t$(\"#\"+WindowId+\" #information_propertys_default_small_height\").css('display', information_propertys_default_small_height);\r\n}\r\n\r\nfunction ShowRowsShopItemPropertysType(WindowId, index)\r\n{\r\n\tWindowId = getWindowId(WindowId);\r\n\r\n\tindex = parseInt(index);\r\n\t\r\n\tvar list_of_properties_default_id = 'none',\r\n\t\tlist_of_properties_mesures_id = 'none',\r\n\t\tlist_of_properties_lists_id = 'none',\r\n\t\tcheckbox = 'none',\r\n\t\tdate_without_time = 'none',\r\n\t\tdate_with_time = 'none',\r\n\t\tshop_list_of_properties_default_big_width = 'none',\r\n\t\tshop_list_of_properties_default_big_height = 'none',\r\n\t\tshop_list_of_properties_default_small_width = 'none',\r\n\t\tshop_list_of_properties_default_small_height = 'none';\r\n\r\n\tswitch (index)\r\n\t{\r\n\t\tcase 0: // Строка\r\n\t\tcase 3: // Большое текстовое поле\r\n\t\tcase 4: // Визуальный редактор\r\n\t\tdefault:\r\n\t\t{\r\n\t\t\tlist_of_properties_default_id = 'block';\r\n\t\t\tlist_of_properties_mesures_id = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 1: // Файл\r\n\t\t{\r\n\t\t\tshop_list_of_properties_default_big_width = 'block',\r\n\t\t\tshop_list_of_properties_default_big_height = 'block',\r\n\t\t\tshop_list_of_properties_default_small_width = 'block',\r\n\t\t\tshop_list_of_properties_default_small_height = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 2: // Список\r\n\t\t{\r\n\t\t\tlist_of_properties_lists_id = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 5: // Дата\r\n\t\t{\r\n\t\t\tdate_without_time = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 6: // ДатаВремя\r\n\t\t{\r\n\t\t\tdate_with_time = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 7: // Флажок\r\n\t\t{\r\n\t\t\tcheckbox = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\t$(\"#\"+WindowId+\" #list_of_properties_default_id\").css('display', list_of_properties_default_id);\r\n\t$(\"#\"+WindowId+\" #list_of_properties_mesures_id\").css('display', list_of_properties_mesures_id);\r\n\t$(\"#\"+WindowId+\" #list_of_properties_lists_id\").css('display', list_of_properties_lists_id);\r\n\t$(\"#\"+WindowId+\" #checkbox\").css('display', checkbox);\r\n\t$(\"#\"+WindowId+\" #date_without_time\").css('display', date_without_time);\r\n\t$(\"#\"+WindowId+\" #date_with_time\").css('display', date_with_time);\r\n\t$(\"#\"+WindowId+\" #shop_list_of_properties_default_big_width\").css('display', shop_list_of_properties_default_big_width);\r\n\t$(\"#\"+WindowId+\" #shop_list_of_properties_default_big_height\").css('display', shop_list_of_properties_default_big_height);\r\n\t$(\"#\"+WindowId+\" #shop_list_of_properties_default_small_width\").css('display', shop_list_of_properties_default_small_width);\r\n\t$(\"#\"+WindowId+\" #shop_list_of_properties_default_small_height\").css('display', shop_list_of_properties_default_small_height);\r\n}\r\n\r\n\r\nfunction ShowRowsShopGroupPropertysType(WindowId, index)\r\n{\r\n\tWindowId = getWindowId(WindowId);\r\n\r\n\tindex = parseInt(index);\r\n\t\r\n\tvar list_of_properties_default_id = 'none',\r\n\t\tlist_of_properties_mesures_id = 'none',\r\n\t\tlist_of_properties_lists_id = 'none',\r\n\t\tcheckbox = 'none',\r\n\t\tdate_without_time = 'none',\r\n\t\tdate_with_time = 'none',\r\n\t\tshop_properties_group_default_big_width = 'none',\r\n\t\tshop_properties_group_default_big_height = 'none',\r\n\t\tshop_properties_group_default_small_width = 'none',\r\n\t\tshop_properties_group_default_small_height = 'none';\r\n\t\t\t\t\r\n\tswitch (index)\r\n\t{\r\n\t\tcase 0: // Строка\r\n\t\tcase 3: // Большое текстовое поле\r\n\t\tcase 4: // Визуальный редактор\r\n\t\tdefault:\r\n\t\t{\r\n\t\t\tlist_of_properties_default_id = 'block';\r\n\t\t\tlist_of_properties_mesures_id = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 1: // Список - файл\r\n\t\t{\r\n\t\t\tshop_properties_group_default_big_width = 'block',\r\n\t\t\tshop_properties_group_default_big_height = 'block',\r\n\t\t\tshop_properties_group_default_small_width = 'block',\r\n\t\t\tshop_properties_group_default_small_height = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 2: // Список\r\n\t\t{\r\n\t\t\tlist_of_properties_lists_id = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 5: // Дата\r\n\t\t{\r\n\t\t\tdate_without_time = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 6: // ДатаВремя\r\n\t\t{\r\n\t\t\tdate_with_time = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 7: // Флажок\r\n\t\t{\r\n\t\t\tcheckbox = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\t$(\"#\"+WindowId+\" #list_of_properties_default_id\").css('display', list_of_properties_default_id);\r\n\t$(\"#\"+WindowId+\" #list_of_properties_mesures_id\").css('display', list_of_properties_mesures_id);\r\n\t$(\"#\"+WindowId+\" #list_of_properties_lists_id\").css('display', list_of_properties_lists_id);\r\n\t$(\"#\"+WindowId+\" #checkbox\").css('display', checkbox);\r\n\t$(\"#\"+WindowId+\" #date_without_time\").css('display', date_without_time);\r\n\t$(\"#\"+WindowId+\" #date_with_time\").css('display', date_with_time);\r\n\t$(\"#\"+WindowId+\" #shop_properties_group_default_big_width\").css('display', shop_properties_group_default_big_width);\r\n\t$(\"#\"+WindowId+\" #shop_properties_group_default_big_height\").css('display', shop_properties_group_default_big_height);\r\n\t$(\"#\"+WindowId+\" #shop_properties_group_default_small_width\").css('display', shop_properties_group_default_small_width);\r\n\t$(\"#\"+WindowId+\" #shop_properties_group_default_small_height\").css('display', shop_properties_group_default_small_height);\r\n}\r\n\r\nfunction ShowRowsSiteUsers(WindowId, index)\r\n{\r\n\tWindowId = getWindowId(WindowId);\r\n\r\n\tvar list_id = 'none',\r\n\t\trows_textarea_id = 'none',\r\n\t\tcols_textarea_id = 'none',\r\n\t\tchecked_id = 'none',\r\n\t\tinput_size_id = 'none',\r\n\t\tdefault_value_id = 'none';\r\n\t\r\n\tswitch (index)\r\n\t{\r\n\t\tcase 'text': // Текстовое поле\r\n\t\t{\r\n\t\t\tinput_size_id = 'block';\r\n\t\t\tdefault_value_id = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'password': // Поле пароля\r\n\t\tcase 'file': // Поле загрузки файла\r\n\t\t{\r\n\t\t\tinput_size_id = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'radio': // Радиогруппа\r\n\t\tcase 'select': // Список\r\n\t\t{\r\n\t\t\tlist_id = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'checkbox': // Флажок \r\n\t\t{\r\n\t\t\t checked_id = 'block';\r\n\t\t\t break;\r\n\t\t}\r\n\t\tcase 'textarea': // Большое текстовое поле\r\n\t\t{\r\n\t\t\trows_textarea_id = 'block';\r\n\t\t\tcols_textarea_id = 'block';\r\n\t\t\tdefault_value_id = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'hidden': // Скрытое поле\r\n\t\t{\r\n\t\t\tdefault_value_id = 'block';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\t$(\"#\"+WindowId+\" #list_id\").css('display', list_id);\r\n\t$(\"#\"+WindowId+\" #rows_textarea_id\").css('display', rows_textarea_id);\r\n\t$(\"#\"+WindowId+\" #cols_textarea_id\").css('display', cols_textarea_id);\r\n\t$(\"#\"+WindowId+\" #checked_id\").css('display', checked_id);\r\n\t$(\"#\"+WindowId+\" #input_size_id\").css('display', input_size_id);\r\n\t$(\"#\"+WindowId+\" #default_value_id\").css('display', default_value_id);\r\n}"
          },
          "redirectURL": "",
          "headersSize": 251,
          "bodySize": 11137
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-05-31T09:51:38.000Z",
            "lastAccess": "2012-05-30T09:51:38.000Z",
            "eTag": "",
            "hitCount": 18
          }
        },
        "timings": {
          "blocked": 4,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 5,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:38.786+04:00",
        "time": 10,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/js/ajax.js?-936011871",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Thu, 15 Sep 2011 12:16:13 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [
            {
              "name": "-936011871",
              "value": ""
            }
          ],
          "headersSize": 707,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Thu, 15 Sep 2011 12:16:13 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Thu, 31 May 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=86400"
            }
          ],
          "content": {
            "mimeType": "application/x-javascript",
            "size": 37690,
            "text": "/**\r\n* HostCMS\r\n*\r\n* @author Hostmake LLC, http://www.hostcms.ru/\r\n* @version 5.x\r\n*/\r\n\r\nif (typeof HostcmsEscape == 'undefined')\r\n{\r\n\tfunction HostcmsEscape(str)\r\n\t{\r\n\t\treturn encodeURIComponent(str);\r\n\t}\r\n}\r\n\r\nfunction function_exists(function_name)\r\n{\r\n\tif (typeof function_name == 'string')\r\n\t{\r\n\t\treturn (typeof window[function_name] == 'function');\r\n\t}\r\n\telse\r\n\t{\r\n\t\treturn (function_name instanceof Function);\r\n\t}\r\n}\r\n\r\nfunction getWindowId(WindowId)\r\n{\r\n\tif (typeof WindowId == 'undefined' || WindowId == '')\r\n\t{\r\n\t\tWindowId = 'id_content';\r\n\t}\r\n\t\r\n\treturn WindowId;\r\n}\r\n\r\n// Событие - нажатие клавиши.\r\ndocument.onkeydown = DoKeyDown;\r\n\r\n// Пользовательский обработчик события нажатия клавиш,\r\n// для обработки Ctrl + стрелка.\r\nfunction DoKeyDown(event)\r\n{\r\n\tif (!document.getElementById)\r\n\t{\r\n\t\treturn;\r\n\t}\r\n\r\n\tif (window.event)\r\n\t{\r\n\t\tevent = window.event;\r\n\t}\r\n\r\n\tif (event.ctrlKey)\r\n\t{\r\n\t\tvar Element = null;\r\n\r\n\t\tswitch (event.keyCode ? event.keyCode : event.which ? event.which : null)\r\n\t\t{\r\n\t\t\tcase 0x25: // Назад\r\n\t\t\tElement = document.getElementById('id_prev');\r\n\t\t\tbreak;\r\n\r\n\t\t\tcase 0x27: // Вперед\r\n\t\t\tElement = document.getElementById('id_next');\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tif (Element && Element.href)\r\n\t\t{\r\n\t\t\t// Редирект на нужную страницу.\r\n\t\t\tdocument.location = Element.href;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Пользовательский обработчик события нажатия клавиш,\r\n// для обработки нажатия Enter у фильтра.\r\nfunction DoKeyDownFilter(event)\r\n{\r\n\tif (!document.getElementById)\r\n\t{\r\n\t\treturn;\r\n\t}\r\n\r\n\tel = document.getElementById('admin_forms_apply_button');\r\n\r\n\tswitch (event.keyCode ? event.keyCode : event.which ? event.which : null)\r\n\t{\r\n\t\tcase 13: // Ввод\r\n\t\tel.click();\r\n\t\tbreak;\r\n\t}\r\n}\r\n\r\n// Функция устанавливает checkbox редактирования у указанного элемента.\r\nfunction DoModification(ACheckboxId)\r\n{\r\n\t$(\"#id_content input[type='checkbox'][id='\"+ACheckboxId+\"']\").attr('checked', true);\r\n}\r\n\r\n// Установка или снятие всех флажков для checkbox'ов элементов.\r\nfunction SelectAllItems(WindowId, checked)\r\n{\r\n\tWindowId = getWindowId(WindowId);\r\n\t\r\n\t$(\"#\"+WindowId+\" input[type='checkbox'][name^='check_']\").each(function() {\r\n\t\tvar el = $(this);\r\n\r\n\t\tvar reg = /check_(\\d+)_(\\S+)/;\r\n\t\tvar arr = reg.exec(el.attr('name'));\r\n\r\n\t\t// arr[1] - ID источника\r\n\t\t// arr[2] - ID элемента\r\n\r\n\t\t// Устанавливаем checked\r\n\t\tel.attr('checked', checked);\r\n\r\n\t\t// Подсвечиваем строчку\r\n\t\tRowHighlight(WindowId, 'row_' + arr[1] + '_' + arr[2]);\r\n\t});\r\n\t\r\n\t// Check/uncheck top checkbox\r\n\tSetTopCheckbox(WindowId);\r\n}\r\n\r\n// Функция проверяет, установлены ли все checkbox'ы, если уcтановлены - устанавливает и главный,\r\n// если не установлены, снимает флажок с главного.\r\nfunction SetTopCheckbox(WindowId)\r\n{\r\n\tWindowId = getWindowId(WindowId);\r\n\r\n\t// Все элементы выделены\r\n\tbChecked = ($(\"#\"+WindowId+\" input[type='checkbox'][name^='check_']:not(:checked)\").length == 0);\r\n\t$(\"#\"+WindowId+\" input[type='checkbox'][name^='admin_forms_all_check']\").attr('checked', bChecked);\r\n}\r\n\r\n// Функция выделят строку таблицы\r\n// RowId - идентификатор строки\r\nfunction RowHighlight(WindowId, RowId)\r\n{\r\n\tWindowId = getWindowId(WindowId);\r\n\t\r\n\tvar oRow = $(\"#\" + WindowId + \" #\" + RowId);\r\n\r\n\tif (oRow.length == 1)\r\n\t{\r\n\t\tvar reg = /row_(\\d+)_(\\S+)/;\r\n\t\tvar arr = reg.exec(RowId);\r\n\r\n\t\t// arr[1] - ID источника\r\n\t\t// arr[2] - ID элемента\r\n\r\n\t\t// Получим элемент ckeckbox\r\n\t\tif ($(\"#\" + WindowId + \" #id_check_\" + arr[1] + '_' + arr[2]).attr('checked'))\r\n\t\t{\r\n\t\t\tswitch (oRow.attr('class'))\r\n\t\t\t{\r\n\t\t\t\tcase \"row_table\":\r\n\t\t\t\t{\r\n\t\t\t\t\tclassname = \"Highlight_row_table\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tcase \"row_table_over\":\r\n\t\t\t\t{\r\n\t\t\t\t\tclassname = \"Highlight_row_table\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tcase \"row_table_odd\":\r\n\t\t\t\t{\r\n\t\t\t\t\tclassname = \"Highlight_row_table_odd\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tcase \"row_table_over_odd\":\r\n\t\t\t\t{\r\n\t\t\t\t\tclassname = \"Highlight_row_table_odd\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tdefault:\r\n\t\t\t\t{\r\n\t\t\t\t\tclassname = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tclassname_over = classname;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tswitch (oRow.attr('class'))\r\n\t\t\t{\r\n\t\t\t\tcase \"Highlight_row_table_odd\":\r\n\t\t\t\t{\r\n\t\t\t\t\tclassname = \"row_table_odd\";\r\n\t\t\t\t\tclassname_over = \"row_table_over_odd\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tcase \"Highlight_row_table\":\r\n\t\t\t\t{\r\n\t\t\t\t\tclassname = \"row_table\";\r\n\t\t\t\t\tclassname_over = \"row_table_over\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tdefault:\r\n\t\t\t\t{\r\n\t\t\t\t\tclassname = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif (classname)\r\n\t\t{\r\n\t\t\toRow.attr('class', classname)\r\n\t\t\t.data('classname_over', classname_over)\r\n\t\t\t.data('classname_out', classname)\r\n\t\t\t.mouseover(function(){\r\n\t\t\t\t$(this).attr('class', $(this).data('classname_over'));\r\n\t\t\t})\r\n\t\t\t.mouseout(function(){\r\n\t\t\t\t$(this).attr('class', $(this).data('classname_out'));\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Функция выполняет событие, убирает выделение всех checkbox'ов кроме нужного.\r\n// AAction - относительный адрес файла, который будет запрошен\r\n// AAdditionalParams - внешние переметры, передаваемые в строку запроса. Должны начинаться с &\r\n// AOperation - название события\r\n// AItemName - кодовое имя элемента, над которым производится действие\r\n// AAdminFromsId - идентификатор формы\r\n// ALimit - текущая страница\r\n// AOnPage - число элементов на страницу\r\n// AOrderFieldId - ID поля, по которому идет сортировка\r\n// AOrderDirection - направление сортировки, 1 - по возрастанию, 2 - по убыванию\r\nfunction TrigerSingleAction(AAction, AAdditionalParams, AOperation, AItemName, AAdminFromsId, ALimit, AOnPage, AOrderFieldId, AOrderDirection, WindowId)\r\n{\r\n\tWindowId = getWindowId(WindowId);\r\n\r\n\tvar ElementID = 'id_' + AItemName;\r\n\r\n\tcbItem = $(\"#\"+WindowId+\" #\"+ElementID);\r\n\r\n\tif (cbItem.length > 0)\r\n\t{\r\n\t\t// Uncheck all checkboxes with name like 'check_'\r\n\t\t$(\"#\"+WindowId+\" input[type='checkbox'][name^='check_']:not([name*='_fv_'])\").attr('checked', false);\r\n\t\t\r\n\t\t// Check checkbox\r\n\t\tcbItem.attr('checked', true);\r\n\t}\r\n\telse\r\n\t{\r\n\t\tvar Check_0_0 = $('<input>')\r\n\t\t\t.attr('type', 'checkbox')\r\n\t\t\t.attr('name', AItemName)\r\n\t\t\t.attr('id', ElementID);\r\n\t\t\t\t\r\n\t\t$('<div>')\r\n\t\t\t.attr(\"style\", 'display: none')\r\n\t\t\t.append(Check_0_0)\r\n\t\t\t.appendTo($(\"#\"+WindowId));\r\n\t\t\r\n\t\t// After insert into DOM\r\n\t\tCheck_0_0.attr('checked', true);\r\n\t}\r\n\r\n\tSetTopCheckbox(WindowId);\r\n\r\n\t// Если для действия был указан 0, то устанавливаем в false, чтобы не передавать явно limit в DoLoadAjax()\r\n\tif (ALimit == 0)\r\n\t{\r\n\t\tALimit = false;\r\n\t}\r\n\r\n\tDoLoadAjax(AAction, AAdditionalParams, AAdminFromsId, AOperation, ALimit, AOnPage, AOrderFieldId, AOrderDirection, WindowId);\r\n}\r\n\r\n// Вызов групповой операции.\r\n// AAction - относительный адрес файла, который будет запрошен\r\n// AAdditionalParams - внешние переметры, передаваемые в строку запроса. Должны начинаться с &\r\nfunction CallGroupOperation(AAction, AAdditionalParams, AAdminFromsId, ALimit, AOnPage, AOrderFieldId,\r\nAOrderDirection)\r\n{\r\n\tcbGroupOperation = document.getElementById('id_admin_forms_group_operation');\r\n\tif (cbGroupOperation)\r\n\t{\r\n\t\tsOperation = cbGroupOperation.options[cbGroupOperation.selectedIndex].value;\r\n\t\tif (sOperation != '')\r\n\t\t{\r\n\t\t\t// Вызываем тригер операции.\r\n\t\t\tDoLoadAjax(AAction, AAdditionalParams, AAdminFromsId, sOperation, ALimit, AOnPage, AOrderFieldId, AOrderDirection);\r\n\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\n// выполняет скрипты из полученного ответа от сервера\r\nfunction runScripts(scripts)\r\n{\r\n\tif (!scripts)\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfor (var i = 0; i < scripts.length; i++)\r\n\t{\r\n\t\tvar thisScript = scripts[i];\r\n\t\tvar text;\r\n\r\n\t\tif (thisScript.src)\r\n\t\t{\r\n\t\t\tvar newScript = document.createElement(\"script\");\r\n\t\t\tnewScript.type = thisScript.type;\r\n\t\t\tnewScript.language = thisScript.language;\r\n\r\n\t\t\tnewScript.src = thisScript.src;\r\n\t\t\tdocument.getElementsByTagName('head')[0].appendChild(newScript);\r\n\t\t}\r\n\t\telse if (text = (thisScript.text || thisScript.innerHTML))\r\n\t\t{\r\n\t\t\tvar text = (\"\"+text).replace(/^\\s*<!\\-\\-/, '').replace(/\\-\\->\\s*$/, '');\r\n\t\t\t\r\n\t\t\tvar newScript = document.createElement(\"script\");\r\n\t\t\tnewScript.setAttribute(\"type\", \"text/javascript\");\r\n\t\t\tnewScript.text = text;\r\n\r\n\t\t\tvar script_node = document.getElementsByTagName('head')[0].appendChild(newScript);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// ActionName может принимать значения\r\n// disable - отключение CodePress\r\n// save - сохранение данных из CodePress\r\nfunction CodePressAction(ActionName)\r\n{\r\n\tif (typeof CodePress != 'undefined')\r\n\t{\r\n\t\tif (ActionName == 'load')\r\n\t\t{\r\n\t\t\tsetTimeout(function(){CodePress.run()}, 500);\t\t\t\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\ttextarea_array = document.getElementsByTagName(\"textarea\");\r\n\t\r\n\t\t\tfor (var i = 0; i < textarea_array.length; i++)\r\n\t\t\t{\r\n\t\t\t\tvar elementId = textarea_array[i].id;\r\n\t\t\t\tif(textarea_array[i].className.match('codepress'))\r\n\t\t\t\t{\r\n\t\t\t\t\tid = textarea_array[i].id;\r\n\t\r\n\t\t\t\t\tvar old_id = id.split('_cp').join('');\r\n\r\n\t\t\t\t\t// Id был заменен CodePress\r\n\t\t\t\t\tif (old_id != id)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tswitch (ActionName)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t//\r\n\t\t\t\t\t\t\tcase 'disable':\r\n\t\t\t\t\t\t\teval(old_id + '.toggleEditor()');\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\r\n\t\t\t\t\t\t\tcase 'save':\r\n\t\t\t\t\t\t\t\tvar eval_code = 'if (typeof ' + old_id + ' != \"undefined\")' +  \r\n\t\t\t\t\t\t\t\t\t'document.getElementById(\"' + id + '\").value = ' + old_id + '.getCode();'\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\teval(eval_code);\r\n\t\t\t\t\t\t\t\t//eval('document.getElementById(\"' + id + '\").value = ' + old_id + '.getCode();');\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction DisableTinyMCE()\r\n{\r\n\t// Работу с визуальным редактором ведём\r\n\tif (typeof tinyMCE != 'undefined')\r\n\t{\r\n\t\ttextarea_array = document.getElementsByTagName(\"textarea\");\r\n\r\n\t\tfor (var i = 0; i < textarea_array.length; i++)\r\n\t\t{\r\n\t\t\tvar elementId = textarea_array[i].id;\r\n\r\n\t\t\tif (tinyMCE.getInstanceById(elementId) != null)\r\n\t\t\t{\r\n\t\t\t\ttextarea_array[i].disabled = true;\r\n\t\t\t\t//tinyMCE.execCommand('mceToggleEditor', false, elementId);\r\n\t\t\t\ttinyMCE.execCommand('mceRemoveControl', false, elementId);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Отключаем все редакторы CodePress, сохраняем код в textarea\r\n\tCodePressAction('disable');\r\n}\r\n\r\nfunction doSendForm(AAction, AAdditionalParams, ButtonObject, AAdminFromsId, AOperation, ALimit, AOnPage, WindowId)\r\n{\r\n\treturn SendForm('', AAction, AAdditionalParams, ButtonObject, AAdminFromsId, AOperation, ALimit, AOnPage, WindowId);\r\n}\r\n\r\nfunction insertContent(object, content)\r\n{\r\n\t// Fix blink in FF\r\n\tobject.scrollTop(0);\r\n\tobject.empty();\r\n\tobject.html(content);\r\n}\r\n\r\n// Отправка формы методом Get или Post\r\n// AAction - относительный адрес файла, который будет запрошен\r\n// AAdditionalParams - внешние переметры, передаваемые в строку запроса. Должны начинаться с &\r\n// ButtonObject - Объект нажатой кнопки\r\n// AAdminFromsId - идентификатор формы центра администрирования\r\nfunction SendForm(WindowId, AAction, AAdditionalParams, ButtonObject, AAdminFromsId, AOperation, ALimit, AOnPage)\r\n{\r\n\tWindowId = getWindowId(WindowId);\r\n\r\n\tvar FormNode = $(ButtonObject).closest('form');\r\n\t\r\n\t// Пытаемся получить скрытый объект для input-а\r\n\tvar jHiddenInput = $(\"#\" + WindowId + \" #\"+ButtonObject.name);\r\n\r\n\t// Элемента нет, добавим его\r\n\tif (jHiddenInput.length == 0)\r\n\t{\r\n\t\t// Создадим скрытй input, т.к. нажатый не передается в форму\r\n\t\tFormNode.append($('<input>')\r\n\t\t\t\t.attr('type', 'hidden')\r\n\t\t\t\t.attr('name', ButtonObject.name)\r\n\t\t\t\t.attr('id', ButtonObject.name));\r\n\t}\r\n\r\n\t// Сохраним из визуальных редакторов данные\r\n\tif (typeof tinyMCE != 'undefined')\r\n\t{\r\n\t\ttinyMCE.triggerSave();\r\n\t}\r\n\t\r\n\tCodePressAction('save');\r\n\r\n\tvar JsHttpRequestSendForm = new JsHttpRequest();\r\n\r\n\t// Код вызывается, когда загрузка завершена\r\n\tJsHttpRequestSendForm.onreadystatechange = function ()\r\n\t{\r\n\t\tif (JsHttpRequestSendForm.readyState == 4)\r\n\t\t{\r\n\t\t\t// Убираем затемнение.\r\n\t\t\tHideLoadingScreen();\r\n\r\n\t\t\tif (typeof JsHttpRequestSendForm.responseJS != 'undefined')\r\n\t\t\t{\r\n\t\t\t\t// Данные записываем только тогда, если они есть и не пустые.\r\n\t\t\t\tif (typeof JsHttpRequestSendForm.responseJS.form_html != 'undefined'\r\n\t\t\t\t\t&& JsHttpRequestSendForm.responseJS.form_html != '')\r\n\t\t\t\t{\r\n\t\t\t\t\t// Устанавливаем путь для возможности в браузере ходить вперед-назад\r\n\t\t\t\t\tAjaxSetLocation(FormAction);\r\n\r\n\t\t\t\t\t// Отключаем связь с редакторами\r\n\t\t\t\t\tDisableTinyMCE();\r\n\r\n\t\t\t\t\tvar div_id_content = $(\"#\"+WindowId);\r\n\r\n\t\t\t\t\tinsertContent(div_id_content, JsHttpRequestSendForm.responseJS.form_html);\r\n\r\n\t\t\t\t\tformatTable(WindowId);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (typeof JsHttpRequestSendForm.responseJS.error != 'undefined')\r\n\t\t\t\t{\r\n\t\t\t\t\tvar div_id_message = $(\"#\"+WindowId+\" #id_message\");\r\n\r\n\t\t\t\t\tif (div_id_message.length == 1)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tinsertContent(div_id_message, JsHttpRequestSendForm.responseJS.error);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Title.\r\n\t\t\t\tif (typeof JsHttpRequestSendForm.responseJS.title != 'undefined' && JsHttpRequestSendForm.responseJS.title != '')\r\n\t\t\t\t{\r\n\t\t\t\t\tdocument.title = JsHttpRequestSendForm.responseJS.title;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\r\n\tvar FormAction, FormMethod, sOnPage = '', ALimit = '';\r\n\t\r\n\tFormAction = FormNode.attr('action');\r\n\tFormMethod = FormNode.attr('method');\r\n\r\n\tif (AOnPage)\r\n\t{\r\n\t\tsOnPage = '&admin_forms_on_page=' + AOnPage;\r\n\t}\r\n\r\n\t// Текущая страница.\r\n\tif (ALimit != 0)\r\n\t{\r\n\t\tALimit = '&limit=' + ALimit;\r\n\t}\r\n\r\n\t// передача параметров AAdditionalParams сделана явно, а не через hostcmsAAdditionalParams\r\n\tFormAction += (FormAction.indexOf('?') >= 0 ? '&' : '?') + 'hostcmsAAction=' + HostcmsEscape(AAction) +\r\n\t'&hostcmsAAdditionalParams=' + HostcmsEscape(AAdditionalParams) + AAdditionalParams +\r\n\t'&operation=' + AOperation + ALimit + sOnPage;\r\n\r\n\tFormAction += '&window_id=' + WindowId;\r\n\t\r\n\tJsHttpRequestSendForm.open(FormMethod, FormAction, true);\r\n\r\n\t// Отправляем запрос в backend.\r\n\tJsHttpRequestSendForm.send( { query: FormNode.get() } );\r\n\r\n\t// Очистим поле для сообщений\r\n\t$(\"#\"+WindowId+\" #id_message\").empty();\r\n\t\r\n\t// Отображаем экран загрузки\r\n\tShowLoadingScreen();\r\n\r\n\treturn false;\r\n}\r\n\r\n// action - адрес страницы для запрос\r\n// method - GET, POST, null - автоматическое определение\r\n// callback_function - функция обратного вызова, которая будет вызвана после получения ответа от backenad-а\r\nfunction sendRequest(action, method, callback_function)\r\n{\r\n\tvar req = new JsHttpRequest();\r\n\r\n\t// Отображаем экран загрузки\r\n\tShowLoadingScreen();\r\n\r\n\t// Этот код вызовется автоматически, когда загрузка данных завершится.\r\n\treq.onreadystatechange = function()\r\n\t{\r\n\t\tif (req.readyState == 4)\r\n\t\t{\r\n\t\t\t// Убираем затемнение.\r\n\t\t\tHideLoadingScreen();\r\n\r\n\t\t\tif (typeof callback_function != 'undefined')\r\n\t\t\t{\r\n\t\t\t\tcallback_function(req.responseJS);\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\r\n\treq.open(method, action, true);\r\n\r\n\t// Отсылаем данные в обработчик.\r\n\treq.send(null);\r\n}\r\n\r\n// Загрузка формы\r\n// AAction - относительный адрес файла, который будет запрошен\r\n// AAdditionalParams - внешние переметры, передаваемые в строку запроса. Должны начинаться с &\r\n// AAdminFromsId - идентификатор формы центра администрирования\r\n// AOperation - имя события\r\n// ALimit - текущая страница, false - не отправлять страницу\r\n// AOnPage - число элементов на страницу\r\n// AOrderFieldId - ID поля, по которому идет сортировка\r\n// AOrderDirection - направление сортировки, 1 - по возрастанию, 2 - по убыванию\r\nfunction DoLoadAjax(AAction, AAdditionalParams, AAdminFromsId, AOperation, ALimit, AOnPage, AOrderFieldId, AOrderDirection, WindowId)\r\n{\r\n\tWindowId = getWindowId(WindowId);\r\n\t\r\n\tif (AOperation == '')\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\r\n\tif (AAdditionalParams == ' ')\r\n\t{\r\n\t\tAAdditionalParams = '';\r\n\t}\r\n\t\r\n\tvar element_name, sOrder = '', sOnPage = '', \r\n\t\tsElements = '', sFilter = '';\r\n\t\r\n\t// Если поле сортировки было указано - передадим поле и направление сортировки\r\n\tif (AOrderFieldId != 0)\r\n\t{\r\n\t\tsOrder = '&order_field_id=' + AOrderFieldId + '&order_field_direction=' + AOrderDirection;\r\n\t}\r\n\r\n\tif (AOnPage)\r\n\t{\r\n\t\tsOnPage = '&admin_forms_on_page=' + AOnPage;\r\n\t}\r\n\r\n\t// Элементы списка\r\n\tvar jChekedItems = $(\"#\"+WindowId+\" :input[type='checkbox'][name^='check_']:checked\"),\r\n\t\tiChekedItemsCount = jChekedItems.length,\r\n\t\tjItemsValue, iItemsValueCount, sValue;\r\n\t\t\r\n\tfor (var jChekedItem, i=0; i < iChekedItemsCount; i++)\r\n\t{\r\n\t\tjChekedItem = jChekedItems.eq(i);\r\n\t\telement_name = jChekedItem.attr('name');\r\n\t\t\r\n\t\tsElements += '&' + element_name + '=1';\r\n\r\n\t\t// Ищем значения записей, имя поля должно начинаться с имени checkbox-а\r\n\t\tjItemsValue = $(\"#\"+WindowId+\" :input[name^='\"+element_name+\"_fv_']\"),\r\n\t\tiItemsValueCount = jItemsValue.length;\r\n\t\t\r\n\t\tfor (var jValueItem, k=0; k < iItemsValueCount; k++)\r\n\t\t{\r\n\t\t\tjValueItem = jItemsValue.eq(k);\r\n\t\t\t\r\n\t\t\tif (jValueItem.attr(\"type\") == 'checkbox')\r\n\t\t\t{\r\n\t\t\t\tif (jValueItem.attr('checked'))\r\n\t\t\t\t{\r\n\t\t\t\t\tsValue = '1';\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tsValue = '0';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tsValue = jValueItem.val();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tsElements += '&' + jValueItem.attr('name') + '=' + sValue;\r\n\t\t}\r\n\t}\r\n\r\n\t// Фильтр\r\n\tvar jFiltersItems = $(\"#\"+WindowId+\" :input[name^='admin_form_filter_']\"),\r\n\t\tiFiltersItemsCount = jFiltersItems.length;\r\n\r\n\tfor (var jFiltersItem, i=0; i < iFiltersItemsCount; i++)\r\n\t{\r\n\t\tjFiltersItem = jFiltersItems.eq(i);\r\n\t\t\r\n\t\t// Если значение фильтра до 255 символов\r\n\t\tif (jFiltersItem.val().length < 256)\r\n\t\t{\r\n\t\t\t// Дописываем к передаваемым данным\r\n\t\t\tsFilter += '&' + jFiltersItem.attr('name') + '=' + HostcmsEscape(jFiltersItem.val());\r\n\t\t}\r\n\t}\r\n\r\n\t// Текущая страница.\r\n\t//if (ALimit == 0)\r\n\tif (ALimit === false)\r\n\t{\r\n\t\tALimit = '';\r\n\t}\r\n\telse\r\n\t{\r\n\t\tALimit = '&limit=' + ALimit;\r\n\t}\r\n\r\n\tcmsrequest = AAction + '?admin_forms_id=' + AAdminFromsId +\r\n\t'&hostcmsAAction=' + HostcmsEscape(AAction) +\r\n\t'&hostcmsAAdditionalParams=' + HostcmsEscape(AAdditionalParams) +\r\n\t'&operation=' + AOperation + ALimit + sOnPage + sFilter +\r\n\tsElements + sOrder + AAdditionalParams;\r\n\r\n\tif (cmsrequest.length < 2000)\r\n\t{\r\n\t\tmethod = 'get';\r\n\t}\r\n\telse\r\n\t{\r\n\t\tmethod = 'post';\r\n\t}\r\n\r\n\t// Отправляем запрос backend-у\r\n\tsendRequest(cmsrequest, method, callbackfunction_DoLoadAjax);\r\n}\r\n\r\n//Устанавливаеn путь для возможности в браузере ходить вперед-назад\r\nfunction AjaxSetLocation(request)\r\n{\r\n\t// Указываем текущий путь\r\n\t// Меняем Location только при DoLoadAjax, если вернулись назад - не меняем\r\n\tif (request != ''\r\n\t&& function_exists('getCmsUrl')\r\n\t&& getCmsUrl() != request)\r\n\t{\r\n\t\tsetLocation(request);\r\n\t}\r\n\r\n\tif (function_exists('saveLocation'))\r\n\t{\r\n\t\t// Сохраняем текущий путь всегда\r\n\t\tsaveLocation(getCmsUrl());\r\n\t}\r\n}\r\n\r\n// Функция обратного вызова для DoLoadAjax\r\nfunction callbackfunction_DoLoadAjax(responseJS)\r\n{\r\n\t// Результат принят\r\n\tsended_request = false;\r\n\r\n\tif (responseJS != null)\r\n\t{\r\n\t\t// Данные.\r\n\t\tif (typeof responseJS.form_html != 'undefined')\r\n\t\t{\r\n\t\t\tif (typeof cmsrequest != 'undefined')\r\n\t\t\t{\r\n\t\t\t\t// Устанавливаем путь для возможности в браузере ходить вперед-назад\r\n\t\t\t\tAjaxSetLocation(cmsrequest);\r\n\t\t\t}\r\n\r\n\t\t\t// Отключаем связь с редакторами\r\n\t\t\tDisableTinyMCE();\r\n\r\n\t\t\tif (responseJS.form_html != '')\r\n\t\t\t{\r\n\t\t\t\tvar div_id_content = $(\"#id_content\");\r\n\r\n\t\t\t\t// Занесем текст\r\n\t\t\t\tdiv_id_content.empty();\r\n\t\t\t\tdiv_id_content.html(responseJS.form_html);\r\n\t\t\t\t\r\n\t\t\t\tformatTable();\r\n\t\t\t\tformatTextarea();\r\n\t\t\t\t\r\n\t\t\t\t// Если Tooltip не скрыт, то скрываем\r\n\t\t\t\t$(\"#tooltip\").remove();\r\n\t\t\t}\r\n\r\n\t\t\t// Сбрасываем cmsrequest\r\n\t\t\tcmsrequest = '';\r\n\r\n\t\t\t// Если Tooltip не скрыт, то скрываем\r\n\t\t\t$(\"#tooltip\").remove();\r\n\t\t}\r\n\r\n\t\tif (typeof responseJS.error != 'undefined')\r\n\t\t{\r\n\t\t\tvar div_id_message = $(\"#id_message\");\r\n\r\n\t\t\tif (div_id_message.length == 1)\r\n\t\t\t{\r\n\t\t\t\t// Занесем текст\r\n\t\t\t\tdiv_id_message.empty();\r\n\t\t\t\tdiv_id_message.html(responseJS.error);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Title.\r\n\t\tif (typeof responseJS.title != 'undefined' && responseJS.title != '')\r\n\t\t{\r\n\t\t\tdocument.title = responseJS.title;\r\n\t\t}\r\n\r\n\t\t// Редирект.\r\n\t\tif (typeof responseJS.redirect != 'undefined')\r\n\t\t{\r\n\t\t\tif (responseJS.redirect != '')\r\n\t\t\t{\r\n\t\t\t\tShowLoadingScreen();\r\n\t\t\t\tlocation = responseJS.redirect;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Удаляет дочерние элементы элемента с ID, равным node_id\r\nfunction deleteChildNodes(node_id)\r\n{\r\n\tvar node = document.getElementById(node_id);\r\n\r\n\tif (typeof node != 'undefined')\r\n\t{\r\n\t\tif (node.hasChildNodes())\r\n\t\t{\r\n\t\t\twhile (node.firstChild)\r\n\t\t\t{\r\n\t\t\t\tnode.removeChild(node.firstChild);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Отображение экрана загрузки AJAX\r\nfunction ShowLoadingScreen()\r\n{\r\n\t$(\"body\").css(\"cursor\", \"wait\");\r\n\t\r\n\tvar fade_div = $(\"#id_admin_forms_fade\");\r\n\t\r\n\tif (fade_div.length == 0)\r\n\t{\r\n\t\t// Создаем div\r\n\t\tfade_div = $('<div></div>')\r\n\t\t\t.appendTo(document.body)\r\n\t\t\t.hide()\r\n\t\t\t.attr('id', \"id_admin_forms_fade\")\r\n\t\t\t.attr('className', \"shadowed\")\r\n\t\t\t.applyShadow()\r\n\t\t\t.css('z-index', \"1500\")\r\n\t\t\t.css('position', \"absolute\")\r\n\t\t\t.css('left', \"50%\")\r\n\t\t\t.css('top', \"50%\")\r\n\t\t\t.append('<img src=\"/admin/images/ajax_loader.gif\" id=\"id_fade_div_img\" />')\r\n\t\t\t.css('width', \"32\");\r\n\t}\r\n\r\n\tfade_div\r\n\t\t.show()\r\n\t\t.css('top', ($(window).height() - fade_div.outerHeight(true)) / 2 + $(window).scrollTop())\r\n\t\t.css('left', ($(window).width() - fade_div.outerWidth(true)) / 2 + $(window).scrollLeft());\r\n}\r\n\r\n// Скрытие экрана загрузки AJAX.\r\nfunction HideLoadingScreen()\r\n{\r\n\t$(\"body\").css(\"cursor\", \"auto\");\r\n\t$(\"#id_admin_forms_fade\").css('display', 'none');\r\n}\r\n\r\n// Функция обратного вызова, вызываемая при получении ответа на удаление изображений\r\nfunction callback_function_exec_from_return(responseJS)\r\n{\r\n\t// Выполняем присланные данные\r\n\tif (typeof responseJS != 'undefined')\r\n\t{\r\n\t\t// Данные.\r\n\t\tif (typeof responseJS.result != 'undefined')\r\n\t\t{\r\n\t\t\tvar temp_div = document.createElement('div');\r\n\t\t\ttemp_div.style.display = 'none';\r\n\t\t\ttemp_div.innerHTML = responseJS.result;\r\n\r\n\t\t\t// Выполняем скрипты из полученного с сервера HTML-а\r\n\t\t\trunScripts(temp_div.getElementsByTagName('SCRIPT'));\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction AddLoadFileField(container_id, input_prefix)\r\n{\r\n\tcbItem = document.getElementById(container_id);\r\n\r\n\tif (cbItem)\r\n\t{\r\n\t\t// Получаем все input-ы\r\n\t\telement_array = cbItem.getElementsByTagName(\"input\");\r\n\r\n\t\tcount_input = element_array.length;\r\n\r\n\t\t// <br/>\r\n\t\tvar ElementBr = document.createElement(\"br\");\r\n\t\tcbItem.appendChild(ElementBr);\r\n\r\n\t\t//<input\r\n\t\tvar ElementInput = document.createElement(\"input\");\r\n\t\tElementInput.setAttribute(\"size\", \"60\");\r\n\t\tElementInput.setAttribute(\"name\", input_prefix + count_input);\r\n\t\tElementInput.setAttribute(\"type\", \"file\");\r\n\t\tElementInput.setAttribute(\"title\", \"Прикрепить файл\");\r\n\t\tElementInput.setAttribute(\"style\", \"margin-bottom: 20px\");\r\n\t\tcbItem.appendChild(ElementInput);\r\n\t}\r\n}\r\n\r\n/**\r\n* Добавление полей для спец.цены\r\n* container_id - div, в который добавляются элементы\r\n*/\r\nfunction AddSpecialPricesFields(container_id)\r\n{\r\n\tcbItem = document.getElementById(container_id);\r\n\r\n\tif (cbItem)\r\n\t{\r\n\t\t// Получаем все input-ы\r\n\t\telement_array = cbItem.getElementsByTagName(\"input\");\r\n\r\n\t\tcount_input = element_array.length / 4 + 1;\r\n\r\n\t\t// <div style=\"clear: both;\"/>\r\n\t\tvar element_div = document.createElement(\"div\");\r\n\t\telement_div.setAttribute(\"style\", \"clear: both;\");\r\n\t\tcbItem.appendChild(element_div);\r\n\r\n\t\t// Создаем div\r\n\t\tvar element_div = document.createElement(\"div\");\r\n\t\telement_div.setAttribute(\"class\", \"item_div\");\r\n\t\telement_div.setAttribute(\"style\", \"float: left;\");\r\n\t\tcbItem.appendChild(element_div);\r\n\r\n\t\tvar element_span = document.createElement(\"span\");\r\n\t\telement_span.setAttribute(\"class\", \"caption\");\r\n\t\telement_div.appendChild(element_span);\r\n\r\n\t\tvar element_acronym = document.createElement(\"acronym\");\r\n\t\telement_acronym.setAttribute(\"title\", \"Минимальное количество товара, которое нужно купить за один раз, чтобы задействовать цену\");\r\n\t\telement_acronym.innerHTML = \"Количество товара от\";\r\n\t\telement_span.appendChild(element_acronym);\r\n\r\n\t\t//<input Количество товара от\r\n\t\tvar ElementInput = document.createElement(\"input\");\r\n\t\tElementInput.setAttribute(\"id\", \"shop_special_prices_from_\" + count_input);\r\n\t\tElementInput.setAttribute(\"type\", \"text\");\r\n\t\tElementInput.setAttribute(\"onblur\", \"FieldCheck(this)\");\r\n\t\tElementInput.setAttribute(\"onkeyup\", \"FieldCheck(this)\");\r\n\t\tElementInput.setAttribute(\"onkeydown\", \"FieldCheck(this)\");\r\n\t\tElementInput.setAttribute(\"value\", \"\");\r\n\t\tElementInput.setAttribute(\"name\", \"shop_special_prices_from_js_\" + count_input);\r\n\t\tElementInput.setAttribute(\"style\", \"width: 120px; background-image: url(/admin/images/bullet_green.gif); background-position: right center; background-repeat: no-repeat;\");\r\n\t\telement_div.appendChild(ElementInput);\r\n\r\n\t\tfieldType[\"shop_special_prices_from_\" + count_input] = {'maxlen' : 11,\r\n\t\t'reg' : /^[0-9]*$/};\r\n\t\tfieldMessage[\"shop_special_prices_from_\" + count_input] = {'reg' : \"Значение поля не соответствует формату.\"};\r\n\r\n\t\t//<div id=\"_error\" class=\"div_message_error\"/>\r\n\t\tvar element_div_error = document.createElement(\"div\");\r\n\t\telement_div_error.setAttribute(\"class\", \"div_message_error\");\r\n\t\telement_div_error.setAttribute(\"id\", \"shop_special_prices_from_\" + count_input + \"_error\");\r\n\t\telement_div.appendChild(element_div_error);\r\n\r\n\t\t// Создаем div\r\n\t\tvar element_div = document.createElement(\"div\");\r\n\t\telement_div.setAttribute(\"class\", \"item_div\");\r\n\t\telement_div.setAttribute(\"style\", \"float: left;\");\r\n\t\tcbItem.appendChild(element_div);\r\n\r\n\t\tvar element_span = document.createElement(\"span\");\r\n\t\telement_span.setAttribute(\"class\", \"caption\");\r\n\t\telement_div.appendChild(element_span);\r\n\r\n\t\tvar element_acronym = document.createElement(\"acronym\");\r\n\t\telement_acronym.setAttribute(\"title\", \"Максимальное количество товара, которое нужно купить за один раз, чтобы задействовать цену\");\r\n\t\telement_acronym.innerHTML = \"Количество товара до\";\r\n\t\telement_span.appendChild(element_acronym);\r\n\r\n\t\t//<input Количество товара до\r\n\t\tvar ElementInput = document.createElement(\"input\");\r\n\t\tElementInput.setAttribute(\"id\", \"shop_special_prices_to_\" + count_input);\r\n\t\tElementInput.setAttribute(\"type\", \"text\");\r\n\t\tElementInput.setAttribute(\"onblur\", \"FieldCheck(this)\");\r\n\t\tElementInput.setAttribute(\"onkeyup\", \"FieldCheck(this)\");\r\n\t\tElementInput.setAttribute(\"onkeydown\", \"FieldCheck(this)\");\r\n\t\tElementInput.setAttribute(\"value\", \"\");\r\n\t\tElementInput.setAttribute(\"name\", \"shop_special_prices_to_js_\" + count_input);\r\n\t\tElementInput.setAttribute(\"style\", \"width: 120px; background-image: url(/admin/images/bullet_green.gif); background-position: right center; background-repeat: no-repeat;\");\r\n\t\telement_div.appendChild(ElementInput);\r\n\r\n\t\tfieldType[\"shop_special_prices_to_\" + count_input] = {'maxlen' : 11,\r\n\t\t'reg' : /^[0-9]*$/};\r\n\t\tfieldMessage[\"shop_special_prices_to_\" + count_input] = {'reg' : \"Значение поля не соответствует формату.\"};\r\n\r\n\t\t//<div id=\"_error\" class=\"div_message_error\"/>\r\n\t\tvar element_div_error = document.createElement(\"div\");\r\n\t\telement_div_error.setAttribute(\"class\", \"div_message_error\");\r\n\t\telement_div_error.setAttribute(\"id\", \"shop_special_prices_to_\" + count_input + \"_error\");\r\n\t\telement_div.appendChild(element_div_error);\r\n\r\n\t\t// Создаем div\r\n\t\tvar element_div = document.createElement(\"div\");\r\n\t\telement_div.setAttribute(\"class\", \"item_div\");\r\n\t\telement_div.setAttribute(\"style\", \"float: left;\");\r\n\t\tcbItem.appendChild(element_div);\r\n\r\n\t\tvar element_span = document.createElement(\"span\");\r\n\t\telement_span.setAttribute(\"class\", \"caption\");\r\n\t\telement_div.appendChild(element_span);\r\n\r\n\t\tvar element_acronym = document.createElement(\"acronym\");\r\n\t\telement_acronym.setAttribute(\"title\", \"Цена за единицу товара, купленного в определенном количестве\");\r\n\t\telement_acronym.innerHTML = \"Цена\";\r\n\t\telement_span.appendChild(element_acronym);\r\n\r\n\t\t//<input Цена\r\n\t\tvar ElementInput = document.createElement(\"input\");\r\n\t\tElementInput.setAttribute(\"id\", \"shop_special_prices_price_\" + count_input);\r\n\t\tElementInput.setAttribute(\"type\", \"text\");\r\n\t\tElementInput.setAttribute(\"onblur\", \"FieldCheck(this)\");\r\n\t\tElementInput.setAttribute(\"onkeyup\", \"FieldCheck(this)\");\r\n\t\tElementInput.setAttribute(\"onkeydown\", \"FieldCheck(this)\");\r\n\t\tElementInput.setAttribute(\"value\", \"\");\r\n\t\tElementInput.setAttribute(\"name\", \"shop_special_prices_price_js_\" + count_input);\r\n\t\tElementInput.setAttribute(\"style\", \"width: 120px; background-image: url(/admin/images/bullet_green.gif); background-position: right center; background-repeat: no-repeat;\");\r\n\t\telement_div.appendChild(ElementInput);\r\n\r\n\t\tfieldType[\"shop_special_prices_price_\" + count_input] = {'reg' : /^[0-9.]*$/};\r\n\t\tfieldMessage[\"shop_special_prices_price_\" + count_input] = {'reg' : \"Значение поля не соответствует формату.\"};\r\n\r\n\t\t//<div id=\"_error\" class=\"div_message_error\"/>\r\n\t\tvar element_div_error = document.createElement(\"div\");\r\n\t\telement_div_error.setAttribute(\"class\", \"div_message_error\");\r\n\t\telement_div_error.setAttribute(\"id\", \"shop_special_prices_price_\" + count_input + \"_error\");\r\n\t\telement_div.appendChild(element_div_error);\r\n\r\n\t\t// или\r\n\t\tvar element_div = document.createElement(\"div\");\r\n\t\telement_div.setAttribute(\"class\", \"item_div\");\r\n\t\telement_div.setAttribute(\"style\", \"float: left; padding-top: 30px;\");\r\n\t\telement_div.innerHTML = \" или\";\r\n\t\tcbItem.appendChild(element_div);\r\n\r\n\t\t// Создаем div\r\n\t\tvar element_div = document.createElement(\"div\");\r\n\t\telement_div.setAttribute(\"class\", \"item_div\");\r\n\t\telement_div.setAttribute(\"style\", \"float: left;\");\r\n\t\tcbItem.appendChild(element_div);\r\n\r\n\t\tvar element_span = document.createElement(\"span\");\r\n\t\telement_span.setAttribute(\"class\", \"caption\");\r\n\t\telement_div.appendChild(element_span);\r\n\r\n\t\tvar element_acronym = document.createElement(\"acronym\");\r\n\t\telement_acronym.setAttribute(\"title\", \"Процент от базовой цены. Например для скидки 15% процент от базовой цены будет 85\");\r\n\t\telement_acronym.innerHTML = \"% от цены\";\r\n\t\telement_span.appendChild(element_acronym);\r\n\r\n\t\t//<input %\r\n\t\tvar ElementInput = document.createElement(\"input\");\r\n\t\tElementInput.setAttribute(\"id\", \"shop_special_prices_percent_\" + count_input);\r\n\t\tElementInput.setAttribute(\"type\", \"text\");\r\n\t\tElementInput.setAttribute(\"onblur\", \"FieldCheck(this)\");\r\n\t\tElementInput.setAttribute(\"onkeyup\", \"FieldCheck(this)\");\r\n\t\tElementInput.setAttribute(\"onkeydown\", \"FieldCheck(this)\");\r\n\t\tElementInput.setAttribute(\"value\", \"0.00\");\r\n\t\tElementInput.setAttribute(\"name\", \"shop_special_prices_percent_js_\" + count_input);\r\n\t\tElementInput.setAttribute(\"style\", \"width: 120px; background-image: url(/admin/images/bullet_green.gif); background-position: right center; background-repeat: no-repeat;\");\r\n\t\telement_div.appendChild(ElementInput);\r\n\r\n\t\tfieldType[\"shop_special_prices_percent_\" + count_input] = {'reg' : /^[0-9.]*$/};\r\n\t\tfieldMessage[\"shop_special_prices_percent_\" + count_input] = {'reg' : \"Значение поля не соответствует формату.\"};\r\n\r\n\t\t//<div id=\"_error\" class=\"div_message_error\"/>\r\n\t\tvar element_div_error = document.createElement(\"div\");\r\n\t\telement_div_error.setAttribute(\"class\", \"div_message_error\");\r\n\t\telement_div_error.setAttribute(\"id\", \"shop_special_prices_percent_\" + count_input + \"_error\");\r\n\t\telement_div.appendChild(element_div_error);\r\n\r\n\t\t// Иконка удаления\r\n\t\t/*\r\n\t\tvar element_div = document.createElement(\"div\");\r\n\t\telement_div.setAttribute(\"class\", \"item_div\");\r\n\t\telement_div.setAttribute(\"style\", \"float: left; padding-top: 23px;\");\r\n\t\telement_div.innerHTML = '<a href=\"javascript:void(0)\" title=\"Удалить специальную цену\"><img src=\"/admin/images/delete.gif\" alt=\"Удалить специальную цену\" title=\"Удалить специальную цену\"/></a>';\r\n\t\tcbItem.appendChild(element_div);\r\n\t\t*/\r\n\t}\r\n}\r\n\r\n// Скрипт для заполнения списка типовых дин. страниц\r\nfunction DoLoadLibs(ALibDirId, ALibId)\r\n{\r\n\t// Этот код вызовется автоматически, когда загрузка данных завершится.\r\n\tfunction callbackfunction(responseJS)\r\n\t{\r\n\t\tif (typeof responseJS != 'undefined')\r\n\t\t{\r\n\t\t\t// Выводим результат в переменную.\r\n\t\t\thtml = responseJS.lib_html;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\thtml = '';\r\n\t\t}\r\n\r\n\t\tdocument.getElementById('id_lib_id').innerHTML = html;\r\n\t}\r\n\r\n\t// Отправляем запрос backend-у\r\n\tsendRequest('/admin/structure/structure.php?ajax_structure=1&get_libs=1&lib_dir_id=' + ALibDirId +\r\n\t'&lib_id=' + ALibId, 'get', callbackfunction);\r\n}\r\n\r\nfunction DoLoadXSL(AXslName, AXslDirId, APropertyId)\r\n{\r\n\t// Этот код вызовется автоматически, когда загрузка данных завершится.\r\n\tfunction callbackfunction(responseJS)\r\n\t{\r\n\t\tif (typeof responseJS != 'undefined')\r\n\t\t{\r\n\t\t\tvar div = $(\"#id_xls_tamplate_\" + APropertyId);\r\n\t\t\tdiv.empty();\r\n\t\t\tdiv.html(responseJS.property_xsl_html);\r\n\t\t}\r\n\t}\r\n\r\n\t// Отправляем запрос backend-у\r\n\tsendRequest('/admin/structure/structure.php?ajax_structure=1&get_xsl=' + HostcmsEscape(AXslName) +\r\n\t'&property_id=' + APropertyId + '&xsl_dir_id=' + AXslDirId, 'get', callbackfunction);\r\n}\r\n\r\nfunction ChangeXslImageLink(lib_property_id, xsl_id, xsl_dir_id)\r\n{\r\n\tif (xsl_id > 0)\r\n\t{\r\n\t\tlink_path = \"/admin/xsl/xsl.php?admin_forms_id=22&operation=edit_xsl_dir&check_1_\" + xsl_id+ \"=1&xsl_dir_parent_id=\" + xsl_dir_id;\r\n\t\r\n\t\tdocument.getElementById('xsl_link_image_id_' + lib_property_id).setAttribute('href', link_path);\r\n\t\tdocument.getElementById('xsl_link_image_id_' + lib_property_id).style.display = \"\";\r\n \t}\r\n\telse\r\n \t{\r\n \t\tdocument.getElementById('xsl_link_image_id_' + lib_property_id).setAttribute('href', 'javascript:void(0)');\r\n \t\tdocument.getElementById('xsl_link_image_id_' + lib_property_id).style.display = \"none\";\r\n \t}\r\n}\r\n\r\n// Скрипт для заполнения списка свойств\r\nfunction DoLoadLibProperties(ALibId, structure_id)\r\n{\r\n\t// Этот код вызовется автоматически, когда загрузка данных завершится.\r\n\tfunction callbackfunction(responseJS)\r\n\t{\r\n\t\tif (typeof responseJS != 'undefined')\r\n\t\t{\r\n\t\t\t// Выводим результат в переменную.\r\n\t\t\thtml = responseJS.lib_properties_html;\r\n\r\n\t\t\tif (responseJS.java_script != '')\r\n\t\t\t{\r\n\t\t\t\teval(responseJS.java_script);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\thtml = '';\r\n\t\t}\r\n\r\n\t\tdocument.getElementById('lib_properties').innerHTML = html;\r\n\t}\r\n\r\n\t// Отправляем запрос backend-у\r\n\tsendRequest('/admin/structure/structure.php?ajax_structure=1&get_lib_properties_id=' + ALibId +\r\n\t'&structure_id=' + structure_id, 'get', callbackfunction);\r\n}\r\n\r\n// -----------------------------------------------------------------------------\r\n// / Модуль \"Структура сайта\"\r\n// -----------------------------------------------------------------------------\r\n\r\nfunction SetViewField(ASelectedItem)\r\n{\r\n\tvar oPercent = document.getElementById(\"affiliate_values_percent_id\");\r\n\tvar oValue = document.getElementById(\"affiliate_values_value_id\");\r\n\r\n\tif (oPercent != 'undefined' && oValue != 'undefined')\r\n\t{\r\n\t\toPercent.style.display = \"none\";\r\n\t\toValue.style.display = \"none\";\r\n\r\n\t\tswitch (ASelectedItem)\r\n\t\t{\r\n\t\t\tcase 0: // Процент.\r\n\t\t\t{\r\n\t\t\t\toPercent.style.display = '';\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tcase 1: // Сумма.\r\n\t\t\t{\r\n\t\t\t\toValue.style.display = '';\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n//показ окна редактирования\r\nfunction ShowEditWindow(caption, path, name)\r\n{\r\n\tvar oWindowId = 'edit_window_'+name;\r\n\r\n\tvar oWindow = document.getElementById(oWindowId);\r\n\r\n\tif (oWindow == undefined)\r\n\t{\r\n\t\t// Создаем окно\r\n\t\tCreateWindow(oWindowId, caption, '90%', '90%');\r\n\r\n\t\tvar oWindow = document.getElementById(oWindowId);\r\n\r\n\t\t// <div id=\"subdiv\">\r\n\t\tvar ElementDiv = document.createElement(\"div\");\r\n\t\tElementDiv.setAttribute(\"id\", \"subdiv\");\r\n\t\tvar SubDiv = oWindow.appendChild(ElementDiv);\r\n\r\n\t\tvar DivMessage = document.createElement(\"div\");\r\n\t\tDivMessage.setAttribute(\"id\", \"id_message\");\r\n\t\tvar oDivMessage = SubDiv.appendChild(DivMessage);\r\n\r\n\t\tvar DivContent = document.createElement(\"div\");\r\n\t\tDivContent.setAttribute(\"id\", \"id_content\");\r\n\t\tvar oDivContent = SubDiv.appendChild(DivContent);\r\n\r\n\t\t// Запрос backend-у\r\n\t\tvar req = new JsHttpRequest();\r\n\r\n\t\t// Отображаем экран загрузки\r\n\t\tShowLoadingScreen();\r\n\r\n\t\treq.onreadystatechange = function()\r\n\t\t{\r\n\t\t\tif (req.readyState == 4)\r\n\t\t\t{\r\n\t\t\t\t// Убираем затемнение.\r\n\t\t\t\tHideLoadingScreen();\r\n\r\n\t\t\t\tif (req.responseJS != undefined)\r\n\t\t\t\t{\r\n\t\t\t\t\t// Сообщение.\r\n\t\t\t\t\t// Выводим результат ошибки в переменную.\r\n\t\t\t\t\tif (typeof req.responseJS.error != 'undefined')\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (oDivMessage)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t// Создадим скрытый SPAN для IE, в который поместим текст + скрипт.\r\n\t\t\t\t\t\t\t// Если перед <script> не будет текста, нехороший IE не увидит SCRIPT\r\n\t\t\t\t\t\t\tvar span = document.createElement(\"span\");\r\n\t\t\t\t\t\t\tspan.style.display = 'none';\r\n\t\t\t\t\t\t\tspan.innerHTML = \"Stupid IE. \" + req.responseJS.error;\r\n\r\n\t\t\t\t\t\t\trunScripts(span.getElementsByTagName('SCRIPT'));\r\n\r\n\t\t\t\t\t\t\t// Занесем текст сообщения только после выполнения скрипта\r\n\t\t\t\t\t\t\toDivMessage.innerHTML = req.responseJS.error;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Данные записываем только тогда, если они есть и не пустые.\r\n\t\t\t\t\tif (typeof req.responseJS.form_html != 'undefined' && req.responseJS.form_html != '')\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcmsrequest = path;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// Указываем текущий путь\r\n\t\t\t\t\t\t// Меняем Location только при DoLoadAjax, если вернулись назад - не меняем\r\n\t\t\t\t\t\tif (cmsrequest != ''\r\n\t\t\t\t\t\t&& function_exists('getCmsUrl')\r\n\t\t\t\t\t\t&& getCmsUrl() != cmsrequest)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tsetLocation(cmsrequest);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (function_exists('saveLocation'))\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t// Сохраняем текущий путь всегда\r\n\t\t\t\t\t\t\tsaveLocation(getCmsUrl());\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// DisableTinyMCE();\r\n\r\n\t\t\t\t\t\t// Занесем текст сообщения ДО выполнения скрипта\r\n\t\t\t\t\t\toDivContent.innerHTML = req.responseJS.form_html;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// Создадим скрытый SPAN для IE, в который поместим текст + скрипт.\r\n\t\t\t\t\t\t// Если перед <script> не будет текста, нехороший IE не увидит SCRIPT\r\n\t\t\t\t\t\tvar span = document.createElement(\"span\");\r\n\t\t\t\t\t\tspan.style.display = 'none';\r\n\t\t\t\t\t\tspan.innerHTML = \"Stupid IE. \" + req.responseJS.form_html;\r\n\r\n\t\t\t\t\t\trunScripts(span.getElementsByTagName('SCRIPT'));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treq.open('get', path, true);\r\n\r\n\t\t// Отсылаем данные в обработчик.\r\n\t\treq.send(null);\r\n\t}\r\n\telse\r\n\t{\r\n\t\t// Отключаем связь с редакторами\r\n\t\tDisableTinyMCE();\r\n\t\toDivMessage = document.getElementById(\"id_message\");\r\n\t\toDivMessage.innerHTML = '';\r\n\t}\r\n\r\n\tSlideWindow(oWindowId);\r\n}"
          },
          "redirectURL": "",
          "headersSize": 251,
          "bodySize": 9159
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-05-31T09:51:38.000Z",
            "lastAccess": "2012-05-30T09:51:38.000Z",
            "eTag": "",
            "hitCount": 18
          }
        },
        "timings": {
          "blocked": 4,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 6,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:38.786+04:00",
        "time": 10,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/js/fieldcheck.js?-936011871",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Thu, 15 Sep 2011 12:16:13 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [
            {
              "name": "-936011871",
              "value": ""
            }
          ],
          "headersSize": 713,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Thu, 15 Sep 2011 12:16:13 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Thu, 31 May 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=86400"
            }
          ],
          "content": {
            "mimeType": "application/x-javascript",
            "size": 5508,
            "text": "/**\r\n* HostCMS\r\n*\r\n* @author Hostmake LLC, http://www.hostcms.ru/\r\n* @version 5\r\n*/\r\n\r\n// Проверка ячейки field\r\n// field - проверяемый элемент\r\nfunction FieldCheck(WindowId, field)\r\n{\r\n\tWindowId = getWindowId(WindowId);\r\n\r\n\tif (typeof fieldType == 'undefined')\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\r\n\tvar value = $(field).val();\r\n\tvar FiledId = $(field).attr('id');\r\n\t\r\n\tif (typeof fieldType[field.id] != 'undefined')\r\n\t{\r\n\t\tvar message = '';\r\n\r\n\t\t// Проверка на минимальную длину\r\n\t\tif (fieldType[FiledId]['minlen']&& value.length < fieldType[FiledId]['minlen'])\r\n\t\t{\r\n\t\t\tvar decl = declension(fieldType[FiledId]['minlen'], i18n['one_letter'], i18n['some_letter2'], i18n['some_letter1']);\r\n\t\t\t\r\n\t\t\t// Есть пользовательское сообщение\r\n\t\t\tif (fieldMessage[FiledId] && fieldMessage[FiledId]['minlen'])\r\n\t\t\t{\r\n\t\t\t\tmessage += fieldMessage[FiledId]['minlen'];\r\n\t\t\t}\r\n\t\t\telse // Стандартное сообщение\r\n\t\t\t{\r\n\t\t\t\tmessage += i18n['Minimum'] + ' ' + fieldType[FiledId]['minlen'] + ' ' + decl + '. ' + i18n['current_length'] + ' ' + value.length + '. ';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Проверка на максимальную длину\r\n\t\tif (fieldType[FiledId]['maxlen'] && value.length > fieldType[FiledId]['maxlen'])\r\n\t\t{\r\n\t\t\tvar decl = declension(fieldType[FiledId]['maxlen'], i18n['one_letter'], i18n['some_letter2'], i18n['some_letter1']);\r\n\t\t\t\r\n\t\t\t// Есть пользовательское сообщение\r\n\t\t\tif (fieldMessage[FiledId] && fieldMessage[FiledId]['maxlen'])\r\n\t\t\t{\r\n\t\t\t\tmessage += fieldMessage[FiledId]['maxlen'];\r\n\t\t\t}\r\n\t\t\telse // Стандартное сообщение\r\n\t\t\t{\r\n\t\t\t\tmessage += i18n['Maximum'] + ' ' + fieldType[FiledId]['maxlen'] + ' ' + decl + '. ' + i18n['current_length'] + ' ' + value.length + '. ';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Проверка на регулярное выражение\r\n\t\tif (value.length > 0 && fieldType[FiledId]['reg'] && !value.match(fieldType[FiledId]['reg']))\r\n\t\t{\r\n\t\t\t// Есть пользовательское сообщение\r\n\t\t\tif (fieldMessage[FiledId] && fieldMessage[FiledId]['reg'])\r\n\t\t\t{\r\n\t\t\t\tmessage += fieldMessage[FiledId]['reg'];\r\n\t\t\t}\r\n\t\t\telse // Стандартное сообщение\r\n\t\t\t{\r\n\t\t\t\tmessage += i18n['wrong_value_format'] + ' ';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Проверка на соответствие значений 2-х полей\r\n\t\tif (fieldType[FiledId]['fieldEquality'])\r\n\t\t{\r\n\t\t\t// Пытаемся получить значение поля, которому должны соответствовать\r\n\t\t\tvar jFiled2 = $(\"#\"+WindowId+\" #\"+fieldType[FiledId]['fieldEquality']);\r\n\t\t\r\n\t\t\tif (jFiled2.length > 0\r\n\t\t\t// Сравниваем значение полей\r\n\t\t\t&& value != jFiled2.val())\r\n\t\t\t{\r\n\t\t\t\t// Есть пользовательское сообщение\r\n\t\t\t\tif (fieldMessage[FiledId] && fieldMessage[FiledId]['fieldEquality'])\r\n\t\t\t\t{\r\n\t\t\t\t\tmessage += fieldMessage[FiledId]['fieldEquality'];\r\n\t\t\t\t}\r\n\t\t\t\telse // Стандартное сообщение\r\n\t\t\t\t{\r\n\t\t\t\t\tmessage += i18n['different_fields_value'] + ' ';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tFieldCheckShowError(WindowId, FiledId, message);\r\n\t}\r\n}\r\n\r\nfunction FieldCheckShowError(WindowId, FiledId, message)\r\n{\r\n\tWindowId = getWindowId(WindowId);\r\n\t\r\n\t// Insert message into the message div\r\n\t$(\"#\" + WindowId + \" #\"+FiledId + '_error').html(message);\r\n\r\n\t// Плучаем элемент формы, над которым ведется работа\r\n\tvar ElementField = \t$(\"#\" + WindowId + \" #\"+FiledId);\r\n\r\n\tif (ElementField.length > 0)\r\n\t{\r\n\t\t// Устанавливаем флаг несоответствия\r\n\t\tfieldsStatus[FiledId] = (message.length > 0);\r\n\t\t\r\n\t\tif (fieldsStatus[FiledId])\r\n\t\t{\r\n\t\t\tElementField\r\n\t\t\t\t.css('border-style', 'solid')\r\n\t\t\t\t.css('border-width', '1px')\r\n\t\t\t\t.css('border-color', '#DB1905')\r\n\t\t\t\t.css('background-image', \"url('/admin/images/bullet_red.gif')\")\r\n\t\t\t\t.css('background-position', 'center right')\r\n\t\t\t\t.css('background-repeat', 'no-repeat');\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tElementField\r\n\t\t\t.css('border-style', '')\r\n\t\t\t.css('border-width', '')\r\n\t\t\t.css('border-color', '')\r\n\t\t\t.css('background-image', \"url('/admin/images/bullet_green.gif')\")\r\n\t\t\t.css('background-position', 'center right')\r\n\t\t\t.css('background-repeat', 'no-repeat');\r\n\t\t}\r\n\t}\r\n\r\n\t// Отображать контрольные элементы\r\n\tvar ControlElementsStatus = true;\r\n\r\n\tfor (ItemIndex in fieldsStatus)\r\n\t{\r\n\t\t// если есть хоть одно несоответствие - выключаем управляющие элементы\r\n\t\tif (fieldsStatus[ItemIndex])\r\n\t\t{\r\n\t\t\tControlElementsStatus = false;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\t// Активируем-выключаем контрольные элементы формы\r\n\tSetControlElementsStatus(WindowId, ControlElementsStatus);\r\n}\r\n\r\nfunction CheckAllField(windowId, formId)\r\n{\r\n\twindowId = getWindowId(windowId);\r\n\r\n\t$(\"#\"+windowId+\" #\"+formId+\" :input\").each(function(){\r\n\t\tFieldCheck(windowId, this);\r\n\t});\r\n}\r\n\r\n/**\r\n* Склонение после числительных\r\n* int number числительное\r\n* int nominative Именительный падеж\r\n* int genitive_singular Родительный падеж, единственное число\r\n* int genitive_plural Родительный падеж, множественное число\r\n*/\r\nfunction declension(number, nominative, genitive_singular, genitive_plural)\r\n{\r\n\tvar last_digit = number % 10;\r\n\tvar last_two_digits = number % 100;\r\n\t\r\n\tif (last_digit == 1 && last_two_digits != 11)\r\n\t{\r\n\t\tvar result = nominative;\r\n\t}\r\n\telse\r\n\t{\r\n\t\tif ((last_digit == 2 && last_two_digits != 12) || (last_digit == 3 && last_two_digits != 13) || (last_digit == 4 && last_two_digits != 14))\r\n\t\t{\r\n\t\t\tvar result = genitive_singular;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tvar result = genitive_plural;\r\n\t\t}\r\n\t}\r\n\t\r\n\treturn result;\r\n}\r\n\r\n/**\r\n* Изменение видимости объекта\r\n* str field_id Идентификатор объекта\r\n*/\r\nfunction SlideField(field_id)\r\n{\r\n\tvar oField = document.getElementById(field_id);\r\n\t\r\n\tif (oField != 'undefined')\r\n\t{\r\n\t\tif (oField.style.display == \"none\")\r\n\t\t{\r\n\t\t\toField.style.display = \"block\";\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\toField.style.display = \"none\";\r\n\t\t}\r\n\t}\r\n}"
          },
          "redirectURL": "",
          "headersSize": 251,
          "bodySize": 1900
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-05-31T09:51:38.000Z",
            "lastAccess": "2012-05-30T09:51:38.000Z",
            "eTag": "",
            "hitCount": 18
          }
        },
        "timings": {
          "blocked": 4,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 6,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:38.786+04:00",
        "time": 10,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/js/lng/ru/ru.js?-936011871",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Thu, 15 Sep 2011 12:16:13 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [
            {
              "name": "-936011871",
              "value": ""
            }
          ],
          "headersSize": 712,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Thu, 15 Sep 2011 12:16:13 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Thu, 31 May 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=86400"
            }
          ],
          "content": {
            "mimeType": "application/x-javascript",
            "size": 310,
            "text": "var i18n =\r\n{\r\n\"Minimum\": \"Минимум\",\r\n\"Maximum\": \"Максимум\",\r\n\"one_letter\": \"символ\",\r\n\"some_letter1\": \"символов\",\r\n\"some_letter2\": \"символа\",\r\n\"current_length\": \"Текущая длина &mdash;\",\r\n\"wrong_value_format\": \"Значение поля не соответствует формату.\",\r\n\"different_fields_value\": \"Значения полей различны.\"\r\n};"
          },
          "redirectURL": "",
          "headersSize": 251,
          "bodySize": 277
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-05-31T09:51:38.000Z",
            "lastAccess": "2012-05-30T09:51:38.000Z",
            "eTag": "",
            "hitCount": 18
          }
        },
        "timings": {
          "blocked": 4,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 6,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:38.786+04:00",
        "time": 10,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/calendar/calendar.css",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "text/css,*/*;q=0.1"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Thu, 15 Sep 2011 12:16:14 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 722,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Thu, 15 Sep 2011 12:16:14 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Thu, 31 May 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=86400"
            }
          ],
          "content": {
            "mimeType": "text/css",
            "size": 5831,
            "text": ".calendar {\r\n\tposition: relative;\r\n\tdisplay: none;\r\n\t /* border: 1px solid;\r\n\t/*border-color: #fff #000 #000 #fff; */\r\n\tfont-size: 10px;\r\n\tcursor: default;\r\n\tbackground: #ffffff;\r\n\tcolor: #000;\r\n\t/* font-family: tahoma, verdana, sans-serif; */\r\n}\r\n\r\n.calendar div table {\r\n\t/* border: 1px solid; */\r\n\tborder-color: #fff #000 #000 #fff;\r\n\tfont-size: 11px;\r\n\tcursor: default;\r\n\tbackground: #ffffff;\r\n\tcolor: #000;\r\n}\r\n\r\n/* Header part -- contains navigation buttons and day names. */\r\n\r\n.calendar .button\r\n{\r\n/* \"<<\", \"<\", \">\", \">>\" buttons have this class */\r\ntext-align: center;\r\npadding: 3px;\r\n\r\n/* border: 1px solid;\r\nborder-color: ButtonHighlight ButtonShadow ButtonShadow ButtonHighlight;*/\r\n\r\n/* background: #EAEAEA; */\r\n}\r\n\r\n.calendar .nav {\r\n/* background: #EAEAEA; */\r\n}\r\n\r\n.calendar thead .title\r\n{ /* This holds the current \"month, year\" */\r\nfont-weight: bold;\r\npadding: 3px;\r\n/* border: 1px solid #000; */\r\ncolor: #000;\r\ntext-align: center;\r\nfont-size: 8pt;\r\n}\r\n\r\n.calendar thead .headrow\r\n{\r\n /* Row <TR> containing navigation buttons */\r\n}\r\n\r\n.calendar thead .daynames\r\n{\r\n /* Row <TR> containing the day names */\r\n}\r\n\r\n.calendar thead .name { /* Cells <TD> containing the day names */\r\n /* border-bottom: 1px solid ButtonShadow;\r\npadding: 2px;*/\r\ntext-align: center;\r\nbackground: #F1F1F1;\r\npadding: 3px;\r\n}\r\n\r\n.calendar thead .weekend {\r\n /* How a weekend day name shows in header */\r\n/* color: #ff5500; */\r\n}\r\n\r\n.calendar thead .hilite\r\n{ /* How do the buttons in header appear when hover */\r\n\r\n\tborder: 1px solid #eee;\r\n\tpadding: 2px; /* на 1px меньше из-за бордера */\r\n\tz-index: 100; /* на 1 больше, чем для блока с тенью */\r\n\t/* border: 2px solid;\r\npadding: 0px;\r\nborder-color: ButtonHighlight ButtonShadow ButtonShadow ButtonHighlight;*/\r\n}\r\n\r\n.calendar thead .active { /* Active (pressed) buttons in header */\r\n/*border-width: 1px;\r\npadding: 2px 0px 0px 2px;\r\nborder-color: ButtonShadow ButtonHighlight ButtonHighlight ButtonShadow;*/\r\n}\r\n\r\n/* The body part -- contains all the days in month. */\r\n\r\n.calendar tbody .day { /* Cells <TD> containing month days dates */\r\n/*width: 2em;*/\r\ntext-align: right;\r\npadding: 4px 5px 4px 4px;\r\n}\r\n\r\n\r\n.calendar tbody .day.othermonth {\r\nfont-size: 80%;\r\ncolor: #aaa;\r\n}\r\n.calendar tbody .day.othermonth.oweekend {\r\ncolor: #faa;\r\n}\r\n\r\n.calendar table .wn {\r\npadding: 2px 3px 2px 2px;\r\nborder-right: 1px solid ButtonShadow;\r\nbackground: #EAEAEA;\r\ncolor: ButtonText;\r\n}\r\n\r\n.calendar tbody .rowhilite td {\r\nbackground: #F2F0EB;\r\ncolor: #000000;\r\n}\r\n\r\n.calendar tbody td.hilite { /* Hovered cells <TD> */\r\npadding: 1px 3px 1px 1px;\r\n/*border-top: 1px solid #fff;\r\n border-left: 1px solid #fff;\r\n */\r\nborder-right: 1px solid #A49570;\r\nborder-bottom: 1px solid #A49570;\r\n \r\n}\r\n\r\n.calendar tbody td.active { /* Active (pressed) cells <TD> */\r\npadding: 2px 2px 0px 2px;\r\nborder: 1px solid #EAEAEA;\r\n/*border-color: ButtonShadow ButtonHighlight ButtonHighlight ButtonShadow;*/\r\n}\r\n\r\n.calendar tbody td.selected { /* Cell showing selected date */\r\nborder: 1px solid #EAEAEA;\r\npadding: 3px 3px 4px 3px;\r\nbackground: #F1F1F1;\r\ncolor: #000;\r\n}\r\n\r\n.calendar tbody td.weekend { /* Cells showing weekend days */\r\ncolor: #999999;\r\n}\r\n\r\n.calendar tbody td.today { /* Cell showing today date */\r\n\t/* font-weight: bold; */\r\n\tborder: 1px solid #77BB36; \r\n\tbackground: #77BB36;\r\n\t\r\n\tpadding: 3px 3px 4px 3px;\r\n\tcolor: #fff;\r\n}\r\n\r\n.calendar tbody td.disabled { color: GrayText; }\r\n\r\n.calendar tbody .emptycell { /* Empty cells (the best is to hide them) */\r\nvisibility: hidden;\r\n}\r\n\r\n.calendar tbody .emptyrow { /* Empty row (some months need less than 6 rows) */\r\ndisplay: none;\r\n}\r\n\r\n/* The footer part -- status bar and \"Close\" button */\r\n\r\n.calendar tfoot .footrow { /* The <TR> in footer (only one right now) */\r\n}\r\n\r\n.calendar tfoot .ttip { /* Tooltip (status bar) cell <TD> */\r\ndisplay: none;\r\n\tbackground: #EAEAEA;\r\npadding: 1px;\r\nborder: 1px solid;\r\nborder-color: ButtonShadow ButtonHighlight ButtonHighlight ButtonShadow;\r\ncolor: ButtonText;\r\ntext-align: center;\r\n}\r\n\r\n.calendar tfoot .hilite { /* Hover style for buttons in footer */\r\nborder-top: 1px solid #fff;\r\nborder-right: 1px solid #000;\r\nborder-bottom: 1px solid #000;\r\nborder-left: 1px solid #fff;\r\npadding: 1px;\r\nbackground: #e4e0d8;\r\n}\r\n\r\n.calendar tfoot .active { /* Active (pressed) style for buttons in footer */\r\npadding: 2px 0px 0px 2px;\r\nborder-top: 1px solid #000;\r\nborder-right: 1px solid #fff;\r\nborder-bottom: 1px solid #fff;\r\nborder-left: 1px solid #000;\r\n}\r\n\r\n/* Combo boxes (menus that display months/years for direct selection) */\r\n.calendar .combo {\r\nposition: absolute;\r\ndisplay: none;\r\nwidth: 4em;\r\ntop: 0px;\r\nleft: 0px;\r\ncursor: default;\r\nborder: 1px solid #EAEAEA;\r\n/*border-color: ButtonHighlight ButtonShadow ButtonShadow ButtonHighlight;*/\r\nbackground: #F1F1F1;\r\ncolor: MenuText;\r\nfont-size: 90%;\r\npadding: 1px;\r\nz-index: 100;\r}\r\n\r\n.calendar .combo .label,\r\n.calendar .combo .label-IEfix {\r\ntext-align: center;\r\npadding: 1px;\r\n}\r\n\r\n.calendar .combo .label-IEfix {\r\nwidth: 4em;\r\n}\r\n\r\n.calendar .combo .active {\r\npadding: 0px;\r\nborder: 1px solid #AAAAAA;\r\n}\r\n\r\n.calendar .combo .hilite {\r\nbackground: #AAAAAA;\r\ncolor: #000;\r\n}\r\n\r\n.calendar td.time {\r\nborder-top: 1px solid #EAEAEA;\r\npadding: 1px 0px;\r\ntext-align: center;\r\n/*background-color: #EAEAEA;*/\r\n}\r\n\r\n.calendar td.time .hour,\r\n.calendar td.time .minute,\r\n.calendar td.time .ampm\r\n{\r\npadding: 0px 3px 0px 4px;\r\n/* border: 1px solid #eeeeee; */\r\nfont-weight: bold;\r\n/*background-color: #EAEAEA;*/\r\n}\r\n\r\n.calendar td.time .ampm {\r\ntext-align: center;\r\n}\r\n\r\n.calendar td.time .colon {\r\npadding: 0px 2px 0px 3px;\r\nfont-weight: bold;\r\n}\r\n\r\n.calendar td.time span.hilite {\r\nborder-color: #000;\r\nbackground-color: #EAEAEA;\r\ncolor: #000;\r\n}\r\n\r\n.calendar td.time span.active {\r\n/* border-color: #f00; */\r\nbackground-color: #AAAAAA;\r\n/* color: #FFFFFF; */\r\n}\r\n"
          },
          "redirectURL": "",
          "headersSize": 251,
          "bodySize": 1642
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-05-31T09:51:38.000Z",
            "lastAccess": "2012-05-30T09:51:38.000Z",
            "eTag": "",
            "hitCount": 17
          }
        },
        "timings": {
          "blocked": 5,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 5,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:38.786+04:00",
        "time": 14,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/calendar/calendar.js",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Thu, 15 Sep 2011 12:16:14 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 706,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Thu, 15 Sep 2011 12:16:14 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Thu, 31 May 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=86400"
            }
          ],
          "content": {
            "mimeType": "application/x-javascript",
            "size": 52827,
            "text": "/*  Copyright Mihai Bazon, 2002-2005  |  www.bazon.net/mishoo\r\n* -----------------------------------------------------------\r\n*\r\n* The DHTML Calendar, version 1.0 \"It is happening again\"\r\n*\r\n* Details and latest version at:\r\n* www.dynarch.com/projects/calendar\r\n*\r\n* This script is developed by Dynarch.com.  Visit us at www.dynarch.com.\r\n*\r\n* This script is distributed under the GNU Lesser General Public License.\r\n* Read the entire license text here: http://www.gnu.org/licenses/lgpl.html\r\n*/\r\n\r\n// $Id: calendar.js,v 1.51 2005/03/07 16:44:31 mishoo Exp $\r\n\r\n/** The Calendar object constructor. */\r\nCalendar = function (firstDayOfWeek, dateStr, onSelected, onClose) {\r\n\t// member variables\r\n\tthis.activeDiv = null;\r\n\tthis.currentDateEl = null;\r\n\tthis.getDateStatus = null;\r\n\tthis.getDateToolTip = null;\r\n\tthis.getDateText = null;\r\n\tthis.timeout = null;\r\n\tthis.onSelected = onSelected || null;\r\n\tthis.onClose = onClose || null;\r\n\tthis.dragging = false;\r\n\tthis.hidden = false;\r\n\tthis.minYear = 1970;\r\n\tthis.maxYear = 2050;\r\n\tthis.dateFormat = Calendar._TT[\"DEF_DATE_FORMAT\"];\r\n\tthis.ttDateFormat = Calendar._TT[\"TT_DATE_FORMAT\"];\r\n\tthis.isPopup = true;\r\n\tthis.weekNumbers = true;\r\n\tthis.firstDayOfWeek = typeof firstDayOfWeek == \"number\" ? firstDayOfWeek : Calendar._FD; // 0 for Sunday, 1 for Monday, etc.\r\n\tthis.showsOtherMonths = false;\r\n\tthis.dateStr = dateStr;\r\n\tthis.ar_days = null;\r\n\tthis.showsTime = false;\r\n\tthis.time24 = true;\r\n\tthis.yearStep = 2;\r\n\tthis.hiliteToday = true;\r\n\tthis.multiple = null;\r\n\t// HTML elements\r\n\tthis.table = null;\r\n\tthis.element = null;\r\n\tthis.tbody = null;\r\n\tthis.firstdayname = null;\r\n\tthis.shadowed_div = null;\r\n\t// Combo boxes\r\n\tthis.monthsCombo = null;\r\n\tthis.yearsCombo = null;\r\n\tthis.hilitedMonth = null;\r\n\tthis.activeMonth = null;\r\n\tthis.hilitedYear = null;\r\n\tthis.activeYear = null;\r\n\t// Information\r\n\tthis.dateClicked = false;\r\n\r\n\t// one-time initializations\r\n\tif (typeof Calendar._SDN == \"undefined\") {\r\n\t\t// table of short day names\r\n\t\tif (typeof Calendar._SDN_len == \"undefined\")\r\n\t\tCalendar._SDN_len = 3;\r\n\t\tvar ar = new Array();\r\n\t\tfor (var i = 8; i > 0;) {\r\n\t\t\tar[--i] = Calendar._DN[i].substr(0, Calendar._SDN_len);\r\n\t\t}\r\n\t\tCalendar._SDN = ar;\r\n\t\t// table of short month names\r\n\t\tif (typeof Calendar._SMN_len == \"undefined\")\r\n\t\tCalendar._SMN_len = 3;\r\n\t\tar = new Array();\r\n\t\tfor (var i = 12; i > 0;) {\r\n\t\t\tar[--i] = Calendar._MN[i].substr(0, Calendar._SMN_len);\r\n\t\t}\r\n\t\tCalendar._SMN = ar;\r\n\t}\r\n};\r\n\r\n// ** constants\r\n\r\n/// \"static\", needed for event handlers.\r\nCalendar._C = null;\r\n\r\n/// detect a special case of \"web browser\"\r\nCalendar.is_ie = ( /msie/i.test(navigator.userAgent) &&\r\n!/opera/i.test(navigator.userAgent) );\r\n\r\nCalendar.is_ie5 = ( Calendar.is_ie && /msie 5\\.0/i.test(navigator.userAgent) );\r\n\r\n/// detect Opera browser\r\nCalendar.is_opera = /opera/i.test(navigator.userAgent);\r\n\r\n/// detect KHTML-based browsers\r\nCalendar.is_khtml = /Konqueror|Safari|KHTML/i.test(navigator.userAgent);\r\n\r\n// BEGIN: UTILITY FUNCTIONS; beware that these might be moved into a separate\r\n//        library, at some point.\r\n\r\nCalendar.getAbsolutePos = function(el) {\r\n\tvar SL = 0, ST = 0;\r\n\tvar is_div = /^div$/i.test(el.tagName);\r\n\tif (is_div && el.scrollLeft)\r\n\tSL = el.scrollLeft;\r\n\tif (is_div && el.scrollTop)\r\n\tST = el.scrollTop;\r\n\tvar r = { x: el.offsetLeft - SL, y: el.offsetTop - ST };\r\n\tif (el.offsetParent) {\r\n\t\tvar tmp = this.getAbsolutePos(el.offsetParent);\r\n\t\tr.x += tmp.x;\r\n\t\tr.y += tmp.y;\r\n\t}\r\n\treturn r;\r\n};\r\n\r\nCalendar.isRelated = function (el, evt) {\r\n\tvar related = evt.relatedTarget;\r\n\tif (!related) {\r\n\t\tvar type = evt.type;\r\n\t\tif (type == \"mouseover\") {\r\n\t\t\trelated = evt.fromElement;\r\n\t\t} else if (type == \"mouseout\") {\r\n\t\t\trelated = evt.toElement;\r\n\t\t}\r\n\t}\r\n\twhile (related) {\r\n\t\tif (related == el) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\trelated = related.parentNode;\r\n\t}\r\n\treturn false;\r\n};\r\n\r\nCalendar.removeClass = function(el, className) {\r\n\tif (!(el && el.className)) {\r\n\t\treturn;\r\n\t}\r\n\tvar cls = el.className.split(\" \");\r\n\tvar ar = new Array();\r\n\tfor (var i = cls.length; i > 0;) {\r\n\t\tif (cls[--i] != className) {\r\n\t\t\tar[ar.length] = cls[i];\r\n\t\t}\r\n\t}\r\n\tel.className = ar.join(\" \");\r\n};\r\n\r\nCalendar.addClass = function(el, className) {\r\n\tCalendar.removeClass(el, className);\r\n\tel.className += \" \" + className;\r\n};\r\n\r\n// FIXME: the following 2 functions totally suck, are useless and should be replaced immediately.\r\nCalendar.getElement = function(ev) {\r\n\tvar f = Calendar.is_ie ? window.event.srcElement : ev.currentTarget;\r\n\twhile (f.nodeType != 1 || /^div$/i.test(f.tagName))\r\n\tf = f.parentNode;\r\n\treturn f;\r\n};\r\n\r\nCalendar.getTargetElement = function(ev) {\r\n\tvar f = Calendar.is_ie ? window.event.srcElement : ev.target;\r\n\twhile (f.nodeType != 1)\r\n\tf = f.parentNode;\r\n\treturn f;\r\n};\r\n\r\nCalendar.stopEvent = function(ev) {\r\n\tev || (ev = window.event);\r\n\tif (Calendar.is_ie) {\r\n\t\tev.cancelBubble = true;\r\n\t\tev.returnValue = false;\r\n\t} else {\r\n\t\tev.preventDefault();\r\n\t\tev.stopPropagation();\r\n\t}\r\n\treturn false;\r\n};\r\n\r\nCalendar.addEvent = function(el, evname, func) {\r\n\tif (el.attachEvent) { // IE\r\n\t\tel.attachEvent(\"on\" + evname, func);\r\n\t} else if (el.addEventListener) { // Gecko / W3C\r\n\t\tel.addEventListener(evname, func, true);\r\n\t} else {\r\n\t\tel[\"on\" + evname] = func;\r\n\t}\r\n};\r\n\r\nCalendar.removeEvent = function(el, evname, func) {\r\n\tif (el.detachEvent) { // IE\r\n\t\tel.detachEvent(\"on\" + evname, func);\r\n\t} else if (el.removeEventListener) { // Gecko / W3C\r\n\t\tel.removeEventListener(evname, func, true);\r\n\t} else {\r\n\t\tel[\"on\" + evname] = null;\r\n\t}\r\n};\r\n\r\nCalendar.createElement = function(type, parent) {\r\n\tvar el = null;\r\n\tif (document.createElementNS) {\r\n\t\t// use the XHTML namespace; IE won't normally get here unless\r\n\t\t// _they_ \"fix\" the DOM2 implementation.\r\n\t\tel = document.createElementNS(\"http://www.w3.org/1999/xhtml\", type);\r\n\t} else {\r\n\t\tel = document.createElement(type);\r\n\t}\r\n\tif (typeof parent != \"undefined\") {\r\n\t\tparent.appendChild(el);\r\n\t}\r\n\treturn el;\r\n};\r\n\r\n// END: UTILITY FUNCTIONS\r\n\r\n// BEGIN: CALENDAR STATIC FUNCTIONS\r\n\r\n/** Internal -- adds a set of events to make some element behave like a button. */\r\nCalendar._add_evs = function(el) {\r\n\twith (Calendar) {\r\n\t\taddEvent(el, \"mouseover\", dayMouseOver);\r\n\t\taddEvent(el, \"mousedown\", dayMouseDown);\r\n\t\taddEvent(el, \"mouseout\", dayMouseOut);\r\n\t\tif (is_ie) {\r\n\t\t\taddEvent(el, \"dblclick\", dayMouseDblClick);\r\n\t\t\tel.setAttribute(\"unselectable\", true);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nCalendar.findMonth = function(el) {\r\n\tif (typeof el.month != \"undefined\") {\r\n\t\treturn el;\r\n\t} else if (typeof el.parentNode.month != \"undefined\") {\r\n\t\treturn el.parentNode;\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nCalendar.findYear = function(el) {\r\n\tif (typeof el.year != \"undefined\") {\r\n\t\treturn el;\r\n\t} else if (typeof el.parentNode.year != \"undefined\") {\r\n\t\treturn el.parentNode;\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nCalendar.showMonthsCombo = function () {\r\n\tvar cal = Calendar._C;\r\n\tif (!cal) {\r\n\t\treturn false;\r\n\t}\r\n\tvar cal = cal;\r\n\tvar cd = cal.activeDiv;\r\n\tvar mc = cal.monthsCombo;\r\n\tif (cal.hilitedMonth) {\r\n\t\tCalendar.removeClass(cal.hilitedMonth, \"hilite\");\r\n\t}\r\n\tif (cal.activeMonth) {\r\n\t\tCalendar.removeClass(cal.activeMonth, \"active\");\r\n\t}\r\n\tvar mon = cal.monthsCombo.getElementsByTagName(\"div\")[cal.date.getMonth()];\r\n\tCalendar.addClass(mon, \"active\");\r\n\tcal.activeMonth = mon;\r\n\tvar s = mc.style;\r\n\ts.display = \"block\";\r\n\tif (cd.navtype < 0)\r\n\ts.left = cd.offsetLeft + \"px\";\r\n\telse {\r\n\t\tvar mcw = mc.offsetWidth;\r\n\t\tif (typeof mcw == \"undefined\")\r\n\t\t// Konqueror brain-dead techniques\r\n\t\tmcw = 50;\r\n\t\ts.left = (cd.offsetLeft + cd.offsetWidth - mcw) + \"px\";\r\n\t}\r\n\ts.top = (cd.offsetTop + cd.offsetHeight) + \"px\";\r\n};\r\n\r\nCalendar.showYearsCombo = function (fwd) {\r\n\tvar cal = Calendar._C;\r\n\tif (!cal) {\r\n\t\treturn false;\r\n\t}\r\n\tvar cal = cal;\r\n\tvar cd = cal.activeDiv;\r\n\tvar yc = cal.yearsCombo;\r\n\tif (cal.hilitedYear) {\r\n\t\tCalendar.removeClass(cal.hilitedYear, \"hilite\");\r\n\t}\r\n\tif (cal.activeYear) {\r\n\t\tCalendar.removeClass(cal.activeYear, \"active\");\r\n\t}\r\n\tcal.activeYear = null;\r\n\tvar Y = cal.date.getFullYear() + (fwd ? 1 : -1);\r\n\tvar yr = yc.firstChild;\r\n\tvar show = false;\r\n\tfor (var i = 12; i > 0; --i) {\r\n\t\tif (Y >= cal.minYear && Y <= cal.maxYear) {\r\n\t\t\tyr.innerHTML = Y;\r\n\t\t\tyr.year = Y;\r\n\t\t\tyr.style.display = \"block\";\r\n\t\t\tshow = true;\r\n\t\t} else {\r\n\t\t\tyr.style.display = \"none\";\r\n\t\t}\r\n\t\tyr = yr.nextSibling;\r\n\t\tY += fwd ? cal.yearStep : -cal.yearStep;\r\n\t}\r\n\tif (show) {\r\n\t\tvar s = yc.style;\r\n\t\ts.display = \"block\";\r\n\t\tif (cd.navtype < 0)\r\n\t\ts.left = cd.offsetLeft + \"px\";\r\n\t\telse {\r\n\t\t\tvar ycw = yc.offsetWidth;\r\n\t\t\tif (typeof ycw == \"undefined\")\r\n\t\t\t// Konqueror brain-dead techniques\r\n\t\t\tycw = 50;\r\n\t\t\ts.left = (cd.offsetLeft + cd.offsetWidth - ycw) + \"px\";\r\n\t\t}\r\n\t\ts.top = (cd.offsetTop + cd.offsetHeight) + \"px\";\r\n\t}\r\n};\r\n\r\n// event handlers\r\n\r\nCalendar.tableMouseUp = function(ev) {\r\n\tvar cal = Calendar._C;\r\n\tif (!cal) {\r\n\t\treturn false;\r\n\t}\r\n\tif (cal.timeout) {\r\n\t\tclearTimeout(cal.timeout);\r\n\t}\r\n\tvar el = cal.activeDiv;\r\n\tif (!el) {\r\n\t\treturn false;\r\n\t}\r\n\tvar target = Calendar.getTargetElement(ev);\r\n\tev || (ev = window.event);\r\n\tCalendar.removeClass(el, \"active\");\r\n\tif (target == el || target.parentNode == el) {\r\n\t\tCalendar.cellClick(el, ev);\r\n\t}\r\n\tvar mon = Calendar.findMonth(target);\r\n\tvar date = null;\r\n\tif (mon) {\r\n\t\tdate = new Date(cal.date);\r\n\t\tif (mon.month != date.getMonth()) {\r\n\t\t\tdate.setMonth(mon.month);\r\n\t\t\tcal.setDate(date);\r\n\t\t\tcal.dateClicked = false;\r\n\t\t\tcal.callHandler();\r\n\t\t}\r\n\t} else {\r\n\t\tvar year = Calendar.findYear(target);\r\n\t\tif (year) {\r\n\t\t\tdate = new Date(cal.date);\r\n\t\t\tif (year.year != date.getFullYear()) {\r\n\t\t\t\tdate.setFullYear(year.year);\r\n\t\t\t\tcal.setDate(date);\r\n\t\t\t\tcal.dateClicked = false;\r\n\t\t\t\tcal.callHandler();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\twith (Calendar) {\r\n\t\tremoveEvent(document, \"mouseup\", tableMouseUp);\r\n\t\tremoveEvent(document, \"mouseover\", tableMouseOver);\r\n\t\tremoveEvent(document, \"mousemove\", tableMouseOver);\r\n\t\tcal._hideCombos();\r\n\t\t_C = null;\r\n\t\treturn stopEvent(ev);\r\n\t}\r\n};\r\n\r\nCalendar.tableMouseOver = function (ev) {\r\n\tvar cal = Calendar._C;\r\n\tif (!cal) {\r\n\t\treturn;\r\n\t}\r\n\tvar el = cal.activeDiv;\r\n\tvar target = Calendar.getTargetElement(ev);\r\n\tif (target == el || target.parentNode == el) {\r\n\t\tCalendar.addClass(el, \"hilite active\");\r\n\t\tCalendar.addClass(el.parentNode, \"rowhilite\");\r\n\t} else {\r\n\t\tif (typeof el.navtype == \"undefined\" || (el.navtype != 50 && (el.navtype == 0 || Math.abs(el.navtype) > 2)))\r\n\t\tCalendar.removeClass(el, \"active\");\r\n\t\tCalendar.removeClass(el, \"hilite\");\r\n\t\tCalendar.removeClass(el.parentNode, \"rowhilite\");\r\n\t}\r\n\tev || (ev = window.event);\r\n\tif (el.navtype == 50 && target != el) {\r\n\t\tvar pos = Calendar.getAbsolutePos(el);\r\n\t\tvar w = el.offsetWidth;\r\n\t\tvar x = ev.clientX;\r\n\t\tvar dx;\r\n\t\tvar decrease = true;\r\n\t\tif (x > pos.x + w) {\r\n\t\t\tdx = x - pos.x - w;\r\n\t\t\tdecrease = false;\r\n\t\t} else\r\n\t\tdx = pos.x - x;\r\n\r\n\t\tif (dx < 0) dx = 0;\r\n\t\tvar range = el._range;\r\n\t\tvar current = el._current;\r\n\t\tvar count = Math.floor(dx / 10) % range.length;\r\n\t\tfor (var i = range.length; --i >= 0;)\r\n\t\tif (range[i] == current)\r\n\t\tbreak;\r\n\t\twhile (count-- > 0)\r\n\t\tif (decrease) {\r\n\t\t\tif (--i < 0)\r\n\t\t\ti = range.length - 1;\r\n\t\t} else if ( ++i >= range.length )\r\n\t\ti = 0;\r\n\t\tvar newval = range[i];\r\n\t\tel.innerHTML = newval;\r\n\r\n\t\tcal.onUpdateTime();\r\n\t}\r\n\tvar mon = Calendar.findMonth(target);\r\n\tif (mon) {\r\n\t\tif (mon.month != cal.date.getMonth()) {\r\n\t\t\tif (cal.hilitedMonth) {\r\n\t\t\t\tCalendar.removeClass(cal.hilitedMonth, \"hilite\");\r\n\t\t\t}\r\n\t\t\tCalendar.addClass(mon, \"hilite\");\r\n\t\t\tcal.hilitedMonth = mon;\r\n\t\t} else if (cal.hilitedMonth) {\r\n\t\t\tCalendar.removeClass(cal.hilitedMonth, \"hilite\");\r\n\t\t}\r\n\t} else {\r\n\t\tif (cal.hilitedMonth) {\r\n\t\t\tCalendar.removeClass(cal.hilitedMonth, \"hilite\");\r\n\t\t}\r\n\t\tvar year = Calendar.findYear(target);\r\n\t\tif (year) {\r\n\t\t\tif (year.year != cal.date.getFullYear()) {\r\n\t\t\t\tif (cal.hilitedYear) {\r\n\t\t\t\t\tCalendar.removeClass(cal.hilitedYear, \"hilite\");\r\n\t\t\t\t}\r\n\t\t\t\tCalendar.addClass(year, \"hilite\");\r\n\t\t\t\tcal.hilitedYear = year;\r\n\t\t\t} else if (cal.hilitedYear) {\r\n\t\t\t\tCalendar.removeClass(cal.hilitedYear, \"hilite\");\r\n\t\t\t}\r\n\t\t} else if (cal.hilitedYear) {\r\n\t\t\tCalendar.removeClass(cal.hilitedYear, \"hilite\");\r\n\t\t}\r\n\t}\r\n\treturn Calendar.stopEvent(ev);\r\n};\r\n\r\nCalendar.tableMouseDown = function (ev) {\r\n\tif (Calendar.getTargetElement(ev) == Calendar.getElement(ev)) {\r\n\t\treturn Calendar.stopEvent(ev);\r\n\t}\r\n};\r\n\r\nCalendar.calDragIt = function (ev) {\r\n\tvar cal = Calendar._C;\r\n\tif (!(cal && cal.dragging)) {\r\n\t\treturn false;\r\n\t}\r\n\tvar posX;\r\n\tvar posY;\r\n\tif (Calendar.is_ie) {\r\n\t\tposY = window.event.clientY + document.body.scrollTop;\r\n\t\tposX = window.event.clientX + document.body.scrollLeft;\r\n\t} else {\r\n\t\tposX = ev.pageX;\r\n\t\tposY = ev.pageY;\r\n\t}\r\n\tcal.hideShowCovered();\r\n\tvar st = cal.element.style;\r\n\tst.left = (posX - cal.xOffs) + \"px\";\r\n\tst.top = (posY - cal.yOffs) + \"px\";\r\n\treturn Calendar.stopEvent(ev);\r\n};\r\n\r\nCalendar.calDragEnd = function (ev) {\r\n\tvar cal = Calendar._C;\r\n\tif (!cal) {\r\n\t\treturn false;\r\n\t}\r\n\tcal.dragging = false;\r\n\twith (Calendar) {\r\n\t\tremoveEvent(document, \"mousemove\", calDragIt);\r\n\t\tremoveEvent(document, \"mouseup\", calDragEnd);\r\n\t\ttableMouseUp(ev);\r\n\t}\r\n\tcal.hideShowCovered();\r\n};\r\n\r\nCalendar.dayMouseDown = function(ev) {\r\n\tvar el = Calendar.getElement(ev);\r\n\tif (el.disabled) {\r\n\t\treturn false;\r\n\t}\r\n\tvar cal = el.calendar;\r\n\tcal.activeDiv = el;\r\n\tCalendar._C = cal;\r\n\tif (el.navtype != 300) with (Calendar) {\r\n\t\tif (el.navtype == 50) {\r\n\t\t\tel._current = el.innerHTML;\r\n\t\t\taddEvent(document, \"mousemove\", tableMouseOver);\r\n\t\t} else\r\n\t\taddEvent(document, Calendar.is_ie5 ? \"mousemove\" : \"mouseover\", tableMouseOver);\r\n\t\taddClass(el, \"hilite active\");\r\n\t\taddEvent(document, \"mouseup\", tableMouseUp);\r\n\t} else if (cal.isPopup) {\r\n\t\tcal._dragStart(ev);\r\n\t}\r\n\tif (el.navtype == -1 || el.navtype == 1) {\r\n\t\tif (cal.timeout) clearTimeout(cal.timeout);\r\n\t\tcal.timeout = setTimeout(\"Calendar.showMonthsCombo()\", 250);\r\n\t} else if (el.navtype == -2 || el.navtype == 2) {\r\n\t\tif (cal.timeout) clearTimeout(cal.timeout);\r\n\t\tcal.timeout = setTimeout((el.navtype > 0) ? \"Calendar.showYearsCombo(true)\" : \"Calendar.showYearsCombo(false)\", 250);\r\n\t} else {\r\n\t\tcal.timeout = null;\r\n\t}\r\n\treturn Calendar.stopEvent(ev);\r\n};\r\n\r\nCalendar.dayMouseDblClick = function(ev) {\r\n\tCalendar.cellClick(Calendar.getElement(ev), ev || window.event);\r\n\tif (Calendar.is_ie) {\r\n\t\tdocument.selection.empty();\r\n\t}\r\n};\r\n\r\nCalendar.dayMouseOver = function(ev) {\r\n\r\n\tif (typeof Calendar != \"undefined\")\r\n\t{\r\n\t\tvar el = Calendar.getElement(ev);\r\n\t\tif (Calendar.isRelated(el, ev) || Calendar._C || el.disabled) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (el.ttip) {\r\n\t\t\tif (el.ttip.substr(0, 1) == \"_\") {\r\n\t\t\t\tel.ttip = el.caldate.print(el.calendar.ttDateFormat) + el.ttip.substr(1);\r\n\t\t\t}\r\n\t\t\tel.calendar.tooltips.innerHTML = el.ttip;\r\n\t\t}\r\n\t\tif (el.navtype != 300) {\r\n\t\t\tCalendar.addClass(el, \"hilite\");\r\n\t\t\tif (el.caldate) {\r\n\t\t\t\tCalendar.addClass(el.parentNode, \"rowhilite\");\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn Calendar.stopEvent(ev);\r\n\t}\r\n};\r\n\r\nCalendar.dayMouseOut = function(ev) {\r\n\tif (typeof Calendar != \"undefined\")\r\n\t{\r\n\t\twith (Calendar) {\r\n\t\t\tvar el = getElement(ev);\r\n\t\t\tif (isRelated(el, ev) || _C || el.disabled)\r\n\t\t\treturn false;\r\n\t\t\tremoveClass(el, \"hilite\");\r\n\t\t\tif (el.caldate)\r\n\t\t\tremoveClass(el.parentNode, \"rowhilite\");\r\n\t\t\tif (el.calendar)\r\n\t\t\tel.calendar.tooltips.innerHTML = _TT[\"SEL_DATE\"];\r\n\t\t\treturn stopEvent(ev);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n*  A generic \"click\" handler :) handles all types of buttons defined in this\r\n*  calendar.\r\n*/\r\nCalendar.cellClick = function(el, ev) {\r\n\tvar cal = el.calendar;\r\n\tvar closing = false;\r\n\tvar newdate = false;\r\n\tvar date = null;\r\n\tif (typeof el.navtype == \"undefined\") {\r\n\t\tif (cal.currentDateEl) {\r\n\t\t\tCalendar.removeClass(cal.currentDateEl, \"selected\");\r\n\t\t\tCalendar.addClass(el, \"selected\");\r\n\t\t\tclosing = (cal.currentDateEl == el);\r\n\t\t\tif (!closing) {\r\n\t\t\t\tcal.currentDateEl = el;\r\n\t\t\t}\r\n\t\t}\r\n\t\tcal.date.setDateOnly(el.caldate);\r\n\t\tdate = cal.date;\r\n\t\tvar other_month = !(cal.dateClicked = !el.otherMonth);\r\n\t\tif (!other_month && !cal.currentDateEl)\r\n\t\tcal._toggleMultipleDate(new Date(date));\r\n\t\telse\r\n\t\tnewdate = !el.disabled;\r\n\t\t// a date was clicked\r\n\t\tif (other_month)\r\n\t\tcal._init(cal.firstDayOfWeek, date);\r\n\t} else {\r\n\t\tif (el.navtype == 200) {\r\n\t\t\tCalendar.removeClass(el, \"hilite\");\r\n\t\t\tcal.callCloseHandler();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdate = new Date(cal.date);\r\n\t\tif (el.navtype == 0)\r\n\t\tdate.setDateOnly(new Date()); // TODAY\r\n\t\t// unless \"today\" was clicked, we assume no date was clicked so\r\n\t\t// the selected handler will know not to close the calenar when\r\n\t\t// in single-click mode.\r\n\t\t// cal.dateClicked = (el.navtype == 0);\r\n\t\tcal.dateClicked = false;\r\n\t\tvar year = date.getFullYear();\r\n\t\tvar mon = date.getMonth();\r\n\t\tfunction setMonth(m) {\r\n\t\t\tvar day = date.getDate();\r\n\t\t\tvar max = date.getMonthDays(m);\r\n\t\t\tif (day > max) {\r\n\t\t\t\tdate.setDate(max);\r\n\t\t\t}\r\n\t\t\tdate.setMonth(m);\r\n\t\t};\r\n\t\tswitch (el.navtype) {\r\n\t\t\tcase 400:\r\n\t\t\tCalendar.removeClass(el, \"hilite\");\r\n\t\t\tvar text = Calendar._TT[\"ABOUT\"];\r\n\t\t\tif (typeof text != \"undefined\") {\r\n\t\t\t\ttext += cal.showsTime ? Calendar._TT[\"ABOUT_TIME\"] : \"\";\r\n\t\t\t} else {\r\n\t\t\t\t// FIXME: this should be removed as soon as lang files get updated!\r\n\t\t\t\ttext = \"Help and about box text is not translated into this language.\\n\" +\r\n\t\t\t\t\"If you know this language and you feel generous please update\\n\" +\r\n\t\t\t\t\"the corresponding file in \\\"lang\\\" subdir to match calendar-en.js\\n\" +\r\n\t\t\t\t\"and send it back to <mihai_bazon@yahoo.com> to get it into the distribution  ;-)\\n\\n\" +\r\n\t\t\t\t\"Thank you!\\n\" +\r\n\t\t\t\t\"http://dynarch.com/mishoo/calendar.epl\\n\";\r\n\t\t\t}\r\n\t\t\talert(text);\r\n\t\t\treturn;\r\n\t\t\tcase -2:\r\n\t\t\tif (year > cal.minYear) {\r\n\t\t\t\tdate.setFullYear(year - 1);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t\tcase -1:\r\n\t\t\tif (mon > 0) {\r\n\t\t\t\tsetMonth(mon - 1);\r\n\t\t\t} else if (year-- > cal.minYear) {\r\n\t\t\t\tdate.setFullYear(year);\r\n\t\t\t\tsetMonth(11);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t\tcase 1:\r\n\t\t\tif (mon < 11) {\r\n\t\t\t\tsetMonth(mon + 1);\r\n\t\t\t} else if (year < cal.maxYear) {\r\n\t\t\t\tdate.setFullYear(year + 1);\r\n\t\t\t\tsetMonth(0);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\tif (year < cal.maxYear) {\r\n\t\t\t\tdate.setFullYear(year + 1);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t\tcase 100:\r\n\t\t\tcal.setFirstDayOfWeek(el.fdow);\r\n\t\t\treturn;\r\n\t\t\tcase 50:\r\n\t\t\tvar range = el._range;\r\n\t\t\tvar current = el.innerHTML;\r\n\t\t\tfor (var i = range.length; --i >= 0;)\r\n\t\t\tif (range[i] == current)\r\n\t\t\tbreak;\r\n\t\t\tif (ev && ev.shiftKey) {\r\n\t\t\t\tif (--i < 0)\r\n\t\t\t\ti = range.length - 1;\r\n\t\t\t} else if ( ++i >= range.length )\r\n\t\t\ti = 0;\r\n\t\t\tvar newval = range[i];\r\n\t\t\tel.innerHTML = newval;\r\n\t\t\tcal.onUpdateTime();\r\n\t\t\treturn;\r\n\t\t\tcase 0:\r\n\t\t\t// TODAY will bring us here\r\n\t\t\tif ((typeof cal.getDateStatus == \"function\") &&\r\n\t\t\tcal.getDateStatus(date, date.getFullYear(), date.getMonth(), date.getDate())) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tif (!date.equalsTo(cal.date)) {\r\n\t\t\tcal.setDate(date);\r\n\t\t\tnewdate = true;\r\n\t\t} else if (el.navtype == 0)\r\n\t\tnewdate = closing = true;\r\n\t}\r\n\tif (newdate) {\r\n\t\tev && cal.callHandler();\r\n\t}\r\n\tif (closing) {\r\n\t\tCalendar.removeClass(el, \"hilite\");\r\n\t\tev && cal.callCloseHandler();\r\n\t}\r\n};\r\n\r\n// END: CALENDAR STATIC FUNCTIONS\r\n\r\n// BEGIN: CALENDAR OBJECT FUNCTIONS\r\n\r\n/**\r\n*  This function creates the calendar inside the given parent.  If _par is\r\n*  null than it creates a popup calendar inside the BODY element.  If _par is\r\n*  an element, be it BODY, then it creates a non-popup calendar (still\r\n*  hidden).  Some properties need to be set before calling this function.\r\n*/\r\nCalendar.prototype.create = function (_par) {\r\n\tvar parent = null;\r\n\tif (! _par) {\r\n\t\t// default parent is the document body, in which case we create\r\n\t\t// a popup calendar.\r\n\t\tparent = document.getElementsByTagName(\"body\")[0];\r\n\t\tthis.isPopup = true;\r\n\t} else {\r\n\t\tparent = _par;\r\n\t\tthis.isPopup = false;\r\n\t}\r\n\tthis.date = this.dateStr ? new Date(this.dateStr) : new Date();\r\n\r\n\r\n\tvar div = Calendar.createElement(\"div\");\r\n\tthis.element = div;\r\n\tdiv.className = \"calendar\";\r\n\t\r\n\tif (this.isPopup)\r\n\t{\r\n\t\tdiv.style.position = \"absolute\";\r\n\t\tdiv.style.display = \"none\";\r\n\t}\r\n\t\r\n\t// [Add]\r\n\tvar shadowed_div = Calendar.createElement(\"div\");\r\n\tthis.shadowed_div = shadowed_div;\r\n\tshadowed_div.className = \"shadowed\";\r\n\tdiv.appendChild(shadowed_div);\r\n\r\n\tvar shadowed_tl = Calendar.createElement(\"div\");\r\n\tshadowed_tl.className = \"tl\";\r\n\tshadowed_div.appendChild(shadowed_tl);\r\n\r\n\tvar shadowed_t = Calendar.createElement(\"div\");\r\n\tshadowed_t.className = \"t\";\r\n\tshadowed_div.appendChild(shadowed_t);\r\n\r\n\tvar shadowed_tr = Calendar.createElement(\"div\");\r\n\tshadowed_tr.className = \"tr\";\r\n\tshadowed_div.appendChild(shadowed_tr);\r\n\r\n\tvar shadowed_l = Calendar.createElement(\"div\");\r\n\tshadowed_l.className = \"l\";\r\n\tshadowed_div.appendChild(shadowed_l);\r\n\r\n\tvar shadowed_r = Calendar.createElement(\"div\");\r\n\tshadowed_r.className = \"r\";\r\n\tshadowed_div.appendChild(shadowed_r);\r\n\r\n\tvar shadowed_bl = Calendar.createElement(\"div\");\r\n\tshadowed_bl.className = \"bl\";\r\n\tshadowed_div.appendChild(shadowed_bl);\r\n\r\n\tvar shadowed_b = Calendar.createElement(\"div\");\r\n\tshadowed_b.className = \"b\";\r\n\tshadowed_div.appendChild(shadowed_b);\r\n\r\n\tvar shadowed_br = Calendar.createElement(\"div\");\r\n\tshadowed_br.className = \"br\";\r\n\tshadowed_div.appendChild(shadowed_br);\r\n\t// [/Add]\r\n\r\n\tvar table = Calendar.createElement(\"table\");\r\n\tthis.table = table;\r\n\ttable.cellSpacing = 0;\r\n\ttable.cellPadding = 0;\r\n\ttable.calendar = this;\r\n\tCalendar.addEvent(table, \"mousedown\", Calendar.tableMouseDown);\r\n\t\r\n\t//div.appendChild(table);\r\n\tshadowed_div.appendChild(table);\r\n\t\r\n\t// --------------------------------------------------\r\n\t\r\n\tvar thead = Calendar.createElement(\"thead\", table);\r\n\tvar cell = null;\r\n\tvar row = null;\r\n\r\n\tvar cal = this;\r\n\tvar hh = function (text, cs, navtype) {\r\n\t\tcell = Calendar.createElement(\"td\", row);\r\n\t\tcell.colSpan = cs;\r\n\t\tcell.className = \"button\";\r\n\t\tif (navtype != 0 && Math.abs(navtype) <= 2)\r\n\t\tcell.className += \" nav\";\r\n\t\tCalendar._add_evs(cell);\r\n\t\tcell.calendar = cal;\r\n\t\tcell.navtype = navtype;\r\n\t\tcell.innerHTML = \"<div unselectable='on'>\" + text + \"</div>\";\r\n\t\treturn cell;\r\n\t};\r\n\r\n\trow = Calendar.createElement(\"tr\", thead);\r\n\tvar title_length = 6;\r\n\t(this.isPopup) && --title_length;\r\n\t(this.weekNumbers) && ++title_length;\r\n\r\n\t//hh(\"?\", 1, 400).ttip = Calendar._TT[\"INFO\"];\r\n\tthis.title = hh(\"\", title_length + 2, 300);\r\n\tthis.title.className = \"title\";\r\n\tif (this.isPopup) {\r\n\t\tthis.title.ttip = Calendar._TT[\"DRAG_TO_MOVE\"];\r\n\t\tthis.title.style.cursor = \"move\";\r\n\t\t// hh(\"&#x00d7;\", 1, 200).ttip = Calendar._TT[\"CLOSE\"];\r\n\t}\r\n\r\n\trow = Calendar.createElement(\"tr\", thead);\r\n\trow.className = \"headrow\";\r\n\r\n\tthis._nav_py = hh(\"&#x00ab;\", 1, -2);\r\n\tthis._nav_py.ttip = Calendar._TT[\"PREV_YEAR\"];\r\n\r\n\tthis._nav_pm = hh(\"&#x2039;\", 1, -1);\r\n\tthis._nav_pm.ttip = Calendar._TT[\"PREV_MONTH\"];\r\n\r\n\tthis._nav_now = hh(Calendar._TT[\"TODAY\"], this.weekNumbers ? 4 : 3, 0);\r\n\tthis._nav_now.ttip = Calendar._TT[\"GO_TODAY\"];\r\n\r\n\tthis._nav_nm = hh(\"&#x203a;\", 1, 1);\r\n\tthis._nav_nm.ttip = Calendar._TT[\"NEXT_MONTH\"];\r\n\r\n\tthis._nav_ny = hh(\"&#x00bb;\", 1, 2);\r\n\tthis._nav_ny.ttip = Calendar._TT[\"NEXT_YEAR\"];\r\n\r\n\t// day names\r\n\trow = Calendar.createElement(\"tr\", thead);\r\n\trow.className = \"daynames\";\r\n\tif (this.weekNumbers) {\r\n\t\tcell = Calendar.createElement(\"td\", row);\r\n\t\tcell.className = \"name wn\";\r\n\t\tcell.innerHTML = Calendar._TT[\"WK\"];\r\n\t}\r\n\tfor (var i = 7; i > 0; --i) {\r\n\t\tcell = Calendar.createElement(\"td\", row);\r\n\t\tif (!i) {\r\n\t\t\tcell.navtype = 100;\r\n\t\t\tcell.calendar = this;\r\n\t\t\tCalendar._add_evs(cell);\r\n\t\t}\r\n\t}\r\n\tthis.firstdayname = (this.weekNumbers) ? row.firstChild.nextSibling : row.firstChild;\r\n\tthis._displayWeekdays();\r\n\r\n\tvar tbody = Calendar.createElement(\"tbody\", table);\r\n\tthis.tbody = tbody;\r\n\r\n\tfor (i = 6; i > 0; --i) {\r\n\t\trow = Calendar.createElement(\"tr\", tbody);\r\n\t\tif (this.weekNumbers) {\r\n\t\t\tcell = Calendar.createElement(\"td\", row);\r\n\t\t}\r\n\t\tfor (var j = 7; j > 0; --j) {\r\n\t\t\tcell = Calendar.createElement(\"td\", row);\r\n\t\t\tcell.calendar = this;\r\n\t\t\tCalendar._add_evs(cell);\r\n\t\t}\r\n\t}\r\n\r\n\tif (this.showsTime) {\r\n\t\trow = Calendar.createElement(\"tr\", tbody);\r\n\t\trow.className = \"time\";\r\n\r\n\t\tcell = Calendar.createElement(\"td\", row);\r\n\t\tcell.className = \"time\";\r\n\t\tcell.colSpan = 2;\r\n\t\tcell.innerHTML = Calendar._TT[\"TIME\"] || \"&nbsp;\";\r\n\r\n\t\tcell = Calendar.createElement(\"td\", row);\r\n\t\tcell.className = \"time\";\r\n\t\tcell.colSpan = this.weekNumbers ? 4 : 3;\r\n\r\n\t\t(function(){\r\n\t\t\tfunction makeTimePart(className, init, range_start, range_end) {\r\n\t\t\t\tvar part = Calendar.createElement(\"span\", cell);\r\n\t\t\t\tpart.className = className;\r\n\t\t\t\tpart.innerHTML = init;\r\n\t\t\t\tpart.calendar = cal;\r\n\t\t\t\tpart.ttip = Calendar._TT[\"TIME_PART\"];\r\n\t\t\t\tpart.navtype = 50;\r\n\t\t\t\tpart._range = [];\r\n\t\t\t\tif (typeof range_start != \"number\")\r\n\t\t\t\tpart._range = range_start;\r\n\t\t\t\telse {\r\n\t\t\t\t\tfor (var i = range_start; i <= range_end; ++i) {\r\n\t\t\t\t\t\tvar txt;\r\n\t\t\t\t\t\tif (i < 10 && range_end >= 10) txt = '0' + i;\r\n\t\t\t\t\t\telse txt = '' + i;\r\n\t\t\t\t\t\tpart._range[part._range.length] = txt;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tCalendar._add_evs(part);\r\n\t\t\t\treturn part;\r\n\t\t\t};\r\n\t\t\tvar hrs = cal.date.getHours();\r\n\t\t\tvar mins = cal.date.getMinutes();\r\n\t\t\tvar t12 = !cal.time24;\r\n\t\t\tvar pm = (hrs > 12);\r\n\t\t\tif (t12 && pm) hrs -= 12;\r\n\t\t\tvar H = makeTimePart(\"hour\", hrs, t12 ? 1 : 0, t12 ? 12 : 23);\r\n\t\t\tvar span = Calendar.createElement(\"span\", cell);\r\n\t\t\tspan.innerHTML = \":\";\r\n\t\t\tspan.className = \"colon\";\r\n\t\t\tvar M = makeTimePart(\"minute\", mins, 0, 59);\r\n\t\t\tvar AP = null;\r\n\t\t\tcell = Calendar.createElement(\"td\", row);\r\n\t\t\tcell.className = \"time\";\r\n\t\t\tcell.colSpan = 2;\r\n\t\t\tif (t12)\r\n\t\t\tAP = makeTimePart(\"ampm\", pm ? \"pm\" : \"am\", [\"am\", \"pm\"]);\r\n\t\t\telse\r\n\t\t\tcell.innerHTML = \"&nbsp;\";\r\n\r\n\t\t\tcal.onSetTime = function() {\r\n\t\t\t\tvar pm, hrs = this.date.getHours(),\r\n\t\t\t\tmins = this.date.getMinutes();\r\n\t\t\t\tif (t12) {\r\n\t\t\t\t\tpm = (hrs >= 12);\r\n\t\t\t\t\tif (pm) hrs -= 12;\r\n\t\t\t\t\tif (hrs == 0) hrs = 12;\r\n\t\t\t\t\tAP.innerHTML = pm ? \"pm\" : \"am\";\r\n\t\t\t\t}\r\n\t\t\t\tH.innerHTML = (hrs < 10) ? (\"0\" + hrs) : hrs;\r\n\t\t\t\tM.innerHTML = (mins < 10) ? (\"0\" + mins) : mins;\r\n\t\t\t};\r\n\r\n\t\t\tcal.onUpdateTime = function() {\r\n\t\t\t\tvar date = this.date;\r\n\t\t\t\tvar h = parseInt(H.innerHTML, 10);\r\n\t\t\t\tif (t12) {\r\n\t\t\t\t\tif (/pm/i.test(AP.innerHTML) && h < 12)\r\n\t\t\t\t\th += 12;\r\n\t\t\t\t\telse if (/am/i.test(AP.innerHTML) && h == 12)\r\n\t\t\t\t\th = 0;\r\n\t\t\t\t}\r\n\t\t\t\tvar d = date.getDate();\r\n\t\t\t\tvar m = date.getMonth();\r\n\t\t\t\tvar y = date.getFullYear();\r\n\t\t\t\tdate.setHours(h);\r\n\t\t\t\tdate.setMinutes(parseInt(M.innerHTML, 10));\r\n\t\t\t\tdate.setFullYear(y);\r\n\t\t\t\tdate.setMonth(m);\r\n\t\t\t\tdate.setDate(d);\r\n\t\t\t\tthis.dateClicked = false;\r\n\t\t\t\tthis.callHandler();\r\n\t\t\t};\r\n\t\t})();\r\n\t} else {\r\n\t\tthis.onSetTime = this.onUpdateTime = function() {};\r\n\t}\r\n\r\n\tvar tfoot = Calendar.createElement(\"tfoot\", table);\r\n\r\n\trow = Calendar.createElement(\"tr\", tfoot);\r\n\trow.className = \"footrow\";\r\n\r\n\tcell = hh(Calendar._TT[\"SEL_DATE\"], this.weekNumbers ? 8 : 7, 300);\r\n\tcell.className = \"ttip\";\r\n\tif (this.isPopup) {\r\n\t\tcell.ttip = Calendar._TT[\"DRAG_TO_MOVE\"];\r\n\t\tcell.style.cursor = \"move\";\r\n\t}\r\n\tthis.tooltips = cell;\r\n\r\n\tdiv = Calendar.createElement(\"div\", this.element);\r\n\tthis.monthsCombo = div;\r\n\tdiv.className = \"combo\";\r\n\tfor (i = 0; i < Calendar._MN.length; ++i) {\r\n\t\tvar mn = Calendar.createElement(\"div\");\r\n\t\tmn.className = Calendar.is_ie ? \"label-IEfix\" : \"label\";\r\n\t\tmn.month = i;\r\n\t\tmn.innerHTML = Calendar._SMN[i];\r\n\t\tdiv.appendChild(mn);\r\n\t}\r\n\r\n\tdiv = Calendar.createElement(\"div\", this.element);\r\n\tthis.yearsCombo = div;\r\n\tdiv.className = \"combo\";\r\n\tfor (i = 12; i > 0; --i) {\r\n\t\tvar yr = Calendar.createElement(\"div\");\r\n\t\tyr.className = Calendar.is_ie ? \"label-IEfix\" : \"label\";\r\n\t\tdiv.appendChild(yr);\r\n\t}\r\n\r\n\tthis._init(this.firstDayOfWeek, this.date);\r\n\tparent.appendChild(this.element);\r\n};\r\n\r\n/** keyboard navigation, only for popup calendars */\r\nCalendar._keyEvent = function(ev) {\r\n\tvar cal = window._dynarch_popupCalendar;\r\n\tif (!cal || cal.multiple)\r\n\treturn false;\r\n\t(Calendar.is_ie) && (ev = window.event);\r\n\tvar act = (Calendar.is_ie || ev.type == \"keypress\"),\r\n\tK = ev.keyCode;\r\n\tif (ev.ctrlKey) {\r\n\t\tswitch (K) {\r\n\t\t\tcase 37: // KEY left\r\n\t\t\tact && Calendar.cellClick(cal._nav_pm);\r\n\t\t\tbreak;\r\n\t\t\tcase 38: // KEY up\r\n\t\t\tact && Calendar.cellClick(cal._nav_py);\r\n\t\t\tbreak;\r\n\t\t\tcase 39: // KEY right\r\n\t\t\tact && Calendar.cellClick(cal._nav_nm);\r\n\t\t\tbreak;\r\n\t\t\tcase 40: // KEY down\r\n\t\t\tact && Calendar.cellClick(cal._nav_ny);\r\n\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\treturn false;\r\n\t\t}\r\n\t} else switch (K) {\r\n\t\tcase 32: // KEY space (now)\r\n\t\tCalendar.cellClick(cal._nav_now);\r\n\t\tbreak;\r\n\t\tcase 27: // KEY esc\r\n\t\tact && cal.callCloseHandler();\r\n\t\tbreak;\r\n\t\tcase 37: // KEY left\r\n\t\tcase 38: // KEY up\r\n\t\tcase 39: // KEY right\r\n\t\tcase 40: // KEY down\r\n\t\tif (act) {\r\n\t\t\tvar prev, x, y, ne, el, step;\r\n\t\t\tprev = K == 37 || K == 38;\r\n\t\t\tstep = (K == 37 || K == 39) ? 1 : 7;\r\n\t\t\tfunction setVars() {\r\n\t\t\t\tel = cal.currentDateEl;\r\n\t\t\t\tvar p = el.pos;\r\n\t\t\t\tx = p & 15;\r\n\t\t\t\ty = p >> 4;\r\n\t\t\t\tne = cal.ar_days[y][x];\r\n\t\t\t};setVars();\r\n\t\t\tfunction prevMonth() {\r\n\t\t\t\tvar date = new Date(cal.date);\r\n\t\t\t\tdate.setDate(date.getDate() - step);\r\n\t\t\t\tcal.setDate(date);\r\n\t\t\t};\r\n\t\t\tfunction nextMonth() {\r\n\t\t\t\tvar date = new Date(cal.date);\r\n\t\t\t\tdate.setDate(date.getDate() + step);\r\n\t\t\t\tcal.setDate(date);\r\n\t\t\t};\r\n\t\t\twhile (1) {\r\n\t\t\t\tswitch (K) {\r\n\t\t\t\t\tcase 37: // KEY left\r\n\t\t\t\t\tif (--x >= 0)\r\n\t\t\t\t\tne = cal.ar_days[y][x];\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tx = 6;\r\n\t\t\t\t\t\tK = 38;\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 38: // KEY up\r\n\t\t\t\t\tif (--y >= 0)\r\n\t\t\t\t\tne = cal.ar_days[y][x];\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tprevMonth();\r\n\t\t\t\t\t\tsetVars();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 39: // KEY right\r\n\t\t\t\t\tif (++x < 7)\r\n\t\t\t\t\tne = cal.ar_days[y][x];\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tx = 0;\r\n\t\t\t\t\t\tK = 40;\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 40: // KEY down\r\n\t\t\t\t\tif (++y < cal.ar_days.length)\r\n\t\t\t\t\tne = cal.ar_days[y][x];\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tnextMonth();\r\n\t\t\t\t\t\tsetVars();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif (ne) {\r\n\t\t\t\tif (!ne.disabled)\r\n\t\t\t\tCalendar.cellClick(ne);\r\n\t\t\t\telse if (prev)\r\n\t\t\t\tprevMonth();\r\n\t\t\t\telse\r\n\t\t\t\tnextMonth();\r\n\t\t\t}\r\n\t\t}\r\n\t\tbreak;\r\n\t\tcase 13: // KEY enter\r\n\t\tif (act)\r\n\t\tCalendar.cellClick(cal.currentDateEl, ev);\r\n\t\tbreak;\r\n\t\tdefault:\r\n\t\treturn false;\r\n\t}\r\n\treturn Calendar.stopEvent(ev);\r\n};\r\n\r\n/**\r\n*  (RE)Initializes the calendar to the given date and firstDayOfWeek\r\n*/\r\nCalendar.prototype._init = function (firstDayOfWeek, date) {\r\n\tvar today = new Date(),\r\n\tTY = today.getFullYear(),\r\n\tTM = today.getMonth(),\r\n\tTD = today.getDate();\r\n\tthis.table.style.visibility = \"hidden\";\r\n\tvar year = date.getFullYear();\r\n\tif (year < this.minYear) {\r\n\t\tyear = this.minYear;\r\n\t\tdate.setFullYear(year);\r\n\t} else if (year > this.maxYear) {\r\n\t\tyear = this.maxYear;\r\n\t\tdate.setFullYear(year);\r\n\t}\r\n\tthis.firstDayOfWeek = firstDayOfWeek;\r\n\tthis.date = new Date(date);\r\n\tvar month = date.getMonth();\r\n\tvar mday = date.getDate();\r\n\tvar no_days = date.getMonthDays();\r\n\r\n\t// calendar voodoo for computing the first day that would actually be\r\n\t// displayed in the calendar, even if it's from the previous month.\r\n\t// WARNING: this is magic. ;-)\r\n\tdate.setDate(1);\r\n\tvar day1 = (date.getDay() - this.firstDayOfWeek) % 7;\r\n\tif (day1 < 0)\r\n\tday1 += 7;\r\n\tdate.setDate(-day1);\r\n\tdate.setDate(date.getDate() + 1);\r\n\r\n\tvar row = this.tbody.firstChild;\r\n\tvar MN = Calendar._SMN[month];\r\n\tvar ar_days = this.ar_days = new Array();\r\n\tvar weekend = Calendar._TT[\"WEEKEND\"];\r\n\tvar dates = this.multiple ? (this.datesCells = {}) : null;\r\n\tfor (var i = 0; i < 6; ++i, row = row.nextSibling) {\r\n\t\tvar cell = row.firstChild;\r\n\t\tif (this.weekNumbers) {\r\n\t\t\tcell.className = \"day wn\";\r\n\t\t\tcell.innerHTML = date.getWeekNumber();\r\n\t\t\tcell = cell.nextSibling;\r\n\t\t}\r\n\t\trow.className = \"daysrow\";\r\n\t\tvar hasdays = false, iday, dpos = ar_days[i] = [];\r\n\t\tfor (var j = 0; j < 7; ++j, cell = cell.nextSibling, date.setDate(iday + 1)) {\r\n\t\t\tiday = date.getDate();\r\n\t\t\tvar wday = date.getDay();\r\n\t\t\tcell.className = \"day\";\r\n\t\t\tcell.pos = i << 4 | j;\r\n\t\t\tdpos[j] = cell;\r\n\t\t\tvar current_month = (date.getMonth() == month);\r\n\t\t\tif (!current_month) {\r\n\t\t\t\tif (this.showsOtherMonths) {\r\n\t\t\t\t\tcell.className += \" othermonth\";\r\n\t\t\t\t\tcell.otherMonth = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcell.className = \"emptycell\";\r\n\t\t\t\t\tcell.innerHTML = \"&nbsp;\";\r\n\t\t\t\t\tcell.disabled = true;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tcell.otherMonth = false;\r\n\t\t\t\thasdays = true;\r\n\t\t\t}\r\n\t\t\tcell.disabled = false;\r\n\t\t\tcell.innerHTML = this.getDateText ? this.getDateText(date, iday) : iday;\r\n\t\t\tif (dates)\r\n\t\t\tdates[date.print(\"%Y%m%d\")] = cell;\r\n\t\t\tif (this.getDateStatus) {\r\n\t\t\t\tvar status = this.getDateStatus(date, year, month, iday);\r\n\t\t\t\tif (this.getDateToolTip) {\r\n\t\t\t\t\tvar toolTip = this.getDateToolTip(date, year, month, iday);\r\n\t\t\t\t\tif (toolTip)\r\n\t\t\t\t\tcell.title = toolTip;\r\n\t\t\t\t}\r\n\t\t\t\tif (status === true) {\r\n\t\t\t\t\tcell.className += \" disabled\";\r\n\t\t\t\t\tcell.disabled = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (/disabled/i.test(status))\r\n\t\t\t\t\tcell.disabled = true;\r\n\t\t\t\t\tcell.className += \" \" + status;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!cell.disabled) {\r\n\t\t\t\tcell.caldate = new Date(date);\r\n\t\t\t\tcell.ttip = \"_\";\r\n\t\t\t\tif (!this.multiple && current_month\r\n\t\t\t\t&& iday == mday && this.hiliteToday) {\r\n\t\t\t\t\tcell.className += \" selected\";\r\n\t\t\t\t\tthis.currentDateEl = cell;\r\n\t\t\t\t}\r\n\t\t\t\tif (date.getFullYear() == TY &&\r\n\t\t\t\tdate.getMonth() == TM &&\r\n\t\t\t\tiday == TD) {\r\n\t\t\t\t\tcell.className += \" today\";\r\n\t\t\t\t\tcell.ttip += Calendar._TT[\"PART_TODAY\"];\r\n\t\t\t\t}\r\n\t\t\t\tif (weekend.indexOf(wday.toString()) != -1)\r\n\t\t\t\tcell.className += cell.otherMonth ? \" oweekend\" : \" weekend\";\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!(hasdays || this.showsOtherMonths))\r\n\t\trow.className = \"emptyrow\";\r\n\t}\r\n\tthis.title.innerHTML = Calendar._MN[month] + \", \" + year;\r\n\tthis.onSetTime();\r\n\tthis.table.style.visibility = \"visible\";\r\n\tthis._initMultipleDates();\r\n\t// PROFILE\r\n\t// this.tooltips.innerHTML = \"Generated in \" + ((new Date()) - today) + \" ms\";\r\n};\r\n\r\nCalendar.prototype._initMultipleDates = function() {\r\n\tif (this.multiple) {\r\n\t\tfor (var i in this.multiple) {\r\n\t\t\tvar cell = this.datesCells[i];\r\n\t\t\tvar d = this.multiple[i];\r\n\t\t\tif (!d)\r\n\t\t\tcontinue;\r\n\t\t\tif (cell)\r\n\t\t\tcell.className += \" selected\";\r\n\t\t}\r\n\t}\r\n};\r\n\r\nCalendar.prototype._toggleMultipleDate = function(date) {\r\n\tif (this.multiple) {\r\n\t\tvar ds = date.print(\"%Y%m%d\");\r\n\t\tvar cell = this.datesCells[ds];\r\n\t\tif (cell) {\r\n\t\t\tvar d = this.multiple[ds];\r\n\t\t\tif (!d) {\r\n\t\t\t\tCalendar.addClass(cell, \"selected\");\r\n\t\t\t\tthis.multiple[ds] = date;\r\n\t\t\t} else {\r\n\t\t\t\tCalendar.removeClass(cell, \"selected\");\r\n\t\t\t\tdelete this.multiple[ds];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\nCalendar.prototype.setDateToolTipHandler = function (unaryFunction) {\r\n\tthis.getDateToolTip = unaryFunction;\r\n};\r\n\r\n/**\r\n*  Calls _init function above for going to a certain date (but only if the\r\n*  date is different than the currently selected one).\r\n*/\r\nCalendar.prototype.setDate = function (date) {\r\n\tif (!date.equalsTo(this.date)) {\r\n\t\tthis._init(this.firstDayOfWeek, date);\r\n\t}\r\n};\r\n\r\n/**\r\n*  Refreshes the calendar.  Useful if the \"disabledHandler\" function is\r\n*  dynamic, meaning that the list of disabled date can change at runtime.\r\n*  Just * call this function if you think that the list of disabled dates\r\n*  should * change.\r\n*/\r\nCalendar.prototype.refresh = function () {\r\n\tthis._init(this.firstDayOfWeek, this.date);\r\n};\r\n\r\n/** Modifies the \"firstDayOfWeek\" parameter (pass 0 for Synday, 1 for Monday, etc.). */\r\nCalendar.prototype.setFirstDayOfWeek = function (firstDayOfWeek) {\r\n\tthis._init(firstDayOfWeek, this.date);\r\n\tthis._displayWeekdays();\r\n};\r\n\r\n/**\r\n*  Allows customization of what dates are enabled.  The \"unaryFunction\"\r\n*  parameter must be a function object that receives the date (as a JS Date\r\n*  object) and returns a boolean value.  If the returned value is true then\r\n*  the passed date will be marked as disabled.\r\n*/\r\nCalendar.prototype.setDateStatusHandler = Calendar.prototype.setDisabledHandler = function (unaryFunction) {\r\n\tthis.getDateStatus = unaryFunction;\r\n};\r\n\r\n/** Customization of allowed year range for the calendar. */\r\nCalendar.prototype.setRange = function (a, z) {\r\n\tthis.minYear = a;\r\n\tthis.maxYear = z;\r\n};\r\n\r\n/** Calls the first user handler (selectedHandler). */\r\nCalendar.prototype.callHandler = function () {\r\n\tif (this.onSelected) {\r\n\t\tthis.onSelected(this, this.date.print(this.dateFormat));\r\n\t}\r\n};\r\n\r\n/** Calls the second user handler (closeHandler). */\r\nCalendar.prototype.callCloseHandler = function () {\r\n\tif (this.onClose) {\r\n\t\tthis.onClose(this);\r\n\t}\r\n\tthis.hideShowCovered();\r\n};\r\n\r\n/** Removes the calendar object from the DOM tree and destroys it. */\r\nCalendar.prototype.destroy = function () {\r\n\tvar el = this.element.parentNode;\r\n\tel.removeChild(this.element);\r\n\tCalendar._C = null;\r\n\twindow._dynarch_popupCalendar = null;\r\n};\r\n\r\n/**\r\n*  Moves the calendar element to a different section in the DOM tree (changes\r\n*  its parent).\r\n*/\r\nCalendar.prototype.reparent = function (new_parent) {\r\n\tvar el = this.element;\r\n\tel.parentNode.removeChild(el);\r\n\tnew_parent.appendChild(el);\r\n};\r\n\r\n// This gets called when the user presses a mouse button anywhere in the\r\n// document, if the calendar is shown.  If the click was outside the open\r\n// calendar this function closes it.\r\nCalendar._checkCalendar = function(ev) {\r\n\tvar calendar = window._dynarch_popupCalendar;\r\n\tif (!calendar) {\r\n\t\treturn false;\r\n\t}\r\n\tvar el = Calendar.is_ie ? Calendar.getElement(ev) : Calendar.getTargetElement(ev);\r\n\tfor (; el != null && el != calendar.element; el = el.parentNode);\r\n\tif (el == null) {\r\n\t\t// calls closeHandler which should hide the calendar.\r\n\t\twindow._dynarch_popupCalendar.callCloseHandler();\r\n\t\treturn Calendar.stopEvent(ev);\r\n\t}\r\n};\r\n\r\n/** Shows the calendar. */\r\nCalendar.prototype.show = function () {\r\n\tvar rows = this.table.getElementsByTagName(\"tr\");\r\n\tfor (var i = rows.length; i > 0;) {\r\n\t\tvar row = rows[--i];\r\n\t\tCalendar.removeClass(row, \"rowhilite\");\r\n\t\tvar cells = row.getElementsByTagName(\"td\");\r\n\t\tfor (var j = cells.length; j > 0;) {\r\n\t\t\tvar cell = cells[--j];\r\n\t\t\tCalendar.removeClass(cell, \"hilite\");\r\n\t\t\tCalendar.removeClass(cell, \"active\");\r\n\t\t}\r\n\t}\r\n\tthis.element.style.display = \"block\";\r\n\tthis.hidden = false;\r\n\tif (this.isPopup) {\r\n\t\twindow._dynarch_popupCalendar = this;\r\n\t\tCalendar.addEvent(document, \"keydown\", Calendar._keyEvent);\r\n\t\tCalendar.addEvent(document, \"keypress\", Calendar._keyEvent);\r\n\t\tCalendar.addEvent(document, \"mousedown\", Calendar._checkCalendar);\r\n\t}\r\n\tthis.hideShowCovered();\r\n\t\r\n\t// Для IE расчитываем размеры теней\r\n\t// получаем ширину выпадающего блока и устанавливаем её для верхней и нижней границы\r\n\tgroupChildElements = this.shadowed_div.children;\r\n\r\n\tif (groupChildElements != undefined)\r\n\t{\r\n\t\tfor (i = 0; i < groupChildElements.length; i++)\r\n\t\t{\r\n\t\t\tif(groupChildElements[i].className == 'b' | groupChildElements[i].className == 't')\r\n\t\t\t{\r\n\t\t\t\tgroupChildElements[i].style.width = this.shadowed_div.clientWidth + 'px';\r\n\t\t\t}\r\n\r\n\t\t\tif(groupChildElements[i].className == 'r' | groupChildElements[i].className == 'l')\r\n\t\t\t{\r\n\t\t\t\tgroupChildElements[i].style.height = this.shadowed_div.clientHeight + 'px';\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n*  Hides the calendar.  Also removes any \"hilite\" from the class of any TD\r\n*  element.\r\n*/\r\nCalendar.prototype.hide = function () {\r\n\tif (this.isPopup) {\r\n\t\tCalendar.removeEvent(document, \"keydown\", Calendar._keyEvent);\r\n\t\tCalendar.removeEvent(document, \"keypress\", Calendar._keyEvent);\r\n\t\tCalendar.removeEvent(document, \"mousedown\", Calendar._checkCalendar);\r\n\t}\r\n\tthis.element.style.display = \"none\";\r\n\tthis.hidden = true;\r\n\tthis.hideShowCovered();\r\n};\r\n\r\n/**\r\n*  Shows the calendar at a given absolute position (beware that, depending on\r\n*  the calendar element style -- position property -- this might be relative\r\n*  to the parent's containing rectangle).\r\n*/\r\nCalendar.prototype.showAt = function (x, y) {\r\n\tvar s = this.element.style;\r\n\ts.left = x + \"px\";\r\n\ts.top = y + \"px\";\r\n\tthis.show();\r\n};\r\n\r\n/** Shows the calendar near a given element. */\r\nCalendar.prototype.showAtElement = function (el, opts) {\r\n\tvar self = this;\r\n\tvar p = Calendar.getAbsolutePos(el);\r\n\tif (!opts || typeof opts != \"string\") {\r\n\t\tthis.showAt(p.x, p.y + el.offsetHeight);\r\n\t\treturn true;\r\n\t}\r\n\tfunction fixPosition(box) {\r\n\t\tif (box.x < 0)\r\n\t\tbox.x = 0;\r\n\t\tif (box.y < 0)\r\n\t\tbox.y = 0;\r\n\t\tvar cp = document.createElement(\"div\");\r\n\t\tvar s = cp.style;\r\n\t\ts.position = \"absolute\";\r\n\t\ts.right = s.bottom = s.width = s.height = \"0px\";\r\n\t\tdocument.body.appendChild(cp);\r\n\t\tvar br = Calendar.getAbsolutePos(cp);\r\n\t\tdocument.body.removeChild(cp);\r\n\t\tif (Calendar.is_ie) {\r\n\t\t\tbr.y += document.body.scrollTop;\r\n\t\t\tbr.x += document.body.scrollLeft;\r\n\t\t} else {\r\n\t\t\tbr.y += window.scrollY;\r\n\t\t\tbr.x += window.scrollX;\r\n\t\t}\r\n\t\tvar tmp = box.x + box.width - br.x;\r\n\t\tif (tmp > 0) box.x -= tmp;\r\n\t\ttmp = box.y + box.height - br.y;\r\n\t\tif (tmp > 0) box.y -= tmp;\r\n\t};\r\n\tthis.element.style.display = \"block\";\r\n\tCalendar.continuation_for_the_fucking_khtml_browser = function() {\r\n\t\tvar w = self.element.offsetWidth;\r\n\t\tvar h = self.element.offsetHeight;\r\n\t\tself.element.style.display = \"none\";\r\n\t\tvar valign = opts.substr(0, 1);\r\n\t\tvar halign = \"l\";\r\n\t\tif (opts.length > 1) {\r\n\t\t\thalign = opts.substr(1, 1);\r\n\t\t}\r\n\t\t// vertical alignment\r\n\t\tswitch (valign) {\r\n\t\t\tcase \"T\": p.y -= h; break;\r\n\t\t\tcase \"B\": p.y += el.offsetHeight; break;\r\n\t\t\tcase \"C\": p.y += (el.offsetHeight - h) / 2; break;\r\n\t\t\tcase \"t\": p.y += el.offsetHeight - h; break;\r\n\t\t\tcase \"b\": break; // already there\r\n\t\t}\r\n\t\t// horizontal alignment\r\n\t\tswitch (halign) {\r\n\t\t\tcase \"L\": p.x -= w; break;\r\n\t\t\tcase \"R\": p.x += el.offsetWidth; break;\r\n\t\t\tcase \"C\": p.x += (el.offsetWidth - w) / 2; break;\r\n\t\t\tcase \"l\": p.x += el.offsetWidth - w; break;\r\n\t\t\tcase \"r\": break; // already there\r\n\t\t}\r\n\t\tp.width = w;\r\n\t\tp.height = h + 40;\r\n\t\tself.monthsCombo.style.display = \"none\";\r\n\t\tfixPosition(p);\r\n\t\tself.showAt(p.x, p.y);\r\n\t};\r\n\tif (Calendar.is_khtml)\r\n\tsetTimeout(\"Calendar.continuation_for_the_fucking_khtml_browser()\", 10);\r\n\telse\r\n\tCalendar.continuation_for_the_fucking_khtml_browser();\r\n};\r\n\r\n/** Customizes the date format. */\r\nCalendar.prototype.setDateFormat = function (str) {\r\n\tthis.dateFormat = str;\r\n};\r\n\r\n/** Customizes the tooltip date format. */\r\nCalendar.prototype.setTtDateFormat = function (str) {\r\n\tthis.ttDateFormat = str;\r\n};\r\n\r\n/**\r\n*  Tries to identify the date represented in a string.  If successful it also\r\n*  calls this.setDate which moves the calendar to the given date.\r\n*/\r\nCalendar.prototype.parseDate = function(str, fmt) {\r\n\tif (!fmt)\r\n\tfmt = this.dateFormat;\r\n\tthis.setDate(Date.parseDate(str, fmt));\r\n};\r\n\r\nCalendar.prototype.hideShowCovered = function () {\r\n\tif (!Calendar.is_ie && !Calendar.is_opera)\r\n\treturn;\r\n\tfunction getVisib(obj){\r\n\t\tvar value = obj.style.visibility;\r\n\t\tif (!value) {\r\n\t\t\tif (document.defaultView && typeof (document.defaultView.getComputedStyle) == \"function\") { // Gecko, W3C\r\n\t\t\t\tif (!Calendar.is_khtml)\r\n\t\t\t\tvalue = document.defaultView.\r\n\t\t\t\tgetComputedStyle(obj, \"\").getPropertyValue(\"visibility\");\r\n\t\t\t\telse\r\n\t\t\t\tvalue = '';\r\n\t\t\t} else if (obj.currentStyle) { // IE\r\n\t\t\t\tvalue = obj.currentStyle.visibility;\r\n\t\t\t} else\r\n\t\t\tvalue = '';\r\n\t\t}\r\n\t\treturn value;\r\n\t};\r\n\r\n\tvar tags = new Array(\"applet\", \"iframe\", \"select\");\r\n\tvar el = this.element;\r\n\r\n\tvar p = Calendar.getAbsolutePos(el);\r\n\tvar EX1 = p.x;\r\n\tvar EX2 = el.offsetWidth + EX1;\r\n\tvar EY1 = p.y;\r\n\tvar EY2 = el.offsetHeight + EY1;\r\n\r\n\tfor (var k = tags.length; k > 0; ) {\r\n\t\tvar ar = document.getElementsByTagName(tags[--k]);\r\n\t\tvar cc = null;\r\n\r\n\t\tfor (var i = ar.length; i > 0;) {\r\n\t\t\tcc = ar[--i];\r\n\r\n\t\t\tp = Calendar.getAbsolutePos(cc);\r\n\t\t\tvar CX1 = p.x;\r\n\t\t\tvar CX2 = cc.offsetWidth + CX1;\r\n\t\t\tvar CY1 = p.y;\r\n\t\t\tvar CY2 = cc.offsetHeight + CY1;\r\n\r\n\t\t\tif (this.hidden || (CX1 > EX2) || (CX2 < EX1) || (CY1 > EY2) || (CY2 < EY1)) {\r\n\t\t\t\tif (!cc.__msh_save_visibility) {\r\n\t\t\t\t\tcc.__msh_save_visibility = getVisib(cc);\r\n\t\t\t\t}\r\n\t\t\t\tcc.style.visibility = cc.__msh_save_visibility;\r\n\t\t\t} else {\r\n\t\t\t\tif (!cc.__msh_save_visibility) {\r\n\t\t\t\t\tcc.__msh_save_visibility = getVisib(cc);\r\n\t\t\t\t}\r\n\t\t\t\tcc.style.visibility = \"hidden\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/** Internal function; it displays the bar with the names of the weekday. */\r\nCalendar.prototype._displayWeekdays = function () {\r\n\tvar fdow = this.firstDayOfWeek;\r\n\tvar cell = this.firstdayname;\r\n\tvar weekend = Calendar._TT[\"WEEKEND\"];\r\n\tfor (var i = 0; i < 7; ++i) {\r\n\t\tcell.className = \"day name\";\r\n\t\tvar realday = (i + fdow) % 7;\r\n\t\tif (i) {\r\n\t\t\tcell.ttip = Calendar._TT[\"DAY_FIRST\"].replace(\"%s\", Calendar._DN[realday]);\r\n\t\t\tcell.navtype = 100;\r\n\t\t\tcell.calendar = this;\r\n\t\t\tcell.fdow = realday;\r\n\t\t\tCalendar._add_evs(cell);\r\n\t\t}\r\n\t\tif (weekend.indexOf(realday.toString()) != -1) {\r\n\t\t\tCalendar.addClass(cell, \"weekend\");\r\n\t\t}\r\n\t\tcell.innerHTML = Calendar._SDN[(i + fdow) % 7];\r\n\t\tcell = cell.nextSibling;\r\n\t}\r\n};\r\n\r\n/** Internal function.  Hides all combo boxes that might be displayed. */\r\nCalendar.prototype._hideCombos = function () {\r\n\tthis.monthsCombo.style.display = \"none\";\r\n\tthis.yearsCombo.style.display = \"none\";\r\n};\r\n\r\n/** Internal function.  Starts dragging the element. */\r\nCalendar.prototype._dragStart = function (ev) {\r\n\tif (this.dragging) {\r\n\t\treturn;\r\n\t}\r\n\tthis.dragging = true;\r\n\tvar posX;\r\n\tvar posY;\r\n\tif (Calendar.is_ie) {\r\n\t\tposY = window.event.clientY + document.body.scrollTop;\r\n\t\tposX = window.event.clientX + document.body.scrollLeft;\r\n\t} else {\r\n\t\tposY = ev.clientY + window.scrollY;\r\n\t\tposX = ev.clientX + window.scrollX;\r\n\t}\r\n\tvar st = this.element.style;\r\n\tthis.xOffs = posX - parseInt(st.left);\r\n\tthis.yOffs = posY - parseInt(st.top);\r\n\twith (Calendar) {\r\n\t\taddEvent(document, \"mousemove\", calDragIt);\r\n\t\taddEvent(document, \"mouseup\", calDragEnd);\r\n\t}\r\n};\r\n\r\n// BEGIN: DATE OBJECT PATCHES\r\n\r\n/** Adds the number of days array to the Date object. */\r\nDate._MD = new Array(31,28,31,30,31,30,31,31,30,31,30,31);\r\n\r\n/** Constants used for time computations */\r\nDate.SECOND = 1000 /* milliseconds */;\r\nDate.MINUTE = 60 * Date.SECOND;\r\nDate.HOUR   = 60 * Date.MINUTE;\r\nDate.DAY    = 24 * Date.HOUR;\r\nDate.WEEK   =  7 * Date.DAY;\r\n\r\nDate.parseDate = function(str, fmt) {\r\n\tvar today = new Date();\r\n\tvar y = 0;\r\n\tvar m = -1;\r\n\tvar d = 0;\r\n\tvar a = str.split(/\\W+/);\r\n\tvar b = fmt.match(/%./g);\r\n\tvar i = 0, j = 0;\r\n\tvar hr = 0;\r\n\tvar min = 0;\r\n\tfor (i = 0; i < a.length; ++i) {\r\n\t\tif (!a[i])\r\n\t\tcontinue;\r\n\t\tswitch (b[i]) {\r\n\t\t\tcase \"%d\":\r\n\t\t\tcase \"%e\":\r\n\t\t\td = parseInt(a[i], 10);\r\n\t\t\tbreak;\r\n\r\n\t\t\tcase \"%m\":\r\n\t\t\tm = parseInt(a[i], 10) - 1;\r\n\t\t\tbreak;\r\n\r\n\t\t\tcase \"%Y\":\r\n\t\t\tcase \"%y\":\r\n\t\t\ty = parseInt(a[i], 10);\r\n\t\t\t(y < 100) && (y += (y > 29) ? 1900 : 2000);\r\n\t\t\tbreak;\r\n\r\n\t\t\tcase \"%b\":\r\n\t\t\tcase \"%B\":\r\n\t\t\tfor (j = 0; j < 12; ++j) {\r\n\t\t\t\tif (Calendar._MN[j].substr(0, a[i].length).toLowerCase() == a[i].toLowerCase()) { m = j; break; }\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\r\n\t\t\tcase \"%H\":\r\n\t\t\tcase \"%I\":\r\n\t\t\tcase \"%k\":\r\n\t\t\tcase \"%l\":\r\n\t\t\thr = parseInt(a[i], 10);\r\n\t\t\tbreak;\r\n\r\n\t\t\tcase \"%P\":\r\n\t\t\tcase \"%p\":\r\n\t\t\tif (/pm/i.test(a[i]) && hr < 12)\r\n\t\t\thr += 12;\r\n\t\t\telse if (/am/i.test(a[i]) && hr >= 12)\r\n\t\t\thr -= 12;\r\n\t\t\tbreak;\r\n\r\n\t\t\tcase \"%M\":\r\n\t\t\tmin = parseInt(a[i], 10);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\tif (isNaN(y)) y = today.getFullYear();\r\n\tif (isNaN(m)) m = today.getMonth();\r\n\tif (isNaN(d)) d = today.getDate();\r\n\tif (isNaN(hr)) hr = today.getHours();\r\n\tif (isNaN(min)) min = today.getMinutes();\r\n\tif (y != 0 && m != -1 && d != 0)\r\n\treturn new Date(y, m, d, hr, min, 0);\r\n\ty = 0; m = -1; d = 0;\r\n\tfor (i = 0; i < a.length; ++i) {\r\n\t\tif (a[i].search(/[a-zA-Z]+/) != -1) {\r\n\t\t\tvar t = -1;\r\n\t\t\tfor (j = 0; j < 12; ++j) {\r\n\t\t\t\tif (Calendar._MN[j].substr(0, a[i].length).toLowerCase() == a[i].toLowerCase()) { t = j; break; }\r\n\t\t\t}\r\n\t\t\tif (t != -1) {\r\n\t\t\t\tif (m != -1) {\r\n\t\t\t\t\td = m+1;\r\n\t\t\t\t}\r\n\t\t\t\tm = t;\r\n\t\t\t}\r\n\t\t} else if (parseInt(a[i], 10) <= 12 && m == -1) {\r\n\t\t\tm = a[i]-1;\r\n\t\t} else if (parseInt(a[i], 10) > 31 && y == 0) {\r\n\t\t\ty = parseInt(a[i], 10);\r\n\t\t\t(y < 100) && (y += (y > 29) ? 1900 : 2000);\r\n\t\t} else if (d == 0) {\r\n\t\t\td = a[i];\r\n\t\t}\r\n\t}\r\n\tif (y == 0)\r\n\ty = today.getFullYear();\r\n\tif (m != -1 && d != 0)\r\n\treturn new Date(y, m, d, hr, min, 0);\r\n\treturn today;\r\n};\r\n\r\n/** Returns the number of days in the current month */\r\nDate.prototype.getMonthDays = function(month) {\r\n\tvar year = this.getFullYear();\r\n\tif (typeof month == \"undefined\") {\r\n\t\tmonth = this.getMonth();\r\n\t}\r\n\tif (((0 == (year%4)) && ( (0 != (year%100)) || (0 == (year%400)))) && month == 1) {\r\n\t\treturn 29;\r\n\t} else {\r\n\t\treturn Date._MD[month];\r\n\t}\r\n};\r\n\r\n/** Returns the number of day in the year. */\r\nDate.prototype.getDayOfYear = function() {\r\n\tvar now = new Date(this.getFullYear(), this.getMonth(), this.getDate(), 0, 0, 0);\r\n\tvar then = new Date(this.getFullYear(), 0, 0, 0, 0, 0);\r\n\tvar time = now - then;\r\n\treturn Math.floor(time / Date.DAY);\r\n};\r\n\r\n/** Returns the number of the week in year, as defined in ISO 8601. */\r\nDate.prototype.getWeekNumber = function() {\r\n\tvar d = new Date(this.getFullYear(), this.getMonth(), this.getDate(), 0, 0, 0);\r\n\tvar DoW = d.getDay();\r\n\td.setDate(d.getDate() - (DoW + 6) % 7 + 3); // Nearest Thu\r\n\tvar ms = d.valueOf(); // GMT\r\n\td.setMonth(0);\r\n\td.setDate(4); // Thu in Week 1\r\n\treturn Math.round((ms - d.valueOf()) / (7 * 864e5)) + 1;\r\n};\r\n\r\n/** Checks date and time equality */\r\nDate.prototype.equalsTo = function(date) {\r\n\treturn ((this.getFullYear() == date.getFullYear()) &&\r\n\t(this.getMonth() == date.getMonth()) &&\r\n\t(this.getDate() == date.getDate()) &&\r\n\t(this.getHours() == date.getHours()) &&\r\n\t(this.getMinutes() == date.getMinutes()));\r\n};\r\n\r\n/** Set only the year, month, date parts (keep existing time) */\r\nDate.prototype.setDateOnly = function(date) {\r\n\tvar tmp = new Date(date);\r\n\tthis.setDate(1);\r\n\tthis.setFullYear(tmp.getFullYear());\r\n\tthis.setMonth(tmp.getMonth());\r\n\tthis.setDate(tmp.getDate());\r\n};\r\n\r\n/** Prints the date in a string according to the given format. */\r\nDate.prototype.print = function (str) {\r\n\tvar m = this.getMonth();\r\n\tvar d = this.getDate();\r\n\tvar y = this.getFullYear();\r\n\tvar wn = this.getWeekNumber();\r\n\tvar w = this.getDay();\r\n\tvar s = {};\r\n\tvar hr = this.getHours();\r\n\tvar pm = (hr >= 12);\r\n\tvar ir = (pm) ? (hr - 12) : hr;\r\n\tvar dy = this.getDayOfYear();\r\n\tif (ir == 0)\r\n\tir = 12;\r\n\tvar min = this.getMinutes();\r\n\tvar sec = this.getSeconds();\r\n\ts[\"%a\"] = Calendar._SDN[w]; // abbreviated weekday name [FIXME: I18N]\r\n\ts[\"%A\"] = Calendar._DN[w]; // full weekday name\r\n\ts[\"%b\"] = Calendar._SMN[m]; // abbreviated month name [FIXME: I18N]\r\n\ts[\"%B\"] = Calendar._MN[m]; // full month name\r\n\t// FIXME: %c : preferred date and time representation for the current locale\r\n\ts[\"%C\"] = 1 + Math.floor(y / 100); // the century number\r\n\ts[\"%d\"] = (d < 10) ? (\"0\" + d) : d; // the day of the month (range 01 to 31)\r\n\ts[\"%e\"] = d; // the day of the month (range 1 to 31)\r\n\t// FIXME: %D : american date style: %m/%d/%y\r\n\t// FIXME: %E, %F, %G, %g, %h (man strftime)\r\n\ts[\"%H\"] = (hr < 10) ? (\"0\" + hr) : hr; // hour, range 00 to 23 (24h format)\r\n\ts[\"%I\"] = (ir < 10) ? (\"0\" + ir) : ir; // hour, range 01 to 12 (12h format)\r\n\ts[\"%j\"] = (dy < 100) ? ((dy < 10) ? (\"00\" + dy) : (\"0\" + dy)) : dy; // day of the year (range 001 to 366)\r\n\ts[\"%k\"] = hr;\t\t// hour, range 0 to 23 (24h format)\r\n\ts[\"%l\"] = ir;\t\t// hour, range 1 to 12 (12h format)\r\n\ts[\"%m\"] = (m < 9) ? (\"0\" + (1+m)) : (1+m); // month, range 01 to 12\r\n\ts[\"%M\"] = (min < 10) ? (\"0\" + min) : min; // minute, range 00 to 59\r\n\ts[\"%n\"] = \"\\n\";\t\t// a newline character\r\n\ts[\"%p\"] = pm ? \"PM\" : \"AM\";\r\n\ts[\"%P\"] = pm ? \"pm\" : \"am\";\r\n\t// FIXME: %r : the time in am/pm notation %I:%M:%S %p\r\n\t// FIXME: %R : the time in 24-hour notation %H:%M\r\n\ts[\"%s\"] = Math.floor(this.getTime() / 1000);\r\n\ts[\"%S\"] = (sec < 10) ? (\"0\" + sec) : sec; // seconds, range 00 to 59\r\n\ts[\"%t\"] = \"\\t\";\t\t// a tab character\r\n\t// FIXME: %T : the time in 24-hour notation (%H:%M:%S)\r\n\ts[\"%U\"] = s[\"%W\"] = s[\"%V\"] = (wn < 10) ? (\"0\" + wn) : wn;\r\n\ts[\"%u\"] = w + 1;\t// the day of the week (range 1 to 7, 1 = MON)\r\n\ts[\"%w\"] = w;\t\t// the day of the week (range 0 to 6, 0 = SUN)\r\n\t// FIXME: %x : preferred date representation for the current locale without the time\r\n\t// FIXME: %X : preferred time representation for the current locale without the date\r\n\ts[\"%y\"] = ('' + y).substr(2, 2); // year without the century (range 00 to 99)\r\n\ts[\"%Y\"] = y;\t\t// year with the century\r\n\ts[\"%%\"] = \"%\";\t\t// a literal '%' character\r\n\r\n\tvar re = /%./g;\r\n\tif (!Calendar.is_ie5 && !Calendar.is_khtml)\r\n\treturn str.replace(re, function (par) { return s[par] || par; });\r\n\r\n\tvar a = str.match(re);\r\n\tfor (var i = 0; i < a.length; i++) {\r\n\t\tvar tmp = s[a[i]];\r\n\t\tif (tmp) {\r\n\t\t\tre = new RegExp(a[i], 'g');\r\n\t\t\tstr = str.replace(re, tmp);\r\n\t\t}\r\n\t}\r\n\r\n\treturn str;\r\n};\r\n\r\nDate.prototype.__msh_oldSetFullYear = Date.prototype.setFullYear;\r\nDate.prototype.setFullYear = function(y) {\r\n\tvar d = new Date(this);\r\n\td.__msh_oldSetFullYear(y);\r\n\tif (d.getMonth() != this.getMonth())\r\n\tthis.setDate(28);\r\n\tthis.__msh_oldSetFullYear(y);\r\n};\r\n\r\n// END: DATE OBJECT PATCHES\r\n\r\n\r\n// global object that remembers the calendar\r\nwindow._dynarch_popupCalendar = null;\r\n"
          },
          "redirectURL": "",
          "headersSize": 251,
          "bodySize": 14084
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-05-31T09:51:38.000Z",
            "lastAccess": "2012-05-30T09:51:38.000Z",
            "eTag": "",
            "hitCount": 18
          }
        },
        "timings": {
          "blocked": 9,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 5,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:38.786+04:00",
        "time": 15,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/calendar/lang/calendar-ru.js",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Thu, 15 Sep 2011 12:16:14 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 714,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Thu, 15 Sep 2011 12:16:14 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Thu, 31 May 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=86400"
            }
          ],
          "content": {
            "mimeType": "application/x-javascript",
            "size": 3881,
            "text": "// ** I18N\r\n\r\n// Calendar RU language\r\n// Translation: Sly Golovanov, http://golovanov.net, <sly@golovanov.net>\r\n// Encoding: any\r\n// Distributed under the same terms as the calendar itself.\r\n\r\n// For translators: please use UTF-8 if possible.  We strongly believe that\r\n// Unicode is the answer to a real internationalized world.  Also please\r\n// include your contact information in the header, as can be seen above.\r\n\r\n// full day names\r\nCalendar._DN = new Array\r\n(\"воскресенье\",\r\n \"понедельник\",\r\n \"вторник\",\r\n \"среда\",\r\n \"четверг\",\r\n \"пятница\",\r\n \"суббота\",\r\n \"воскресенье\");\r\n\r\n// Please note that the following array of short day names (and the same goes\r\n// for short month names, _SMN) isn't absolutely necessary.  We give it here\r\n// for exemplification on how one can customize the short day names, but if\r\n// they are simply the first N letters of the full name you can simply say:\r\n//\r\n//   Calendar._SDN_len = N; // short day name length\r\n//   Calendar._SMN_len = N; // short month name length\r\n//\r\n// If N = 3 then this is not needed either since we assume a value of 3 if not\r\n// present, to be compatible with translation files that were written before\r\n// this feature.\r\n\r\n// short day names\r\nCalendar._SDN = new Array\r\n(\"вс\",\r\n \"пн\",\r\n \"вт\",\r\n \"ср\",\r\n \"чт\",\r\n \"пт\",\r\n \"сб\",\r\n \"вс\");\r\n\r\n// full month names\r\n\r\n\r\n// First day of the week. \"0\" means display Sunday first, \"1\" means display\r\n// Monday first, etc.\r\nCalendar._FD = 0;\r\n\r\nCalendar._MN = new Array\r\n(\"январь\",\r\n \"февраль\",\r\n \"март\",\r\n \"апрель\",\r\n \"май\",\r\n \"июнь\",\r\n \"июль\",\r\n \"август\",\r\n \"сентябрь\",\r\n \"октябрь\",\r\n \"ноябрь\",\r\n \"декабрь\");\r\n\r\n// short month names\r\nCalendar._SMN = new Array\r\n(\"янв\",\r\n \"фев\",\r\n \"мар\",\r\n \"апр\",\r\n \"май\",\r\n \"июн\",\r\n \"июл\",\r\n \"авг\",\r\n \"сен\",\r\n \"окт\",\r\n \"ноя\",\r\n \"дек\");\r\n\r\n// tooltips\r\nCalendar._TT = {};\r\nCalendar._TT[\"INFO\"] = \"О календаре...\";\r\n\r\nCalendar._TT[\"ABOUT\"] =\r\n\"DHTML Date/Time Selector\\n\" +\r\n\"(c) dynarch.com 2002-2005 / Author: Mihai Bazon\\n\" + // don't translate this this ;-)\r\n\"For latest version visit: http://www.dynarch.com/projects/calendar/\\n\" +\r\n\"Distributed under GNU LGPL.  See http://gnu.org/licenses/lgpl.html for details.\" +\r\n\"\\n\\n\" +\r\n\"Как выбрать дату:\\n\" +\r\n\"- При помощи кнопок \\xab, \\xbb можно выбрать год\\n\" +\r\n\"- При помощи кнопок \" + String.fromCharCode(0x2039) + \", \" + String.fromCharCode(0x203a) + \" можно выбрать месяц\\n\" +\r\n\"- Подержите эти кнопки нажатыми, чтобы появилось меню быстрого выбора.\";\r\nCalendar._TT[\"ABOUT_TIME\"] = \"\\n\\n\" +\r\n\"Как выбрать время:\\n\" +\r\n\"- При клике на часах или минутах они увеличиваются\\n\" +\r\n\"- при клике с нажатой клавишей Shift они уменьшаются\\n\" +\r\n\"- если нажать и двигать мышкой влево/вправо, они будут меняться быстрее.\";\r\n\r\nCalendar._TT[\"PREV_YEAR\"] = \"На год назад (удерживать для меню)\";\r\nCalendar._TT[\"PREV_MONTH\"] = \"На месяц назад (удерживать для меню)\";\r\nCalendar._TT[\"GO_TODAY\"] = \"Сегодня\";\r\nCalendar._TT[\"NEXT_MONTH\"] = \"На месяц вперед (удерживать для меню)\";\r\nCalendar._TT[\"NEXT_YEAR\"] = \"На год вперед (удерживать для меню)\";\r\nCalendar._TT[\"SEL_DATE\"] = \"Выберите дату\";\r\nCalendar._TT[\"DRAG_TO_MOVE\"] = \"Перетаскивайте мышкой\";\r\nCalendar._TT[\"PART_TODAY\"] = \" (сегодня)\";\r\n\r\n// the following is to inform that \"%s\" is to be the first day of week\r\n// %s will be replaced with the day name.\r\nCalendar._TT[\"DAY_FIRST\"] = \"Первый день недели будет %s\";\r\n\r\n// This may be locale-dependent.  It specifies the week-end days, as an array\r\n// of comma-separated numbers.  The numbers are from 0 to 6: 0 means Sunday, 1\r\n// means Monday, etc.\r\nCalendar._TT[\"WEEKEND\"] = \"0,6\";\r\n\r\nCalendar._TT[\"CLOSE\"] = \"Закрыть\";\r\nCalendar._TT[\"TODAY\"] = \"Сегодня\";\r\nCalendar._TT[\"TIME_PART\"] = \"(Shift-)клик или нажать и двигать\";\r\n\r\n// date formats\r\nCalendar._TT[\"DEF_DATE_FORMAT\"] = \"%Y-%m-%d\";\r\nCalendar._TT[\"TT_DATE_FORMAT\"] = \"%e %b, %a\";\r\n\r\nCalendar._TT[\"WK\"] = \"нед\";\r\nCalendar._TT[\"TIME\"] = \"Время:\";"
          },
          "redirectURL": "",
          "headersSize": 251,
          "bodySize": 1992
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-05-31T09:51:38.000Z",
            "lastAccess": "2012-05-30T09:51:38.000Z",
            "eTag": "",
            "hitCount": 18
          }
        },
        "timings": {
          "blocked": 10,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 5,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:38.786+04:00",
        "time": 15,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/calendar/calendar-setup.js",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Thu, 15 Sep 2011 12:16:14 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 712,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Thu, 15 Sep 2011 12:16:14 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Thu, 31 May 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=86400"
            }
          ],
          "content": {
            "mimeType": "application/x-javascript",
            "size": 9054,
            "text": "/*  Copyright Mihai Bazon, 2002, 2003  |  http://dynarch.com/mishoo/\r\n * ---------------------------------------------------------------------------\r\n *\r\n * The DHTML Calendar\r\n *\r\n * Details and latest version at:\r\n * http://dynarch.com/mishoo/calendar.epl\r\n *\r\n * This script is distributed under the GNU Lesser General Public License.\r\n * Read the entire license text here: http://www.gnu.org/licenses/lgpl.html\r\n *\r\n * This file defines helper functions for setting up the calendar.  They are\r\n * intended to help non-programmers get a working calendar on their site\r\n * quickly.  This script should not be seen as part of the calendar.  It just\r\n * shows you what one can do with the calendar, while in the same time\r\n * providing a quick and simple method for setting it up.  If you need\r\n * exhaustive customization of the calendar creation process feel free to\r\n * modify this code to suit your needs (this is recommended and much better\r\n * than modifying calendar.js itself).\r\n */\r\n\r\n// $Id: calendar-setup.js,v 1.25 2005/03/07 09:51:33 mishoo Exp $\r\n\r\n/**\r\n *  This function \"patches\" an input field (or other element) to use a calendar\r\n *  widget for date selection.\r\n *\r\n *  The \"params\" is a single object that can have the following properties:\r\n *\r\n *    prop. name   | description\r\n *  -------------------------------------------------------------------------------------------------\r\n *   inputField    | the ID of an input field to store the date\r\n *   displayArea   | the ID of a DIV or other element to show the date\r\n *   button        | ID of a button or other element that will trigger the calendar\r\n *   eventName     | event that will trigger the calendar, without the \"on\" prefix (default: \"click\")\r\n *   ifFormat      | date format that will be stored in the input field\r\n *   daFormat      | the date format that will be used to display the date in displayArea\r\n *   singleClick   | (true/false) wether the calendar is in single click mode or not (default: true)\r\n *   firstDay      | numeric: 0 to 6.  \"0\" means display Sunday first, \"1\" means display Monday first, etc.\r\n *   align         | alignment (default: \"Br\"); if you don't know what's this see the calendar documentation\r\n *   range         | array with 2 elements.  Default: [1900, 2999] -- the range of years available\r\n *   weekNumbers   | (true/false) if it's true (default) the calendar will display week numbers\r\n *   flat          | null or element ID; if not null the calendar will be a flat calendar having the parent with the given ID\r\n *   flatCallback  | function that receives a JS Date object and returns an URL to point the browser to (for flat calendar)\r\n *   disableFunc   | function that receives a JS Date object and should return true if that date has to be disabled in the calendar\r\n *   onSelect      | function that gets called when a date is selected.  You don't _have_ to supply this (the default is generally okay)\r\n *   onClose       | function that gets called when the calendar is closed.  [default]\r\n *   onUpdate      | function that gets called after the date is updated in the input field.  Receives a reference to the calendar.\r\n *   date          | the date that the calendar will be initially displayed to\r\n *   showsTime     | default: false; if true the calendar will include a time selector\r\n *   timeFormat    | the time format; can be \"12\" or \"24\", default is \"12\"\r\n *   electric      | if true (default) then given fields/date areas are updated for each move; otherwise they're updated only on close\r\n *   step          | configures the step of the years in drop-down boxes; default: 2\r\n *   position      | configures the calendar absolute position; default: null\r\n *   cache         | if \"true\" (but default: \"false\") it will reuse the same calendar object, where possible\r\n *   showOthers    | if \"true\" (but default: \"false\") it will show days from other months too\r\n *\r\n *  None of them is required, they all have default values.  However, if you\r\n *  pass none of \"inputField\", \"displayArea\" or \"button\" you'll get a warning\r\n *  saying \"nothing to setup\".\r\n */\r\nCalendar.setup = function (params) {\r\n\tfunction param_default(pname, def) { if (typeof params[pname] == \"undefined\") { params[pname] = def; } };\r\n\r\n\tparam_default(\"inputField\",     null);\r\n\tparam_default(\"displayArea\",    null);\r\n\tparam_default(\"button\",         null);\r\n\tparam_default(\"eventName\",      \"click\");\r\n\tparam_default(\"ifFormat\",       \"%Y/%m/%d\");\r\n\tparam_default(\"daFormat\",       \"%Y/%m/%d\");\r\n\tparam_default(\"singleClick\",    true);\r\n\tparam_default(\"disableFunc\",    null);\r\n\tparam_default(\"dateStatusFunc\", params[\"disableFunc\"]);\t// takes precedence if both are defined\r\n\tparam_default(\"dateText\",       null);\r\n\tparam_default(\"firstDay\",       null);\r\n\tparam_default(\"align\",          \"Br\");\r\n\tparam_default(\"range\",          [1900, 2999]);\r\n\tparam_default(\"weekNumbers\",    false);\r\n\tparam_default(\"flat\",           null);\r\n\tparam_default(\"flatCallback\",   null);\r\n\tparam_default(\"onSelect\",       null);\r\n\tparam_default(\"onClose\",        null);\r\n\tparam_default(\"onUpdate\",       null);\r\n\tparam_default(\"date\",           null);\r\n\tparam_default(\"showsTime\",      false);\r\n\tparam_default(\"timeFormat\",     \"24\");\r\n\tparam_default(\"electric\",       true);\r\n\tparam_default(\"step\",           2);\r\n\tparam_default(\"position\",       null);\r\n\tparam_default(\"cache\",          false);\r\n\tparam_default(\"showOthers\",     false);\r\n\tparam_default(\"multiple\",       null);\r\n\r\n\tvar tmp = [\"inputField\", \"displayArea\", \"button\"];\r\n\tfor (var i in tmp) {\r\n\t\tif (typeof params[tmp[i]] == \"string\") {\r\n\t\t\tparams[tmp[i]] = document.getElementById(params[tmp[i]]);\r\n\t\t}\r\n\t}\r\n\tif (!(params.flat || params.multiple || params.inputField || params.displayArea || params.button)) {\r\n\t\talert(\"Calendar.setup:\\n  Nothing to setup (no fields found).  Please check your code\");\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfunction onSelect(cal) {\r\n\t\tvar p = cal.params;\r\n\t\tvar update = (cal.dateClicked || p.electric);\r\n\t\tif (update && p.inputField) {\r\n\t\t\tp.inputField.value = cal.date.print(p.ifFormat);\r\n\t\t\tif (typeof p.inputField.onchange == \"function\")\r\n\t\t\t\tp.inputField.onchange();\r\n\t\t}\r\n\t\tif (update && p.displayArea)\r\n\t\t\tp.displayArea.innerHTML = cal.date.print(p.daFormat);\r\n\t\tif (update && typeof p.onUpdate == \"function\")\r\n\t\t\tp.onUpdate(cal);\r\n\t\tif (update && p.flat) {\r\n\t\t\tif (typeof p.flatCallback == \"function\")\r\n\t\t\t\tp.flatCallback(cal);\r\n\t\t}\r\n\t\tif (update && p.singleClick && cal.dateClicked)\r\n\t\t\tcal.callCloseHandler();\r\n\t};\r\n\r\n\tif (params.flat != null) {\r\n\t\tif (typeof params.flat == \"string\")\r\n\t\t\tparams.flat = document.getElementById(params.flat);\r\n\t\tif (!params.flat) {\r\n\t\t\talert(\"Calendar.setup:\\n  Flat specified but can't find parent.\");\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar cal = new Calendar(params.firstDay, params.date, params.onSelect || onSelect);\r\n\t\tcal.showsOtherMonths = params.showOthers;\r\n\t\tcal.showsTime = params.showsTime;\r\n\t\tcal.time24 = (params.timeFormat == \"24\");\r\n\t\tcal.params = params;\r\n\t\tcal.weekNumbers = params.weekNumbers;\r\n\t\tcal.setRange(params.range[0], params.range[1]);\r\n\t\tcal.setDateStatusHandler(params.dateStatusFunc);\r\n\t\tcal.getDateText = params.dateText;\r\n\t\tif (params.ifFormat) {\r\n\t\t\tcal.setDateFormat(params.ifFormat);\r\n\t\t}\r\n\t\tif (params.inputField && typeof params.inputField.value == \"string\") {\r\n\t\t\tcal.parseDate(params.inputField.value);\r\n\t\t}\r\n\t\tcal.create(params.flat);\r\n\t\tcal.show();\r\n\t\treturn false;\r\n\t}\r\n\r\n\tvar triggerEl = params.button || params.displayArea || params.inputField;\r\n\ttriggerEl[\"on\" + params.eventName] = function() {\r\n\t\tvar dateEl = params.inputField || params.displayArea;\r\n\t\tvar dateFmt = params.inputField ? params.ifFormat : params.daFormat;\r\n\t\tvar mustCreate = false;\r\n\t\tvar cal = window.calendar;\r\n\t\tif (dateEl)\r\n\t\t\tparams.date = Date.parseDate(dateEl.value || dateEl.innerHTML, dateFmt);\r\n\t\tif (!(cal && params.cache)) {\r\n\t\t\twindow.calendar = cal = new Calendar(params.firstDay,\r\n\t\t\t\t\t\t\t     params.date,\r\n\t\t\t\t\t\t\t     params.onSelect || onSelect,\r\n\t\t\t\t\t\t\t     params.onClose || function(cal) { cal.hide(); });\r\n\t\t\tcal.showsTime = params.showsTime;\r\n\t\t\tcal.time24 = (params.timeFormat == \"24\");\r\n\t\t\tcal.weekNumbers = params.weekNumbers;\r\n\t\t\tmustCreate = true;\r\n\t\t} else {\r\n\t\t\tif (params.date)\r\n\t\t\t\tcal.setDate(params.date);\r\n\t\t\tcal.hide();\r\n\t\t}\r\n\t\tif (params.multiple) {\r\n\t\t\tcal.multiple = {};\r\n\t\t\tfor (var i = params.multiple.length; --i >= 0;) {\r\n\t\t\t\tvar d = params.multiple[i];\r\n\t\t\t\tvar ds = d.print(\"%Y%m%d\");\r\n\t\t\t\tcal.multiple[ds] = d;\r\n\t\t\t}\r\n\t\t}\r\n\t\tcal.showsOtherMonths = params.showOthers;\r\n\t\tcal.yearStep = params.step;\r\n\t\tcal.setRange(params.range[0], params.range[1]);\r\n\t\tcal.params = params;\r\n\t\tcal.setDateStatusHandler(params.dateStatusFunc);\r\n\t\tcal.getDateText = params.dateText;\r\n\t\tcal.setDateFormat(dateFmt);\r\n\t\tif (mustCreate)\r\n\t\t\tcal.create();\r\n\t\tcal.refresh();\r\n\t\tif (!params.position)\r\n\t\t\tcal.showAtElement(params.button || params.displayArea || params.inputField, params.align);\r\n\t\telse\r\n\t\t\tcal.showAt(params.position[0], params.position[1]);\r\n\t\treturn false;\r\n\t};\r\n\r\n\treturn cal;\r\n};\r\n"
          },
          "redirectURL": "",
          "headersSize": 251,
          "bodySize": 2961
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-05-31T09:51:38.000Z",
            "lastAccess": "2012-05-30T09:51:38.000Z",
            "eTag": "",
            "hitCount": 18
          }
        },
        "timings": {
          "blocked": 10,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 5,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:38.786+04:00",
        "time": 15,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/wysiwyg/tiny_mce_gzip.js",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Thu, 15 Sep 2011 12:16:15 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 710,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Thu, 15 Sep 2011 12:16:15 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Thu, 31 May 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=86400"
            }
          ],
          "content": {
            "mimeType": "application/x-javascript",
            "size": 3062,
            "text": "var tinyMCE_GZ = {\r\n\tsettings : {\r\n\t\tthemes : '',\r\n\t\tplugins : '',\r\n\t\tlanguages : '',\r\n\t\tdisk_cache : true,\r\n\t\tpage_name : 'tiny_mce_gzip.php',\r\n\t\tdebug : false,\r\n\t\tsuffix : ''\r\n\t},\r\n\r\n\tinit : function(s, cb, sc) {\r\n\t\tvar t = this, n, i, nl = document.getElementsByTagName('script');\r\n\r\n\t\tfor (n in s)\r\n\t\t\tt.settings[n] = s[n];\r\n\r\n\t\ts = t.settings;\r\n\r\n\t\tfor (i=0; i<nl.length; i++) {\r\n\t\t\tn = nl[i];\r\n\r\n\t\t\tif (n.src && n.src.indexOf('tiny_mce') != -1)\r\n\t\t\t\tt.baseURL = n.src.substring(0, n.src.lastIndexOf('/'));\r\n\t\t}\r\n\r\n\t\tif (!t.coreLoaded)\r\n\t\t\tt.loadScripts(1, s.themes, s.plugins, s.languages, cb, sc);\r\n\t},\r\n\r\n\tloadScripts : function(co, th, pl, la, cb, sc) {\r\n\t\tvar t = this, x, w = window, q, c = 0, ti, s = t.settings;\r\n\r\n\t\tfunction get(s) {\r\n\t\t\tx = 0;\r\n\r\n\t\t\ttry {\r\n\t\t\t\tx = new ActiveXObject(s);\r\n\t\t\t} catch (s) {\r\n\t\t\t}\r\n\r\n\t\t\treturn x;\r\n\t\t};\r\n\r\n\t\t// Build query string\r\n\t\tq = 'js=true&diskcache=' + (s.disk_cache ? 'true' : 'false') + '&core=' + (co ? 'true' : 'false') + '&suffix=' + escape(s.suffix) + '&themes=' + escape(th) + '&plugins=' + escape(pl) + '&languages=' + escape(la);\r\n\r\n\t\tif (co)\r\n\t\t\tt.coreLoaded = 1;\r\n\r\n\t\t// Send request\r\n\t\tx = w.XMLHttpRequest ? new XMLHttpRequest() : get('Msxml2.XMLHTTP') || get('Microsoft.XMLHTTP');\r\n\t\tx.overrideMimeType && x.overrideMimeType('text/javascript');\r\n\t\tx.open('GET', t.baseURL + '/' + s.page_name + '?' + q, !!cb);\r\n//\t\tx.setRequestHeader('Content-Type', 'text/javascript');\r\n\t\tx.send('');\r\n\r\n\t\t// Handle asyncronous loading\r\n\t\tif (cb) {\r\n\t\t\t// Wait for response\r\n\t\t\tti = w.setInterval(function() {\r\n\t\t\t\tif (x.readyState == 4 || c++ > 10000) {\r\n\t\t\t\t\tw.clearInterval(ti);\r\n\r\n\t\t\t\t\tif (c < 10000 && x.status == 200) {\r\n\t\t\t\t\t\tt.loaded = 1;\r\n\t\t\t\t\t\tt.eval(x.responseText);\r\n\t\t\t\t\t\ttinymce.dom.Event.domLoaded = true;\r\n\t\t\t\t\t\tcb.call(sc || t, x);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tti = x = null;\r\n\t\t\t\t}\r\n\t\t\t}, 10);\r\n\t\t} else\r\n\t\t\tt.eval(x.responseText);\r\n\t},\r\n\r\n\tstart : function() {\r\n\t\tvar t = this, each = tinymce.each, s = t.settings, ln = s.languages.split(',');\r\n\r\n\t\ttinymce.suffix = s.suffix;\r\n\r\n\t\tfunction load(u) {\r\n\t\t\ttinymce.ScriptLoader.markDone(tinyMCE.baseURI.toAbsolute(u));\r\n\t\t};\r\n\r\n\t\t// Add core languages\r\n\t\teach(ln, function(c) {\r\n\t\t\tif (c)\r\n\t\t\t\tload('langs/' + c + '.js');\r\n\t\t});\r\n\r\n\t\t// Add themes with languages\r\n\t\teach(s.themes.split(','), function(n) {\r\n\t\t\tif (n) {\r\n\t\t\t\tload('themes/' + n + '/editor_template' + s.suffix + '.js');\r\n\r\n\t\t\t\teach (ln, function(c) {\r\n\t\t\t\t\tif (c)\r\n\t\t\t\t\t\tload('themes/' + n + '/langs/' + c + '.js');\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Add plugins with languages\r\n\t\teach(s.plugins.split(','), function(n) {\r\n\t\t\tif (n) {\r\n\t\t\t\tload('plugins/' + n + '/editor_plugin' + s.suffix + '.js');\r\n\r\n\t\t\t\teach(ln, function(c) {\r\n\t\t\t\t\tif (c)\r\n\t\t\t\t\t\tload('plugins/' + n + '/langs/' + c + '.js');\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tend : function() {\r\n\t},\r\n\r\n\teval : function(co) {\r\n\t\tvar w = window;\r\n\r\n\t\t// Evaluate script\r\n\t\tif (!w.execScript) {\r\n\t\t\tif (/Gecko/.test(navigator.userAgent))\r\n\t\t\t\teval(co, w); // Firefox 3.0\r\n\t\t\telse\r\n\t\t\t\teval.call(w, co);\r\n\t\t} else\r\n\t\t\tw.execScript(co); // IE\r\n\t}\r\n};\r\n"
          },
          "redirectURL": "",
          "headersSize": 251,
          "bodySize": 1248
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-05-31T09:51:38.000Z",
            "lastAccess": "2012-05-30T09:51:38.000Z",
            "eTag": "",
            "hitCount": 18
          }
        },
        "timings": {
          "blocked": 10,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 5,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:38.986+04:00",
        "time": 6,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/images/ajax_loader.gif",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "image/png,image/*;q=0.8,*/*;q=0.5"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Sat, 15 Mar 2008 08:15:38 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 738,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Sat, 15 Mar 2008 08:15:38 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Fri, 29 Jun 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=2592000"
            }
          ],
          "content": {
            "mimeType": "image/gif",
            "size": 4178
          },
          "redirectURL": "",
          "headersSize": 253,
          "bodySize": 4178
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-06-29T09:51:38.000Z",
            "lastAccess": "2012-05-30T09:51:39.000Z",
            "eTag": "",
            "hitCount": 14
          }
        },
        "timings": {
          "blocked": 0,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 6,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:38.986+04:00",
        "time": 6,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/images/shadow-t.png",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "image/png,image/*;q=0.8,*/*;q=0.5"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Sun, 23 Mar 2008 14:24:42 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 735,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Sun, 23 Mar 2008 14:24:42 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Fri, 29 Jun 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=2592000"
            }
          ],
          "content": {
            "mimeType": "image/png",
            "size": 191
          },
          "redirectURL": "",
          "headersSize": 253,
          "bodySize": 191
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-06-29T09:51:38.000Z",
            "lastAccess": "2012-05-30T09:51:39.000Z",
            "eTag": "",
            "hitCount": 14
          }
        },
        "timings": {
          "blocked": 0,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 6,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:38.986+04:00",
        "time": 6,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/images/shadow-rt.png",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "image/png,image/*;q=0.8,*/*;q=0.5"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Sun, 23 Mar 2008 14:24:46 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 736,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Sun, 23 Mar 2008 14:24:46 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Fri, 29 Jun 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=2592000"
            }
          ],
          "content": {
            "mimeType": "image/png",
            "size": 391
          },
          "redirectURL": "",
          "headersSize": 253,
          "bodySize": 391
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-06-29T09:51:38.000Z",
            "lastAccess": "2012-05-30T09:51:39.000Z",
            "eTag": "",
            "hitCount": 14
          }
        },
        "timings": {
          "blocked": 0,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 6,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:38.986+04:00",
        "time": 6,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/images/shadow-rb.png",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "image/png,image/*;q=0.8,*/*;q=0.5"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Sun, 23 Mar 2008 14:24:54 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 736,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Sun, 23 Mar 2008 14:24:54 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Fri, 29 Jun 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=2592000"
            }
          ],
          "content": {
            "mimeType": "image/png",
            "size": 556
          },
          "redirectURL": "",
          "headersSize": 253,
          "bodySize": 556
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-06-29T09:51:38.000Z",
            "lastAccess": "2012-05-30T09:51:39.000Z",
            "eTag": "",
            "hitCount": 14
          }
        },
        "timings": {
          "blocked": 0,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 6,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:38.986+04:00",
        "time": 6,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/images/shadow-r.png",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "image/png,image/*;q=0.8,*/*;q=0.5"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Sun, 23 Mar 2008 14:25:00 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 735,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Sun, 23 Mar 2008 14:25:00 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Fri, 29 Jun 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=2592000"
            }
          ],
          "content": {
            "mimeType": "image/png",
            "size": 146
          },
          "redirectURL": "",
          "headersSize": 253,
          "bodySize": 146
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-06-29T09:51:38.000Z",
            "lastAccess": "2012-05-30T09:51:39.000Z",
            "eTag": "",
            "hitCount": 14
          }
        },
        "timings": {
          "blocked": 0,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 6,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:38.986+04:00",
        "time": 6,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/images/shadow-lt.png",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "image/png,image/*;q=0.8,*/*;q=0.5"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Sun, 23 Mar 2008 14:25:06 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 736,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Sun, 23 Mar 2008 14:25:06 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Fri, 29 Jun 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=2592000"
            }
          ],
          "content": {
            "mimeType": "image/png",
            "size": 373
          },
          "redirectURL": "",
          "headersSize": 253,
          "bodySize": 373
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-06-29T09:51:38.000Z",
            "lastAccess": "2012-05-30T09:51:39.000Z",
            "eTag": "",
            "hitCount": 14
          }
        },
        "timings": {
          "blocked": 0,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 6,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:38.986+04:00",
        "time": 12,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/images/shadow-lb.png",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "image/png,image/*;q=0.8,*/*;q=0.5"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Sun, 23 Mar 2008 14:25:14 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 736,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Sun, 23 Mar 2008 14:25:14 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Fri, 29 Jun 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=2592000"
            }
          ],
          "content": {
            "mimeType": "image/png",
            "size": 543
          },
          "redirectURL": "",
          "headersSize": 253,
          "bodySize": 543
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-06-29T09:51:38.000Z",
            "lastAccess": "2012-05-30T09:51:39.000Z",
            "eTag": "",
            "hitCount": 14
          }
        },
        "timings": {
          "blocked": 6,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 6,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:38.986+04:00",
        "time": 11,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/images/shadow-l.png",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "image/png,image/*;q=0.8,*/*;q=0.5"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Sun, 23 Mar 2008 14:25:20 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 735,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Sun, 23 Mar 2008 14:25:20 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Fri, 29 Jun 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=2592000"
            }
          ],
          "content": {
            "mimeType": "image/png",
            "size": 148
          },
          "redirectURL": "",
          "headersSize": 253,
          "bodySize": 148
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-06-29T09:51:38.000Z",
            "lastAccess": "2012-05-30T09:51:39.000Z",
            "eTag": "",
            "hitCount": 14
          }
        },
        "timings": {
          "blocked": 6,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 5,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:38.987+04:00",
        "time": 11,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/images/shadow-b.png",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "image/png,image/*;q=0.8,*/*;q=0.5"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Sun, 23 Mar 2008 14:24:14 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 735,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Sun, 23 Mar 2008 14:24:14 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Fri, 29 Jun 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=2592000"
            }
          ],
          "content": {
            "mimeType": "image/png",
            "size": 220
          },
          "redirectURL": "",
          "headersSize": 253,
          "bodySize": 220
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-06-29T09:51:38.000Z",
            "lastAccess": "2012-05-30T09:51:39.000Z",
            "eTag": "",
            "hitCount": 14
          }
        },
        "timings": {
          "blocked": 5,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 6,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:39.019+04:00",
        "time": 46,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/wysiwyg/tiny_mce_gzip.php?js=true&diskcache=true&core=true&suffix=_src&themes=advanced&plugins=safari%2Cpagebreak%2Cstyle%2Clayer%2Ctable%2Csave%2Cadvhr%2Cadvimage%2Cadvlink%2Cemotions%2Ciespell%2Cinsertdatetime%2Cpreview%2Cmedia%2Csearchreplace%2Cprint%2Ccontextmenu%2Cpaste%2Cdirectionality%2Cfullscreen%2Cnoneditable%2Cvisualchars%2Cnonbreaking%2Cxhtmlxtras%2Ctemplate%2Cinlinepopups&languages=ru",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [
            {
              "name": "core",
              "value": "true"
            },
            {
              "name": "diskcache",
              "value": "true"
            },
            {
              "name": "js",
              "value": "true"
            },
            {
              "name": "languages",
              "value": "ru"
            },
            {
              "name": "plugins",
              "value": "safari,pagebreak,style,layer,table,save,advhr,advimage,advlink,emotions,iespell,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,xhtmlxtras,template,inlinepopups"
            },
            {
              "name": "suffix",
              "value": "_src"
            },
            {
              "name": "themes",
              "value": "advanced"
            }
          ],
          "headersSize": 1095,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Content-Type",
              "value": "text/javascript"
            },
            {
              "name": "Transfer-Encoding",
              "value": "chunked"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "X-Powered-By",
              "value": "PHP/5.2.17"
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Expires",
              "value": "Sat, 09 Jun 2012 09:51:41 GMT"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            }
          ],
          "content": {
            "mimeType": "text/javascript",
            "size": 577424,
            "text": "(function(win) {\r\n\tvar whiteSpaceRe = /^\\s*|\\s*$/g,\r\n\t\tundefined;\r\n\r\n\tvar tinymce = {\r\n\t\tmajorVersion : '3',\r\n\r\n\t\tminorVersion : '3.9',\r\n\r\n\t\treleaseDate : '2010-09-08',\r\n\r\n\t\t_init : function() {\r\n\t\t\tvar t = this, d = document, na = navigator, ua = na.userAgent, i, nl, n, base, p, v;\r\n\r\n\t\t\tt.isOpera = win.opera && opera.buildNumber;\r\n\r\n\t\t\tt.isWebKit = /WebKit/.test(ua);\r\n\r\n\t\t\tt.isIE = !t.isWebKit && !t.isOpera && (/MSIE/gi).test(ua) && (/Explorer/gi).test(na.appName);\r\n\r\n\t\t\tt.isIE6 = t.isIE && /MSIE [56]/.test(ua);\r\n\r\n\t\t\tt.isGecko = !t.isWebKit && /Gecko/.test(ua);\r\n\r\n\t\t\tt.isMac = ua.indexOf('Mac') != -1;\r\n\r\n\t\t\tt.isAir = /adobeair/i.test(ua);\r\n\r\n\t\t\tt.isIDevice = /(iPad|iPhone)/.test(ua);\r\n\r\n\t\t\t// TinyMCE .NET webcontrol might be setting the values for TinyMCE\r\n\t\t\tif (win.tinyMCEPreInit) {\r\n\t\t\t\tt.suffix = tinyMCEPreInit.suffix;\r\n\t\t\t\tt.baseURL = tinyMCEPreInit.base;\r\n\t\t\t\tt.query = tinyMCEPreInit.query;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Get suffix and base\r\n\t\t\tt.suffix = '';\r\n\r\n\t\t\t// If base element found, add that infront of baseURL\r\n\t\t\tnl = d.getElementsByTagName('base');\r\n\t\t\tfor (i=0; i<nl.length; i++) {\r\n\t\t\t\tif (v = nl[i].href) {\r\n\t\t\t\t\t// Host only value like http://site.com or http://site.com:8008\r\n\t\t\t\t\tif (/^https?:\\/\\/[^\\/]+$/.test(v))\r\n\t\t\t\t\t\tv += '/';\r\n\r\n\t\t\t\t\tbase = v ? v.match(/.*\\//)[0] : ''; // Get only directory\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction getBase(n) {\r\n\t\t\t\tif (n.src && /tiny_mce(|_gzip|_jquery|_prototype|_full)(_dev|_src)?.js/.test(n.src)) {\r\n\t\t\t\t\tif (/_(src|dev)\\.js/g.test(n.src))\r\n\t\t\t\t\t\tt.suffix = '_src';\r\n\r\n\t\t\t\t\tif ((p = n.src.indexOf('?')) != -1)\r\n\t\t\t\t\t\tt.query = n.src.substring(p + 1);\r\n\r\n\t\t\t\t\tt.baseURL = n.src.substring(0, n.src.lastIndexOf('/'));\r\n\r\n\t\t\t\t\t// If path to script is relative and a base href was found add that one infront\r\n\t\t\t\t\t// the src property will always be an absolute one on non IE browsers and IE 8\r\n\t\t\t\t\t// so this logic will basically only be executed on older IE versions\r\n\t\t\t\t\tif (base && t.baseURL.indexOf('://') == -1 && t.baseURL.indexOf('/') !== 0)\r\n\t\t\t\t\t\tt.baseURL = base + t.baseURL;\r\n\r\n\t\t\t\t\treturn t.baseURL;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn null;\r\n\t\t\t};\r\n\r\n\t\t\t// Check document\r\n\t\t\tnl = d.getElementsByTagName('script');\r\n\t\t\tfor (i=0; i<nl.length; i++) {\r\n\t\t\t\tif (getBase(nl[i]))\r\n\t\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Check head\r\n\t\t\tn = d.getElementsByTagName('head')[0];\r\n\t\t\tif (n) {\r\n\t\t\t\tnl = n.getElementsByTagName('script');\r\n\t\t\t\tfor (i=0; i<nl.length; i++) {\r\n\t\t\t\t\tif (getBase(nl[i]))\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn;\r\n\t\t},\r\n\r\n\t\tis : function(o, t) {\r\n\t\t\tif (!t)\r\n\t\t\t\treturn o !== undefined;\r\n\r\n\t\t\tif (t == 'array' && (o.hasOwnProperty && o instanceof Array))\r\n\t\t\t\treturn true;\r\n\r\n\t\t\treturn typeof(o) == t;\r\n\t\t},\r\n\r\n\t\teach : function(o, cb, s) {\r\n\t\t\tvar n, l;\r\n\r\n\t\t\tif (!o)\r\n\t\t\t\treturn 0;\r\n\r\n\t\t\ts = s || o;\r\n\r\n\t\t\tif (o.length !== undefined) {\r\n\t\t\t\t// Indexed arrays, needed for Safari\r\n\t\t\t\tfor (n=0, l = o.length; n < l; n++) {\r\n\t\t\t\t\tif (cb.call(s, o[n], n, o) === false)\r\n\t\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// Hashtables\r\n\t\t\t\tfor (n in o) {\r\n\t\t\t\t\tif (o.hasOwnProperty(n)) {\r\n\t\t\t\t\t\tif (cb.call(s, o[n], n, o) === false)\r\n\t\t\t\t\t\t\treturn 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn 1;\r\n\t\t},\r\n\r\n\r\n\t\tmap : function(a, f) {\r\n\t\t\tvar o = [];\r\n\r\n\t\t\ttinymce.each(a, function(v) {\r\n\t\t\t\to.push(f(v));\r\n\t\t\t});\r\n\r\n\t\t\treturn o;\r\n\t\t},\r\n\r\n\t\tgrep : function(a, f) {\r\n\t\t\tvar o = [];\r\n\r\n\t\t\ttinymce.each(a, function(v) {\r\n\t\t\t\tif (!f || f(v))\r\n\t\t\t\t\to.push(v);\r\n\t\t\t});\r\n\r\n\t\t\treturn o;\r\n\t\t},\r\n\r\n\t\tinArray : function(a, v) {\r\n\t\t\tvar i, l;\r\n\r\n\t\t\tif (a) {\r\n\t\t\t\tfor (i = 0, l = a.length; i < l; i++) {\r\n\t\t\t\t\tif (a[i] === v)\r\n\t\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn -1;\r\n\t\t},\r\n\r\n\t\textend : function(o, e) {\r\n\t\t\tvar i, l, a = arguments;\r\n\r\n\t\t\tfor (i = 1, l = a.length; i < l; i++) {\r\n\t\t\t\te = a[i];\r\n\r\n\t\t\t\ttinymce.each(e, function(v, n) {\r\n\t\t\t\t\tif (v !== undefined)\r\n\t\t\t\t\t\to[n] = v;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn o;\r\n\t\t},\r\n\r\n\r\n\t\ttrim : function(s) {\r\n\t\t\treturn (s ? '' + s : '').replace(whiteSpaceRe, '');\r\n\t\t},\r\n\r\n\t\tcreate : function(s, p) {\r\n\t\t\tvar t = this, sp, ns, cn, scn, c, de = 0;\r\n\r\n\t\t\t// Parse : <prefix> <class>:<super class>\r\n\t\t\ts = /^((static) )?([\\w.]+)(:([\\w.]+))?/.exec(s);\r\n\t\t\tcn = s[3].match(/(^|\\.)(\\w+)$/i)[2]; // Class name\r\n\r\n\t\t\t// Create namespace for new class\r\n\t\t\tns = t.createNS(s[3].replace(/\\.\\w+$/, ''));\r\n\r\n\t\t\t// Class already exists\r\n\t\t\tif (ns[cn])\r\n\t\t\t\treturn;\r\n\r\n\t\t\t// Make pure static class\r\n\t\t\tif (s[2] == 'static') {\r\n\t\t\t\tns[cn] = p;\r\n\r\n\t\t\t\tif (this.onCreate)\r\n\t\t\t\t\tthis.onCreate(s[2], s[3], ns[cn]);\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Create default constructor\r\n\t\t\tif (!p[cn]) {\r\n\t\t\t\tp[cn] = function() {};\r\n\t\t\t\tde = 1;\r\n\t\t\t}\r\n\r\n\t\t\t// Add constructor and methods\r\n\t\t\tns[cn] = p[cn];\r\n\t\t\tt.extend(ns[cn].prototype, p);\r\n\r\n\t\t\t// Extend\r\n\t\t\tif (s[5]) {\r\n\t\t\t\tsp = t.resolve(s[5]).prototype;\r\n\t\t\t\tscn = s[5].match(/\\.(\\w+)$/i)[1]; // Class name\r\n\r\n\t\t\t\t// Extend constructor\r\n\t\t\t\tc = ns[cn];\r\n\t\t\t\tif (de) {\r\n\t\t\t\t\t// Add passthrough constructor\r\n\t\t\t\t\tns[cn] = function() {\r\n\t\t\t\t\t\treturn sp[scn].apply(this, arguments);\r\n\t\t\t\t\t};\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Add inherit constructor\r\n\t\t\t\t\tns[cn] = function() {\r\n\t\t\t\t\t\tthis.parent = sp[scn];\r\n\t\t\t\t\t\treturn c.apply(this, arguments);\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tns[cn].prototype[cn] = ns[cn];\r\n\r\n\t\t\t\t// Add super methods\r\n\t\t\t\tt.each(sp, function(f, n) {\r\n\t\t\t\t\tns[cn].prototype[n] = sp[n];\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Add overridden methods\r\n\t\t\t\tt.each(p, function(f, n) {\r\n\t\t\t\t\t// Extend methods if needed\r\n\t\t\t\t\tif (sp[n]) {\r\n\t\t\t\t\t\tns[cn].prototype[n] = function() {\r\n\t\t\t\t\t\t\tthis.parent = sp[n];\r\n\t\t\t\t\t\t\treturn f.apply(this, arguments);\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (n != cn)\r\n\t\t\t\t\t\t\tns[cn].prototype[n] = f;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Add static methods\r\n\t\t\tt.each(p['static'], function(f, n) {\r\n\t\t\t\tns[cn][n] = f;\r\n\t\t\t});\r\n\r\n\t\t\tif (this.onCreate)\r\n\t\t\t\tthis.onCreate(s[2], s[3], ns[cn].prototype);\r\n\t\t},\r\n\r\n\t\twalk : function(o, f, n, s) {\r\n\t\t\ts = s || this;\r\n\r\n\t\t\tif (o) {\r\n\t\t\t\tif (n)\r\n\t\t\t\t\to = o[n];\r\n\r\n\t\t\t\ttinymce.each(o, function(o, i) {\r\n\t\t\t\t\tif (f.call(s, o, i, n) === false)\r\n\t\t\t\t\t\treturn false;\r\n\r\n\t\t\t\t\ttinymce.walk(o, f, n, s);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tcreateNS : function(n, o) {\r\n\t\t\tvar i, v;\r\n\r\n\t\t\to = o || win;\r\n\r\n\t\t\tn = n.split('.');\r\n\t\t\tfor (i=0; i<n.length; i++) {\r\n\t\t\t\tv = n[i];\r\n\r\n\t\t\t\tif (!o[v])\r\n\t\t\t\t\to[v] = {};\r\n\r\n\t\t\t\to = o[v];\r\n\t\t\t}\r\n\r\n\t\t\treturn o;\r\n\t\t},\r\n\r\n\t\tresolve : function(n, o) {\r\n\t\t\tvar i, l;\r\n\r\n\t\t\to = o || win;\r\n\r\n\t\t\tn = n.split('.');\r\n\t\t\tfor (i = 0, l = n.length; i < l; i++) {\r\n\t\t\t\to = o[n[i]];\r\n\r\n\t\t\t\tif (!o)\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\treturn o;\r\n\t\t},\r\n\r\n\t\taddUnload : function(f, s) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tf = {func : f, scope : s || this};\r\n\r\n\t\t\tif (!t.unloads) {\r\n\t\t\t\tfunction unload() {\r\n\t\t\t\t\tvar li = t.unloads, o, n;\r\n\r\n\t\t\t\t\tif (li) {\r\n\t\t\t\t\t\t// Call unload handlers\r\n\t\t\t\t\t\tfor (n in li) {\r\n\t\t\t\t\t\t\to = li[n];\r\n\r\n\t\t\t\t\t\t\tif (o && o.func)\r\n\t\t\t\t\t\t\t\to.func.call(o.scope, 1); // Send in one arg to distinct unload and user destroy\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Detach unload function\r\n\t\t\t\t\t\tif (win.detachEvent) {\r\n\t\t\t\t\t\t\twin.detachEvent('onbeforeunload', fakeUnload);\r\n\t\t\t\t\t\t\twin.detachEvent('onunload', unload);\r\n\t\t\t\t\t\t} else if (win.removeEventListener)\r\n\t\t\t\t\t\t\twin.removeEventListener('unload', unload, false);\r\n\r\n\t\t\t\t\t\t// Destroy references\r\n\t\t\t\t\t\tt.unloads = o = li = w = unload = 0;\r\n\r\n\t\t\t\t\t\t// Run garbarge collector on IE\r\n\t\t\t\t\t\tif (win.CollectGarbage)\r\n\t\t\t\t\t\t\tCollectGarbage();\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\tfunction fakeUnload() {\r\n\t\t\t\t\tvar d = document;\r\n\r\n\t\t\t\t\t// Is there things still loading, then do some magic\r\n\t\t\t\t\tif (d.readyState == 'interactive') {\r\n\t\t\t\t\t\tfunction stop() {\r\n\t\t\t\t\t\t\t// Prevent memory leak\r\n\t\t\t\t\t\t\td.detachEvent('onstop', stop);\r\n\r\n\t\t\t\t\t\t\t// Call unload handler\r\n\t\t\t\t\t\t\tif (unload)\r\n\t\t\t\t\t\t\t\tunload();\r\n\r\n\t\t\t\t\t\t\td = 0;\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t// Fire unload when the currently loading page is stopped\r\n\t\t\t\t\t\tif (d)\r\n\t\t\t\t\t\t\td.attachEvent('onstop', stop);\r\n\r\n\t\t\t\t\t\t// Remove onstop listener after a while to prevent the unload function\r\n\t\t\t\t\t\t// to execute if the user presses cancel in an onbeforeunload\r\n\t\t\t\t\t\t// confirm dialog and then presses the browser stop button\r\n\t\t\t\t\t\twin.setTimeout(function() {\r\n\t\t\t\t\t\t\tif (d)\r\n\t\t\t\t\t\t\t\td.detachEvent('onstop', stop);\r\n\t\t\t\t\t\t}, 0);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Attach unload handler\r\n\t\t\t\tif (win.attachEvent) {\r\n\t\t\t\t\twin.attachEvent('onunload', unload);\r\n\t\t\t\t\twin.attachEvent('onbeforeunload', fakeUnload);\r\n\t\t\t\t} else if (win.addEventListener)\r\n\t\t\t\t\twin.addEventListener('unload', unload, false);\r\n\r\n\t\t\t\t// Setup initial unload handler array\r\n\t\t\t\tt.unloads = [f];\r\n\t\t\t} else\r\n\t\t\t\tt.unloads.push(f);\r\n\r\n\t\t\treturn f;\r\n\t\t},\r\n\r\n\t\tremoveUnload : function(f) {\r\n\t\t\tvar u = this.unloads, r = null;\r\n\r\n\t\t\ttinymce.each(u, function(o, i) {\r\n\t\t\t\tif (o && o.func == f) {\r\n\t\t\t\t\tu.splice(i, 1);\r\n\t\t\t\t\tr = f;\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn r;\r\n\t\t},\r\n\r\n\t\texplode : function(s, d) {\r\n\t\t\treturn s ? tinymce.map(s.split(d || ','), tinymce.trim) : s;\r\n\t\t},\r\n\r\n\t\t_addVer : function(u) {\r\n\t\t\tvar v;\r\n\r\n\t\t\tif (!this.query)\r\n\t\t\t\treturn u;\r\n\r\n\t\t\tv = (u.indexOf('?') == -1 ? '?' : '&') + this.query;\r\n\r\n\t\t\tif (u.indexOf('#') == -1)\r\n\t\t\t\treturn u + v;\r\n\r\n\t\t\treturn u.replace('#', v + '#');\r\n\t\t}\r\n\r\n\t\t};\r\n\r\n\t// Initialize the API\r\n\ttinymce._init();\r\n\r\n\t// Expose tinymce namespace to the global namespace (window)\r\n\twin.tinymce = win.tinyMCE = tinymce;\r\n})(window);\r\n\r\n\r\ntinymce.create('tinymce.util.Dispatcher', {\r\n\tscope : null,\r\n\tlisteners : null,\r\n\r\n\tDispatcher : function(s) {\r\n\t\tthis.scope = s || this;\r\n\t\tthis.listeners = [];\r\n\t},\r\n\r\n\tadd : function(cb, s) {\r\n\t\tthis.listeners.push({cb : cb, scope : s || this.scope});\r\n\r\n\t\treturn cb;\r\n\t},\r\n\r\n\taddToTop : function(cb, s) {\r\n\t\tthis.listeners.unshift({cb : cb, scope : s || this.scope});\r\n\r\n\t\treturn cb;\r\n\t},\r\n\r\n\tremove : function(cb) {\r\n\t\tvar l = this.listeners, o = null;\r\n\r\n\t\ttinymce.each(l, function(c, i) {\r\n\t\t\tif (cb == c.cb) {\r\n\t\t\t\to = cb;\r\n\t\t\t\tl.splice(i, 1);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn o;\r\n\t},\r\n\r\n\tdispatch : function() {\r\n\t\tvar s, a = arguments, i, li = this.listeners, c;\r\n\r\n\t\t// Needs to be a real loop since the listener count might change while looping\r\n\t\t// And this is also more efficient\r\n\t\tfor (i = 0; i<li.length; i++) {\r\n\t\t\tc = li[i];\r\n\t\t\ts = c.cb.apply(c.scope, a);\r\n\r\n\t\t\tif (s === false)\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn s;\r\n\t}\r\n\r\n\t});\r\n\r\n(function() {\r\n\tvar each = tinymce.each;\r\n\r\n\ttinymce.create('tinymce.util.URI', {\r\n\t\tURI : function(u, s) {\r\n\t\t\tvar t = this, o, a, b;\r\n\r\n\t\t\t// Trim whitespace\r\n\t\t\tu = tinymce.trim(u);\r\n\r\n\t\t\t// Default settings\r\n\t\t\ts = t.settings = s || {};\r\n\r\n\t\t\t// Strange app protocol or local anchor\r\n\t\t\tif (/^(mailto|tel|news|javascript|about|data):/i.test(u) || /^\\s*#/.test(u)) {\r\n\t\t\t\tt.source = u;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Absolute path with no host, fake host and protocol\r\n\t\t\tif (u.indexOf('/') === 0 && u.indexOf('//') !== 0)\r\n\t\t\t\tu = (s.base_uri ? s.base_uri.protocol || 'http' : 'http') + '://mce_host' + u;\r\n\r\n\t\t\t// Relative path http:// or protocol relative //path\r\n\t\t\tif (!/^\\w*:?\\/\\//.test(u))\r\n\t\t\t\tu = (s.base_uri.protocol || 'http') + '://mce_host' + t.toAbsPath(s.base_uri.path, u);\r\n\r\n\t\t\t// Parse URL (Credits goes to Steave, http://blog.stevenlevithan.com/archives/parseuri)\r\n\t\t\tu = u.replace(/@@/g, '(mce_at)'); // Zope 3 workaround, they use @@something\r\n\t\t\tu = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/.exec(u);\r\n\t\t\teach([\"source\",\"protocol\",\"authority\",\"userInfo\",\"user\",\"password\",\"host\",\"port\",\"relative\",\"path\",\"directory\",\"file\",\"query\",\"anchor\"], function(v, i) {\r\n\t\t\t\tvar s = u[i];\r\n\r\n\t\t\t\t// Zope 3 workaround, they use @@something\r\n\t\t\t\tif (s)\r\n\t\t\t\t\ts = s.replace(/\\(mce_at\\)/g, '@@');\r\n\r\n\t\t\t\tt[v] = s;\r\n\t\t\t});\r\n\r\n\t\t\tif (b = s.base_uri) {\r\n\t\t\t\tif (!t.protocol)\r\n\t\t\t\t\tt.protocol = b.protocol;\r\n\r\n\t\t\t\tif (!t.userInfo)\r\n\t\t\t\t\tt.userInfo = b.userInfo;\r\n\r\n\t\t\t\tif (!t.port && t.host == 'mce_host')\r\n\t\t\t\t\tt.port = b.port;\r\n\r\n\t\t\t\tif (!t.host || t.host == 'mce_host')\r\n\t\t\t\t\tt.host = b.host;\r\n\r\n\t\t\t\tt.source = '';\r\n\t\t\t}\r\n\r\n\t\t\t//t.path = t.path || '/';\r\n\t\t},\r\n\r\n\t\tsetPath : function(p) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tp = /^(.*?)\\/?(\\w+)?$/.exec(p);\r\n\r\n\t\t\t// Update path parts\r\n\t\t\tt.path = p[0];\r\n\t\t\tt.directory = p[1];\r\n\t\t\tt.file = p[2];\r\n\r\n\t\t\t// Rebuild source\r\n\t\t\tt.source = '';\r\n\t\t\tt.getURI();\r\n\t\t},\r\n\r\n\t\ttoRelative : function(u) {\r\n\t\t\tvar t = this, o;\r\n\r\n\t\t\tif (u === \"./\")\r\n\t\t\t\treturn u;\r\n\r\n\t\t\tu = new tinymce.util.URI(u, {base_uri : t});\r\n\r\n\t\t\t// Not on same domain/port or protocol\r\n\t\t\tif ((u.host != 'mce_host' && t.host != u.host && u.host) || t.port != u.port || t.protocol != u.protocol)\r\n\t\t\t\treturn u.getURI();\r\n\r\n\t\t\to = t.toRelPath(t.path, u.path);\r\n\r\n\t\t\t// Add query\r\n\t\t\tif (u.query)\r\n\t\t\t\to += '?' + u.query;\r\n\r\n\t\t\t// Add anchor\r\n\t\t\tif (u.anchor)\r\n\t\t\t\to += '#' + u.anchor;\r\n\r\n\t\t\treturn o;\r\n\t\t},\r\n\t\r\n\t\ttoAbsolute : function(u, nh) {\r\n\t\t\tvar u = new tinymce.util.URI(u, {base_uri : this});\r\n\r\n\t\t\treturn u.getURI(this.host == u.host && this.protocol == u.protocol ? nh : 0);\r\n\t\t},\r\n\r\n\t\ttoRelPath : function(base, path) {\r\n\t\t\tvar items, bp = 0, out = '', i, l;\r\n\r\n\t\t\t// Split the paths\r\n\t\t\tbase = base.substring(0, base.lastIndexOf('/'));\r\n\t\t\tbase = base.split('/');\r\n\t\t\titems = path.split('/');\r\n\r\n\t\t\tif (base.length >= items.length) {\r\n\t\t\t\tfor (i = 0, l = base.length; i < l; i++) {\r\n\t\t\t\t\tif (i >= items.length || base[i] != items[i]) {\r\n\t\t\t\t\t\tbp = i + 1;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (base.length < items.length) {\r\n\t\t\t\tfor (i = 0, l = items.length; i < l; i++) {\r\n\t\t\t\t\tif (i >= base.length || base[i] != items[i]) {\r\n\t\t\t\t\t\tbp = i + 1;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (bp == 1)\r\n\t\t\t\treturn path;\r\n\r\n\t\t\tfor (i = 0, l = base.length - (bp - 1); i < l; i++)\r\n\t\t\t\tout += \"../\";\r\n\r\n\t\t\tfor (i = bp - 1, l = items.length; i < l; i++) {\r\n\t\t\t\tif (i != bp - 1)\r\n\t\t\t\t\tout += \"/\" + items[i];\r\n\t\t\t\telse\r\n\t\t\t\t\tout += items[i];\r\n\t\t\t}\r\n\r\n\t\t\treturn out;\r\n\t\t},\r\n\r\n\t\ttoAbsPath : function(base, path) {\r\n\t\t\tvar i, nb = 0, o = [], tr, outPath;\r\n\r\n\t\t\t// Split paths\r\n\t\t\ttr = /\\/$/.test(path) ? '/' : '';\r\n\t\t\tbase = base.split('/');\r\n\t\t\tpath = path.split('/');\r\n\r\n\t\t\t// Remove empty chunks\r\n\t\t\teach(base, function(k) {\r\n\t\t\t\tif (k)\r\n\t\t\t\t\to.push(k);\r\n\t\t\t});\r\n\r\n\t\t\tbase = o;\r\n\r\n\t\t\t// Merge relURLParts chunks\r\n\t\t\tfor (i = path.length - 1, o = []; i >= 0; i--) {\r\n\t\t\t\t// Ignore empty or .\r\n\t\t\t\tif (path[i].length == 0 || path[i] == \".\")\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t// Is parent\r\n\t\t\t\tif (path[i] == '..') {\r\n\t\t\t\t\tnb++;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Move up\r\n\t\t\t\tif (nb > 0) {\r\n\t\t\t\t\tnb--;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\to.push(path[i]);\r\n\t\t\t}\r\n\r\n\t\t\ti = base.length - nb;\r\n\r\n\t\t\t// If /a/b/c or /\r\n\t\t\tif (i <= 0)\r\n\t\t\t\toutPath = o.reverse().join('/');\r\n\t\t\telse\r\n\t\t\t\toutPath = base.slice(0, i).join('/') + '/' + o.reverse().join('/');\r\n\r\n\t\t\t// Add front / if it's needed\r\n\t\t\tif (outPath.indexOf('/') !== 0)\r\n\t\t\t\toutPath = '/' + outPath;\r\n\r\n\t\t\t// Add traling / if it's needed\r\n\t\t\tif (tr && outPath.lastIndexOf('/') !== outPath.length - 1)\r\n\t\t\t\toutPath += tr;\r\n\r\n\t\t\treturn outPath;\r\n\t\t},\r\n\r\n\t\tgetURI : function(nh) {\r\n\t\t\tvar s, t = this;\r\n\r\n\t\t\t// Rebuild source\r\n\t\t\tif (!t.source || nh) {\r\n\t\t\t\ts = '';\r\n\r\n\t\t\t\tif (!nh) {\r\n\t\t\t\t\tif (t.protocol)\r\n\t\t\t\t\t\ts += t.protocol + '://';\r\n\r\n\t\t\t\t\tif (t.userInfo)\r\n\t\t\t\t\t\ts += t.userInfo + '@';\r\n\r\n\t\t\t\t\tif (t.host)\r\n\t\t\t\t\t\ts += t.host;\r\n\r\n\t\t\t\t\tif (t.port)\r\n\t\t\t\t\t\ts += ':' + t.port;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (t.path)\r\n\t\t\t\t\ts += t.path;\r\n\r\n\t\t\t\tif (t.query)\r\n\t\t\t\t\ts += '?' + t.query;\r\n\r\n\t\t\t\tif (t.anchor)\r\n\t\t\t\t\ts += '#' + t.anchor;\r\n\r\n\t\t\t\tt.source = s;\r\n\t\t\t}\r\n\r\n\t\t\treturn t.source;\r\n\t\t}\r\n\t});\r\n})();\r\n\r\n(function() {\r\n\tvar each = tinymce.each;\r\n\r\n\ttinymce.create('static tinymce.util.Cookie', {\r\n\t\tgetHash : function(n) {\r\n\t\t\tvar v = this.get(n), h;\r\n\r\n\t\t\tif (v) {\r\n\t\t\t\teach(v.split('&'), function(v) {\r\n\t\t\t\t\tv = v.split('=');\r\n\t\t\t\t\th = h || {};\r\n\t\t\t\t\th[unescape(v[0])] = unescape(v[1]);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn h;\r\n\t\t},\r\n\r\n\t\tsetHash : function(n, v, e, p, d, s) {\r\n\t\t\tvar o = '';\r\n\r\n\t\t\teach(v, function(v, k) {\r\n\t\t\t\to += (!o ? '' : '&') + escape(k) + '=' + escape(v);\r\n\t\t\t});\r\n\r\n\t\t\tthis.set(n, o, e, p, d, s);\r\n\t\t},\r\n\r\n\t\tget : function(n) {\r\n\t\t\tvar c = document.cookie, e, p = n + \"=\", b;\r\n\r\n\t\t\t// Strict mode\r\n\t\t\tif (!c)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tb = c.indexOf(\"; \" + p);\r\n\r\n\t\t\tif (b == -1) {\r\n\t\t\t\tb = c.indexOf(p);\r\n\r\n\t\t\t\tif (b != 0)\r\n\t\t\t\t\treturn null;\r\n\t\t\t} else\r\n\t\t\t\tb += 2;\r\n\r\n\t\t\te = c.indexOf(\";\", b);\r\n\r\n\t\t\tif (e == -1)\r\n\t\t\t\te = c.length;\r\n\r\n\t\t\treturn unescape(c.substring(b + p.length, e));\r\n\t\t},\r\n\r\n\t\tset : function(n, v, e, p, d, s) {\r\n\t\t\tdocument.cookie = n + \"=\" + escape(v) +\r\n\t\t\t\t((e) ? \"; expires=\" + e.toGMTString() : \"\") +\r\n\t\t\t\t((p) ? \"; path=\" + escape(p) : \"\") +\r\n\t\t\t\t((d) ? \"; domain=\" + d : \"\") +\r\n\t\t\t\t((s) ? \"; secure\" : \"\");\r\n\t\t},\r\n\r\n\t\tremove : function(n, p) {\r\n\t\t\tvar d = new Date();\r\n\r\n\t\t\td.setTime(d.getTime() - 1000);\r\n\r\n\t\t\tthis.set(n, '', d, p, d);\r\n\t\t}\r\n\t});\r\n})();\r\n\r\ntinymce.create('static tinymce.util.JSON', {\r\n\tserialize : function(o) {\r\n\t\tvar i, v, s = tinymce.util.JSON.serialize, t;\r\n\r\n\t\tif (o == null)\r\n\t\t\treturn 'null';\r\n\r\n\t\tt = typeof o;\r\n\r\n\t\tif (t == 'string') {\r\n\t\t\tv = '\\bb\\tt\\nn\\ff\\rr\\\"\"\\'\\'\\\\\\\\';\r\n\r\n\t\t\treturn '\"' + o.replace(/([\\u0080-\\uFFFF\\x00-\\x1f\\\"])/g, function(a, b) {\r\n\t\t\t\ti = v.indexOf(b);\r\n\r\n\t\t\t\tif (i + 1)\r\n\t\t\t\t\treturn '\\\\' + v.charAt(i + 1);\r\n\r\n\t\t\t\ta = b.charCodeAt().toString(16);\r\n\r\n\t\t\t\treturn '\\\\u' + '0000'.substring(a.length) + a;\r\n\t\t\t}) + '\"';\r\n\t\t}\r\n\r\n\t\tif (t == 'object') {\r\n\t\t\tif (o.hasOwnProperty && o instanceof Array) {\r\n\t\t\t\t\tfor (i=0, v = '['; i<o.length; i++)\r\n\t\t\t\t\t\tv += (i > 0 ? ',' : '') + s(o[i]);\r\n\r\n\t\t\t\t\treturn v + ']';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tv = '{';\r\n\r\n\t\t\t\tfor (i in o)\r\n\t\t\t\t\tv += typeof o[i] != 'function' ? (v.length > 1 ? ',\"' : '\"') + i + '\":' + s(o[i]) : '';\r\n\r\n\t\t\t\treturn v + '}';\r\n\t\t}\r\n\r\n\t\treturn '' + o;\r\n\t},\r\n\r\n\tparse : function(s) {\r\n\t\ttry {\r\n\t\t\treturn eval('(' + s + ')');\r\n\t\t} catch (ex) {\r\n\t\t\t// Ignore\r\n\t\t}\r\n\t}\r\n\r\n\t});\r\n\r\ntinymce.create('static tinymce.util.XHR', {\r\n\tsend : function(o) {\r\n\t\tvar x, t, w = window, c = 0;\r\n\r\n\t\t// Default settings\r\n\t\to.scope = o.scope || this;\r\n\t\to.success_scope = o.success_scope || o.scope;\r\n\t\to.error_scope = o.error_scope || o.scope;\r\n\t\to.async = o.async === false ? false : true;\r\n\t\to.data = o.data || '';\r\n\r\n\t\tfunction get(s) {\r\n\t\t\tx = 0;\r\n\r\n\t\t\ttry {\r\n\t\t\t\tx = new ActiveXObject(s);\r\n\t\t\t} catch (ex) {\r\n\t\t\t}\r\n\r\n\t\t\treturn x;\r\n\t\t};\r\n\r\n\t\tx = w.XMLHttpRequest ? new XMLHttpRequest() : get('Microsoft.XMLHTTP') || get('Msxml2.XMLHTTP');\r\n\r\n\t\tif (x) {\r\n\t\t\tif (x.overrideMimeType)\r\n\t\t\t\tx.overrideMimeType(o.content_type);\r\n\r\n\t\t\tx.open(o.type || (o.data ? 'POST' : 'GET'), o.url, o.async);\r\n\r\n\t\t\tif (o.content_type)\r\n\t\t\t\tx.setRequestHeader('Content-Type', o.content_type);\r\n\r\n\t\t\tx.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\r\n\r\n\t\t\tx.send(o.data);\r\n\r\n\t\t\tfunction ready() {\r\n\t\t\t\tif (!o.async || x.readyState == 4 || c++ > 10000) {\r\n\t\t\t\t\tif (o.success && c < 10000 && x.status == 200)\r\n\t\t\t\t\t\to.success.call(o.success_scope, '' + x.responseText, x, o);\r\n\t\t\t\t\telse if (o.error)\r\n\t\t\t\t\t\to.error.call(o.error_scope, c > 10000 ? 'TIMED_OUT' : 'GENERAL', x, o);\r\n\r\n\t\t\t\t\tx = null;\r\n\t\t\t\t} else\r\n\t\t\t\t\tw.setTimeout(ready, 10);\r\n\t\t\t};\r\n\r\n\t\t\t// Syncronous request\r\n\t\t\tif (!o.async)\r\n\t\t\t\treturn ready();\r\n\r\n\t\t\t// Wait for response, onReadyStateChange can not be used since it leaks memory in IE\r\n\t\t\tt = w.setTimeout(ready, 10);\r\n\t\t}\r\n\t}\r\n});\r\n\r\n(function() {\r\n\tvar extend = tinymce.extend, JSON = tinymce.util.JSON, XHR = tinymce.util.XHR;\r\n\r\n\ttinymce.create('tinymce.util.JSONRequest', {\r\n\t\tJSONRequest : function(s) {\r\n\t\t\tthis.settings = extend({\r\n\t\t\t}, s);\r\n\t\t\tthis.count = 0;\r\n\t\t},\r\n\r\n\t\tsend : function(o) {\r\n\t\t\tvar ecb = o.error, scb = o.success;\r\n\r\n\t\t\to = extend(this.settings, o);\r\n\r\n\t\t\to.success = function(c, x) {\r\n\t\t\t\tc = JSON.parse(c);\r\n\r\n\t\t\t\tif (typeof(c) == 'undefined') {\r\n\t\t\t\t\tc = {\r\n\t\t\t\t\t\terror : 'JSON Parse error.'\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (c.error)\r\n\t\t\t\t\tecb.call(o.error_scope || o.scope, c.error, x);\r\n\t\t\t\telse\r\n\t\t\t\t\tscb.call(o.success_scope || o.scope, c.result);\r\n\t\t\t};\r\n\r\n\t\t\to.error = function(ty, x) {\r\n\t\t\t\tecb.call(o.error_scope || o.scope, ty, x);\r\n\t\t\t};\r\n\r\n\t\t\to.data = JSON.serialize({\r\n\t\t\t\tid : o.id || 'c' + (this.count++),\r\n\t\t\t\tmethod : o.method,\r\n\t\t\t\tparams : o.params\r\n\t\t\t});\r\n\r\n\t\t\t// JSON content type for Ruby on rails. Bug: #1883287\r\n\t\t\to.content_type = 'application/json';\r\n\r\n\t\t\tXHR.send(o);\r\n\t\t},\r\n\r\n\t\t'static' : {\r\n\t\t\tsendRPC : function(o) {\r\n\t\t\t\treturn new tinymce.util.JSONRequest().send(o);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n}());\r\n(function(tinymce) {\r\n\t// Shorten names\r\n\tvar each = tinymce.each,\r\n\t\tis = tinymce.is,\r\n\t\tisWebKit = tinymce.isWebKit,\r\n\t\tisIE = tinymce.isIE,\r\n\t\tblockRe = /^(H[1-6R]|P|DIV|ADDRESS|PRE|FORM|T(ABLE|BODY|HEAD|FOOT|H|R|D)|LI|OL|UL|CAPTION|BLOCKQUOTE|CENTER|DL|DT|DD|DIR|FIELDSET|NOSCRIPT|MENU|ISINDEX|SAMP)$/,\r\n\t\tboolAttrs = makeMap('checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected'),\r\n\t\tmceAttribs = makeMap('src,href,style,coords,shape'),\r\n\t\tencodedChars = {'&' : '&amp;', '\"' : '&quot;', '<' : '&lt;', '>' : '&gt;'},\r\n\t\tencodeCharsRe = /[<>&\\\"]/g,\r\n\t\tsimpleSelectorRe = /^([a-z0-9],?)+$/i,\r\n\t\ttagRegExp = /<(\\w+)((?:\\s+\\w+(?:\\s*=\\s*(?:(?:\"[^\"]*\")|(?:'[^']*')|[^>\\s]+))?)*)(\\s*\\/?)>/g,\r\n\t\tattrRegExp = /(\\w+)(?:\\s*=\\s*(?:(?:\"((?:\\\\.|[^\"])*)\")|(?:'((?:\\\\.|[^'])*)')|([^>\\s]+)))?/g;\r\n\r\n\tfunction makeMap(str) {\r\n\t\tvar map = {}, i;\r\n\r\n\t\tstr = str.split(',');\r\n\t\tfor (i = str.length; i >= 0; i--)\r\n\t\t\tmap[str[i]] = 1;\r\n\r\n\t\treturn map;\r\n\t};\r\n\r\n\ttinymce.create('tinymce.dom.DOMUtils', {\r\n\t\tdoc : null,\r\n\t\troot : null,\r\n\t\tfiles : null,\r\n\t\tpixelStyles : /^(top|left|bottom|right|width|height|borderWidth)$/,\r\n\t\tprops : {\r\n\t\t\t\"for\" : \"htmlFor\",\r\n\t\t\t\"class\" : \"className\",\r\n\t\t\tclassName : \"className\",\r\n\t\t\tchecked : \"checked\",\r\n\t\t\tdisabled : \"disabled\",\r\n\t\t\tmaxlength : \"maxLength\",\r\n\t\t\treadonly : \"readOnly\",\r\n\t\t\tselected : \"selected\",\r\n\t\t\tvalue : \"value\",\r\n\t\t\tid : \"id\",\r\n\t\t\tname : \"name\",\r\n\t\t\ttype : \"type\"\r\n\t\t},\r\n\r\n\t\tDOMUtils : function(d, s) {\r\n\t\t\tvar t = this, globalStyle;\r\n\r\n\t\t\tt.doc = d;\r\n\t\t\tt.win = window;\r\n\t\t\tt.files = {};\r\n\t\t\tt.cssFlicker = false;\r\n\t\t\tt.counter = 0;\r\n\t\t\tt.boxModel = !tinymce.isIE || d.compatMode == \"CSS1Compat\"; \r\n\t\t\tt.stdMode = d.documentMode === 8;\r\n\r\n\t\t\tt.settings = s = tinymce.extend({\r\n\t\t\t\tkeep_values : false,\r\n\t\t\t\thex_colors : 1,\r\n\t\t\t\tprocess_html : 1\r\n\t\t\t}, s);\r\n\r\n\t\t\t// Fix IE6SP2 flicker and check it failed for pre SP2\r\n\t\t\tif (tinymce.isIE6) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\td.execCommand('BackgroundImageCache', false, true);\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tt.cssFlicker = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Build styles list\r\n\t\t\tif (s.valid_styles) {\r\n\t\t\t\tt._styles = {};\r\n\r\n\t\t\t\t// Convert styles into a rule list\r\n\t\t\t\teach(s.valid_styles, function(value, key) {\r\n\t\t\t\t\tt._styles[key] = tinymce.explode(value);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\ttinymce.addUnload(t.destroy, t);\r\n\t\t},\r\n\r\n\t\tgetRoot : function() {\r\n\t\t\tvar t = this, s = t.settings;\r\n\r\n\t\t\treturn (s && t.get(s.root_element)) || t.doc.body;\r\n\t\t},\r\n\r\n\t\tgetViewPort : function(w) {\r\n\t\t\tvar d, b;\r\n\r\n\t\t\tw = !w ? this.win : w;\r\n\t\t\td = w.document;\r\n\t\t\tb = this.boxModel ? d.documentElement : d.body;\r\n\r\n\t\t\t// Returns viewport size excluding scrollbars\r\n\t\t\treturn {\r\n\t\t\t\tx : w.pageXOffset || b.scrollLeft,\r\n\t\t\t\ty : w.pageYOffset || b.scrollTop,\r\n\t\t\t\tw : w.innerWidth || b.clientWidth,\r\n\t\t\t\th : w.innerHeight || b.clientHeight\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\tgetRect : function(e) {\r\n\t\t\tvar p, t = this, sr;\r\n\r\n\t\t\te = t.get(e);\r\n\t\t\tp = t.getPos(e);\r\n\t\t\tsr = t.getSize(e);\r\n\r\n\t\t\treturn {\r\n\t\t\t\tx : p.x,\r\n\t\t\t\ty : p.y,\r\n\t\t\t\tw : sr.w,\r\n\t\t\t\th : sr.h\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\tgetSize : function(e) {\r\n\t\t\tvar t = this, w, h;\r\n\r\n\t\t\te = t.get(e);\r\n\t\t\tw = t.getStyle(e, 'width');\r\n\t\t\th = t.getStyle(e, 'height');\r\n\r\n\t\t\t// Non pixel value, then force offset/clientWidth\r\n\t\t\tif (w.indexOf('px') === -1)\r\n\t\t\t\tw = 0;\r\n\r\n\t\t\t// Non pixel value, then force offset/clientWidth\r\n\t\t\tif (h.indexOf('px') === -1)\r\n\t\t\t\th = 0;\r\n\r\n\t\t\treturn {\r\n\t\t\t\tw : parseInt(w) || e.offsetWidth || e.clientWidth,\r\n\t\t\t\th : parseInt(h) || e.offsetHeight || e.clientHeight\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\tgetParent : function(n, f, r) {\r\n\t\t\treturn this.getParents(n, f, r, false);\r\n\t\t},\r\n\r\n\t\tgetParents : function(n, f, r, c) {\r\n\t\t\tvar t = this, na, se = t.settings, o = [];\r\n\r\n\t\t\tn = t.get(n);\r\n\t\t\tc = c === undefined;\r\n\r\n\t\t\tif (se.strict_root)\r\n\t\t\t\tr = r || t.getRoot();\r\n\r\n\t\t\t// Wrap node name as func\r\n\t\t\tif (is(f, 'string')) {\r\n\t\t\t\tna = f;\r\n\r\n\t\t\t\tif (f === '*') {\r\n\t\t\t\t\tf = function(n) {return n.nodeType == 1;};\r\n\t\t\t\t} else {\r\n\t\t\t\t\tf = function(n) {\r\n\t\t\t\t\t\treturn t.is(n, na);\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\twhile (n) {\r\n\t\t\t\tif (n == r || !n.nodeType || n.nodeType === 9)\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tif (!f || f(n)) {\r\n\t\t\t\t\tif (c)\r\n\t\t\t\t\t\to.push(n);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\treturn n;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tn = n.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\treturn c ? o : null;\r\n\t\t},\r\n\r\n\t\tget : function(e) {\r\n\t\t\tvar n;\r\n\r\n\t\t\tif (e && this.doc && typeof(e) == 'string') {\r\n\t\t\t\tn = e;\r\n\t\t\t\te = this.doc.getElementById(e);\r\n\r\n\t\t\t\t// IE and Opera returns meta elements when they match the specified input ID, but getElementsByName seems to do the trick\r\n\t\t\t\tif (e && e.id !== n)\r\n\t\t\t\t\treturn this.doc.getElementsByName(n)[1];\r\n\t\t\t}\r\n\r\n\t\t\treturn e;\r\n\t\t},\r\n\r\n\t\tgetNext : function(node, selector) {\r\n\t\t\treturn this._findSib(node, selector, 'nextSibling');\r\n\t\t},\r\n\r\n\t\tgetPrev : function(node, selector) {\r\n\t\t\treturn this._findSib(node, selector, 'previousSibling');\r\n\t\t},\r\n\r\n\r\n\t\tselect : function(pa, s) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\treturn tinymce.dom.Sizzle(pa, t.get(s) || t.get(t.settings.root_element) || t.doc, []);\r\n\t\t},\r\n\r\n\t\tis : function(n, selector) {\r\n\t\t\tvar i;\r\n\r\n\t\t\t// If it isn't an array then try to do some simple selectors instead of Sizzle for to boost performance\r\n\t\t\tif (n.length === undefined) {\r\n\t\t\t\t// Simple all selector\r\n\t\t\t\tif (selector === '*')\r\n\t\t\t\t\treturn n.nodeType == 1;\r\n\r\n\t\t\t\t// Simple selector just elements\r\n\t\t\t\tif (simpleSelectorRe.test(selector)) {\r\n\t\t\t\t\tselector = selector.toLowerCase().split(/,/);\r\n\t\t\t\t\tn = n.nodeName.toLowerCase();\r\n\r\n\t\t\t\t\tfor (i = selector.length - 1; i >= 0; i--) {\r\n\t\t\t\t\t\tif (selector[i] == n)\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn tinymce.dom.Sizzle.matches(selector, n.nodeType ? [n] : n).length > 0;\r\n\t\t},\r\n\r\n\r\n\t\tadd : function(p, n, a, h, c) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\treturn this.run(p, function(p) {\r\n\t\t\t\tvar e, k;\r\n\r\n\t\t\t\te = is(n, 'string') ? t.doc.createElement(n) : n;\r\n\t\t\t\tt.setAttribs(e, a);\r\n\r\n\t\t\t\tif (h) {\r\n\t\t\t\t\tif (h.nodeType)\r\n\t\t\t\t\t\te.appendChild(h);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tt.setHTML(e, h);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn !c ? p.appendChild(e) : e;\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tcreate : function(n, a, h) {\r\n\t\t\treturn this.add(this.doc.createElement(n), n, a, h, 1);\r\n\t\t},\r\n\r\n\t\tcreateHTML : function(n, a, h) {\r\n\t\t\tvar o = '', t = this, k;\r\n\r\n\t\t\to += '<' + n;\r\n\r\n\t\t\tfor (k in a) {\r\n\t\t\t\tif (a.hasOwnProperty(k))\r\n\t\t\t\t\to += ' ' + k + '=\"' + t.encode(a[k]) + '\"';\r\n\t\t\t}\r\n\r\n\t\t\tif (tinymce.is(h))\r\n\t\t\t\treturn o + '>' + h + '</' + n + '>';\r\n\r\n\t\t\treturn o + ' />';\r\n\t\t},\r\n\r\n\t\tremove : function(node, keep_children) {\r\n\t\t\treturn this.run(node, function(node) {\r\n\t\t\t\tvar parent, child;\r\n\r\n\t\t\t\tparent = node.parentNode;\r\n\r\n\t\t\t\tif (!parent)\r\n\t\t\t\t\treturn null;\r\n\r\n\t\t\t\tif (keep_children) {\r\n\t\t\t\t\twhile (child = node.firstChild) {\r\n\t\t\t\t\t\t// IE 8 will crash if you don't remove completely empty text nodes\r\n\t\t\t\t\t\tif (!tinymce.isIE || child.nodeType !== 3 || child.nodeValue)\r\n\t\t\t\t\t\t\tparent.insertBefore(child, node);\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tnode.removeChild(child);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn parent.removeChild(node);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tsetStyle : function(n, na, v) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\treturn t.run(n, function(e) {\r\n\t\t\t\tvar s, i;\r\n\r\n\t\t\t\ts = e.style;\r\n\r\n\t\t\t\t// Camelcase it, if needed\r\n\t\t\t\tna = na.replace(/-(\\D)/g, function(a, b){\r\n\t\t\t\t\treturn b.toUpperCase();\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Default px suffix on these\r\n\t\t\t\tif (t.pixelStyles.test(na) && (tinymce.is(v, 'number') || /^[\\-0-9\\.]+$/.test(v)))\r\n\t\t\t\t\tv += 'px';\r\n\r\n\t\t\t\tswitch (na) {\r\n\t\t\t\t\tcase 'opacity':\r\n\t\t\t\t\t\t// IE specific opacity\r\n\t\t\t\t\t\tif (isIE) {\r\n\t\t\t\t\t\t\ts.filter = v === '' ? '' : \"alpha(opacity=\" + (v * 100) + \")\";\r\n\r\n\t\t\t\t\t\t\tif (!n.currentStyle || !n.currentStyle.hasLayout)\r\n\t\t\t\t\t\t\t\ts.display = 'inline-block';\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Fix for older browsers\r\n\t\t\t\t\t\ts[na] = s['-moz-opacity'] = s['-khtml-opacity'] = v || '';\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'float':\r\n\t\t\t\t\t\tisIE ? s.styleFloat = v : s.cssFloat = v;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\ts[na] = v || '';\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Force update of the style data\r\n\t\t\t\tif (t.settings.update_styles)\r\n\t\t\t\t\tt.setAttrib(e, '_mce_style');\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tgetStyle : function(n, na, c) {\r\n\t\t\tn = this.get(n);\r\n\r\n\t\t\tif (!n)\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t// Gecko\r\n\t\t\tif (this.doc.defaultView && c) {\r\n\t\t\t\t// Remove camelcase\r\n\t\t\t\tna = na.replace(/[A-Z]/g, function(a){\r\n\t\t\t\t\treturn '-' + a;\r\n\t\t\t\t});\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\treturn this.doc.defaultView.getComputedStyle(n, null).getPropertyValue(na);\r\n\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t// Old safari might fail\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Camelcase it, if needed\r\n\t\t\tna = na.replace(/-(\\D)/g, function(a, b){\r\n\t\t\t\treturn b.toUpperCase();\r\n\t\t\t});\r\n\r\n\t\t\tif (na == 'float')\r\n\t\t\t\tna = isIE ? 'styleFloat' : 'cssFloat';\r\n\r\n\t\t\t// IE & Opera\r\n\t\t\tif (n.currentStyle && c)\r\n\t\t\t\treturn n.currentStyle[na];\r\n\r\n\t\t\treturn n.style[na];\r\n\t\t},\r\n\r\n\t\tsetStyles : function(e, o) {\r\n\t\t\tvar t = this, s = t.settings, ol;\r\n\r\n\t\t\tol = s.update_styles;\r\n\t\t\ts.update_styles = 0;\r\n\r\n\t\t\teach(o, function(v, n) {\r\n\t\t\t\tt.setStyle(e, n, v);\r\n\t\t\t});\r\n\r\n\t\t\t// Update style info\r\n\t\t\ts.update_styles = ol;\r\n\t\t\tif (s.update_styles)\r\n\t\t\t\tt.setAttrib(e, s.cssText);\r\n\t\t},\r\n\r\n\t\tsetAttrib : function(e, n, v) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\t// Whats the point\r\n\t\t\tif (!e || !n)\r\n\t\t\t\treturn;\r\n\r\n\t\t\t// Strict XML mode\r\n\t\t\tif (t.settings.strict)\r\n\t\t\t\tn = n.toLowerCase();\r\n\r\n\t\t\treturn this.run(e, function(e) {\r\n\t\t\t\tvar s = t.settings;\r\n\r\n\t\t\t\tswitch (n) {\r\n\t\t\t\t\tcase \"style\":\r\n\t\t\t\t\t\tif (!is(v, 'string')) {\r\n\t\t\t\t\t\t\teach(v, function(v, n) {\r\n\t\t\t\t\t\t\t\tt.setStyle(e, n, v);\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// No mce_style for elements with these since they might get resized by the user\r\n\t\t\t\t\t\tif (s.keep_values) {\r\n\t\t\t\t\t\t\tif (v && !t._isRes(v))\r\n\t\t\t\t\t\t\t\te.setAttribute('_mce_style', v, 2);\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\te.removeAttribute('_mce_style', 2);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\te.style.cssText = v;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase \"class\":\r\n\t\t\t\t\t\te.className = v || ''; // Fix IE null bug\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase \"src\":\r\n\t\t\t\t\tcase \"href\":\r\n\t\t\t\t\t\tif (s.keep_values) {\r\n\t\t\t\t\t\t\tif (s.url_converter)\r\n\t\t\t\t\t\t\t\tv = s.url_converter.call(s.url_converter_scope || t, v, n, e);\r\n\r\n\t\t\t\t\t\t\tt.setAttrib(e, '_mce_' + n, v, 2);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\r\n\t\t\t\t\tcase \"shape\":\r\n\t\t\t\t\t\te.setAttribute('_mce_style', v);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (is(v) && v !== null && v.length !== 0)\r\n\t\t\t\t\te.setAttribute(n, '' + v, 2);\r\n\t\t\t\telse\r\n\t\t\t\t\te.removeAttribute(n, 2);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tsetAttribs : function(e, o) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\treturn this.run(e, function(e) {\r\n\t\t\t\teach(o, function(v, n) {\r\n\t\t\t\t\tt.setAttrib(e, n, v);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tgetAttrib : function(e, n, dv) {\r\n\t\t\tvar v, t = this;\r\n\r\n\t\t\te = t.get(e);\r\n\r\n\t\t\tif (!e || e.nodeType !== 1)\r\n\t\t\t\treturn false;\r\n\r\n\t\t\tif (!is(dv))\r\n\t\t\t\tdv = '';\r\n\r\n\t\t\t// Try the mce variant for these\r\n\t\t\tif (/^(src|href|style|coords|shape)$/.test(n)) {\r\n\t\t\t\tv = e.getAttribute(\"_mce_\" + n);\r\n\r\n\t\t\t\tif (v)\r\n\t\t\t\t\treturn v;\r\n\t\t\t}\r\n\r\n\t\t\tif (isIE && t.props[n]) {\r\n\t\t\t\tv = e[t.props[n]];\r\n\t\t\t\tv = v && v.nodeValue ? v.nodeValue : v;\r\n\t\t\t}\r\n\r\n\t\t\tif (!v)\r\n\t\t\t\tv = e.getAttribute(n, 2);\r\n\r\n\t\t\t// Check boolean attribs\r\n\t\t\tif (/^(checked|compact|declare|defer|disabled|ismap|multiple|nohref|noshade|nowrap|readonly|selected)$/.test(n)) {\r\n\t\t\t\tif (e[t.props[n]] === true && v === '')\r\n\t\t\t\t\treturn n;\r\n\r\n\t\t\t\treturn v ? n : '';\r\n\t\t\t}\r\n\r\n\t\t\t// Inner input elements will override attributes on form elements\r\n\t\t\tif (e.nodeName === \"FORM\" && e.getAttributeNode(n))\r\n\t\t\t\treturn e.getAttributeNode(n).nodeValue;\r\n\r\n\t\t\tif (n === 'style') {\r\n\t\t\t\tv = v || e.style.cssText;\r\n\r\n\t\t\t\tif (v) {\r\n\t\t\t\t\tv = t.serializeStyle(t.parseStyle(v), e.nodeName);\r\n\r\n\t\t\t\t\tif (t.settings.keep_values && !t._isRes(v))\r\n\t\t\t\t\t\te.setAttribute('_mce_style', v);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Remove Apple and WebKit stuff\r\n\t\t\tif (isWebKit && n === \"class\" && v)\r\n\t\t\t\tv = v.replace(/(apple|webkit)\\-[a-z\\-]+/gi, '');\r\n\r\n\t\t\t// Handle IE issues\r\n\t\t\tif (isIE) {\r\n\t\t\t\tswitch (n) {\r\n\t\t\t\t\tcase 'rowspan':\r\n\t\t\t\t\tcase 'colspan':\r\n\t\t\t\t\t\t// IE returns 1 as default value\r\n\t\t\t\t\t\tif (v === 1)\r\n\t\t\t\t\t\t\tv = '';\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'size':\r\n\t\t\t\t\t\t// IE returns +0 as default value for size\r\n\t\t\t\t\t\tif (v === '+0' || v === 20 || v === 0)\r\n\t\t\t\t\t\t\tv = '';\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'width':\r\n\t\t\t\t\tcase 'height':\r\n\t\t\t\t\tcase 'vspace':\r\n\t\t\t\t\tcase 'checked':\r\n\t\t\t\t\tcase 'disabled':\r\n\t\t\t\t\tcase 'readonly':\r\n\t\t\t\t\t\tif (v === 0)\r\n\t\t\t\t\t\t\tv = '';\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'hspace':\r\n\t\t\t\t\t\t// IE returns -1 as default value\r\n\t\t\t\t\t\tif (v === -1)\r\n\t\t\t\t\t\t\tv = '';\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'maxlength':\r\n\t\t\t\t\tcase 'tabindex':\r\n\t\t\t\t\t\t// IE returns default value\r\n\t\t\t\t\t\tif (v === 32768 || v === 2147483647 || v === '32768')\r\n\t\t\t\t\t\t\tv = '';\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'multiple':\r\n\t\t\t\t\tcase 'compact':\r\n\t\t\t\t\tcase 'noshade':\r\n\t\t\t\t\tcase 'nowrap':\r\n\t\t\t\t\t\tif (v === 65535)\r\n\t\t\t\t\t\t\treturn n;\r\n\r\n\t\t\t\t\t\treturn dv;\r\n\r\n\t\t\t\t\tcase 'shape':\r\n\t\t\t\t\t\tv = v.toLowerCase();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t// IE has odd anonymous function for event attributes\r\n\t\t\t\t\t\tif (n.indexOf('on') === 0 && v)\r\n\t\t\t\t\t\t\tv = ('' + v).replace(/^function\\s+\\w+\\(\\)\\s+\\{\\s+(.*)\\s+\\}$/, '$1');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn (v !== undefined && v !== null && v !== '') ? '' + v : dv;\r\n\t\t},\r\n\r\n\t\tgetPos : function(n, ro) {\r\n\t\t\tvar t = this, x = 0, y = 0, e, d = t.doc, r;\r\n\r\n\t\t\tn = t.get(n);\r\n\t\t\tro = ro || d.body;\r\n\r\n\t\t\tif (n) {\r\n\t\t\t\t// Use getBoundingClientRect on IE, Opera has it but it's not perfect\r\n\t\t\t\tif (isIE && !t.stdMode) {\r\n\t\t\t\t\tn = n.getBoundingClientRect();\r\n\t\t\t\t\te = t.boxModel ? d.documentElement : d.body;\r\n\t\t\t\t\tx = t.getStyle(t.select('html')[0], 'borderWidth'); // Remove border\r\n\t\t\t\t\tx = (x == 'medium' || t.boxModel && !t.isIE6) && 2 || x;\r\n\r\n\t\t\t\t\treturn {x : n.left + e.scrollLeft - x, y : n.top + e.scrollTop - x};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tr = n;\r\n\t\t\t\twhile (r && r != ro && r.nodeType) {\r\n\t\t\t\t\tx += r.offsetLeft || 0;\r\n\t\t\t\t\ty += r.offsetTop || 0;\r\n\t\t\t\t\tr = r.offsetParent;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tr = n.parentNode;\r\n\t\t\t\twhile (r && r != ro && r.nodeType) {\r\n\t\t\t\t\tx -= r.scrollLeft || 0;\r\n\t\t\t\t\ty -= r.scrollTop || 0;\r\n\t\t\t\t\tr = r.parentNode;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn {x : x, y : y};\r\n\t\t},\r\n\r\n\t\tparseStyle : function(st) {\r\n\t\t\tvar t = this, s = t.settings, o = {};\r\n\r\n\t\t\tif (!st)\r\n\t\t\t\treturn o;\r\n\r\n\t\t\tfunction compress(p, s, ot) {\r\n\t\t\t\tvar t, r, b, l;\r\n\r\n\t\t\t\t// Get values and check it it needs compressing\r\n\t\t\t\tt = o[p + '-top' + s];\r\n\t\t\t\tif (!t)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tr = o[p + '-right' + s];\r\n\t\t\t\tif (t != r)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tb = o[p + '-bottom' + s];\r\n\t\t\t\tif (r != b)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tl = o[p + '-left' + s];\r\n\t\t\t\tif (b != l)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t// Compress\r\n\t\t\t\to[ot] = l;\r\n\t\t\t\tdelete o[p + '-top' + s];\r\n\t\t\t\tdelete o[p + '-right' + s];\r\n\t\t\t\tdelete o[p + '-bottom' + s];\r\n\t\t\t\tdelete o[p + '-left' + s];\r\n\t\t\t};\r\n\r\n\t\t\tfunction compress2(ta, a, b, c) {\r\n\t\t\t\tvar t;\r\n\r\n\t\t\t\tt = o[a];\r\n\t\t\t\tif (!t)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tt = o[b];\r\n\t\t\t\tif (!t)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tt = o[c];\r\n\t\t\t\tif (!t)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t// Compress\r\n\t\t\t\to[ta] = o[a] + ' ' + o[b] + ' ' + o[c];\r\n\t\t\t\tdelete o[a];\r\n\t\t\t\tdelete o[b];\r\n\t\t\t\tdelete o[c];\r\n\t\t\t};\r\n\r\n\t\t\tst = st.replace(/&(#?[a-z0-9]+);/g, '&$1_MCE_SEMI_'); // Protect entities\r\n\r\n\t\t\teach(st.split(';'), function(v) {\r\n\t\t\t\tvar sv, ur = [];\r\n\r\n\t\t\t\tif (v) {\r\n\t\t\t\t\tv = v.replace(/_MCE_SEMI_/g, ';'); // Restore entities\r\n\t\t\t\t\tv = v.replace(/url\\([^\\)]+\\)/g, function(v) {ur.push(v);return 'url(' + ur.length + ')';});\r\n\t\t\t\t\tv = v.split(':');\r\n\t\t\t\t\tsv = tinymce.trim(v[1]);\r\n\t\t\t\t\tsv = sv.replace(/url\\(([^\\)]+)\\)/g, function(a, b) {return ur[parseInt(b) - 1];});\r\n\r\n\t\t\t\t\tsv = sv.replace(/rgb\\([^\\)]+\\)/g, function(v) {\r\n\t\t\t\t\t\treturn t.toHex(v);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (s.url_converter) {\r\n\t\t\t\t\t\tsv = sv.replace(/url\\([\\'\\\"]?([^\\)\\'\\\"]+)[\\'\\\"]?\\)/g, function(x, c) {\r\n\t\t\t\t\t\t\treturn 'url(' + s.url_converter.call(s.url_converter_scope || t, t.decode(c), 'style', null) + ')';\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\to[tinymce.trim(v[0]).toLowerCase()] = sv;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tcompress(\"border\", \"\", \"border\");\r\n\t\t\tcompress(\"border\", \"-width\", \"border-width\");\r\n\t\t\tcompress(\"border\", \"-color\", \"border-color\");\r\n\t\t\tcompress(\"border\", \"-style\", \"border-style\");\r\n\t\t\tcompress(\"padding\", \"\", \"padding\");\r\n\t\t\tcompress(\"margin\", \"\", \"margin\");\r\n\t\t\tcompress2('border', 'border-width', 'border-style', 'border-color');\r\n\r\n\t\t\tif (isIE) {\r\n\t\t\t\t// Remove pointless border\r\n\t\t\t\tif (o.border == 'medium none')\r\n\t\t\t\t\to.border = '';\r\n\t\t\t}\r\n\r\n\t\t\treturn o;\r\n\t\t},\r\n\r\n\t\tserializeStyle : function(o, name) {\r\n\t\t\tvar t = this, s = '';\r\n\r\n\t\t\tfunction add(v, k) {\r\n\t\t\t\tif (k && v) {\r\n\t\t\t\t\t// Remove browser specific styles like -moz- or -webkit-\r\n\t\t\t\t\tif (k.indexOf('-') === 0)\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tswitch (k) {\r\n\t\t\t\t\t\tcase 'font-weight':\r\n\t\t\t\t\t\t\t// Opera will output bold as 700\r\n\t\t\t\t\t\t\tif (v == 700)\r\n\t\t\t\t\t\t\t\tv = 'bold';\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 'color':\r\n\t\t\t\t\t\tcase 'background-color':\r\n\t\t\t\t\t\t\tv = v.toLowerCase();\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ts += (s ? ' ' : '') + k + ': ' + v + ';';\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t// Validate style output\r\n\t\t\tif (name && t._styles) {\r\n\t\t\t\teach(t._styles['*'], function(name) {\r\n\t\t\t\t\tadd(o[name], name);\r\n\t\t\t\t});\r\n\r\n\t\t\t\teach(t._styles[name.toLowerCase()], function(name) {\r\n\t\t\t\t\tadd(o[name], name);\r\n\t\t\t\t});\r\n\t\t\t} else\r\n\t\t\t\teach(o, add);\r\n\r\n\t\t\treturn s;\r\n\t\t},\r\n\r\n\t\tloadCSS : function(u) {\r\n\t\t\tvar t = this, d = t.doc, head;\r\n\r\n\t\t\tif (!u)\r\n\t\t\t\tu = '';\r\n\r\n\t\t\thead = t.select('head')[0];\r\n\r\n\t\t\teach(u.split(','), function(u) {\r\n\t\t\t\tvar link;\r\n\r\n\t\t\t\tif (t.files[u])\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tt.files[u] = true;\r\n\t\t\t\tlink = t.create('link', {rel : 'stylesheet', href : tinymce._addVer(u)});\r\n\r\n\t\t\t\t// IE 8 has a bug where dynamically loading stylesheets would produce a 1 item remaining bug\r\n\t\t\t\t// This fix seems to resolve that issue by realcing the document ones a stylesheet finishes loading\r\n\t\t\t\t// It's ugly but it seems to work fine.\r\n\t\t\t\tif (isIE && d.documentMode) {\r\n\t\t\t\t\tlink.onload = function() {\r\n\t\t\t\t\t\td.recalc();\r\n\t\t\t\t\t\tlink.onload = null;\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\thead.appendChild(link);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\taddClass : function(e, c) {\r\n\t\t\treturn this.run(e, function(e) {\r\n\t\t\t\tvar o;\r\n\r\n\t\t\t\tif (!c)\r\n\t\t\t\t\treturn 0;\r\n\r\n\t\t\t\tif (this.hasClass(e, c))\r\n\t\t\t\t\treturn e.className;\r\n\r\n\t\t\t\to = this.removeClass(e, c);\r\n\r\n\t\t\t\treturn e.className = (o != '' ? (o + ' ') : '') + c;\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tremoveClass : function(e, c) {\r\n\t\t\tvar t = this, re;\r\n\r\n\t\t\treturn t.run(e, function(e) {\r\n\t\t\t\tvar v;\r\n\r\n\t\t\t\tif (t.hasClass(e, c)) {\r\n\t\t\t\t\tif (!re)\r\n\t\t\t\t\t\tre = new RegExp(\"(^|\\\\s+)\" + c + \"(\\\\s+|$)\", \"g\");\r\n\r\n\t\t\t\t\tv = e.className.replace(re, ' ');\r\n\t\t\t\t\tv = tinymce.trim(v != ' ' ? v : '');\r\n\r\n\t\t\t\t\te.className = v;\r\n\r\n\t\t\t\t\t// Empty class attr\r\n\t\t\t\t\tif (!v) {\r\n\t\t\t\t\t\te.removeAttribute('class');\r\n\t\t\t\t\t\te.removeAttribute('className');\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn v;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn e.className;\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\thasClass : function(n, c) {\r\n\t\t\tn = this.get(n);\r\n\r\n\t\t\tif (!n || !c)\r\n\t\t\t\treturn false;\r\n\r\n\t\t\treturn (' ' + n.className + ' ').indexOf(' ' + c + ' ') !== -1;\r\n\t\t},\r\n\r\n\t\tshow : function(e) {\r\n\t\t\treturn this.setStyle(e, 'display', 'block');\r\n\t\t},\r\n\r\n\t\thide : function(e) {\r\n\t\t\treturn this.setStyle(e, 'display', 'none');\r\n\t\t},\r\n\r\n\t\tisHidden : function(e) {\r\n\t\t\te = this.get(e);\r\n\r\n\t\t\treturn !e || e.style.display == 'none' || this.getStyle(e, 'display') == 'none';\r\n\t\t},\r\n\r\n\t\tuniqueId : function(p) {\r\n\t\t\treturn (!p ? 'mce_' : p) + (this.counter++);\r\n\t\t},\r\n\r\n\t\tsetHTML : function(e, h) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\treturn this.run(e, function(e) {\r\n\t\t\t\tvar x, i, nl, n, p, x;\r\n\r\n\t\t\t\th = t.processHTML(h);\r\n\r\n\t\t\t\tif (isIE) {\r\n\t\t\t\t\tfunction set() {\r\n\t\t\t\t\t\t// Remove all child nodes\r\n\t\t\t\t\t\twhile (e.firstChild)\r\n\t\t\t\t\t\t\te.firstChild.removeNode();\r\n\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t// IE will remove comments from the beginning\r\n\t\t\t\t\t\t\t// unless you padd the contents with something\r\n\t\t\t\t\t\t\te.innerHTML = '<br />' + h;\r\n\t\t\t\t\t\t\te.removeChild(e.firstChild);\r\n\t\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t\t// IE sometimes produces an unknown runtime error on innerHTML if it's an block element within a block element for example a div inside a p\r\n\t\t\t\t\t\t\t// This seems to fix this problem\r\n\r\n\t\t\t\t\t\t\t// Create new div with HTML contents and a BR infront to keep comments\r\n\t\t\t\t\t\t\tx = t.create('div');\r\n\t\t\t\t\t\t\tx.innerHTML = '<br />' + h;\r\n\r\n\t\t\t\t\t\t\t// Add all children from div to target\r\n\t\t\t\t\t\t\teach (x.childNodes, function(n, i) {\r\n\t\t\t\t\t\t\t\t// Skip br element\r\n\t\t\t\t\t\t\t\tif (i)\r\n\t\t\t\t\t\t\t\t\te.appendChild(n);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\t// IE has a serious bug when it comes to paragraphs it can produce an invalid\r\n\t\t\t\t\t// DOM tree if contents like this <p><ul><li>Item 1</li></ul></p> is inserted\r\n\t\t\t\t\t// It seems to be that IE doesn't like a root block element placed inside another root block element\r\n\t\t\t\t\tif (t.settings.fix_ie_paragraphs)\r\n\t\t\t\t\t\th = h.replace(/<p><\\/p>|<p([^>]+)><\\/p>|<p[^\\/+]\\/>/gi, '<p$1 _mce_keep=\"true\">&nbsp;</p>');\r\n\r\n\t\t\t\t\tset();\r\n\r\n\t\t\t\t\tif (t.settings.fix_ie_paragraphs) {\r\n\t\t\t\t\t\t// Check for odd paragraphs this is a sign of a broken DOM\r\n\t\t\t\t\t\tnl = e.getElementsByTagName(\"p\");\r\n\t\t\t\t\t\tfor (i = nl.length - 1, x = 0; i >= 0; i--) {\r\n\t\t\t\t\t\t\tn = nl[i];\r\n\r\n\t\t\t\t\t\t\tif (!n.hasChildNodes()) {\r\n\t\t\t\t\t\t\t\tif (!n._mce_keep) {\r\n\t\t\t\t\t\t\t\t\tx = 1; // Is broken\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tn.removeAttribute('_mce_keep');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Time to fix the madness IE left us\r\n\t\t\t\t\tif (x) {\r\n\t\t\t\t\t\t// So if we replace the p elements with divs and mark them and then replace them back to paragraphs\r\n\t\t\t\t\t\t// after we use innerHTML we can fix the DOM tree\r\n\t\t\t\t\t\th = h.replace(/<p ([^>]+)>|<p>/ig, '<div $1 _mce_tmp=\"1\">');\r\n\t\t\t\t\t\th = h.replace(/<\\/p>/gi, '</div>');\r\n\r\n\t\t\t\t\t\t// Set the new HTML with DIVs\r\n\t\t\t\t\t\tset();\r\n\r\n\t\t\t\t\t\t// Replace all DIV elements with the _mce_tmp attibute back to paragraphs\r\n\t\t\t\t\t\t// This is needed since IE has a annoying bug see above for details\r\n\t\t\t\t\t\t// This is a slow process but it has to be done. :(\r\n\t\t\t\t\t\tif (t.settings.fix_ie_paragraphs) {\r\n\t\t\t\t\t\t\tnl = e.getElementsByTagName(\"DIV\");\r\n\t\t\t\t\t\t\tfor (i = nl.length - 1; i >= 0; i--) {\r\n\t\t\t\t\t\t\t\tn = nl[i];\r\n\r\n\t\t\t\t\t\t\t\t// Is it a temp div\r\n\t\t\t\t\t\t\t\tif (n._mce_tmp) {\r\n\t\t\t\t\t\t\t\t\t// Create new paragraph\r\n\t\t\t\t\t\t\t\t\tp = t.doc.createElement('p');\r\n\r\n\t\t\t\t\t\t\t\t\t// Copy all attributes\r\n\t\t\t\t\t\t\t\t\tn.cloneNode(false).outerHTML.replace(/([a-z0-9\\-_]+)=/gi, function(a, b) {\r\n\t\t\t\t\t\t\t\t\t\tvar v;\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (b !== '_mce_tmp') {\r\n\t\t\t\t\t\t\t\t\t\t\tv = n.getAttribute(b);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tif (!v && b === 'class')\r\n\t\t\t\t\t\t\t\t\t\t\t\tv = n.className;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tp.setAttribute(b, v);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t\t// Append all children to new paragraph\r\n\t\t\t\t\t\t\t\t\tfor (x = 0; x<n.childNodes.length; x++)\r\n\t\t\t\t\t\t\t\t\t\tp.appendChild(n.childNodes[x].cloneNode(true));\r\n\r\n\t\t\t\t\t\t\t\t\t// Replace div with new paragraph\r\n\t\t\t\t\t\t\t\t\tn.swapNode(p);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else\r\n\t\t\t\t\te.innerHTML = h;\r\n\r\n\t\t\t\treturn h;\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tprocessHTML : function(h) {\r\n\t\t\tvar t = this, s = t.settings, codeBlocks = [];\r\n\r\n\t\t\tif (!s.process_html)\r\n\t\t\t\treturn h;\r\n\r\n\t\t\tif (isIE) {\r\n\t\t\t\th = h.replace(/&apos;/g, '&#39;'); // IE can't handle apos\r\n\t\t\t\th = h.replace(/\\s+(disabled|checked|readonly|selected)\\s*=\\s*[\\\"\\']?(false|0)[\\\"\\']?/gi, ''); // IE doesn't handle default values correct\r\n\t\t\t}\r\n\r\n\t\t\t// Fix some issues\r\n\t\t\th = h.replace(/<a( )([^>]+)\\/>|<a\\/>/gi, '<a$1$2></a>'); // Force open\r\n\r\n\t\t\t// Store away src and href in _mce_src and mce_href since browsers mess them up\r\n\t\t\tif (s.keep_values) {\r\n\t\t\t\t// Wrap scripts and styles in comments for serialization purposes\r\n\t\t\t\tif (/<script|noscript|style/i.test(h)) {\r\n\t\t\t\t\tfunction trim(s) {\r\n\t\t\t\t\t\t// Remove prefix and suffix code for element\r\n\t\t\t\t\t\ts = s.replace(/(<!--\\[CDATA\\[|\\]\\]-->)/g, '\\n');\r\n\t\t\t\t\t\ts = s.replace(/^[\\r\\n]*|[\\r\\n]*$/g, '');\r\n\t\t\t\t\t\ts = s.replace(/^\\s*(\\/\\/\\s*<!--|\\/\\/\\s*<!\\[CDATA\\[|<!--|<!\\[CDATA\\[)[\\r\\n]*/g, '');\r\n\t\t\t\t\t\ts = s.replace(/\\s*(\\/\\/\\s*\\]\\]>|\\/\\/\\s*-->|\\]\\]>|-->|\\]\\]-->)\\s*$/g, '');\r\n\r\n\t\t\t\t\t\treturn s;\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\t// Wrap the script contents in CDATA and keep them from executing\r\n\t\t\t\t\th = h.replace(/<script([^>]+|)>([\\s\\S]*?)<\\/script>/gi, function(v, attribs, text) {\r\n\t\t\t\t\t\t// Force type attribute\r\n\t\t\t\t\t\tif (!attribs)\r\n\t\t\t\t\t\t\tattribs = ' type=\"text/javascript\"';\r\n\r\n\t\t\t\t\t\t// Convert the src attribute of the scripts\r\n\t\t\t\t\t\tattribs = attribs.replace(/src=\\\"([^\\\"]+)\\\"?/i, function(a, url) {\r\n\t\t\t\t\t\t\tif (s.url_converter)\r\n\t\t\t\t\t\t\t\turl = t.encode(s.url_converter.call(s.url_converter_scope || t, t.decode(url), 'src', 'script'));\r\n\r\n\t\t\t\t\t\t\treturn '_mce_src=\"' + url + '\"';\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t// Wrap text contents\r\n\t\t\t\t\t\tif (tinymce.trim(text)) {\r\n\t\t\t\t\t\t\tcodeBlocks.push(trim(text));\r\n\t\t\t\t\t\t\ttext = '<!--\\nMCE_SCRIPT:' + (codeBlocks.length - 1) + '\\n// -->';\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn '<mce:script' + attribs + '>' + text + '</mce:script>';\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Wrap style elements\r\n\t\t\t\t\th = h.replace(/<style([^>]+|)>([\\s\\S]*?)<\\/style>/gi, function(v, attribs, text) {\r\n\t\t\t\t\t\t// Wrap text contents\r\n\t\t\t\t\t\tif (text) {\r\n\t\t\t\t\t\t\tcodeBlocks.push(trim(text));\r\n\t\t\t\t\t\t\ttext = '<!--\\nMCE_SCRIPT:' + (codeBlocks.length - 1) + '\\n-->';\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn '<mce:style' + attribs + '>' + text + '</mce:style><style ' + attribs + ' _mce_bogus=\"1\">' + text + '</style>';\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Wrap noscript elements\r\n\t\t\t\t\th = h.replace(/<noscript([^>]+|)>([\\s\\S]*?)<\\/noscript>/g, function(v, attribs, text) {\r\n\t\t\t\t\t\treturn '<mce:noscript' + attribs + '><!--' + t.encode(text).replace(/--/g, '&#45;&#45;') + '--></mce:noscript>';\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\th = h.replace(/<!\\[CDATA\\[([\\s\\S]+)\\]\\]>/g, '<!--[CDATA[$1]]-->');\r\n\r\n\t\t\t\t// This function processes the attributes in the HTML string to force boolean\r\n\t\t\t\t// attributes to the attr=\"attr\" format and convert style, src and href to _mce_ versions\r\n\t\t\t\tfunction processTags(html) {\r\n\t\t\t\t\treturn html.replace(tagRegExp, function(match, elm_name, attrs, end) {\r\n\t\t\t\t\t\treturn '<' + elm_name + attrs.replace(attrRegExp, function(match, name, value, val2, val3) {\r\n\t\t\t\t\t\t\tvar mceValue;\r\n\r\n\t\t\t\t\t\t\tname = name.toLowerCase();\r\n\t\t\t\t\t\t\tvalue = value || val2 || val3 || \"\";\r\n\r\n\t\t\t\t\t\t\t// Treat boolean attributes\r\n\t\t\t\t\t\t\tif (boolAttrs[name]) {\r\n\t\t\t\t\t\t\t\t// false or 0 is treated as a missing attribute\r\n\t\t\t\t\t\t\t\tif (value === 'false' || value === '0')\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\t\t\treturn name + '=\"' + name + '\"';\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Is attribute one that needs special treatment\r\n\t\t\t\t\t\t\tif (mceAttribs[name] && attrs.indexOf('_mce_' + name) == -1) {\r\n\t\t\t\t\t\t\t\tmceValue = t.decode(value);\r\n\r\n\t\t\t\t\t\t\t\t// Convert URLs to relative/absolute ones\r\n\t\t\t\t\t\t\t\tif (s.url_converter && (name == \"src\" || name == \"href\"))\r\n\t\t\t\t\t\t\t\t\tmceValue = s.url_converter.call(s.url_converter_scope || t, mceValue, name, elm_name);\r\n\r\n\t\t\t\t\t\t\t\t// Process styles lowercases them and compresses them\r\n\t\t\t\t\t\t\t\tif (name == 'style')\r\n\t\t\t\t\t\t\t\t\tmceValue = t.serializeStyle(t.parseStyle(mceValue), name);\r\n\r\n\t\t\t\t\t\t\t\treturn name + '=\"' + value + '\"' + ' _mce_' + name + '=\"' + t.encode(mceValue) + '\"';\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\treturn match;\r\n\t\t\t\t\t\t}) + end + '>';\r\n\t\t\t\t\t});\r\n\t\t\t\t};\r\n\r\n\t\t\t\th = processTags(h);\r\n\r\n\t\t\t\t// Restore script blocks\r\n\t\t\t\th = h.replace(/MCE_SCRIPT:([0-9]+)/g, function(val, idx) {\r\n\t\t\t\t\treturn codeBlocks[idx];\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn h;\r\n\t\t},\r\n\r\n\t\tgetOuterHTML : function(e) {\r\n\t\t\tvar d;\r\n\r\n\t\t\te = this.get(e);\r\n\r\n\t\t\tif (!e)\r\n\t\t\t\treturn null;\r\n\r\n\t\t\tif (e.outerHTML !== undefined)\r\n\t\t\t\treturn e.outerHTML;\r\n\r\n\t\t\td = (e.ownerDocument || this.doc).createElement(\"body\");\r\n\t\t\td.appendChild(e.cloneNode(true));\r\n\r\n\t\t\treturn d.innerHTML;\r\n\t\t},\r\n\r\n\t\tsetOuterHTML : function(e, h, d) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tfunction setHTML(e, h, d) {\r\n\t\t\t\tvar n, tp;\r\n\r\n\t\t\t\ttp = d.createElement(\"body\");\r\n\t\t\t\ttp.innerHTML = h;\r\n\r\n\t\t\t\tn = tp.lastChild;\r\n\t\t\t\twhile (n) {\r\n\t\t\t\t\tt.insertAfter(n.cloneNode(true), e);\r\n\t\t\t\t\tn = n.previousSibling;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tt.remove(e);\r\n\t\t\t};\r\n\r\n\t\t\treturn this.run(e, function(e) {\r\n\t\t\t\te = t.get(e);\r\n\r\n\t\t\t\t// Only set HTML on elements\r\n\t\t\t\tif (e.nodeType == 1) {\r\n\t\t\t\t\td = d || e.ownerDocument || t.doc;\r\n\r\n\t\t\t\t\tif (isIE) {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t// Try outerHTML for IE it sometimes produces an unknown runtime error\r\n\t\t\t\t\t\t\tif (isIE && e.nodeType == 1)\r\n\t\t\t\t\t\t\t\te.outerHTML = h;\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tsetHTML(e, h, d);\r\n\t\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t\t// Fix for unknown runtime error\r\n\t\t\t\t\t\t\tsetHTML(e, h, d);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\tsetHTML(e, h, d);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tdecode : function(s) {\r\n\t\t\tvar e, n, v;\r\n\r\n\t\t\t// Look for entities to decode\r\n\t\t\tif (/&[\\w#]+;/.test(s)) {\r\n\t\t\t\t// Decode the entities using a div element not super efficient but less code\r\n\t\t\t\te = this.doc.createElement(\"div\");\r\n\t\t\t\te.innerHTML = s;\r\n\t\t\t\tn = e.firstChild;\r\n\t\t\t\tv = '';\r\n\r\n\t\t\t\tif (n) {\r\n\t\t\t\t\tdo {\r\n\t\t\t\t\t\tv += n.nodeValue;\r\n\t\t\t\t\t} while (n = n.nextSibling);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn v || s;\r\n\t\t\t}\r\n\r\n\t\t\treturn s;\r\n\t\t},\r\n\r\n\t\tencode : function(str) {\r\n\t\t\treturn ('' + str).replace(encodeCharsRe, function(chr) {\r\n\t\t\t\treturn encodedChars[chr];\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tinsertAfter : function(node, reference_node) {\r\n\t\t\treference_node = this.get(reference_node);\r\n\r\n\t\t\treturn this.run(node, function(node) {\r\n\t\t\t\tvar parent, nextSibling;\r\n\r\n\t\t\t\tparent = reference_node.parentNode;\r\n\t\t\t\tnextSibling = reference_node.nextSibling;\r\n\r\n\t\t\t\tif (nextSibling)\r\n\t\t\t\t\tparent.insertBefore(node, nextSibling);\r\n\t\t\t\telse\r\n\t\t\t\t\tparent.appendChild(node);\r\n\r\n\t\t\t\treturn node;\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tisBlock : function(n) {\r\n\t\t\tif (n.nodeType && n.nodeType !== 1)\r\n\t\t\t\treturn false;\r\n\r\n\t\t\tn = n.nodeName || n;\r\n\r\n\t\t\treturn blockRe.test(n);\r\n\t\t},\r\n\r\n\t\treplace : function(n, o, k) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tif (is(o, 'array'))\r\n\t\t\t\tn = n.cloneNode(true);\r\n\r\n\t\t\treturn t.run(o, function(o) {\r\n\t\t\t\tif (k) {\r\n\t\t\t\t\teach(tinymce.grep(o.childNodes), function(c) {\r\n\t\t\t\t\t\tn.appendChild(c);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn o.parentNode.replaceChild(n, o);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\trename : function(elm, name) {\r\n\t\t\tvar t = this, newElm;\r\n\r\n\t\t\tif (elm.nodeName != name.toUpperCase()) {\r\n\t\t\t\t// Rename block element\r\n\t\t\t\tnewElm = t.create(name);\r\n\r\n\t\t\t\t// Copy attribs to new block\r\n\t\t\t\teach(t.getAttribs(elm), function(attr_node) {\r\n\t\t\t\t\tt.setAttrib(newElm, attr_node.nodeName, t.getAttrib(elm, attr_node.nodeName));\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Replace block\r\n\t\t\t\tt.replace(newElm, elm, 1);\r\n\t\t\t}\r\n\r\n\t\t\treturn newElm || elm;\r\n\t\t},\r\n\r\n\t\tfindCommonAncestor : function(a, b) {\r\n\t\t\tvar ps = a, pe;\r\n\r\n\t\t\twhile (ps) {\r\n\t\t\t\tpe = b;\r\n\r\n\t\t\t\twhile (pe && ps != pe)\r\n\t\t\t\t\tpe = pe.parentNode;\r\n\r\n\t\t\t\tif (ps == pe)\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tps = ps.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\tif (!ps && a.ownerDocument)\r\n\t\t\t\treturn a.ownerDocument.documentElement;\r\n\r\n\t\t\treturn ps;\r\n\t\t},\r\n\r\n\t\ttoHex : function(s) {\r\n\t\t\tvar c = /^\\s*rgb\\s*?\\(\\s*?([0-9]+)\\s*?,\\s*?([0-9]+)\\s*?,\\s*?([0-9]+)\\s*?\\)\\s*$/i.exec(s);\r\n\r\n\t\t\tfunction hex(s) {\r\n\t\t\t\ts = parseInt(s).toString(16);\r\n\r\n\t\t\t\treturn s.length > 1 ? s : '0' + s; // 0 -> 00\r\n\t\t\t};\r\n\r\n\t\t\tif (c) {\r\n\t\t\t\ts = '#' + hex(c[1]) + hex(c[2]) + hex(c[3]);\r\n\r\n\t\t\t\treturn s;\r\n\t\t\t}\r\n\r\n\t\t\treturn s;\r\n\t\t},\r\n\r\n\t\tgetClasses : function() {\r\n\t\t\tvar t = this, cl = [], i, lo = {}, f = t.settings.class_filter, ov;\r\n\r\n\t\t\tif (t.classes)\r\n\t\t\t\treturn t.classes;\r\n\r\n\t\t\tfunction addClasses(s) {\r\n\t\t\t\t// IE style imports\r\n\t\t\t\teach(s.imports, function(r) {\r\n\t\t\t\t\taddClasses(r);\r\n\t\t\t\t});\r\n\r\n\t\t\t\teach(s.cssRules || s.rules, function(r) {\r\n\t\t\t\t\t// Real type or fake it on IE\r\n\t\t\t\t\tswitch (r.type || 1) {\r\n\t\t\t\t\t\t// Rule\r\n\t\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\t\tif (r.selectorText) {\r\n\t\t\t\t\t\t\t\teach(r.selectorText.split(','), function(v) {\r\n\t\t\t\t\t\t\t\t\tv = v.replace(/^\\s*|\\s*$|^\\s\\./g, \"\");\r\n\r\n\t\t\t\t\t\t\t\t\t// Is internal or it doesn't contain a class\r\n\t\t\t\t\t\t\t\t\tif (/\\.mce/.test(v) || !/\\.[\\w\\-]+$/.test(v))\r\n\t\t\t\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\t\t\t\t// Remove everything but class name\r\n\t\t\t\t\t\t\t\t\tov = v;\r\n\t\t\t\t\t\t\t\t\tv = v.replace(/.*\\.([a-z0-9_\\-]+).*/i, '$1');\r\n\r\n\t\t\t\t\t\t\t\t\t// Filter classes\r\n\t\t\t\t\t\t\t\t\tif (f && !(v = f(v, ov)))\r\n\t\t\t\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\t\t\t\tif (!lo[v]) {\r\n\t\t\t\t\t\t\t\t\t\tcl.push({'class' : v});\r\n\t\t\t\t\t\t\t\t\t\tlo[v] = 1;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t// Import\r\n\t\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\t\taddClasses(r.styleSheet);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\ttry {\r\n\t\t\t\teach(t.doc.styleSheets, addClasses);\r\n\t\t\t} catch (ex) {\r\n\t\t\t\t// Ignore\r\n\t\t\t}\r\n\r\n\t\t\tif (cl.length > 0)\r\n\t\t\t\tt.classes = cl;\r\n\r\n\t\t\treturn cl;\r\n\t\t},\r\n\r\n\t\trun : function(e, f, s) {\r\n\t\t\tvar t = this, o;\r\n\r\n\t\t\tif (t.doc && typeof(e) === 'string')\r\n\t\t\t\te = t.get(e);\r\n\r\n\t\t\tif (!e)\r\n\t\t\t\treturn false;\r\n\r\n\t\t\ts = s || this;\r\n\t\t\tif (!e.nodeType && (e.length || e.length === 0)) {\r\n\t\t\t\to = [];\r\n\r\n\t\t\t\teach(e, function(e, i) {\r\n\t\t\t\t\tif (e) {\r\n\t\t\t\t\t\tif (typeof(e) == 'string')\r\n\t\t\t\t\t\t\te = t.doc.getElementById(e);\r\n\r\n\t\t\t\t\t\to.push(f.call(s, e, i));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn o;\r\n\t\t\t}\r\n\r\n\t\t\treturn f.call(s, e);\r\n\t\t},\r\n\r\n\t\tgetAttribs : function(n) {\r\n\t\t\tvar o;\r\n\r\n\t\t\tn = this.get(n);\r\n\r\n\t\t\tif (!n)\r\n\t\t\t\treturn [];\r\n\r\n\t\t\tif (isIE) {\r\n\t\t\t\to = [];\r\n\r\n\t\t\t\t// Object will throw exception in IE\r\n\t\t\t\tif (n.nodeName == 'OBJECT')\r\n\t\t\t\t\treturn n.attributes;\r\n\r\n\t\t\t\t// IE doesn't keep the selected attribute if you clone option elements\r\n\t\t\t\tif (n.nodeName === 'OPTION' && this.getAttrib(n, 'selected'))\r\n\t\t\t\t\to.push({specified : 1, nodeName : 'selected'});\r\n\r\n\t\t\t\t// It's crazy that this is faster in IE but it's because it returns all attributes all the time\r\n\t\t\t\tn.cloneNode(false).outerHTML.replace(/<\\/?[\\w:\\-]+ ?|=[\\\"][^\\\"]+\\\"|=\\'[^\\']+\\'|=[\\w\\-]+|>/gi, '').replace(/[\\w:\\-]+/gi, function(a) {\r\n\t\t\t\t\to.push({specified : 1, nodeName : a});\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn o;\r\n\t\t\t}\r\n\r\n\t\t\treturn n.attributes;\r\n\t\t},\r\n\r\n\t\tdestroy : function(s) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tif (t.events)\r\n\t\t\t\tt.events.destroy();\r\n\r\n\t\t\tt.win = t.doc = t.root = t.events = null;\r\n\r\n\t\t\t// Manual destroy then remove unload handler\r\n\t\t\tif (!s)\r\n\t\t\t\ttinymce.removeUnload(t.destroy);\r\n\t\t},\r\n\r\n\t\tcreateRng : function() {\r\n\t\t\tvar d = this.doc;\r\n\r\n\t\t\treturn d.createRange ? d.createRange() : new tinymce.dom.Range(this);\r\n\t\t},\r\n\r\n\t\tnodeIndex : function(node, normalized) {\r\n\t\t\tvar idx = 0, lastNodeType, lastNode, nodeType;\r\n\r\n\t\t\tif (node) {\r\n\t\t\t\tfor (lastNodeType = node.nodeType, node = node.previousSibling, lastNode = node; node; node = node.previousSibling) {\r\n\t\t\t\t\tnodeType = node.nodeType;\r\n\r\n\t\t\t\t\t// Normalize text nodes\r\n\t\t\t\t\tif (normalized && nodeType == 3) {\r\n\t\t\t\t\t\tif (nodeType == lastNodeType || !node.nodeValue.length)\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tidx++;\r\n\t\t\t\t\tlastNodeType = nodeType;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn idx;\r\n\t\t},\r\n\r\n\t\tsplit : function(pe, e, re) {\r\n\t\t\tvar t = this, r = t.createRng(), bef, aft, pa;\r\n\r\n\t\t\t// W3C valid browsers tend to leave empty nodes to the left/right side of the contents, this makes sense\r\n\t\t\t// but we don't want that in our code since it serves no purpose for the end user\r\n\t\t\t// For example if this is chopped:\r\n\t\t\t//   <p>text 1<span><b>CHOP</b></span>text 2</p>\r\n\t\t\t// would produce:\r\n\t\t\t//   <p>text 1<span></span></p><b>CHOP</b><p><span></span>text 2</p>\r\n\t\t\t// this function will then trim of empty edges and produce:\r\n\t\t\t//   <p>text 1</p><b>CHOP</b><p>text 2</p>\r\n\t\t\tfunction trim(node) {\r\n\t\t\t\tvar i, children = node.childNodes;\r\n\r\n\t\t\t\tif (node.nodeType == 1 && node.getAttribute('_mce_type') == 'bookmark')\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tfor (i = children.length - 1; i >= 0; i--)\r\n\t\t\t\t\ttrim(children[i]);\r\n\r\n\t\t\t\tif (node.nodeType != 9) {\r\n\t\t\t\t\t// Keep non whitespace text nodes\r\n\t\t\t\t\tif (node.nodeType == 3 && node.nodeValue.length > 0)\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tif (node.nodeType == 1) {\r\n\t\t\t\t\t\t// If the only child is a bookmark then move it up\r\n\t\t\t\t\t\tchildren = node.childNodes;\r\n\t\t\t\t\t\tif (children.length == 1 && children[0] && children[0].nodeType == 1 && children[0].getAttribute('_mce_type') == 'bookmark')\r\n\t\t\t\t\t\t\tnode.parentNode.insertBefore(children[0], node);\r\n\r\n\t\t\t\t\t\t// Keep non empty elements or img, hr etc\r\n\t\t\t\t\t\tif (children.length || /^(br|hr|input|img)$/i.test(node.nodeName))\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tt.remove(node);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn node;\r\n\t\t\t};\r\n\r\n\t\t\tif (pe && e) {\r\n\t\t\t\t// Get before chunk\r\n\t\t\t\tr.setStart(pe.parentNode, t.nodeIndex(pe));\r\n\t\t\t\tr.setEnd(e.parentNode, t.nodeIndex(e));\r\n\t\t\t\tbef = r.extractContents();\r\n\r\n\t\t\t\t// Get after chunk\r\n\t\t\t\tr = t.createRng();\r\n\t\t\t\tr.setStart(e.parentNode, t.nodeIndex(e) + 1);\r\n\t\t\t\tr.setEnd(pe.parentNode, t.nodeIndex(pe) + 1);\r\n\t\t\t\taft = r.extractContents();\r\n\r\n\t\t\t\t// Insert before chunk\r\n\t\t\t\tpa = pe.parentNode;\r\n\t\t\t\tpa.insertBefore(trim(bef), pe);\r\n\r\n\t\t\t\t// Insert middle chunk\r\n\t\t\t\tif (re)\r\n\t\t\t\t\tpa.replaceChild(re, e);\r\n\t\t\t\telse\r\n\t\t\t\t\tpa.insertBefore(e, pe);\r\n\r\n\t\t\t\t// Insert after chunk\r\n\t\t\t\tpa.insertBefore(trim(aft), pe);\r\n\t\t\t\tt.remove(pe);\r\n\r\n\t\t\t\treturn re || e;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tbind : function(target, name, func, scope) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tif (!t.events)\r\n\t\t\t\tt.events = new tinymce.dom.EventUtils();\r\n\r\n\t\t\treturn t.events.add(target, name, func, scope || this);\r\n\t\t},\r\n\r\n\t\tunbind : function(target, name, func) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tif (!t.events)\r\n\t\t\t\tt.events = new tinymce.dom.EventUtils();\r\n\r\n\t\t\treturn t.events.remove(target, name, func);\r\n\t\t},\r\n\r\n\r\n\t\t_findSib : function(node, selector, name) {\r\n\t\t\tvar t = this, f = selector;\r\n\r\n\t\t\tif (node) {\r\n\t\t\t\t// If expression make a function of it using is\r\n\t\t\t\tif (is(f, 'string')) {\r\n\t\t\t\t\tf = function(node) {\r\n\t\t\t\t\t\treturn t.is(node, selector);\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Loop all siblings\r\n\t\t\t\tfor (node = node[name]; node; node = node[name]) {\r\n\t\t\t\t\tif (f(node))\r\n\t\t\t\t\t\treturn node;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\t\t},\r\n\r\n\t\t_isRes : function(c) {\r\n\t\t\t// Is live resizble element\r\n\t\t\treturn /^(top|left|bottom|right|width|height)/i.test(c) || /;\\s*(top|left|bottom|right|width|height)/i.test(c);\r\n\t\t}\r\n\r\n\t\t/*\r\n\t\twalk : function(n, f, s) {\r\n\t\t\tvar d = this.doc, w;\r\n\r\n\t\t\tif (d.createTreeWalker) {\r\n\t\t\t\tw = d.createTreeWalker(n, NodeFilter.SHOW_TEXT, null, false);\r\n\r\n\t\t\t\twhile ((n = w.nextNode()) != null)\r\n\t\t\t\t\tf.call(s || this, n);\r\n\t\t\t} else\r\n\t\t\t\ttinymce.walk(n, f, 'childNodes', s);\r\n\t\t}\r\n\t\t*/\r\n\r\n\t\t/*\r\n\t\ttoRGB : function(s) {\r\n\t\t\tvar c = /^\\s*?#([0-9A-F]{2})([0-9A-F]{1,2})([0-9A-F]{2})?\\s*?$/.exec(s);\r\n\r\n\t\t\tif (c) {\r\n\t\t\t\t// #FFF -> #FFFFFF\r\n\t\t\t\tif (!is(c[3]))\r\n\t\t\t\t\tc[3] = c[2] = c[1];\r\n\r\n\t\t\t\treturn \"rgb(\" + parseInt(c[1], 16) + \",\" + parseInt(c[2], 16) + \",\" + parseInt(c[3], 16) + \")\";\r\n\t\t\t}\r\n\r\n\t\t\treturn s;\r\n\t\t}\r\n\t\t*/\r\n\t});\r\n\r\n\ttinymce.DOM = new tinymce.dom.DOMUtils(document, {process_html : 0});\r\n})(tinymce);\r\n\r\n(function(ns) {\r\n\t// Range constructor\r\n\tfunction Range(dom) {\r\n\t\tvar t = this,\r\n\t\t\tdoc = dom.doc,\r\n\t\t\tEXTRACT = 0,\r\n\t\t\tCLONE = 1,\r\n\t\t\tDELETE = 2,\r\n\t\t\tTRUE = true,\r\n\t\t\tFALSE = false,\r\n\t\t\tSTART_OFFSET = 'startOffset',\r\n\t\t\tSTART_CONTAINER = 'startContainer',\r\n\t\t\tEND_CONTAINER = 'endContainer',\r\n\t\t\tEND_OFFSET = 'endOffset',\r\n\t\t\textend = tinymce.extend,\r\n\t\t\tnodeIndex = dom.nodeIndex;\r\n\r\n\t\textend(t, {\r\n\t\t\t// Inital states\r\n\t\t\tstartContainer : doc,\r\n\t\t\tstartOffset : 0,\r\n\t\t\tendContainer : doc,\r\n\t\t\tendOffset : 0,\r\n\t\t\tcollapsed : TRUE,\r\n\t\t\tcommonAncestorContainer : doc,\r\n\r\n\t\t\t// Range constants\r\n\t\t\tSTART_TO_START : 0,\r\n\t\t\tSTART_TO_END : 1,\r\n\t\t\tEND_TO_END : 2,\r\n\t\t\tEND_TO_START : 3,\r\n\r\n\t\t\t// Public methods\r\n\t\t\tsetStart : setStart,\r\n\t\t\tsetEnd : setEnd,\r\n\t\t\tsetStartBefore : setStartBefore,\r\n\t\t\tsetStartAfter : setStartAfter,\r\n\t\t\tsetEndBefore : setEndBefore,\r\n\t\t\tsetEndAfter : setEndAfter,\r\n\t\t\tcollapse : collapse,\r\n\t\t\tselectNode : selectNode,\r\n\t\t\tselectNodeContents : selectNodeContents,\r\n\t\t\tcompareBoundaryPoints : compareBoundaryPoints,\r\n\t\t\tdeleteContents : deleteContents,\r\n\t\t\textractContents : extractContents,\r\n\t\t\tcloneContents : cloneContents,\r\n\t\t\tinsertNode : insertNode,\r\n\t\t\tsurroundContents : surroundContents,\r\n\t\t\tcloneRange : cloneRange\r\n\t\t});\r\n\r\n\t\tfunction setStart(n, o) {\r\n\t\t\t_setEndPoint(TRUE, n, o);\r\n\t\t};\r\n\r\n\t\tfunction setEnd(n, o) {\r\n\t\t\t_setEndPoint(FALSE, n, o);\r\n\t\t};\r\n\r\n\t\tfunction setStartBefore(n) {\r\n\t\t\tsetStart(n.parentNode, nodeIndex(n));\r\n\t\t};\r\n\r\n\t\tfunction setStartAfter(n) {\r\n\t\t\tsetStart(n.parentNode, nodeIndex(n) + 1);\r\n\t\t};\r\n\r\n\t\tfunction setEndBefore(n) {\r\n\t\t\tsetEnd(n.parentNode, nodeIndex(n));\r\n\t\t};\r\n\r\n\t\tfunction setEndAfter(n) {\r\n\t\t\tsetEnd(n.parentNode, nodeIndex(n) + 1);\r\n\t\t};\r\n\r\n\t\tfunction collapse(ts) {\r\n\t\t\tif (ts) {\r\n\t\t\t\tt[END_CONTAINER] = t[START_CONTAINER];\r\n\t\t\t\tt[END_OFFSET] = t[START_OFFSET];\r\n\t\t\t} else {\r\n\t\t\t\tt[START_CONTAINER] = t[END_CONTAINER];\r\n\t\t\t\tt[START_OFFSET] = t[END_OFFSET];\r\n\t\t\t}\r\n\r\n\t\t\tt.collapsed = TRUE;\r\n\t\t};\r\n\r\n\t\tfunction selectNode(n) {\r\n\t\t\tsetStartBefore(n);\r\n\t\t\tsetEndAfter(n);\r\n\t\t};\r\n\r\n\t\tfunction selectNodeContents(n) {\r\n\t\t\tsetStart(n, 0);\r\n\t\t\tsetEnd(n, n.nodeType === 1 ? n.childNodes.length : n.nodeValue.length);\r\n\t\t};\r\n\r\n\t\tfunction compareBoundaryPoints(h, r) {\r\n\t\t\tvar sc = t[START_CONTAINER], so = t[START_OFFSET], ec = t[END_CONTAINER], eo = t[END_OFFSET];\r\n\r\n\t\t\t// Check START_TO_START\r\n\t\t\tif (h === 0)\r\n\t\t\t\treturn _compareBoundaryPoints(sc, so, sc, so);\r\n\r\n\t\t\t// Check START_TO_END\r\n\t\t\tif (h === 1)\r\n\t\t\t\treturn _compareBoundaryPoints(sc, so, ec, eo);\r\n\r\n\t\t\t// Check END_TO_END\r\n\t\t\tif (h === 2)\r\n\t\t\t\treturn _compareBoundaryPoints(ec, eo, ec, eo);\r\n\r\n\t\t\t// Check END_TO_START\r\n\t\t\tif (h === 3)\r\n\t\t\t\treturn _compareBoundaryPoints(ec, eo, sc, so);\r\n\t\t};\r\n\r\n\t\tfunction deleteContents() {\r\n\t\t\t_traverse(DELETE);\r\n\t\t};\r\n\r\n\t\tfunction extractContents() {\r\n\t\t\treturn _traverse(EXTRACT);\r\n\t\t};\r\n\r\n\t\tfunction cloneContents() {\r\n\t\t\treturn _traverse(CLONE);\r\n\t\t};\r\n\r\n\t\tfunction insertNode(n) {\r\n\t\t\tvar startContainer = this[START_CONTAINER],\r\n\t\t\t\tstartOffset = this[START_OFFSET], nn, o;\r\n\r\n\t\t\t// Node is TEXT_NODE or CDATA\r\n\t\t\tif ((startContainer.nodeType === 3 || startContainer.nodeType === 4) && startContainer.nodeValue) {\r\n\t\t\t\tif (!startOffset) {\r\n\t\t\t\t\t// At the start of text\r\n\t\t\t\t\tstartContainer.parentNode.insertBefore(n, startContainer);\r\n\t\t\t\t} else if (startOffset >= startContainer.nodeValue.length) {\r\n\t\t\t\t\t// At the end of text\r\n\t\t\t\t\tdom.insertAfter(n, startContainer);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Middle, need to split\r\n\t\t\t\t\tnn = startContainer.splitText(startOffset);\r\n\t\t\t\t\tstartContainer.parentNode.insertBefore(n, nn);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// Insert element node\r\n\t\t\t\tif (startContainer.childNodes.length > 0)\r\n\t\t\t\t\to = startContainer.childNodes[startOffset];\r\n\r\n\t\t\t\tif (o)\r\n\t\t\t\t\tstartContainer.insertBefore(n, o);\r\n\t\t\t\telse\r\n\t\t\t\t\tstartContainer.appendChild(n);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction surroundContents(n) {\r\n\t\t\tvar f = t.extractContents();\r\n\r\n\t\t\tt.insertNode(n);\r\n\t\t\tn.appendChild(f);\r\n\t\t\tt.selectNode(n);\r\n\t\t};\r\n\r\n\t\tfunction cloneRange() {\r\n\t\t\treturn extend(new Range(dom), {\r\n\t\t\t\tstartContainer : t[START_CONTAINER],\r\n\t\t\t\tstartOffset : t[START_OFFSET],\r\n\t\t\t\tendContainer : t[END_CONTAINER],\r\n\t\t\t\tendOffset : t[END_OFFSET],\r\n\t\t\t\tcollapsed : t.collapsed,\r\n\t\t\t\tcommonAncestorContainer : t.commonAncestorContainer\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t// Private methods\r\n\r\n\t\tfunction _getSelectedNode(container, offset) {\r\n\t\t\tvar child;\r\n\r\n\t\t\tif (container.nodeType == 3 /* TEXT_NODE */)\r\n\t\t\t\treturn container;\r\n\r\n\t\t\tif (offset < 0)\r\n\t\t\t\treturn container;\r\n\r\n\t\t\tchild = container.firstChild;\r\n\t\t\twhile (child && offset > 0) {\r\n\t\t\t\t--offset;\r\n\t\t\t\tchild = child.nextSibling;\r\n\t\t\t}\r\n\r\n\t\t\tif (child)\r\n\t\t\t\treturn child;\r\n\r\n\t\t\treturn container;\r\n\t\t};\r\n\r\n\t\tfunction _isCollapsed() {\r\n\t\t\treturn (t[START_CONTAINER] == t[END_CONTAINER] && t[START_OFFSET] == t[END_OFFSET]);\r\n\t\t};\r\n\r\n\t\tfunction _compareBoundaryPoints(containerA, offsetA, containerB, offsetB) {\r\n\t\t\tvar c, offsetC, n, cmnRoot, childA, childB;\r\n\r\n\t\t\t// In the first case the boundary-points have the same container. A is before B\r\n\t\t\t// if its offset is less than the offset of B, A is equal to B if its offset is\r\n\t\t\t// equal to the offset of B, and A is after B if its offset is greater than the\r\n\t\t\t// offset of B.\r\n\t\t\tif (containerA == containerB) {\r\n\t\t\t\tif (offsetA == offsetB)\r\n\t\t\t\t\treturn 0; // equal\r\n\r\n\t\t\t\tif (offsetA < offsetB)\r\n\t\t\t\t\treturn -1; // before\r\n\r\n\t\t\t\treturn 1; // after\r\n\t\t\t}\r\n\r\n\t\t\t// In the second case a child node C of the container of A is an ancestor\r\n\t\t\t// container of B. In this case, A is before B if the offset of A is less than or\r\n\t\t\t// equal to the index of the child node C and A is after B otherwise.\r\n\t\t\tc = containerB;\r\n\t\t\twhile (c && c.parentNode != containerA)\r\n\t\t\t\tc = c.parentNode;\r\n\r\n\t\t\tif (c) {\r\n\t\t\t\toffsetC = 0;\r\n\t\t\t\tn = containerA.firstChild;\r\n\r\n\t\t\t\twhile (n != c && offsetC < offsetA) {\r\n\t\t\t\t\toffsetC++;\r\n\t\t\t\t\tn = n.nextSibling;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (offsetA <= offsetC)\r\n\t\t\t\t\treturn -1; // before\r\n\r\n\t\t\t\treturn 1; // after\r\n\t\t\t}\r\n\r\n\t\t\t// In the third case a child node C of the container of B is an ancestor container\r\n\t\t\t// of A. In this case, A is before B if the index of the child node C is less than\r\n\t\t\t// the offset of B and A is after B otherwise.\r\n\t\t\tc = containerA;\r\n\t\t\twhile (c && c.parentNode != containerB) {\r\n\t\t\t\tc = c.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\tif (c) {\r\n\t\t\t\toffsetC = 0;\r\n\t\t\t\tn = containerB.firstChild;\r\n\r\n\t\t\t\twhile (n != c && offsetC < offsetB) {\r\n\t\t\t\t\toffsetC++;\r\n\t\t\t\t\tn = n.nextSibling;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (offsetC < offsetB)\r\n\t\t\t\t\treturn -1; // before\r\n\r\n\t\t\t\treturn 1; // after\r\n\t\t\t}\r\n\r\n\t\t\t// In the fourth case, none of three other cases hold: the containers of A and B\r\n\t\t\t// are siblings or descendants of sibling nodes. In this case, A is before B if\r\n\t\t\t// the container of A is before the container of B in a pre-order traversal of the\r\n\t\t\t// Ranges' context tree and A is after B otherwise.\r\n\t\t\tcmnRoot = dom.findCommonAncestor(containerA, containerB);\r\n\t\t\tchildA = containerA;\r\n\r\n\t\t\twhile (childA && childA.parentNode != cmnRoot)\r\n\t\t\t\tchildA = childA.parentNode;\r\n\r\n\t\t\tif (!childA)\r\n\t\t\t\tchildA = cmnRoot;\r\n\r\n\t\t\tchildB = containerB;\r\n\t\t\twhile (childB && childB.parentNode != cmnRoot)\r\n\t\t\t\tchildB = childB.parentNode;\r\n\r\n\t\t\tif (!childB)\r\n\t\t\t\tchildB = cmnRoot;\r\n\r\n\t\t\tif (childA == childB)\r\n\t\t\t\treturn 0; // equal\r\n\r\n\t\t\tn = cmnRoot.firstChild;\r\n\t\t\twhile (n) {\r\n\t\t\t\tif (n == childA)\r\n\t\t\t\t\treturn -1; // before\r\n\r\n\t\t\t\tif (n == childB)\r\n\t\t\t\t\treturn 1; // after\r\n\r\n\t\t\t\tn = n.nextSibling;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction _setEndPoint(st, n, o) {\r\n\t\t\tvar ec, sc;\r\n\r\n\t\t\tif (st) {\r\n\t\t\t\tt[START_CONTAINER] = n;\r\n\t\t\t\tt[START_OFFSET] = o;\r\n\t\t\t} else {\r\n\t\t\t\tt[END_CONTAINER] = n;\r\n\t\t\t\tt[END_OFFSET] = o;\r\n\t\t\t}\r\n\r\n\t\t\t// If one boundary-point of a Range is set to have a root container\r\n\t\t\t// other than the current one for the Range, the Range is collapsed to\r\n\t\t\t// the new position. This enforces the restriction that both boundary-\r\n\t\t\t// points of a Range must have the same root container.\r\n\t\t\tec = t[END_CONTAINER];\r\n\t\t\twhile (ec.parentNode)\r\n\t\t\t\tec = ec.parentNode;\r\n\r\n\t\t\tsc = t[START_CONTAINER];\r\n\t\t\twhile (sc.parentNode)\r\n\t\t\t\tsc = sc.parentNode;\r\n\r\n\t\t\tif (sc == ec) {\r\n\t\t\t\t// The start position of a Range is guaranteed to never be after the\r\n\t\t\t\t// end position. To enforce this restriction, if the start is set to\r\n\t\t\t\t// be at a position after the end, the Range is collapsed to that\r\n\t\t\t\t// position.\r\n\t\t\t\tif (_compareBoundaryPoints(t[START_CONTAINER], t[START_OFFSET], t[END_CONTAINER], t[END_OFFSET]) > 0)\r\n\t\t\t\t\tt.collapse(st);\r\n\t\t\t} else\r\n\t\t\t\tt.collapse(st);\r\n\r\n\t\t\tt.collapsed = _isCollapsed();\r\n\t\t\tt.commonAncestorContainer = dom.findCommonAncestor(t[START_CONTAINER], t[END_CONTAINER]);\r\n\t\t};\r\n\r\n\t\tfunction _traverse(how) {\r\n\t\t\tvar c, endContainerDepth = 0, startContainerDepth = 0, p, depthDiff, startNode, endNode, sp, ep;\r\n\r\n\t\t\tif (t[START_CONTAINER] == t[END_CONTAINER])\r\n\t\t\t\treturn _traverseSameContainer(how);\r\n\r\n\t\t\tfor (c = t[END_CONTAINER], p = c.parentNode; p; c = p, p = p.parentNode) {\r\n\t\t\t\tif (p == t[START_CONTAINER])\r\n\t\t\t\t\treturn _traverseCommonStartContainer(c, how);\r\n\r\n\t\t\t\t++endContainerDepth;\r\n\t\t\t}\r\n\r\n\t\t\tfor (c = t[START_CONTAINER], p = c.parentNode; p; c = p, p = p.parentNode) {\r\n\t\t\t\tif (p == t[END_CONTAINER])\r\n\t\t\t\t\treturn _traverseCommonEndContainer(c, how);\r\n\r\n\t\t\t\t++startContainerDepth;\r\n\t\t\t}\r\n\r\n\t\t\tdepthDiff = startContainerDepth - endContainerDepth;\r\n\r\n\t\t\tstartNode = t[START_CONTAINER];\r\n\t\t\twhile (depthDiff > 0) {\r\n\t\t\t\tstartNode = startNode.parentNode;\r\n\t\t\t\tdepthDiff--;\r\n\t\t\t}\r\n\r\n\t\t\tendNode = t[END_CONTAINER];\r\n\t\t\twhile (depthDiff < 0) {\r\n\t\t\t\tendNode = endNode.parentNode;\r\n\t\t\t\tdepthDiff++;\r\n\t\t\t}\r\n\r\n\t\t\t// ascend the ancestor hierarchy until we have a common parent.\r\n\t\t\tfor (sp = startNode.parentNode, ep = endNode.parentNode; sp != ep; sp = sp.parentNode, ep = ep.parentNode) {\r\n\t\t\t\tstartNode = sp;\r\n\t\t\t\tendNode = ep;\r\n\t\t\t}\r\n\r\n\t\t\treturn _traverseCommonAncestors(startNode, endNode, how);\r\n\t\t};\r\n\r\n\t\t function _traverseSameContainer(how) {\r\n\t\t\tvar frag, s, sub, n, cnt, sibling, xferNode;\r\n\r\n\t\t\tif (how != DELETE)\r\n\t\t\t\tfrag = doc.createDocumentFragment();\r\n\r\n\t\t\t// If selection is empty, just return the fragment\r\n\t\t\tif (t[START_OFFSET] == t[END_OFFSET])\r\n\t\t\t\treturn frag;\r\n\r\n\t\t\t// Text node needs special case handling\r\n\t\t\tif (t[START_CONTAINER].nodeType == 3 /* TEXT_NODE */) {\r\n\t\t\t\t// get the substring\r\n\t\t\t\ts = t[START_CONTAINER].nodeValue;\r\n\t\t\t\tsub = s.substring(t[START_OFFSET], t[END_OFFSET]);\r\n\r\n\t\t\t\t// set the original text node to its new value\r\n\t\t\t\tif (how != CLONE) {\r\n\t\t\t\t\tt[START_CONTAINER].deleteData(t[START_OFFSET], t[END_OFFSET] - t[START_OFFSET]);\r\n\r\n\t\t\t\t\t// Nothing is partially selected, so collapse to start point\r\n\t\t\t\t\tt.collapse(TRUE);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (how == DELETE)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tfrag.appendChild(doc.createTextNode(sub));\r\n\t\t\t\treturn frag;\r\n\t\t\t}\r\n\r\n\t\t\t// Copy nodes between the start/end offsets.\r\n\t\t\tn = _getSelectedNode(t[START_CONTAINER], t[START_OFFSET]);\r\n\t\t\tcnt = t[END_OFFSET] - t[START_OFFSET];\r\n\r\n\t\t\twhile (cnt > 0) {\r\n\t\t\t\tsibling = n.nextSibling;\r\n\t\t\t\txferNode = _traverseFullySelected(n, how);\r\n\r\n\t\t\t\tif (frag)\r\n\t\t\t\t\tfrag.appendChild( xferNode );\r\n\r\n\t\t\t\t--cnt;\r\n\t\t\t\tn = sibling;\r\n\t\t\t}\r\n\r\n\t\t\t// Nothing is partially selected, so collapse to start point\r\n\t\t\tif (how != CLONE)\r\n\t\t\t\tt.collapse(TRUE);\r\n\r\n\t\t\treturn frag;\r\n\t\t};\r\n\r\n\t\tfunction _traverseCommonStartContainer(endAncestor, how) {\r\n\t\t\tvar frag, n, endIdx, cnt, sibling, xferNode;\r\n\r\n\t\t\tif (how != DELETE)\r\n\t\t\t\tfrag = doc.createDocumentFragment();\r\n\r\n\t\t\tn = _traverseRightBoundary(endAncestor, how);\r\n\r\n\t\t\tif (frag)\r\n\t\t\t\tfrag.appendChild(n);\r\n\r\n\t\t\tendIdx = nodeIndex(endAncestor);\r\n\t\t\tcnt = endIdx - t[START_OFFSET];\r\n\r\n\t\t\tif (cnt <= 0) {\r\n\t\t\t\t// Collapse to just before the endAncestor, which\r\n\t\t\t\t// is partially selected.\r\n\t\t\t\tif (how != CLONE) {\r\n\t\t\t\t\tt.setEndBefore(endAncestor);\r\n\t\t\t\t\tt.collapse(FALSE);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn frag;\r\n\t\t\t}\r\n\r\n\t\t\tn = endAncestor.previousSibling;\r\n\t\t\twhile (cnt > 0) {\r\n\t\t\t\tsibling = n.previousSibling;\r\n\t\t\t\txferNode = _traverseFullySelected(n, how);\r\n\r\n\t\t\t\tif (frag)\r\n\t\t\t\t\tfrag.insertBefore(xferNode, frag.firstChild);\r\n\r\n\t\t\t\t--cnt;\r\n\t\t\t\tn = sibling;\r\n\t\t\t}\r\n\r\n\t\t\t// Collapse to just before the endAncestor, which\r\n\t\t\t// is partially selected.\r\n\t\t\tif (how != CLONE) {\r\n\t\t\t\tt.setEndBefore(endAncestor);\r\n\t\t\t\tt.collapse(FALSE);\r\n\t\t\t}\r\n\r\n\t\t\treturn frag;\r\n\t\t};\r\n\r\n\t\tfunction _traverseCommonEndContainer(startAncestor, how) {\r\n\t\t\tvar frag, startIdx, n, cnt, sibling, xferNode;\r\n\r\n\t\t\tif (how != DELETE)\r\n\t\t\t\tfrag = doc.createDocumentFragment();\r\n\r\n\t\t\tn = _traverseLeftBoundary(startAncestor, how);\r\n\t\t\tif (frag)\r\n\t\t\t\tfrag.appendChild(n);\r\n\r\n\t\t\tstartIdx = nodeIndex(startAncestor);\r\n\t\t\t++startIdx;  // Because we already traversed it....\r\n\r\n\t\t\tcnt = t[END_OFFSET] - startIdx;\r\n\t\t\tn = startAncestor.nextSibling;\r\n\t\t\twhile (cnt > 0) {\r\n\t\t\t\tsibling = n.nextSibling;\r\n\t\t\t\txferNode = _traverseFullySelected(n, how);\r\n\r\n\t\t\t\tif (frag)\r\n\t\t\t\t\tfrag.appendChild(xferNode);\r\n\r\n\t\t\t\t--cnt;\r\n\t\t\t\tn = sibling;\r\n\t\t\t}\r\n\r\n\t\t\tif (how != CLONE) {\r\n\t\t\t\tt.setStartAfter(startAncestor);\r\n\t\t\t\tt.collapse(TRUE);\r\n\t\t\t}\r\n\r\n\t\t\treturn frag;\r\n\t\t};\r\n\r\n\t\tfunction _traverseCommonAncestors(startAncestor, endAncestor, how) {\r\n\t\t\tvar n, frag, commonParent, startOffset, endOffset, cnt, sibling, nextSibling;\r\n\r\n\t\t\tif (how != DELETE)\r\n\t\t\t\tfrag = doc.createDocumentFragment();\r\n\r\n\t\t\tn = _traverseLeftBoundary(startAncestor, how);\r\n\t\t\tif (frag)\r\n\t\t\t\tfrag.appendChild(n);\r\n\r\n\t\t\tcommonParent = startAncestor.parentNode;\r\n\t\t\tstartOffset = nodeIndex(startAncestor);\r\n\t\t\tendOffset = nodeIndex(endAncestor);\r\n\t\t\t++startOffset;\r\n\r\n\t\t\tcnt = endOffset - startOffset;\r\n\t\t\tsibling = startAncestor.nextSibling;\r\n\r\n\t\t\twhile (cnt > 0) {\r\n\t\t\t\tnextSibling = sibling.nextSibling;\r\n\t\t\t\tn = _traverseFullySelected(sibling, how);\r\n\r\n\t\t\t\tif (frag)\r\n\t\t\t\t\tfrag.appendChild(n);\r\n\r\n\t\t\t\tsibling = nextSibling;\r\n\t\t\t\t--cnt;\r\n\t\t\t}\r\n\r\n\t\t\tn = _traverseRightBoundary(endAncestor, how);\r\n\r\n\t\t\tif (frag)\r\n\t\t\t\tfrag.appendChild(n);\r\n\r\n\t\t\tif (how != CLONE) {\r\n\t\t\t\tt.setStartAfter(startAncestor);\r\n\t\t\t\tt.collapse(TRUE);\r\n\t\t\t}\r\n\r\n\t\t\treturn frag;\r\n\t\t};\r\n\r\n\t\tfunction _traverseRightBoundary(root, how) {\r\n\t\t\tvar next = _getSelectedNode(t[END_CONTAINER], t[END_OFFSET] - 1), parent, clonedParent, prevSibling, clonedChild, clonedGrandParent, isFullySelected = next != t[END_CONTAINER];\r\n\r\n\t\t\tif (next == root)\r\n\t\t\t\treturn _traverseNode(next, isFullySelected, FALSE, how);\r\n\r\n\t\t\tparent = next.parentNode;\r\n\t\t\tclonedParent = _traverseNode(parent, FALSE, FALSE, how);\r\n\r\n\t\t\twhile (parent) {\r\n\t\t\t\twhile (next) {\r\n\t\t\t\t\tprevSibling = next.previousSibling;\r\n\t\t\t\t\tclonedChild = _traverseNode(next, isFullySelected, FALSE, how);\r\n\r\n\t\t\t\t\tif (how != DELETE)\r\n\t\t\t\t\t\tclonedParent.insertBefore(clonedChild, clonedParent.firstChild);\r\n\r\n\t\t\t\t\tisFullySelected = TRUE;\r\n\t\t\t\t\tnext = prevSibling;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (parent == root)\r\n\t\t\t\t\treturn clonedParent;\r\n\r\n\t\t\t\tnext = parent.previousSibling;\r\n\t\t\t\tparent = parent.parentNode;\r\n\r\n\t\t\t\tclonedGrandParent = _traverseNode(parent, FALSE, FALSE, how);\r\n\r\n\t\t\t\tif (how != DELETE)\r\n\t\t\t\t\tclonedGrandParent.appendChild(clonedParent);\r\n\r\n\t\t\t\tclonedParent = clonedGrandParent;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction _traverseLeftBoundary(root, how) {\r\n\t\t\tvar next = _getSelectedNode(t[START_CONTAINER], t[START_OFFSET]), isFullySelected = next != t[START_CONTAINER], parent, clonedParent, nextSibling, clonedChild, clonedGrandParent;\r\n\r\n\t\t\tif (next == root)\r\n\t\t\t\treturn _traverseNode(next, isFullySelected, TRUE, how);\r\n\r\n\t\t\tparent = next.parentNode;\r\n\t\t\tclonedParent = _traverseNode(parent, FALSE, TRUE, how);\r\n\r\n\t\t\twhile (parent) {\r\n\t\t\t\twhile (next) {\r\n\t\t\t\t\tnextSibling = next.nextSibling;\r\n\t\t\t\t\tclonedChild = _traverseNode(next, isFullySelected, TRUE, how);\r\n\r\n\t\t\t\t\tif (how != DELETE)\r\n\t\t\t\t\t\tclonedParent.appendChild(clonedChild);\r\n\r\n\t\t\t\t\tisFullySelected = TRUE;\r\n\t\t\t\t\tnext = nextSibling;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (parent == root)\r\n\t\t\t\t\treturn clonedParent;\r\n\r\n\t\t\t\tnext = parent.nextSibling;\r\n\t\t\t\tparent = parent.parentNode;\r\n\r\n\t\t\t\tclonedGrandParent = _traverseNode(parent, FALSE, TRUE, how);\r\n\r\n\t\t\t\tif (how != DELETE)\r\n\t\t\t\t\tclonedGrandParent.appendChild(clonedParent);\r\n\r\n\t\t\t\tclonedParent = clonedGrandParent;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction _traverseNode(n, isFullySelected, isLeft, how) {\r\n\t\t\tvar txtValue, newNodeValue, oldNodeValue, offset, newNode;\r\n\r\n\t\t\tif (isFullySelected)\r\n\t\t\t\treturn _traverseFullySelected(n, how);\r\n\r\n\t\t\tif (n.nodeType == 3 /* TEXT_NODE */) {\r\n\t\t\t\ttxtValue = n.nodeValue;\r\n\r\n\t\t\t\tif (isLeft) {\r\n\t\t\t\t\toffset = t[START_OFFSET];\r\n\t\t\t\t\tnewNodeValue = txtValue.substring(offset);\r\n\t\t\t\t\toldNodeValue = txtValue.substring(0, offset);\r\n\t\t\t\t} else {\r\n\t\t\t\t\toffset = t[END_OFFSET];\r\n\t\t\t\t\tnewNodeValue = txtValue.substring(0, offset);\r\n\t\t\t\t\toldNodeValue = txtValue.substring(offset);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (how != CLONE)\r\n\t\t\t\t\tn.nodeValue = oldNodeValue;\r\n\r\n\t\t\t\tif (how == DELETE)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tnewNode = n.cloneNode(FALSE);\r\n\t\t\t\tnewNode.nodeValue = newNodeValue;\r\n\r\n\t\t\t\treturn newNode;\r\n\t\t\t}\r\n\r\n\t\t\tif (how == DELETE)\r\n\t\t\t\treturn;\r\n\r\n\t\t\treturn n.cloneNode(FALSE);\r\n\t\t};\r\n\r\n\t\tfunction _traverseFullySelected(n, how) {\r\n\t\t\tif (how != DELETE)\r\n\t\t\t\treturn how == CLONE ? n.cloneNode(TRUE) : n;\r\n\r\n\t\t\tn.parentNode.removeChild(n);\r\n\t\t};\r\n\t};\r\n\r\n\tns.Range = Range;\r\n})(tinymce.dom);\r\n\r\n(function() {\r\n\tfunction Selection(selection) {\r\n\t\tvar t = this, invisibleChar = '\\uFEFF', range, lastIERng, dom = selection.dom, TRUE = true, FALSE = false;\r\n\r\n\t\t// Returns a W3C DOM compatible range object by using the IE Range API\r\n\t\tfunction getRange() {\r\n\t\t\tvar ieRange = selection.getRng(), domRange = dom.createRng(), element, collapsed;\r\n\r\n\t\t\t// If selection is outside the current document just return an empty range\r\n\t\t\telement = ieRange.item ? ieRange.item(0) : ieRange.parentElement();\r\n\t\t\tif (element.ownerDocument != dom.doc)\r\n\t\t\t\treturn domRange;\r\n\r\n\t\t\t// Handle control selection or text selection of a image\r\n\t\t\tif (ieRange.item || !element.hasChildNodes()) {\r\n\t\t\t\tdomRange.setStart(element.parentNode, dom.nodeIndex(element));\r\n\t\t\t\tdomRange.setEnd(domRange.startContainer, domRange.startOffset + 1);\r\n\r\n\t\t\t\treturn domRange;\r\n\t\t\t}\r\n\r\n\t\t\tcollapsed = selection.isCollapsed();\r\n\r\n\t\t\tfunction findEndPoint(start) {\r\n\t\t\t\tvar marker, container, offset, nodes, startIndex = 0, endIndex, index, parent, checkRng, position;\r\n\r\n\t\t\t\t// Setup temp range and collapse it\r\n\t\t\t\tcheckRng = ieRange.duplicate();\r\n\t\t\t\tcheckRng.collapse(start);\r\n\r\n\t\t\t\t// Create marker and insert it at the end of the endpoints parent\r\n\t\t\t\tmarker = dom.create('a');\r\n\t\t\t\tparent = checkRng.parentElement();\r\n\r\n\t\t\t\t// If parent doesn't have any children then set the container to that parent and the index to 0\r\n\t\t\t\tif (!parent.hasChildNodes()) {\r\n\t\t\t\t\tdomRange[start ? 'setStart' : 'setEnd'](parent, 0);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tparent.appendChild(marker);\r\n\t\t\t\tcheckRng.moveToElementText(marker);\r\n\t\t\t\tposition = ieRange.compareEndPoints(start ? 'StartToStart' : 'EndToEnd', checkRng);\r\n\t\t\t\tif (position > 0) {\r\n\t\t\t\t\t// The position is after the end of the parent element.\r\n\t\t\t\t\t// This is the case where IE puts the caret to the left edge of a table.\r\n\t\t\t\t\tdomRange[start ? 'setStartAfter' : 'setEndAfter'](parent);\r\n\t\t\t\t\tdom.remove(marker);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Setup node list and endIndex\r\n\t\t\t\tnodes = tinymce.grep(parent.childNodes);\r\n\t\t\t\tendIndex = nodes.length - 1;\r\n\t\t\t\t// Perform a binary search for the position\r\n\t\t\t\twhile (startIndex <= endIndex) {\r\n\t\t\t\t\tindex = Math.floor((startIndex + endIndex) / 2);\r\n\r\n\t\t\t\t\t// Insert marker and check it's position relative to the selection\r\n\t\t\t\t\tparent.insertBefore(marker, nodes[index]);\r\n\t\t\t\t\tcheckRng.moveToElementText(marker);\r\n\t\t\t\t\tposition = ieRange.compareEndPoints(start ? 'StartToStart' : 'EndToEnd', checkRng);\r\n\t\t\t\t\tif (position > 0) {\r\n\t\t\t\t\t\t// Marker is to the right\r\n\t\t\t\t\t\tstartIndex = index + 1;\r\n\t\t\t\t\t} else if (position < 0) {\r\n\t\t\t\t\t\t// Marker is to the left\r\n\t\t\t\t\t\tendIndex = index - 1;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Maker is where we are\r\n\t\t\t\t\t\tfound = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Setup container\r\n\t\t\t\tcontainer = position > 0 || index == 0 ? marker.nextSibling : marker.previousSibling;\r\n\r\n\t\t\t\t// Handle element selection\r\n\t\t\t\tif (container.nodeType == 1) {\r\n\t\t\t\t\tdom.remove(marker);\r\n\r\n\t\t\t\t\t// Find offset and container\r\n\t\t\t\t\toffset = dom.nodeIndex(container);\r\n\t\t\t\t\tcontainer = container.parentNode;\r\n\r\n\t\t\t\t\t// Move the offset if we are setting the end or the position is after an element\r\n\t\t\t\t\tif (!start || index > 0)\r\n\t\t\t\t\t\toffset++;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Calculate offset within text node\r\n\t\t\t\t\tif (position > 0 || index == 0) {\r\n\t\t\t\t\t\tcheckRng.setEndPoint(start ? 'StartToStart' : 'EndToEnd', ieRange);\r\n\t\t\t\t\t\toffset = checkRng.text.length;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcheckRng.setEndPoint(start ? 'StartToStart' : 'EndToEnd', ieRange);\r\n\t\t\t\t\t\toffset = container.nodeValue.length - checkRng.text.length;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdom.remove(marker);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdomRange[start ? 'setStart' : 'setEnd'](container, offset);\r\n\t\t\t};\r\n\r\n\t\t\t// Find start point\r\n\t\t\tfindEndPoint(true);\r\n\r\n\t\t\t// Find end point if needed\r\n\t\t\tif (!collapsed)\r\n\t\t\t\tfindEndPoint();\r\n\r\n\t\t\treturn domRange;\r\n\t\t};\r\n\r\n\t\tthis.addRange = function(rng) {\r\n\t\t\tvar ieRng, ctrlRng, startContainer, startOffset, endContainer, endOffset, doc = selection.dom.doc, body = doc.body;\r\n\r\n\t\t\tfunction setEndPoint(start) {\r\n\t\t\t\tvar container, offset, marker, tmpRng, nodes;\r\n\r\n\t\t\t\tmarker = dom.create('a');\r\n\t\t\t\tcontainer = start ? startContainer : endContainer;\r\n\t\t\t\toffset = start ? startOffset : endOffset;\r\n\t\t\t\ttmpRng = ieRng.duplicate();\r\n\r\n\t\t\t\tif (container == doc) {\r\n\t\t\t\t\tcontainer = body;\r\n\t\t\t\t\toffset = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (container.nodeType == 3) {\r\n\t\t\t\t\tcontainer.parentNode.insertBefore(marker, container);\r\n\t\t\t\t\ttmpRng.moveToElementText(marker);\r\n\t\t\t\t\ttmpRng.moveStart('character', offset);\r\n\t\t\t\t\tdom.remove(marker);\r\n\t\t\t\t\tieRng.setEndPoint(start ? 'StartToStart' : 'EndToEnd', tmpRng);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnodes = container.childNodes;\r\n\r\n\t\t\t\t\tif (nodes.length) {\r\n\t\t\t\t\t\tif (offset >= nodes.length) {\r\n\t\t\t\t\t\t\tdom.insertAfter(marker, nodes[nodes.length - 1]);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcontainer.insertBefore(marker, nodes[offset]);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\ttmpRng.moveToElementText(marker);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Empty node selection for example <div>|</div>\r\n\t\t\t\t\t\tmarker = doc.createTextNode(invisibleChar);\r\n\t\t\t\t\t\tcontainer.appendChild(marker);\r\n\t\t\t\t\t\ttmpRng.moveToElementText(marker.parentNode);\r\n\t\t\t\t\t\ttmpRng.collapse(TRUE);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tieRng.setEndPoint(start ? 'StartToStart' : 'EndToEnd', tmpRng);\r\n\t\t\t\t\tdom.remove(marker);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Destroy cached range\r\n\t\t\tthis.destroy();\r\n\r\n\t\t\t// Setup some shorter versions\r\n\t\t\tstartContainer = rng.startContainer;\r\n\t\t\tstartOffset = rng.startOffset;\r\n\t\t\tendContainer = rng.endContainer;\r\n\t\t\tendOffset = rng.endOffset;\r\n\t\t\tieRng = body.createTextRange();\r\n\r\n\t\t\t// If single element selection then try making a control selection out of it\r\n\t\t\tif (startContainer == endContainer && startContainer.nodeType == 1 && startOffset == endOffset - 1) {\r\n\t\t\t\tif (startOffset == endOffset - 1) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tctrlRng = body.createControlRange();\r\n\t\t\t\t\t\tctrlRng.addElement(startContainer.childNodes[startOffset]);\r\n\t\t\t\t\t\tctrlRng.select();\r\n\t\t\t\t\t\tctrlRng.scrollIntoView();\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t// Ignore\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Set start/end point of selection\r\n\t\t\tsetEndPoint(true);\r\n\t\t\tsetEndPoint();\r\n\r\n\t\t\t// Select the new range and scroll it into view\r\n\t\t\tieRng.select();\r\n\t\t\tieRng.scrollIntoView();\r\n\t\t};\r\n\r\n\t\tthis.getRangeAt = function() {\r\n\t\t\t// Setup new range if the cache is empty\r\n\t\t\tif (!range || !tinymce.dom.RangeUtils.compareRanges(lastIERng, selection.getRng())) {\r\n\t\t\t\trange = getRange();\r\n\r\n\t\t\t\t// Store away text range for next call\r\n\t\t\t\tlastIERng = selection.getRng();\r\n\t\t\t}\r\n\r\n\t\t\t// IE will say that the range is equal then produce an invalid argument exception\r\n\t\t\t// if you perform specific operations in a keyup event. For example Ctrl+Del.\r\n\t\t\t// This hack will invalidate the range cache if the exception occurs\r\n\t\t\ttry {\r\n\t\t\t\trange.startContainer.nextSibling;\r\n\t\t\t} catch (ex) {\r\n\t\t\t\trange = getRange();\r\n\t\t\t\tlastIERng = null;\r\n\t\t\t}\r\n\r\n\t\t\t// Return cached range\r\n\t\t\treturn range;\r\n\t\t};\r\n\r\n\t\tthis.destroy = function() {\r\n\t\t\t// Destroy cached range and last IE range to avoid memory leaks\r\n\t\t\tlastIERng = range = null;\r\n\t\t};\r\n\r\n\t\t// IE has an issue where you can't select/move the caret by clicking outside the body if the document is in standards mode\r\n\t\tif (selection.dom.boxModel) {\r\n\t\t\t(function() {\r\n\t\t\t\tvar doc = dom.doc, body = doc.body, started, startRng;\r\n\r\n\t\t\t\t// Make HTML element unselectable since we are going to handle selection by hand\r\n\t\t\t\tdoc.documentElement.unselectable = TRUE;\r\n\r\n\t\t\t\t// Return range from point or null if it failed\r\n\t\t\t\tfunction rngFromPoint(x, y) {\r\n\t\t\t\t\tvar rng = body.createTextRange();\r\n\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\trng.moveToPoint(x, y);\r\n\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t// IE sometimes throws and exception, so lets just ignore it\r\n\t\t\t\t\t\trng = null;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn rng;\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Fires while the selection is changing\r\n\t\t\t\tfunction selectionChange(e) {\r\n\t\t\t\t\tvar pointRng;\r\n\r\n\t\t\t\t\t// Check if the button is down or not\r\n\t\t\t\t\tif (e.button) {\r\n\t\t\t\t\t\t// Create range from mouse position\r\n\t\t\t\t\t\tpointRng = rngFromPoint(e.x, e.y);\r\n\r\n\t\t\t\t\t\tif (pointRng) {\r\n\t\t\t\t\t\t\t// Check if pointRange is before/after selection then change the endPoint\r\n\t\t\t\t\t\t\tif (pointRng.compareEndPoints('StartToStart', startRng) > 0)\r\n\t\t\t\t\t\t\t\tpointRng.setEndPoint('StartToStart', startRng);\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tpointRng.setEndPoint('EndToEnd', startRng);\r\n\r\n\t\t\t\t\t\t\tpointRng.select();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\tendSelection();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Removes listeners\r\n\t\t\t\tfunction endSelection() {\r\n\t\t\t\t\tdom.unbind(doc, 'mouseup', endSelection);\r\n\t\t\t\t\tdom.unbind(doc, 'mousemove', selectionChange);\r\n\t\t\t\t\tstarted = 0;\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Detect when user selects outside BODY\r\n\t\t\t\tdom.bind(doc, 'mousedown', function(e) {\r\n\t\t\t\t\tif (e.target.nodeName === 'HTML') {\r\n\t\t\t\t\t\tif (started)\r\n\t\t\t\t\t\t\tendSelection();\r\n\r\n\t\t\t\t\t\tstarted = 1;\r\n\r\n\t\t\t\t\t\t// Setup start position\r\n\t\t\t\t\t\tstartRng = rngFromPoint(e.x, e.y);\r\n\t\t\t\t\t\tif (startRng) {\r\n\t\t\t\t\t\t\t// Listen for selection change events\r\n\t\t\t\t\t\t\tdom.bind(doc, 'mouseup', endSelection);\r\n\t\t\t\t\t\t\tdom.bind(doc, 'mousemove', selectionChange);\r\n\r\n\t\t\t\t\t\t\tstartRng.select();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t})();\r\n\t\t}\r\n\t};\r\n\r\n\t// Expose the selection object\r\n\ttinymce.dom.TridentSelection = Selection;\r\n})();\r\n\r\n\r\n/*\r\n * Sizzle CSS Selector Engine - v1.0\r\n *  Copyright 2009, The Dojo Foundation\r\n *  Released under the MIT, BSD, and GPL Licenses.\r\n *  More information: http://sizzlejs.com/\r\n */\r\n(function(){\r\n\r\nvar chunker = /((?:\\((?:\\([^()]+\\)|[^()]+)+\\)|\\[(?:\\[[^\\[\\]]*\\]|['\"][^'\"]*['\"]|[^\\[\\]'\"]+)+\\]|\\\\.|[^ >+~,(\\[\\\\]+)+|[>+~])(\\s*,\\s*)?((?:.|\\r|\\n)*)/g,\r\n\tdone = 0,\r\n\ttoString = Object.prototype.toString,\r\n\thasDuplicate = false,\r\n\tbaseHasDuplicate = true;\r\n\r\n// Here we check if the JavaScript engine is using some sort of\r\n// optimization where it does not always call our comparision\r\n// function. If that is the case, discard the hasDuplicate value.\r\n//   Thus far that includes Google Chrome.\r\n[0, 0].sort(function(){\r\n\tbaseHasDuplicate = false;\r\n\treturn 0;\r\n});\r\n\r\nvar Sizzle = function(selector, context, results, seed) {\r\n\tresults = results || [];\r\n\tcontext = context || document;\r\n\r\n\tvar origContext = context;\r\n\r\n\tif ( context.nodeType !== 1 && context.nodeType !== 9 ) {\r\n\t\treturn [];\r\n\t}\r\n\t\r\n\tif ( !selector || typeof selector !== \"string\" ) {\r\n\t\treturn results;\r\n\t}\r\n\r\n\tvar parts = [], m, set, checkSet, extra, prune = true, contextXML = Sizzle.isXML(context),\r\n\t\tsoFar = selector, ret, cur, pop, i;\r\n\t\r\n\t// Reset the position of the chunker regexp (start from head)\r\n\tdo {\r\n\t\tchunker.exec(\"\");\r\n\t\tm = chunker.exec(soFar);\r\n\r\n\t\tif ( m ) {\r\n\t\t\tsoFar = m[3];\r\n\t\t\r\n\t\t\tparts.push( m[1] );\r\n\t\t\r\n\t\t\tif ( m[2] ) {\r\n\t\t\t\textra = m[3];\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t} while ( m );\r\n\r\n\tif ( parts.length > 1 && origPOS.exec( selector ) ) {\r\n\t\tif ( parts.length === 2 && Expr.relative[ parts[0] ] ) {\r\n\t\t\tset = posProcess( parts[0] + parts[1], context );\r\n\t\t} else {\r\n\t\t\tset = Expr.relative[ parts[0] ] ?\r\n\t\t\t\t[ context ] :\r\n\t\t\t\tSizzle( parts.shift(), context );\r\n\r\n\t\t\twhile ( parts.length ) {\r\n\t\t\t\tselector = parts.shift();\r\n\r\n\t\t\t\tif ( Expr.relative[ selector ] ) {\r\n\t\t\t\t\tselector += parts.shift();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tset = posProcess( selector, set );\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\t// Take a shortcut and set the context if the root selector is an ID\r\n\t\t// (but not if it'll be faster if the inner selector is an ID)\r\n\t\tif ( !seed && parts.length > 1 && context.nodeType === 9 && !contextXML &&\r\n\t\t\t\tExpr.match.ID.test(parts[0]) && !Expr.match.ID.test(parts[parts.length - 1]) ) {\r\n\t\t\tret = Sizzle.find( parts.shift(), context, contextXML );\r\n\t\t\tcontext = ret.expr ? Sizzle.filter( ret.expr, ret.set )[0] : ret.set[0];\r\n\t\t}\r\n\r\n\t\tif ( context ) {\r\n\t\t\tret = seed ?\r\n\t\t\t\t{ expr: parts.pop(), set: makeArray(seed) } :\r\n\t\t\t\tSizzle.find( parts.pop(), parts.length === 1 && (parts[0] === \"~\" || parts[0] === \"+\") && context.parentNode ? context.parentNode : context, contextXML );\r\n\t\t\tset = ret.expr ? Sizzle.filter( ret.expr, ret.set ) : ret.set;\r\n\r\n\t\t\tif ( parts.length > 0 ) {\r\n\t\t\t\tcheckSet = makeArray(set);\r\n\t\t\t} else {\r\n\t\t\t\tprune = false;\r\n\t\t\t}\r\n\r\n\t\t\twhile ( parts.length ) {\r\n\t\t\t\tcur = parts.pop();\r\n\t\t\t\tpop = cur;\r\n\r\n\t\t\t\tif ( !Expr.relative[ cur ] ) {\r\n\t\t\t\t\tcur = \"\";\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpop = parts.pop();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( pop == null ) {\r\n\t\t\t\t\tpop = context;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tExpr.relative[ cur ]( checkSet, pop, contextXML );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tcheckSet = parts = [];\r\n\t\t}\r\n\t}\r\n\r\n\tif ( !checkSet ) {\r\n\t\tcheckSet = set;\r\n\t}\r\n\r\n\tif ( !checkSet ) {\r\n\t\tSizzle.error( cur || selector );\r\n\t}\r\n\r\n\tif ( toString.call(checkSet) === \"[object Array]\" ) {\r\n\t\tif ( !prune ) {\r\n\t\t\tresults.push.apply( results, checkSet );\r\n\t\t} else if ( context && context.nodeType === 1 ) {\r\n\t\t\tfor ( i = 0; checkSet[i] != null; i++ ) {\r\n\t\t\t\tif ( checkSet[i] && (checkSet[i] === true || checkSet[i].nodeType === 1 && Sizzle.contains(context, checkSet[i])) ) {\r\n\t\t\t\t\tresults.push( set[i] );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tfor ( i = 0; checkSet[i] != null; i++ ) {\r\n\t\t\t\tif ( checkSet[i] && checkSet[i].nodeType === 1 ) {\r\n\t\t\t\t\tresults.push( set[i] );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tmakeArray( checkSet, results );\r\n\t}\r\n\r\n\tif ( extra ) {\r\n\t\tSizzle( extra, origContext, results, seed );\r\n\t\tSizzle.uniqueSort( results );\r\n\t}\r\n\r\n\treturn results;\r\n};\r\n\r\nSizzle.uniqueSort = function(results){\r\n\tif ( sortOrder ) {\r\n\t\thasDuplicate = baseHasDuplicate;\r\n\t\tresults.sort(sortOrder);\r\n\r\n\t\tif ( hasDuplicate ) {\r\n\t\t\tfor ( var i = 1; i < results.length; i++ ) {\r\n\t\t\t\tif ( results[i] === results[i-1] ) {\r\n\t\t\t\t\tresults.splice(i--, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn results;\r\n};\r\n\r\nSizzle.matches = function(expr, set){\r\n\treturn Sizzle(expr, null, null, set);\r\n};\r\n\r\nSizzle.find = function(expr, context, isXML){\r\n\tvar set;\r\n\r\n\tif ( !expr ) {\r\n\t\treturn [];\r\n\t}\r\n\r\n\tfor ( var i = 0, l = Expr.order.length; i < l; i++ ) {\r\n\t\tvar type = Expr.order[i], match;\r\n\t\t\r\n\t\tif ( (match = Expr.leftMatch[ type ].exec( expr )) ) {\r\n\t\t\tvar left = match[1];\r\n\t\t\tmatch.splice(1,1);\r\n\r\n\t\t\tif ( left.substr( left.length - 1 ) !== \"\\\\\" ) {\r\n\t\t\t\tmatch[1] = (match[1] || \"\").replace(/\\\\/g, \"\");\r\n\t\t\t\tset = Expr.find[ type ]( match, context, isXML );\r\n\t\t\t\tif ( set != null ) {\r\n\t\t\t\t\texpr = expr.replace( Expr.match[ type ], \"\" );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif ( !set ) {\r\n\t\tset = context.getElementsByTagName(\"*\");\r\n\t}\r\n\r\n\treturn {set: set, expr: expr};\r\n};\r\n\r\nSizzle.filter = function(expr, set, inplace, not){\r\n\tvar old = expr, result = [], curLoop = set, match, anyFound,\r\n\t\tisXMLFilter = set && set[0] && Sizzle.isXML(set[0]);\r\n\r\n\twhile ( expr && set.length ) {\r\n\t\tfor ( var type in Expr.filter ) {\r\n\t\t\tif ( (match = Expr.leftMatch[ type ].exec( expr )) != null && match[2] ) {\r\n\t\t\t\tvar filter = Expr.filter[ type ], found, item, left = match[1];\r\n\t\t\t\tanyFound = false;\r\n\r\n\t\t\t\tmatch.splice(1,1);\r\n\r\n\t\t\t\tif ( left.substr( left.length - 1 ) === \"\\\\\" ) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( curLoop === result ) {\r\n\t\t\t\t\tresult = [];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( Expr.preFilter[ type ] ) {\r\n\t\t\t\t\tmatch = Expr.preFilter[ type ]( match, curLoop, inplace, result, not, isXMLFilter );\r\n\r\n\t\t\t\t\tif ( !match ) {\r\n\t\t\t\t\t\tanyFound = found = true;\r\n\t\t\t\t\t} else if ( match === true ) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( match ) {\r\n\t\t\t\t\tfor ( var i = 0; (item = curLoop[i]) != null; i++ ) {\r\n\t\t\t\t\t\tif ( item ) {\r\n\t\t\t\t\t\t\tfound = filter( item, match, i, curLoop );\r\n\t\t\t\t\t\t\tvar pass = not ^ !!found;\r\n\r\n\t\t\t\t\t\t\tif ( inplace && found != null ) {\r\n\t\t\t\t\t\t\t\tif ( pass ) {\r\n\t\t\t\t\t\t\t\t\tanyFound = true;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tcurLoop[i] = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else if ( pass ) {\r\n\t\t\t\t\t\t\t\tresult.push( item );\r\n\t\t\t\t\t\t\t\tanyFound = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( found !== undefined ) {\r\n\t\t\t\t\tif ( !inplace ) {\r\n\t\t\t\t\t\tcurLoop = result;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\texpr = expr.replace( Expr.match[ type ], \"\" );\r\n\r\n\t\t\t\t\tif ( !anyFound ) {\r\n\t\t\t\t\t\treturn [];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Improper expression\r\n\t\tif ( expr === old ) {\r\n\t\t\tif ( anyFound == null ) {\r\n\t\t\t\tSizzle.error( expr );\r\n\t\t\t} else {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\told = expr;\r\n\t}\r\n\r\n\treturn curLoop;\r\n};\r\n\r\nSizzle.error = function( msg ) {\r\n\tthrow \"Syntax error, unrecognized expression: \" + msg;\r\n};\r\n\r\nvar Expr = Sizzle.selectors = {\r\n\torder: [ \"ID\", \"NAME\", \"TAG\" ],\r\n\tmatch: {\r\n\t\tID: /#((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)/,\r\n\t\tCLASS: /\\.((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)/,\r\n\t\tNAME: /\\[name=['\"]*((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)['\"]*\\]/,\r\n\t\tATTR: /\\[\\s*((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)\\s*(?:(\\S?=)\\s*(['\"]*)(.*?)\\3|)\\s*\\]/,\r\n\t\tTAG: /^((?:[\\w\\u00c0-\\uFFFF\\*\\-]|\\\\.)+)/,\r\n\t\tCHILD: /:(only|nth|last|first)-child(?:\\((even|odd|[\\dn+\\-]*)\\))?/,\r\n\t\tPOS: /:(nth|eq|gt|lt|first|last|even|odd)(?:\\((\\d*)\\))?(?=[^\\-]|$)/,\r\n\t\tPSEUDO: /:((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)(?:\\((['\"]?)((?:\\([^\\)]+\\)|[^\\(\\)]*)+)\\2\\))?/\r\n\t},\r\n\tleftMatch: {},\r\n\tattrMap: {\r\n\t\t\"class\": \"className\",\r\n\t\t\"for\": \"htmlFor\"\r\n\t},\r\n\tattrHandle: {\r\n\t\thref: function(elem){\r\n\t\t\treturn elem.getAttribute(\"href\");\r\n\t\t}\r\n\t},\r\n\trelative: {\r\n\t\t\"+\": function(checkSet, part){\r\n\t\t\tvar isPartStr = typeof part === \"string\",\r\n\t\t\t\tisTag = isPartStr && !/\\W/.test(part),\r\n\t\t\t\tisPartStrNotTag = isPartStr && !isTag;\r\n\r\n\t\t\tif ( isTag ) {\r\n\t\t\t\tpart = part.toLowerCase();\r\n\t\t\t}\r\n\r\n\t\t\tfor ( var i = 0, l = checkSet.length, elem; i < l; i++ ) {\r\n\t\t\t\tif ( (elem = checkSet[i]) ) {\r\n\t\t\t\t\twhile ( (elem = elem.previousSibling) && elem.nodeType !== 1 ) {}\r\n\r\n\t\t\t\t\tcheckSet[i] = isPartStrNotTag || elem && elem.nodeName.toLowerCase() === part ?\r\n\t\t\t\t\t\telem || false :\r\n\t\t\t\t\t\telem === part;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif ( isPartStrNotTag ) {\r\n\t\t\t\tSizzle.filter( part, checkSet, true );\r\n\t\t\t}\r\n\t\t},\r\n\t\t\">\": function(checkSet, part){\r\n\t\t\tvar isPartStr = typeof part === \"string\",\r\n\t\t\t\telem, i = 0, l = checkSet.length;\r\n\r\n\t\t\tif ( isPartStr && !/\\W/.test(part) ) {\r\n\t\t\t\tpart = part.toLowerCase();\r\n\r\n\t\t\t\tfor ( ; i < l; i++ ) {\r\n\t\t\t\t\telem = checkSet[i];\r\n\t\t\t\t\tif ( elem ) {\r\n\t\t\t\t\t\tvar parent = elem.parentNode;\r\n\t\t\t\t\t\tcheckSet[i] = parent.nodeName.toLowerCase() === part ? parent : false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor ( ; i < l; i++ ) {\r\n\t\t\t\t\telem = checkSet[i];\r\n\t\t\t\t\tif ( elem ) {\r\n\t\t\t\t\t\tcheckSet[i] = isPartStr ?\r\n\t\t\t\t\t\t\telem.parentNode :\r\n\t\t\t\t\t\t\telem.parentNode === part;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( isPartStr ) {\r\n\t\t\t\t\tSizzle.filter( part, checkSet, true );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"\": function(checkSet, part, isXML){\r\n\t\t\tvar doneName = done++, checkFn = dirCheck, nodeCheck;\r\n\r\n\t\t\tif ( typeof part === \"string\" && !/\\W/.test(part) ) {\r\n\t\t\t\tpart = part.toLowerCase();\r\n\t\t\t\tnodeCheck = part;\r\n\t\t\t\tcheckFn = dirNodeCheck;\r\n\t\t\t}\r\n\r\n\t\t\tcheckFn(\"parentNode\", part, doneName, checkSet, nodeCheck, isXML);\r\n\t\t},\r\n\t\t\"~\": function(checkSet, part, isXML){\r\n\t\t\tvar doneName = done++, checkFn = dirCheck, nodeCheck;\r\n\r\n\t\t\tif ( typeof part === \"string\" && !/\\W/.test(part) ) {\r\n\t\t\t\tpart = part.toLowerCase();\r\n\t\t\t\tnodeCheck = part;\r\n\t\t\t\tcheckFn = dirNodeCheck;\r\n\t\t\t}\r\n\r\n\t\t\tcheckFn(\"previousSibling\", part, doneName, checkSet, nodeCheck, isXML);\r\n\t\t}\r\n\t},\r\n\tfind: {\r\n\t\tID: function(match, context, isXML){\r\n\t\t\tif ( typeof context.getElementById !== \"undefined\" && !isXML ) {\r\n\t\t\t\tvar m = context.getElementById(match[1]);\r\n\t\t\t\treturn m ? [m] : [];\r\n\t\t\t}\r\n\t\t},\r\n\t\tNAME: function(match, context){\r\n\t\t\tif ( typeof context.getElementsByName !== \"undefined\" ) {\r\n\t\t\t\tvar ret = [], results = context.getElementsByName(match[1]);\r\n\r\n\t\t\t\tfor ( var i = 0, l = results.length; i < l; i++ ) {\r\n\t\t\t\t\tif ( results[i].getAttribute(\"name\") === match[1] ) {\r\n\t\t\t\t\t\tret.push( results[i] );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn ret.length === 0 ? null : ret;\r\n\t\t\t}\r\n\t\t},\r\n\t\tTAG: function(match, context){\r\n\t\t\treturn context.getElementsByTagName(match[1]);\r\n\t\t}\r\n\t},\r\n\tpreFilter: {\r\n\t\tCLASS: function(match, curLoop, inplace, result, not, isXML){\r\n\t\t\tmatch = \" \" + match[1].replace(/\\\\/g, \"\") + \" \";\r\n\r\n\t\t\tif ( isXML ) {\r\n\t\t\t\treturn match;\r\n\t\t\t}\r\n\r\n\t\t\tfor ( var i = 0, elem; (elem = curLoop[i]) != null; i++ ) {\r\n\t\t\t\tif ( elem ) {\r\n\t\t\t\t\tif ( not ^ (elem.className && (\" \" + elem.className + \" \").replace(/[\\t\\n]/g, \" \").indexOf(match) >= 0) ) {\r\n\t\t\t\t\t\tif ( !inplace ) {\r\n\t\t\t\t\t\t\tresult.push( elem );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if ( inplace ) {\r\n\t\t\t\t\t\tcurLoop[i] = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\tID: function(match){\r\n\t\t\treturn match[1].replace(/\\\\/g, \"\");\r\n\t\t},\r\n\t\tTAG: function(match, curLoop){\r\n\t\t\treturn match[1].toLowerCase();\r\n\t\t},\r\n\t\tCHILD: function(match){\r\n\t\t\tif ( match[1] === \"nth\" ) {\r\n\t\t\t\t// parse equations like 'even', 'odd', '5', '2n', '3n+2', '4n-1', '-n+6'\r\n\t\t\t\tvar test = /(-?)(\\d*)n((?:\\+|-)?\\d*)/.exec(\r\n\t\t\t\t\tmatch[2] === \"even\" && \"2n\" || match[2] === \"odd\" && \"2n+1\" ||\r\n\t\t\t\t\t!/\\D/.test( match[2] ) && \"0n+\" + match[2] || match[2]);\r\n\r\n\t\t\t\t// calculate the numbers (first)n+(last) including if they are negative\r\n\t\t\t\tmatch[2] = (test[1] + (test[2] || 1)) - 0;\r\n\t\t\t\tmatch[3] = test[3] - 0;\r\n\t\t\t}\r\n\r\n\t\t\t// TODO: Move to normal caching system\r\n\t\t\tmatch[0] = done++;\r\n\r\n\t\t\treturn match;\r\n\t\t},\r\n\t\tATTR: function(match, curLoop, inplace, result, not, isXML){\r\n\t\t\tvar name = match[1].replace(/\\\\/g, \"\");\r\n\t\t\t\r\n\t\t\tif ( !isXML && Expr.attrMap[name] ) {\r\n\t\t\t\tmatch[1] = Expr.attrMap[name];\r\n\t\t\t}\r\n\r\n\t\t\tif ( match[2] === \"~=\" ) {\r\n\t\t\t\tmatch[4] = \" \" + match[4] + \" \";\r\n\t\t\t}\r\n\r\n\t\t\treturn match;\r\n\t\t},\r\n\t\tPSEUDO: function(match, curLoop, inplace, result, not){\r\n\t\t\tif ( match[1] === \"not\" ) {\r\n\t\t\t\t// If we're dealing with a complex expression, or a simple one\r\n\t\t\t\tif ( ( chunker.exec(match[3]) || \"\" ).length > 1 || /^\\w/.test(match[3]) ) {\r\n\t\t\t\t\tmatch[3] = Sizzle(match[3], null, null, curLoop);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar ret = Sizzle.filter(match[3], curLoop, inplace, true ^ not);\r\n\t\t\t\t\tif ( !inplace ) {\r\n\t\t\t\t\t\tresult.push.apply( result, ret );\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t} else if ( Expr.match.POS.test( match[0] ) || Expr.match.CHILD.test( match[0] ) ) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn match;\r\n\t\t},\r\n\t\tPOS: function(match){\r\n\t\t\tmatch.unshift( true );\r\n\t\t\treturn match;\r\n\t\t}\r\n\t},\r\n\tfilters: {\r\n\t\tenabled: function(elem){\r\n\t\t\treturn elem.disabled === false && elem.type !== \"hidden\";\r\n\t\t},\r\n\t\tdisabled: function(elem){\r\n\t\t\treturn elem.disabled === true;\r\n\t\t},\r\n\t\tchecked: function(elem){\r\n\t\t\treturn elem.checked === true;\r\n\t\t},\r\n\t\tselected: function(elem){\r\n\t\t\t// Accessing this property makes selected-by-default\r\n\t\t\t// options in Safari work properly\r\n\t\t\telem.parentNode.selectedIndex;\r\n\t\t\treturn elem.selected === true;\r\n\t\t},\r\n\t\tparent: function(elem){\r\n\t\t\treturn !!elem.firstChild;\r\n\t\t},\r\n\t\tempty: function(elem){\r\n\t\t\treturn !elem.firstChild;\r\n\t\t},\r\n\t\thas: function(elem, i, match){\r\n\t\t\treturn !!Sizzle( match[3], elem ).length;\r\n\t\t},\r\n\t\theader: function(elem){\r\n\t\t\treturn (/h\\d/i).test( elem.nodeName );\r\n\t\t},\r\n\t\ttext: function(elem){\r\n\t\t\treturn \"text\" === elem.type;\r\n\t\t},\r\n\t\tradio: function(elem){\r\n\t\t\treturn \"radio\" === elem.type;\r\n\t\t},\r\n\t\tcheckbox: function(elem){\r\n\t\t\treturn \"checkbox\" === elem.type;\r\n\t\t},\r\n\t\tfile: function(elem){\r\n\t\t\treturn \"file\" === elem.type;\r\n\t\t},\r\n\t\tpassword: function(elem){\r\n\t\t\treturn \"password\" === elem.type;\r\n\t\t},\r\n\t\tsubmit: function(elem){\r\n\t\t\treturn \"submit\" === elem.type;\r\n\t\t},\r\n\t\timage: function(elem){\r\n\t\t\treturn \"image\" === elem.type;\r\n\t\t},\r\n\t\treset: function(elem){\r\n\t\t\treturn \"reset\" === elem.type;\r\n\t\t},\r\n\t\tbutton: function(elem){\r\n\t\t\treturn \"button\" === elem.type || elem.nodeName.toLowerCase() === \"button\";\r\n\t\t},\r\n\t\tinput: function(elem){\r\n\t\t\treturn (/input|select|textarea|button/i).test(elem.nodeName);\r\n\t\t}\r\n\t},\r\n\tsetFilters: {\r\n\t\tfirst: function(elem, i){\r\n\t\t\treturn i === 0;\r\n\t\t},\r\n\t\tlast: function(elem, i, match, array){\r\n\t\t\treturn i === array.length - 1;\r\n\t\t},\r\n\t\teven: function(elem, i){\r\n\t\t\treturn i % 2 === 0;\r\n\t\t},\r\n\t\todd: function(elem, i){\r\n\t\t\treturn i % 2 === 1;\r\n\t\t},\r\n\t\tlt: function(elem, i, match){\r\n\t\t\treturn i < match[3] - 0;\r\n\t\t},\r\n\t\tgt: function(elem, i, match){\r\n\t\t\treturn i > match[3] - 0;\r\n\t\t},\r\n\t\tnth: function(elem, i, match){\r\n\t\t\treturn match[3] - 0 === i;\r\n\t\t},\r\n\t\teq: function(elem, i, match){\r\n\t\t\treturn match[3] - 0 === i;\r\n\t\t}\r\n\t},\r\n\tfilter: {\r\n\t\tPSEUDO: function(elem, match, i, array){\r\n\t\t\tvar name = match[1], filter = Expr.filters[ name ];\r\n\r\n\t\t\tif ( filter ) {\r\n\t\t\t\treturn filter( elem, i, match, array );\r\n\t\t\t} else if ( name === \"contains\" ) {\r\n\t\t\t\treturn (elem.textContent || elem.innerText || Sizzle.getText([ elem ]) || \"\").indexOf(match[3]) >= 0;\r\n\t\t\t} else if ( name === \"not\" ) {\r\n\t\t\t\tvar not = match[3];\r\n\r\n\t\t\t\tfor ( var j = 0, l = not.length; j < l; j++ ) {\r\n\t\t\t\t\tif ( not[j] === elem ) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\tSizzle.error( \"Syntax error, unrecognized expression: \" + name );\r\n\t\t\t}\r\n\t\t},\r\n\t\tCHILD: function(elem, match){\r\n\t\t\tvar type = match[1], node = elem;\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase 'only':\r\n\t\t\t\tcase 'first':\r\n\t\t\t\t\twhile ( (node = node.previousSibling) )\t {\r\n\t\t\t\t\t\tif ( node.nodeType === 1 ) { \r\n\t\t\t\t\t\t\treturn false; \r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ( type === \"first\" ) { \r\n\t\t\t\t\t\treturn true; \r\n\t\t\t\t\t}\r\n\t\t\t\t\tnode = elem;\r\n\t\t\t\tcase 'last':\r\n\t\t\t\t\twhile ( (node = node.nextSibling) )\t {\r\n\t\t\t\t\t\tif ( node.nodeType === 1 ) { \r\n\t\t\t\t\t\t\treturn false; \r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true;\r\n\t\t\t\tcase 'nth':\r\n\t\t\t\t\tvar first = match[2], last = match[3];\r\n\r\n\t\t\t\t\tif ( first === 1 && last === 0 ) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar doneName = match[0],\r\n\t\t\t\t\t\tparent = elem.parentNode;\r\n\t\r\n\t\t\t\t\tif ( parent && (parent.sizcache !== doneName || !elem.nodeIndex) ) {\r\n\t\t\t\t\t\tvar count = 0;\r\n\t\t\t\t\t\tfor ( node = parent.firstChild; node; node = node.nextSibling ) {\r\n\t\t\t\t\t\t\tif ( node.nodeType === 1 ) {\r\n\t\t\t\t\t\t\t\tnode.nodeIndex = ++count;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} \r\n\t\t\t\t\t\tparent.sizcache = doneName;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar diff = elem.nodeIndex - last;\r\n\t\t\t\t\tif ( first === 0 ) {\r\n\t\t\t\t\t\treturn diff === 0;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn ( diff % first === 0 && diff / first >= 0 );\r\n\t\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tID: function(elem, match){\r\n\t\t\treturn elem.nodeType === 1 && elem.getAttribute(\"id\") === match;\r\n\t\t},\r\n\t\tTAG: function(elem, match){\r\n\t\t\treturn (match === \"*\" && elem.nodeType === 1) || elem.nodeName.toLowerCase() === match;\r\n\t\t},\r\n\t\tCLASS: function(elem, match){\r\n\t\t\treturn (\" \" + (elem.className || elem.getAttribute(\"class\")) + \" \")\r\n\t\t\t\t.indexOf( match ) > -1;\r\n\t\t},\r\n\t\tATTR: function(elem, match){\r\n\t\t\tvar name = match[1],\r\n\t\t\t\tresult = Expr.attrHandle[ name ] ?\r\n\t\t\t\t\tExpr.attrHandle[ name ]( elem ) :\r\n\t\t\t\t\telem[ name ] != null ?\r\n\t\t\t\t\t\telem[ name ] :\r\n\t\t\t\t\t\telem.getAttribute( name ),\r\n\t\t\t\tvalue = result + \"\",\r\n\t\t\t\ttype = match[2],\r\n\t\t\t\tcheck = match[4];\r\n\r\n\t\t\treturn result == null ?\r\n\t\t\t\ttype === \"!=\" :\r\n\t\t\t\ttype === \"=\" ?\r\n\t\t\t\tvalue === check :\r\n\t\t\t\ttype === \"*=\" ?\r\n\t\t\t\tvalue.indexOf(check) >= 0 :\r\n\t\t\t\ttype === \"~=\" ?\r\n\t\t\t\t(\" \" + value + \" \").indexOf(check) >= 0 :\r\n\t\t\t\t!check ?\r\n\t\t\t\tvalue && result !== false :\r\n\t\t\t\ttype === \"!=\" ?\r\n\t\t\t\tvalue !== check :\r\n\t\t\t\ttype === \"^=\" ?\r\n\t\t\t\tvalue.indexOf(check) === 0 :\r\n\t\t\t\ttype === \"$=\" ?\r\n\t\t\t\tvalue.substr(value.length - check.length) === check :\r\n\t\t\t\ttype === \"|=\" ?\r\n\t\t\t\tvalue === check || value.substr(0, check.length + 1) === check + \"-\" :\r\n\t\t\t\tfalse;\r\n\t\t},\r\n\t\tPOS: function(elem, match, i, array){\r\n\t\t\tvar name = match[2], filter = Expr.setFilters[ name ];\r\n\r\n\t\t\tif ( filter ) {\r\n\t\t\t\treturn filter( elem, i, match, array );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\nvar origPOS = Expr.match.POS,\r\n\tfescape = function(all, num){\r\n\t\treturn \"\\\\\" + (num - 0 + 1);\r\n\t};\r\n\r\nfor ( var type in Expr.match ) {\r\n\tExpr.match[ type ] = new RegExp( Expr.match[ type ].source + (/(?![^\\[]*\\])(?![^\\(]*\\))/.source) );\r\n\tExpr.leftMatch[ type ] = new RegExp( /(^(?:.|\\r|\\n)*?)/.source + Expr.match[ type ].source.replace(/\\\\(\\d+)/g, fescape) );\r\n}\r\n\r\nvar makeArray = function(array, results) {\r\n\tarray = Array.prototype.slice.call( array, 0 );\r\n\r\n\tif ( results ) {\r\n\t\tresults.push.apply( results, array );\r\n\t\treturn results;\r\n\t}\r\n\t\r\n\treturn array;\r\n};\r\n\r\n// Perform a simple check to determine if the browser is capable of\r\n// converting a NodeList to an array using builtin methods.\r\n// Also verifies that the returned array holds DOM nodes\r\n// (which is not the case in the Blackberry browser)\r\ntry {\r\n\tArray.prototype.slice.call( document.documentElement.childNodes, 0 )[0].nodeType;\r\n\r\n// Provide a fallback method if it does not work\r\n} catch(e){\r\n\tmakeArray = function(array, results) {\r\n\t\tvar ret = results || [], i = 0;\r\n\r\n\t\tif ( toString.call(array) === \"[object Array]\" ) {\r\n\t\t\tArray.prototype.push.apply( ret, array );\r\n\t\t} else {\r\n\t\t\tif ( typeof array.length === \"number\" ) {\r\n\t\t\t\tfor ( var l = array.length; i < l; i++ ) {\r\n\t\t\t\t\tret.push( array[i] );\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor ( ; array[i]; i++ ) {\r\n\t\t\t\t\tret.push( array[i] );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn ret;\r\n\t};\r\n}\r\n\r\nvar sortOrder;\r\n\r\nif ( document.documentElement.compareDocumentPosition ) {\r\n\tsortOrder = function( a, b ) {\r\n\t\tif ( !a.compareDocumentPosition || !b.compareDocumentPosition ) {\r\n\t\t\tif ( a == b ) {\r\n\t\t\t\thasDuplicate = true;\r\n\t\t\t}\r\n\t\t\treturn a.compareDocumentPosition ? -1 : 1;\r\n\t\t}\r\n\r\n\t\tvar ret = a.compareDocumentPosition(b) & 4 ? -1 : a === b ? 0 : 1;\r\n\t\tif ( ret === 0 ) {\r\n\t\t\thasDuplicate = true;\r\n\t\t}\r\n\t\treturn ret;\r\n\t};\r\n} else if ( \"sourceIndex\" in document.documentElement ) {\r\n\tsortOrder = function( a, b ) {\r\n\t\tif ( !a.sourceIndex || !b.sourceIndex ) {\r\n\t\t\tif ( a == b ) {\r\n\t\t\t\thasDuplicate = true;\r\n\t\t\t}\r\n\t\t\treturn a.sourceIndex ? -1 : 1;\r\n\t\t}\r\n\r\n\t\tvar ret = a.sourceIndex - b.sourceIndex;\r\n\t\tif ( ret === 0 ) {\r\n\t\t\thasDuplicate = true;\r\n\t\t}\r\n\t\treturn ret;\r\n\t};\r\n} else if ( document.createRange ) {\r\n\tsortOrder = function( a, b ) {\r\n\t\tif ( !a.ownerDocument || !b.ownerDocument ) {\r\n\t\t\tif ( a == b ) {\r\n\t\t\t\thasDuplicate = true;\r\n\t\t\t}\r\n\t\t\treturn a.ownerDocument ? -1 : 1;\r\n\t\t}\r\n\r\n\t\tvar aRange = a.ownerDocument.createRange(), bRange = b.ownerDocument.createRange();\r\n\t\taRange.setStart(a, 0);\r\n\t\taRange.setEnd(a, 0);\r\n\t\tbRange.setStart(b, 0);\r\n\t\tbRange.setEnd(b, 0);\r\n\t\tvar ret = aRange.compareBoundaryPoints(Range.START_TO_END, bRange);\r\n\t\tif ( ret === 0 ) {\r\n\t\t\thasDuplicate = true;\r\n\t\t}\r\n\t\treturn ret;\r\n\t};\r\n}\r\n\r\n// Utility function for retreiving the text value of an array of DOM nodes\r\nSizzle.getText = function( elems ) {\r\n\tvar ret = \"\", elem;\r\n\r\n\tfor ( var i = 0; elems[i]; i++ ) {\r\n\t\telem = elems[i];\r\n\r\n\t\t// Get the text from text nodes and CDATA nodes\r\n\t\tif ( elem.nodeType === 3 || elem.nodeType === 4 ) {\r\n\t\t\tret += elem.nodeValue;\r\n\r\n\t\t// Traverse everything else, except comment nodes\r\n\t\t} else if ( elem.nodeType !== 8 ) {\r\n\t\t\tret += Sizzle.getText( elem.childNodes );\r\n\t\t}\r\n\t}\r\n\r\n\treturn ret;\r\n};\r\n\r\n// Check to see if the browser returns elements by name when\r\n// querying by getElementById (and provide a workaround)\r\n(function(){\r\n\t// We're going to inject a fake input element with a specified name\r\n\tvar form = document.createElement(\"div\"),\r\n\t\tid = \"script\" + (new Date()).getTime();\r\n\tform.innerHTML = \"<a name='\" + id + \"'/>\";\r\n\r\n\t// Inject it into the root element, check its status, and remove it quickly\r\n\tvar root = document.documentElement;\r\n\troot.insertBefore( form, root.firstChild );\r\n\r\n\t// The workaround has to do additional checks after a getElementById\r\n\t// Which slows things down for other browsers (hence the branching)\r\n\tif ( document.getElementById( id ) ) {\r\n\t\tExpr.find.ID = function(match, context, isXML){\r\n\t\t\tif ( typeof context.getElementById !== \"undefined\" && !isXML ) {\r\n\t\t\t\tvar m = context.getElementById(match[1]);\r\n\t\t\t\treturn m ? m.id === match[1] || typeof m.getAttributeNode !== \"undefined\" && m.getAttributeNode(\"id\").nodeValue === match[1] ? [m] : undefined : [];\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tExpr.filter.ID = function(elem, match){\r\n\t\t\tvar node = typeof elem.getAttributeNode !== \"undefined\" && elem.getAttributeNode(\"id\");\r\n\t\t\treturn elem.nodeType === 1 && node && node.nodeValue === match;\r\n\t\t};\r\n\t}\r\n\r\n\troot.removeChild( form );\r\n\troot = form = null; // release memory in IE\r\n})();\r\n\r\n(function(){\r\n\t// Check to see if the browser returns only elements\r\n\t// when doing getElementsByTagName(\"*\")\r\n\r\n\t// Create a fake element\r\n\tvar div = document.createElement(\"div\");\r\n\tdiv.appendChild( document.createComment(\"\") );\r\n\r\n\t// Make sure no comments are found\r\n\tif ( div.getElementsByTagName(\"*\").length > 0 ) {\r\n\t\tExpr.find.TAG = function(match, context){\r\n\t\t\tvar results = context.getElementsByTagName(match[1]);\r\n\r\n\t\t\t// Filter out possible comments\r\n\t\t\tif ( match[1] === \"*\" ) {\r\n\t\t\t\tvar tmp = [];\r\n\r\n\t\t\t\tfor ( var i = 0; results[i]; i++ ) {\r\n\t\t\t\t\tif ( results[i].nodeType === 1 ) {\r\n\t\t\t\t\t\ttmp.push( results[i] );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tresults = tmp;\r\n\t\t\t}\r\n\r\n\t\t\treturn results;\r\n\t\t};\r\n\t}\r\n\r\n\t// Check to see if an attribute returns normalized href attributes\r\n\tdiv.innerHTML = \"<a href='#'></a>\";\r\n\tif ( div.firstChild && typeof div.firstChild.getAttribute !== \"undefined\" &&\r\n\t\t\tdiv.firstChild.getAttribute(\"href\") !== \"#\" ) {\r\n\t\tExpr.attrHandle.href = function(elem){\r\n\t\t\treturn elem.getAttribute(\"href\", 2);\r\n\t\t};\r\n\t}\r\n\r\n\tdiv = null; // release memory in IE\r\n})();\r\n\r\nif ( document.querySelectorAll ) {\r\n\t(function(){\r\n\t\tvar oldSizzle = Sizzle, div = document.createElement(\"div\");\r\n\t\tdiv.innerHTML = \"<p class='TEST'></p>\";\r\n\r\n\t\t// Safari can't handle uppercase or unicode characters when\r\n\t\t// in quirks mode.\r\n\t\tif ( div.querySelectorAll && div.querySelectorAll(\".TEST\").length === 0 ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\r\n\t\tSizzle = function(query, context, extra, seed){\r\n\t\t\tcontext = context || document;\r\n\r\n\t\t\t// Only use querySelectorAll on non-XML documents\r\n\t\t\t// (ID selectors don't work in non-HTML documents)\r\n\t\t\tif ( !seed && context.nodeType === 9 && !Sizzle.isXML(context) ) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\treturn makeArray( context.querySelectorAll(query), extra );\r\n\t\t\t\t} catch(e){}\r\n\t\t\t}\r\n\t\t\r\n\t\t\treturn oldSizzle(query, context, extra, seed);\r\n\t\t};\r\n\r\n\t\tfor ( var prop in oldSizzle ) {\r\n\t\t\tSizzle[ prop ] = oldSizzle[ prop ];\r\n\t\t}\r\n\r\n\t\tdiv = null; // release memory in IE\r\n\t})();\r\n}\r\n\r\n(function(){\r\n\tvar div = document.createElement(\"div\");\r\n\r\n\tdiv.innerHTML = \"<div class='test e'></div><div class='test'></div>\";\r\n\r\n\t// Opera can't find a second classname (in 9.6)\r\n\t// Also, make sure that getElementsByClassName actually exists\r\n\tif ( !div.getElementsByClassName || div.getElementsByClassName(\"e\").length === 0 ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Safari caches class attributes, doesn't catch changes (in 3.2)\r\n\tdiv.lastChild.className = \"e\";\r\n\r\n\tif ( div.getElementsByClassName(\"e\").length === 1 ) {\r\n\t\treturn;\r\n\t}\r\n\t\r\n\tExpr.order.splice(1, 0, \"CLASS\");\r\n\tExpr.find.CLASS = function(match, context, isXML) {\r\n\t\tif ( typeof context.getElementsByClassName !== \"undefined\" && !isXML ) {\r\n\t\t\treturn context.getElementsByClassName(match[1]);\r\n\t\t}\r\n\t};\r\n\r\n\tdiv = null; // release memory in IE\r\n})();\r\n\r\nfunction dirNodeCheck( dir, cur, doneName, checkSet, nodeCheck, isXML ) {\r\n\tfor ( var i = 0, l = checkSet.length; i < l; i++ ) {\r\n\t\tvar elem = checkSet[i];\r\n\t\tif ( elem ) {\r\n\t\t\telem = elem[dir];\r\n\t\t\tvar match = false;\r\n\r\n\t\t\twhile ( elem ) {\r\n\t\t\t\tif ( elem.sizcache === doneName ) {\r\n\t\t\t\t\tmatch = checkSet[elem.sizset];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( elem.nodeType === 1 && !isXML ){\r\n\t\t\t\t\telem.sizcache = doneName;\r\n\t\t\t\t\telem.sizset = i;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( elem.nodeName.toLowerCase() === cur ) {\r\n\t\t\t\t\tmatch = elem;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\telem = elem[dir];\r\n\t\t\t}\r\n\r\n\t\t\tcheckSet[i] = match;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction dirCheck( dir, cur, doneName, checkSet, nodeCheck, isXML ) {\r\n\tfor ( var i = 0, l = checkSet.length; i < l; i++ ) {\r\n\t\tvar elem = checkSet[i];\r\n\t\tif ( elem ) {\r\n\t\t\telem = elem[dir];\r\n\t\t\tvar match = false;\r\n\r\n\t\t\twhile ( elem ) {\r\n\t\t\t\tif ( elem.sizcache === doneName ) {\r\n\t\t\t\t\tmatch = checkSet[elem.sizset];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( elem.nodeType === 1 ) {\r\n\t\t\t\t\tif ( !isXML ) {\r\n\t\t\t\t\t\telem.sizcache = doneName;\r\n\t\t\t\t\t\telem.sizset = i;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ( typeof cur !== \"string\" ) {\r\n\t\t\t\t\t\tif ( elem === cur ) {\r\n\t\t\t\t\t\t\tmatch = true;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else if ( Sizzle.filter( cur, [elem] ).length > 0 ) {\r\n\t\t\t\t\t\tmatch = elem;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\telem = elem[dir];\r\n\t\t\t}\r\n\r\n\t\t\tcheckSet[i] = match;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nSizzle.contains = document.compareDocumentPosition ? function(a, b){\r\n\treturn !!(a.compareDocumentPosition(b) & 16);\r\n} : function(a, b){\r\n\treturn a !== b && (a.contains ? a.contains(b) : true);\r\n};\r\n\r\nSizzle.isXML = function(elem){\r\n\t// documentElement is verified for cases where it doesn't yet exist\r\n\t// (such as loading iframes in IE - #4833) \r\n\tvar documentElement = (elem ? elem.ownerDocument || elem : 0).documentElement;\r\n\treturn documentElement ? documentElement.nodeName !== \"HTML\" : false;\r\n};\r\n\r\nvar posProcess = function(selector, context){\r\n\tvar tmpSet = [], later = \"\", match,\r\n\t\troot = context.nodeType ? [context] : context;\r\n\r\n\t// Position selectors must be done after the filter\r\n\t// And so must :not(positional) so we move all PSEUDOs to the end\r\n\twhile ( (match = Expr.match.PSEUDO.exec( selector )) ) {\r\n\t\tlater += match[0];\r\n\t\tselector = selector.replace( Expr.match.PSEUDO, \"\" );\r\n\t}\r\n\r\n\tselector = Expr.relative[selector] ? selector + \"*\" : selector;\r\n\r\n\tfor ( var i = 0, l = root.length; i < l; i++ ) {\r\n\t\tSizzle( selector, root[i], tmpSet );\r\n\t}\r\n\r\n\treturn Sizzle.filter( later, tmpSet );\r\n};\r\n\r\n// EXPOSE\r\n\r\nwindow.tinymce.dom.Sizzle = Sizzle;\r\n\r\n})();\r\n\r\n\r\n(function(tinymce) {\r\n\t// Shorten names\r\n\tvar each = tinymce.each, DOM = tinymce.DOM, isIE = tinymce.isIE, isWebKit = tinymce.isWebKit, Event;\r\n\r\n\ttinymce.create('tinymce.dom.EventUtils', {\r\n\t\tEventUtils : function() {\r\n\t\t\tthis.inits = [];\r\n\t\t\tthis.events = [];\r\n\t\t},\r\n\r\n\t\tadd : function(o, n, f, s) {\r\n\t\t\tvar cb, t = this, el = t.events, r;\r\n\r\n\t\t\tif (n instanceof Array) {\r\n\t\t\t\tr = [];\r\n\r\n\t\t\t\teach(n, function(n) {\r\n\t\t\t\t\tr.push(t.add(o, n, f, s));\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn r;\r\n\t\t\t}\r\n\r\n\t\t\t// Handle array\r\n\t\t\tif (o && o.hasOwnProperty && o instanceof Array) {\r\n\t\t\t\tr = [];\r\n\r\n\t\t\t\teach(o, function(o) {\r\n\t\t\t\t\to = DOM.get(o);\r\n\t\t\t\t\tr.push(t.add(o, n, f, s));\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn r;\r\n\t\t\t}\r\n\r\n\t\t\to = DOM.get(o);\r\n\r\n\t\t\tif (!o)\r\n\t\t\t\treturn;\r\n\r\n\t\t\t// Setup event callback\r\n\t\t\tcb = function(e) {\r\n\t\t\t\t// Is all events disabled\r\n\t\t\t\tif (t.disabled)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\te = e || window.event;\r\n\r\n\t\t\t\t// Patch in target, preventDefault and stopPropagation in IE it's W3C valid\r\n\t\t\t\tif (e && isIE) {\r\n\t\t\t\t\tif (!e.target)\r\n\t\t\t\t\t\te.target = e.srcElement;\r\n\r\n\t\t\t\t\t// Patch in preventDefault, stopPropagation methods for W3C compatibility\r\n\t\t\t\t\ttinymce.extend(e, t._stoppers);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!s)\r\n\t\t\t\t\treturn f(e);\r\n\r\n\t\t\t\treturn f.call(s, e);\r\n\t\t\t};\r\n\r\n\t\t\tif (n == 'unload') {\r\n\t\t\t\ttinymce.unloads.unshift({func : cb});\r\n\t\t\t\treturn cb;\r\n\t\t\t}\r\n\r\n\t\t\tif (n == 'init') {\r\n\t\t\t\tif (t.domLoaded)\r\n\t\t\t\t\tcb();\r\n\t\t\t\telse\r\n\t\t\t\t\tt.inits.push(cb);\r\n\r\n\t\t\t\treturn cb;\r\n\t\t\t}\r\n\r\n\t\t\t// Store away listener reference\r\n\t\t\tel.push({\r\n\t\t\t\tobj : o,\r\n\t\t\t\tname : n,\r\n\t\t\t\tfunc : f,\r\n\t\t\t\tcfunc : cb,\r\n\t\t\t\tscope : s\r\n\t\t\t});\r\n\r\n\t\t\tt._add(o, n, cb);\r\n\r\n\t\t\treturn f;\r\n\t\t},\r\n\r\n\t\tremove : function(o, n, f) {\r\n\t\t\tvar t = this, a = t.events, s = false, r;\r\n\r\n\t\t\t// Handle array\r\n\t\t\tif (o && o.hasOwnProperty && o instanceof Array) {\r\n\t\t\t\tr = [];\r\n\r\n\t\t\t\teach(o, function(o) {\r\n\t\t\t\t\to = DOM.get(o);\r\n\t\t\t\t\tr.push(t.remove(o, n, f));\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn r;\r\n\t\t\t}\r\n\r\n\t\t\to = DOM.get(o);\r\n\r\n\t\t\teach(a, function(e, i) {\r\n\t\t\t\tif (e.obj == o && e.name == n && (!f || (e.func == f || e.cfunc == f))) {\r\n\t\t\t\t\ta.splice(i, 1);\r\n\t\t\t\t\tt._remove(o, n, e.cfunc);\r\n\t\t\t\t\ts = true;\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn s;\r\n\t\t},\r\n\r\n\t\tclear : function(o) {\r\n\t\t\tvar t = this, a = t.events, i, e;\r\n\r\n\t\t\tif (o) {\r\n\t\t\t\to = DOM.get(o);\r\n\r\n\t\t\t\tfor (i = a.length - 1; i >= 0; i--) {\r\n\t\t\t\t\te = a[i];\r\n\r\n\t\t\t\t\tif (e.obj === o) {\r\n\t\t\t\t\t\tt._remove(e.obj, e.name, e.cfunc);\r\n\t\t\t\t\t\te.obj = e.cfunc = null;\r\n\t\t\t\t\t\ta.splice(i, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tcancel : function(e) {\r\n\t\t\tif (!e)\r\n\t\t\t\treturn false;\r\n\r\n\t\t\tthis.stop(e);\r\n\r\n\t\t\treturn this.prevent(e);\r\n\t\t},\r\n\r\n\t\tstop : function(e) {\r\n\t\t\tif (e.stopPropagation)\r\n\t\t\t\te.stopPropagation();\r\n\t\t\telse\r\n\t\t\t\te.cancelBubble = true;\r\n\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\tprevent : function(e) {\r\n\t\t\tif (e.preventDefault)\r\n\t\t\t\te.preventDefault();\r\n\t\t\telse\r\n\t\t\t\te.returnValue = false;\r\n\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\tdestroy : function() {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\teach(t.events, function(e, i) {\r\n\t\t\t\tt._remove(e.obj, e.name, e.cfunc);\r\n\t\t\t\te.obj = e.cfunc = null;\r\n\t\t\t});\r\n\r\n\t\t\tt.events = [];\r\n\t\t\tt = null;\r\n\t\t},\r\n\r\n\t\t_add : function(o, n, f) {\r\n\t\t\tif (o.attachEvent)\r\n\t\t\t\to.attachEvent('on' + n, f);\r\n\t\t\telse if (o.addEventListener)\r\n\t\t\t\to.addEventListener(n, f, false);\r\n\t\t\telse\r\n\t\t\t\to['on' + n] = f;\r\n\t\t},\r\n\r\n\t\t_remove : function(o, n, f) {\r\n\t\t\tif (o) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif (o.detachEvent)\r\n\t\t\t\t\t\to.detachEvent('on' + n, f);\r\n\t\t\t\t\telse if (o.removeEventListener)\r\n\t\t\t\t\t\to.removeEventListener(n, f, false);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\to['on' + n] = null;\r\n\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t// Might fail with permission denined on IE so we just ignore that\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_pageInit : function(win) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\t// Keep it from running more than once\r\n\t\t\tif (t.domLoaded)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tt.domLoaded = true;\r\n\r\n\t\t\teach(t.inits, function(c) {\r\n\t\t\t\tc();\r\n\t\t\t});\r\n\r\n\t\t\tt.inits = [];\r\n\t\t},\r\n\r\n\t\t_wait : function(win) {\r\n\t\t\tvar t = this, doc = win.document;\r\n\r\n\t\t\t// No need since the document is already loaded\r\n\t\t\tif (win.tinyMCE_GZ && tinyMCE_GZ.loaded) {\r\n\t\t\t\tt.domLoaded = 1;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Use IE method\r\n\t\t\tif (doc.attachEvent) {\r\n\t\t\t\tdoc.attachEvent(\"onreadystatechange\", function() {\r\n\t\t\t\t\tif (doc.readyState === \"complete\") {\r\n\t\t\t\t\t\tdoc.detachEvent(\"onreadystatechange\", arguments.callee);\r\n\t\t\t\t\t\tt._pageInit(win);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (doc.documentElement.doScroll && win == win.top) {\r\n\t\t\t\t\t(function() {\r\n\t\t\t\t\t\tif (t.domLoaded)\r\n\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t// If IE is used, use the trick by Diego Perini\r\n\t\t\t\t\t\t\t// http://javascript.nwbox.com/IEContentLoaded/\r\n\t\t\t\t\t\t\tdoc.documentElement.doScroll(\"left\");\r\n\t\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t\tsetTimeout(arguments.callee, 0);\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tt._pageInit(win);\r\n\t\t\t\t\t})();\r\n\t\t\t\t}\r\n\t\t\t} else if (doc.addEventListener) {\r\n\t\t\t\tt._add(win, 'DOMContentLoaded', function() {\r\n\t\t\t\t\tt._pageInit(win);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tt._add(win, 'load', function() {\r\n\t\t\t\tt._pageInit(win);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_stoppers : {\r\n\t\t\tpreventDefault :  function() {\r\n\t\t\t\tthis.returnValue = false;\r\n\t\t\t},\r\n\r\n\t\t\tstopPropagation : function() {\r\n\t\t\t\tthis.cancelBubble = true;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tEvent = tinymce.dom.Event = new tinymce.dom.EventUtils();\r\n\r\n\t// Dispatch DOM content loaded event for IE and Safari\r\n\tEvent._wait(window);\r\n\r\n\ttinymce.addUnload(function() {\r\n\t\tEvent.destroy();\r\n\t});\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\ttinymce.dom.Element = function(id, settings) {\r\n\t\tvar t = this, dom, el;\r\n\r\n\t\tt.settings = settings = settings || {};\r\n\t\tt.id = id;\r\n\t\tt.dom = dom = settings.dom || tinymce.DOM;\r\n\r\n\t\t// Only IE leaks DOM references, this is a lot faster\r\n\t\tif (!tinymce.isIE)\r\n\t\t\tel = dom.get(t.id);\r\n\r\n\t\ttinymce.each(\r\n\t\t\t\t('getPos,getRect,getParent,add,setStyle,getStyle,setStyles,' + \r\n\t\t\t\t'setAttrib,setAttribs,getAttrib,addClass,removeClass,' + \r\n\t\t\t\t'hasClass,getOuterHTML,setOuterHTML,remove,show,hide,' + \r\n\t\t\t\t'isHidden,setHTML,get').split(/,/)\r\n\t\t\t, function(k) {\r\n\t\t\t\tt[k] = function() {\r\n\t\t\t\t\tvar a = [id], i;\r\n\r\n\t\t\t\t\tfor (i = 0; i < arguments.length; i++)\r\n\t\t\t\t\t\ta.push(arguments[i]);\r\n\r\n\t\t\t\t\ta = dom[k].apply(dom, a);\r\n\t\t\t\t\tt.update(k);\r\n\r\n\t\t\t\t\treturn a;\r\n\t\t\t\t};\r\n\t\t});\r\n\r\n\t\ttinymce.extend(t, {\r\n\t\t\ton : function(n, f, s) {\r\n\t\t\t\treturn tinymce.dom.Event.add(t.id, n, f, s);\r\n\t\t\t},\r\n\r\n\t\t\tgetXY : function() {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tx : parseInt(t.getStyle('left')),\r\n\t\t\t\t\ty : parseInt(t.getStyle('top'))\r\n\t\t\t\t};\r\n\t\t\t},\r\n\r\n\t\t\tgetSize : function() {\r\n\t\t\t\tvar n = dom.get(t.id);\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tw : parseInt(t.getStyle('width') || n.clientWidth),\r\n\t\t\t\t\th : parseInt(t.getStyle('height') || n.clientHeight)\r\n\t\t\t\t};\r\n\t\t\t},\r\n\r\n\t\t\tmoveTo : function(x, y) {\r\n\t\t\t\tt.setStyles({left : x, top : y});\r\n\t\t\t},\r\n\r\n\t\t\tmoveBy : function(x, y) {\r\n\t\t\t\tvar p = t.getXY();\r\n\r\n\t\t\t\tt.moveTo(p.x + x, p.y + y);\r\n\t\t\t},\r\n\r\n\t\t\tresizeTo : function(w, h) {\r\n\t\t\t\tt.setStyles({width : w, height : h});\r\n\t\t\t},\r\n\r\n\t\t\tresizeBy : function(w, h) {\r\n\t\t\t\tvar s = t.getSize();\r\n\r\n\t\t\t\tt.resizeTo(s.w + w, s.h + h);\r\n\t\t\t},\r\n\r\n\t\t\tupdate : function(k) {\r\n\t\t\t\tvar b;\r\n\r\n\t\t\t\tif (tinymce.isIE6 && settings.blocker) {\r\n\t\t\t\t\tk = k || '';\r\n\r\n\t\t\t\t\t// Ignore getters\r\n\t\t\t\t\tif (k.indexOf('get') === 0 || k.indexOf('has') === 0 || k.indexOf('is') === 0)\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t// Remove blocker on remove\r\n\t\t\t\t\tif (k == 'remove') {\r\n\t\t\t\t\t\tdom.remove(t.blocker);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!t.blocker) {\r\n\t\t\t\t\t\tt.blocker = dom.uniqueId();\r\n\t\t\t\t\t\tb = dom.add(settings.container || dom.getRoot(), 'iframe', {id : t.blocker, style : 'position:absolute;', frameBorder : 0, src : 'javascript:\"\"'});\r\n\t\t\t\t\t\tdom.setStyle(b, 'opacity', 0);\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\tb = dom.get(t.blocker);\r\n\r\n\t\t\t\t\tdom.setStyles(b, {\r\n\t\t\t\t\t\tleft : t.getStyle('left', 1),\r\n\t\t\t\t\t\ttop : t.getStyle('top', 1),\r\n\t\t\t\t\t\twidth : t.getStyle('width', 1),\r\n\t\t\t\t\t\theight : t.getStyle('height', 1),\r\n\t\t\t\t\t\tdisplay : t.getStyle('display', 1),\r\n\t\t\t\t\t\tzIndex : parseInt(t.getStyle('zIndex', 1) || 0) - 1\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\tfunction trimNl(s) {\r\n\t\treturn s.replace(/[\\n\\r]+/g, '');\r\n\t};\r\n\r\n\t// Shorten names\r\n\tvar is = tinymce.is, isIE = tinymce.isIE, each = tinymce.each;\r\n\r\n\ttinymce.create('tinymce.dom.Selection', {\r\n\t\tSelection : function(dom, win, serializer) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tt.dom = dom;\r\n\t\t\tt.win = win;\r\n\t\t\tt.serializer = serializer;\r\n\r\n\t\t\t// Add events\r\n\t\t\teach([\r\n\t\t\t\t'onBeforeSetContent',\r\n\t\t\t\t'onBeforeGetContent',\r\n\t\t\t\t'onSetContent',\r\n\t\t\t\t'onGetContent'\r\n\t\t\t], function(e) {\r\n\t\t\t\tt[e] = new tinymce.util.Dispatcher(t);\r\n\t\t\t});\r\n\r\n\t\t\t// No W3C Range support\r\n\t\t\tif (!t.win.getSelection)\r\n\t\t\t\tt.tridentSel = new tinymce.dom.TridentSelection(t);\r\n\r\n\t\t\t// Prevent leaks\r\n\t\t\ttinymce.addUnload(t.destroy, t);\r\n\t\t},\r\n\r\n\t\tgetContent : function(s) {\r\n\t\t\tvar t = this, r = t.getRng(), e = t.dom.create(\"body\"), se = t.getSel(), wb, wa, n;\r\n\r\n\t\t\ts = s || {};\r\n\t\t\twb = wa = '';\r\n\t\t\ts.get = true;\r\n\t\t\ts.format = s.format || 'html';\r\n\t\t\tt.onBeforeGetContent.dispatch(t, s);\r\n\r\n\t\t\tif (s.format == 'text')\r\n\t\t\t\treturn t.isCollapsed() ? '' : (r.text || (se.toString ? se.toString() : ''));\r\n\r\n\t\t\tif (r.cloneContents) {\r\n\t\t\t\tn = r.cloneContents();\r\n\r\n\t\t\t\tif (n)\r\n\t\t\t\t\te.appendChild(n);\r\n\t\t\t} else if (is(r.item) || is(r.htmlText))\r\n\t\t\t\te.innerHTML = r.item ? r.item(0).outerHTML : r.htmlText;\r\n\t\t\telse\r\n\t\t\t\te.innerHTML = r.toString();\r\n\r\n\t\t\t// Keep whitespace before and after\r\n\t\t\tif (/^\\s/.test(e.innerHTML))\r\n\t\t\t\twb = ' ';\r\n\r\n\t\t\tif (/\\s+$/.test(e.innerHTML))\r\n\t\t\t\twa = ' ';\r\n\r\n\t\t\ts.getInner = true;\r\n\r\n\t\t\ts.content = t.isCollapsed() ? '' : wb + t.serializer.serialize(e, s) + wa;\r\n\t\t\tt.onGetContent.dispatch(t, s);\r\n\r\n\t\t\treturn s.content;\r\n\t\t},\r\n\r\n\t\tsetContent : function(h, s) {\r\n\t\t\tvar t = this, r = t.getRng(), c, d = t.win.document;\r\n\r\n\t\t\ts = s || {format : 'html'};\r\n\t\t\ts.set = true;\r\n\t\t\th = s.content = t.dom.processHTML(h);\r\n\r\n\t\t\t// Dispatch before set content event\r\n\t\t\tt.onBeforeSetContent.dispatch(t, s);\r\n\t\t\th = s.content;\r\n\r\n\t\t\tif (r.insertNode) {\r\n\t\t\t\t// Make caret marker since insertNode places the caret in the beginning of text after insert\r\n\t\t\t\th += '<span id=\"__caret\">_</span>';\r\n\r\n\t\t\t\t// Delete and insert new node\r\n\t\t\t\t\r\n\t\t\t\tif (r.startContainer == d && r.endContainer ==  d) {\r\n\t\t\t\t\t// WebKit will fail if the body is empty since the range is then invalid and it can't insert contents\r\n\t\t\t\t\td.body.innerHTML = h;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tr.deleteContents();\r\n\t\t\t\t\tif (d.body.childNodes.length == 0) {\r\n\t\t\t\t\t\td.body.innerHTML = h;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tr.insertNode(r.createContextualFragment(h));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Move to caret marker\r\n\t\t\t\tc = t.dom.get('__caret');\r\n\t\t\t\t// Make sure we wrap it compleatly, Opera fails with a simple select call\r\n\t\t\t\tr = d.createRange();\r\n\t\t\t\tr.setStartBefore(c);\r\n\t\t\t\tr.setEndBefore(c);\r\n\t\t\t\tt.setRng(r);\r\n\r\n\t\t\t\t// Remove the caret position\r\n\t\t\t\tt.dom.remove('__caret');\r\n\t\t\t} else {\r\n\t\t\t\tif (r.item) {\r\n\t\t\t\t\t// Delete content and get caret text selection\r\n\t\t\t\t\td.execCommand('Delete', false, null);\r\n\t\t\t\t\tr = t.getRng();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tr.pasteHTML(h);\r\n\t\t\t}\r\n\r\n\t\t\t// Dispatch set content event\r\n\t\t\tt.onSetContent.dispatch(t, s);\r\n\t\t},\r\n\r\n\t\tgetStart : function() {\r\n\t\t\tvar rng = this.getRng(), startElement, parentElement, checkRng, node;\r\n\r\n\t\t\tif (rng.duplicate || rng.item) {\r\n\t\t\t\t// Control selection, return first item\r\n\t\t\t\tif (rng.item)\r\n\t\t\t\t\treturn rng.item(0);\r\n\r\n\t\t\t\t// Get start element\r\n\t\t\t\tcheckRng = rng.duplicate();\r\n\t\t\t\tcheckRng.collapse(1);\r\n\t\t\t\tstartElement = checkRng.parentElement();\r\n\r\n\t\t\t\t// Check if range parent is inside the start element, then return the inner parent element\r\n\t\t\t\t// This will fix issues when a single element is selected, IE would otherwise return the wrong start element\r\n\t\t\t\tparentElement = node = rng.parentElement();\r\n\t\t\t\twhile (node = node.parentNode) {\r\n\t\t\t\t\tif (node == startElement) {\r\n\t\t\t\t\t\tstartElement = parentElement;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// If start element is body element try to move to the first child if it exists\r\n\t\t\t\tif (startElement && startElement.nodeName == 'BODY')\r\n\t\t\t\t\treturn startElement.firstChild || startElement;\r\n\r\n\t\t\t\treturn startElement;\r\n\t\t\t} else {\r\n\t\t\t\tstartElement = rng.startContainer;\r\n\r\n\t\t\t\tif (startElement.nodeType == 1 && startElement.hasChildNodes())\r\n\t\t\t\t\tstartElement = startElement.childNodes[Math.min(startElement.childNodes.length - 1, rng.startOffset)];\r\n\r\n\t\t\t\tif (startElement && startElement.nodeType == 3)\r\n\t\t\t\t\treturn startElement.parentNode;\r\n\r\n\t\t\t\treturn startElement;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetEnd : function() {\r\n\t\t\tvar t = this, r = t.getRng(), e, eo;\r\n\r\n\t\t\tif (r.duplicate || r.item) {\r\n\t\t\t\tif (r.item)\r\n\t\t\t\t\treturn r.item(0);\r\n\r\n\t\t\t\tr = r.duplicate();\r\n\t\t\t\tr.collapse(0);\r\n\t\t\t\te = r.parentElement();\r\n\r\n\t\t\t\tif (e && e.nodeName == 'BODY')\r\n\t\t\t\t\treturn e.lastChild || e;\r\n\r\n\t\t\t\treturn e;\r\n\t\t\t} else {\r\n\t\t\t\te = r.endContainer;\r\n\t\t\t\teo = r.endOffset;\r\n\r\n\t\t\t\tif (e.nodeType == 1 && e.hasChildNodes())\r\n\t\t\t\t\te = e.childNodes[eo > 0 ? eo - 1 : eo];\r\n\r\n\t\t\t\tif (e && e.nodeType == 3)\r\n\t\t\t\t\treturn e.parentNode;\r\n\r\n\t\t\t\treturn e;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetBookmark : function(type, normalized) {\r\n\t\t\tvar t = this, dom = t.dom, rng, rng2, id, collapsed, name, element, index, chr = '\\uFEFF', styles;\r\n\r\n\t\t\tfunction findIndex(name, element) {\r\n\t\t\t\tvar index = 0;\r\n\r\n\t\t\t\teach(dom.select(name), function(node, i) {\r\n\t\t\t\t\tif (node == element)\r\n\t\t\t\t\t\tindex = i;\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn index;\r\n\t\t\t};\r\n\r\n\t\t\tif (type == 2) {\r\n\t\t\t\tfunction getLocation() {\r\n\t\t\t\t\tvar rng = t.getRng(true), root = dom.getRoot(), bookmark = {};\r\n\r\n\t\t\t\t\tfunction getPoint(rng, start) {\r\n\t\t\t\t\t\tvar container = rng[start ? 'startContainer' : 'endContainer'],\r\n\t\t\t\t\t\t\toffset = rng[start ? 'startOffset' : 'endOffset'], point = [], node, childNodes, after = 0;\r\n\r\n\t\t\t\t\t\tif (container.nodeType == 3) {\r\n\t\t\t\t\t\t\tif (normalized) {\r\n\t\t\t\t\t\t\t\tfor (node = container.previousSibling; node && node.nodeType == 3; node = node.previousSibling)\r\n\t\t\t\t\t\t\t\t\toffset += node.nodeValue.length;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tpoint.push(offset);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tchildNodes = container.childNodes;\r\n\r\n\t\t\t\t\t\t\tif (offset >= childNodes.length && childNodes.length) {\r\n\t\t\t\t\t\t\t\tafter = 1;\r\n\t\t\t\t\t\t\t\toffset = Math.max(0, childNodes.length - 1);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tpoint.push(t.dom.nodeIndex(childNodes[offset], normalized) + after);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfor (; container && container != root; container = container.parentNode)\r\n\t\t\t\t\t\t\tpoint.push(t.dom.nodeIndex(container, normalized));\r\n\r\n\t\t\t\t\t\treturn point;\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tbookmark.start = getPoint(rng, true);\r\n\r\n\t\t\t\t\tif (!t.isCollapsed())\r\n\t\t\t\t\t\tbookmark.end = getPoint(rng);\r\n\r\n\t\t\t\t\treturn bookmark;\r\n\t\t\t\t};\r\n\r\n\t\t\t\treturn getLocation();\r\n\t\t\t}\r\n\r\n\t\t\t// Handle simple range\r\n\t\t\tif (type)\r\n\t\t\t\treturn {rng : t.getRng()};\r\n\r\n\t\t\trng = t.getRng();\r\n\t\t\tid = dom.uniqueId();\r\n\t\t\tcollapsed = tinyMCE.activeEditor.selection.isCollapsed();\r\n\t\t\tstyles = 'overflow:hidden;line-height:0px';\r\n\r\n\t\t\t// Explorer method\r\n\t\t\tif (rng.duplicate || rng.item) {\r\n\t\t\t\t// Text selection\r\n\t\t\t\tif (!rng.item) {\r\n\t\t\t\t\trng2 = rng.duplicate();\r\n\r\n\t\t\t\t\t// Insert start marker\r\n\t\t\t\t\trng.collapse();\r\n\t\t\t\t\trng.pasteHTML('<span _mce_type=\"bookmark\" id=\"' + id + '_start\" style=\"' + styles + '\">' + chr + '</span>');\r\n\r\n\t\t\t\t\t// Insert end marker\r\n\t\t\t\t\tif (!collapsed) {\r\n\t\t\t\t\t\trng2.collapse(false);\r\n\t\t\t\t\t\trng2.pasteHTML('<span _mce_type=\"bookmark\" id=\"' + id + '_end\" style=\"' + styles + '\">' + chr + '</span>');\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Control selection\r\n\t\t\t\t\telement = rng.item(0);\r\n\t\t\t\t\tname = element.nodeName;\r\n\r\n\t\t\t\t\treturn {name : name, index : findIndex(name, element)};\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\telement = t.getNode();\r\n\t\t\t\tname = element.nodeName;\r\n\t\t\t\tif (name == 'IMG')\r\n\t\t\t\t\treturn {name : name, index : findIndex(name, element)};\r\n\r\n\t\t\t\t// W3C method\r\n\t\t\t\trng2 = rng.cloneRange();\r\n\r\n\t\t\t\t// Insert end marker\r\n\t\t\t\tif (!collapsed) {\r\n\t\t\t\t\trng2.collapse(false);\r\n\t\t\t\t\trng2.insertNode(dom.create('span', {_mce_type : \"bookmark\", id : id + '_end', style : styles}, chr));\r\n\t\t\t\t}\r\n\r\n\t\t\t\trng.collapse(true);\r\n\t\t\t\trng.insertNode(dom.create('span', {_mce_type : \"bookmark\", id : id + '_start', style : styles}, chr));\r\n\t\t\t}\r\n\r\n\t\t\tt.moveToBookmark({id : id, keep : 1});\r\n\r\n\t\t\treturn {id : id};\r\n\t\t},\r\n\r\n\t\tmoveToBookmark : function(bookmark) {\r\n\t\t\tvar t = this, dom = t.dom, marker1, marker2, rng, root, startContainer, endContainer, startOffset, endOffset;\r\n\r\n\t\t\t// Clear selection cache\r\n\t\t\tif (t.tridentSel)\r\n\t\t\t\tt.tridentSel.destroy();\r\n\r\n\t\t\tif (bookmark) {\r\n\t\t\t\tif (bookmark.start) {\r\n\t\t\t\t\trng = dom.createRng();\r\n\t\t\t\t\troot = dom.getRoot();\r\n\r\n\t\t\t\t\tfunction setEndPoint(start) {\r\n\t\t\t\t\t\tvar point = bookmark[start ? 'start' : 'end'], i, node, offset, children;\r\n\r\n\t\t\t\t\t\tif (point) {\r\n\t\t\t\t\t\t\t// Find container node\r\n\t\t\t\t\t\t\tfor (node = root, i = point.length - 1; i >= 1; i--) {\r\n\t\t\t\t\t\t\t\tchildren = node.childNodes;\r\n\r\n\t\t\t\t\t\t\t\tif (children.length)\r\n\t\t\t\t\t\t\t\t\tnode = children[point[i]];\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Set offset within container node\r\n\t\t\t\t\t\t\tif (start)\r\n\t\t\t\t\t\t\t\trng.setStart(node, point[0]);\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\trng.setEnd(node, point[0]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tsetEndPoint(true);\r\n\t\t\t\t\tsetEndPoint();\r\n\r\n\t\t\t\t\tt.setRng(rng);\r\n\t\t\t\t} else if (bookmark.id) {\r\n\t\t\t\t\tfunction restoreEndPoint(suffix) {\r\n\t\t\t\t\t\tvar marker = dom.get(bookmark.id + '_' + suffix), node, idx, next, prev, keep = bookmark.keep;\r\n\r\n\t\t\t\t\t\tif (marker) {\r\n\t\t\t\t\t\t\tnode = marker.parentNode;\r\n\r\n\t\t\t\t\t\t\tif (suffix == 'start') {\r\n\t\t\t\t\t\t\t\tif (!keep) {\r\n\t\t\t\t\t\t\t\t\tidx = dom.nodeIndex(marker);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tnode = marker.firstChild;\r\n\t\t\t\t\t\t\t\t\tidx = 1;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tstartContainer = endContainer = node;\r\n\t\t\t\t\t\t\t\tstartOffset = endOffset = idx;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif (!keep) {\r\n\t\t\t\t\t\t\t\t\tidx = dom.nodeIndex(marker);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tnode = marker.firstChild;\r\n\t\t\t\t\t\t\t\t\tidx = 1;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tendContainer = node;\r\n\t\t\t\t\t\t\t\tendOffset = idx;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (!keep) {\r\n\t\t\t\t\t\t\t\tprev = marker.previousSibling;\r\n\t\t\t\t\t\t\t\tnext = marker.nextSibling;\r\n\r\n\t\t\t\t\t\t\t\t// Remove all marker text nodes\r\n\t\t\t\t\t\t\t\teach(tinymce.grep(marker.childNodes), function(node) {\r\n\t\t\t\t\t\t\t\t\tif (node.nodeType == 3)\r\n\t\t\t\t\t\t\t\t\t\tnode.nodeValue = node.nodeValue.replace(/\\uFEFF/g, '');\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t// Remove marker but keep children if for example contents where inserted into the marker\r\n\t\t\t\t\t\t\t\t// Also remove duplicated instances of the marker for example by a split operation or by WebKit auto split on paste feature\r\n\t\t\t\t\t\t\t\twhile (marker = dom.get(bookmark.id + '_' + suffix))\r\n\t\t\t\t\t\t\t\t\tdom.remove(marker, 1);\r\n\r\n\t\t\t\t\t\t\t\t// If siblings are text nodes then merge them\r\n\t\t\t\t\t\t\t\tif (prev && next && prev.nodeType == next.nodeType && prev.nodeType == 3) {\r\n\t\t\t\t\t\t\t\t\tidx = prev.nodeValue.length;\r\n\t\t\t\t\t\t\t\t\tprev.appendData(next.nodeValue);\r\n\t\t\t\t\t\t\t\t\tdom.remove(next);\r\n\r\n\t\t\t\t\t\t\t\t\tif (suffix == 'start') {\r\n\t\t\t\t\t\t\t\t\t\tstartContainer = endContainer = prev;\r\n\t\t\t\t\t\t\t\t\t\tstartOffset = endOffset = idx;\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tendContainer = prev;\r\n\t\t\t\t\t\t\t\t\t\tendOffset = idx;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tfunction addBogus(node) {\r\n\t\t\t\t\t\t// Adds a bogus BR element for empty block elements\r\n\t\t\t\t\t\t// on non IE browsers just to have a place to put the caret\r\n\t\t\t\t\t\tif (!isIE && dom.isBlock(node) && !node.innerHTML)\r\n\t\t\t\t\t\t\tnode.innerHTML = '<br _mce_bogus=\"1\" />';\r\n\r\n\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\t// Restore start/end points\r\n\t\t\t\t\trestoreEndPoint('start');\r\n\t\t\t\t\trestoreEndPoint('end');\r\n\r\n\t\t\t\t\tif (startContainer) {\r\n\t\t\t\t\t\trng = dom.createRng();\r\n\t\t\t\t\t\trng.setStart(addBogus(startContainer), startOffset);\r\n\t\t\t\t\t\trng.setEnd(addBogus(endContainer), endOffset);\r\n\t\t\t\t\t\tt.setRng(rng);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (bookmark.name) {\r\n\t\t\t\t\tt.select(dom.select(bookmark.name)[bookmark.index]);\r\n\t\t\t\t} else if (bookmark.rng)\r\n\t\t\t\t\tt.setRng(bookmark.rng);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tselect : function(node, content) {\r\n\t\t\tvar t = this, dom = t.dom, rng = dom.createRng(), idx;\r\n\r\n\t\t\tidx = dom.nodeIndex(node);\r\n\t\t\trng.setStart(node.parentNode, idx);\r\n\t\t\trng.setEnd(node.parentNode, idx + 1);\r\n\r\n\t\t\t// Find first/last text node or BR element\r\n\t\t\tif (content) {\r\n\t\t\t\tfunction setPoint(node, start) {\r\n\t\t\t\t\tvar walker = new tinymce.dom.TreeWalker(node, node);\r\n\r\n\t\t\t\t\tdo {\r\n\t\t\t\t\t\t// Text node\r\n\t\t\t\t\t\tif (node.nodeType == 3 && tinymce.trim(node.nodeValue).length != 0) {\r\n\t\t\t\t\t\t\tif (start)\r\n\t\t\t\t\t\t\t\trng.setStart(node, 0);\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\trng.setEnd(node, node.nodeValue.length);\r\n\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// BR element\r\n\t\t\t\t\t\tif (node.nodeName == 'BR') {\r\n\t\t\t\t\t\t\tif (start)\r\n\t\t\t\t\t\t\t\trng.setStartBefore(node);\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\trng.setEndBefore(node);\r\n\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} while (node = (start ? walker.next() : walker.prev()));\r\n\t\t\t\t};\r\n\r\n\t\t\t\tsetPoint(node, 1);\r\n\t\t\t\tsetPoint(node);\r\n\t\t\t}\r\n\r\n\t\t\tt.setRng(rng);\r\n\r\n\t\t\treturn node;\r\n\t\t},\r\n\r\n\t\tisCollapsed : function() {\r\n\t\t\tvar t = this, r = t.getRng(), s = t.getSel();\r\n\r\n\t\t\tif (!r || r.item)\r\n\t\t\t\treturn false;\r\n\r\n\t\t\tif (r.compareEndPoints)\r\n\t\t\t\treturn r.compareEndPoints('StartToEnd', r) === 0;\r\n\r\n\t\t\treturn !s || r.collapsed;\r\n\t\t},\r\n\r\n\t\tcollapse : function(b) {\r\n\t\t\tvar t = this, r = t.getRng(), n;\r\n\r\n\t\t\t// Control range on IE\r\n\t\t\tif (r.item) {\r\n\t\t\t\tn = r.item(0);\r\n\t\t\t\tr = this.win.document.body.createTextRange();\r\n\t\t\t\tr.moveToElementText(n);\r\n\t\t\t}\r\n\r\n\t\t\tr.collapse(!!b);\r\n\t\t\tt.setRng(r);\r\n\t\t},\r\n\r\n\t\tgetSel : function() {\r\n\t\t\tvar t = this, w = this.win;\r\n\r\n\t\t\treturn w.getSelection ? w.getSelection() : w.document.selection;\r\n\t\t},\r\n\r\n\t\tgetRng : function(w3c) {\r\n\t\t\tvar t = this, s, r;\r\n\r\n\t\t\t// Found tridentSel object then we need to use that one\r\n\t\t\tif (w3c && t.tridentSel)\r\n\t\t\t\treturn t.tridentSel.getRangeAt(0);\r\n\r\n\t\t\ttry {\r\n\t\t\t\tif (s = t.getSel())\r\n\t\t\t\t\tr = s.rangeCount > 0 ? s.getRangeAt(0) : (s.createRange ? s.createRange() : t.win.document.createRange());\r\n\t\t\t} catch (ex) {\r\n\t\t\t\t// IE throws unspecified error here if TinyMCE is placed in a frame/iframe\r\n\t\t\t}\r\n\r\n\t\t\t// No range found then create an empty one\r\n\t\t\t// This can occur when the editor is placed in a hidden container element on Gecko\r\n\t\t\t// Or on IE when there was an exception\r\n\t\t\tif (!r)\r\n\t\t\t\tr = t.win.document.createRange ? t.win.document.createRange() : t.win.document.body.createTextRange();\r\n\r\n\t\t\tif (t.selectedRange && t.explicitRange) {\r\n\t\t\t\tif (r.compareBoundaryPoints(r.START_TO_START, t.selectedRange) === 0 && r.compareBoundaryPoints(r.END_TO_END, t.selectedRange) === 0) {\r\n\t\t\t\t\t// Safari, Opera and Chrome only ever select text which causes the range to change.\r\n\t\t\t\t\t// This lets us use the originally set range if the selection hasn't been changed by the user.\r\n\t\t\t\t\tr = t.explicitRange;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tt.selectedRange = null;\r\n\t\t\t\t\tt.explicitRange = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn r;\r\n\t\t},\r\n\r\n\t\tsetRng : function(r) {\r\n\t\t\tvar s, t = this;\r\n\t\t\t\r\n\t\t\tif (!t.tridentSel) {\r\n\t\t\t\ts = t.getSel();\r\n\r\n\t\t\t\tif (s) {\r\n\t\t\t\t\tt.explicitRange = r;\r\n\t\t\t\t\ts.removeAllRanges();\r\n\t\t\t\t\ts.addRange(r);\r\n\t\t\t\t\tt.selectedRange = s.getRangeAt(0);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// Is W3C Range\r\n\t\t\t\tif (r.cloneRange) {\r\n\t\t\t\t\tt.tridentSel.addRange(r);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Is IE specific range\r\n\t\t\t\ttry {\r\n\t\t\t\t\tr.select();\r\n\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t// Needed for some odd IE bug #1843306\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tsetNode : function(n) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tt.setContent(t.dom.getOuterHTML(n));\r\n\r\n\t\t\treturn n;\r\n\t\t},\r\n\r\n\t\tgetNode : function() {\r\n\t\t\tvar t = this, rng = t.getRng(), sel = t.getSel(), elm;\r\n\r\n\t\t\tif (rng.setStart) {\r\n\t\t\t\t// Range maybe lost after the editor is made visible again\r\n\t\t\t\tif (!rng)\r\n\t\t\t\t\treturn t.dom.getRoot();\r\n\r\n\t\t\t\telm = rng.commonAncestorContainer;\r\n\r\n\t\t\t\t// Handle selection a image or other control like element such as anchors\r\n\t\t\t\tif (!rng.collapsed) {\r\n\t\t\t\t\tif (rng.startContainer == rng.endContainer) {\r\n\t\t\t\t\t\tif (rng.startOffset - rng.endOffset < 2) {\r\n\t\t\t\t\t\t\tif (rng.startContainer.hasChildNodes())\r\n\t\t\t\t\t\t\t\telm = rng.startContainer.childNodes[rng.startOffset];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// If the anchor node is a element instead of a text node then return this element\r\n\t\t\t\t\tif (tinymce.isWebKit && sel.anchorNode && sel.anchorNode.nodeType == 1) \r\n\t\t\t\t\t\treturn sel.anchorNode.childNodes[sel.anchorOffset]; \r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (elm && elm.nodeType == 3)\r\n\t\t\t\t\treturn elm.parentNode;\r\n\r\n\t\t\t\treturn elm;\r\n\t\t\t}\r\n\r\n\t\t\treturn rng.item ? rng.item(0) : rng.parentElement();\r\n\t\t},\r\n\r\n\t\tgetSelectedBlocks : function(st, en) {\r\n\t\t\tvar t = this, dom = t.dom, sb, eb, n, bl = [];\r\n\r\n\t\t\tsb = dom.getParent(st || t.getStart(), dom.isBlock);\r\n\t\t\teb = dom.getParent(en || t.getEnd(), dom.isBlock);\r\n\r\n\t\t\tif (sb)\r\n\t\t\t\tbl.push(sb);\r\n\r\n\t\t\tif (sb && eb && sb != eb) {\r\n\t\t\t\tn = sb;\r\n\r\n\t\t\t\twhile ((n = n.nextSibling) && n != eb) {\r\n\t\t\t\t\tif (dom.isBlock(n))\r\n\t\t\t\t\t\tbl.push(n);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (eb && sb != eb)\r\n\t\t\t\tbl.push(eb);\r\n\r\n\t\t\treturn bl;\r\n\t\t},\r\n\r\n\t\tdestroy : function(s) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tt.win = null;\r\n\r\n\t\t\tif (t.tridentSel)\r\n\t\t\t\tt.tridentSel.destroy();\r\n\r\n\t\t\t// Manual destroy then remove unload handler\r\n\t\t\tif (!s)\r\n\t\t\t\ttinymce.removeUnload(t.destroy);\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\ttinymce.create('tinymce.dom.XMLWriter', {\r\n\t\tnode : null,\r\n\r\n\t\tXMLWriter : function(s) {\r\n\t\t\t// Get XML document\r\n\t\t\tfunction getXML() {\r\n\t\t\t\tvar i = document.implementation;\r\n\r\n\t\t\t\tif (!i || !i.createDocument) {\r\n\t\t\t\t\t// Try IE objects\r\n\t\t\t\t\ttry {return new ActiveXObject('MSXML2.DOMDocument');} catch (ex) {}\r\n\t\t\t\t\ttry {return new ActiveXObject('Microsoft.XmlDom');} catch (ex) {}\r\n\t\t\t\t} else\r\n\t\t\t\t\treturn i.createDocument('', '', null);\r\n\t\t\t};\r\n\r\n\t\t\tthis.doc = getXML();\r\n\t\t\t\r\n\t\t\t// Since Opera and WebKit doesn't escape > into &gt; we need to do it our self to normalize the output for all browsers\r\n\t\t\tthis.valid = tinymce.isOpera || tinymce.isWebKit;\r\n\r\n\t\t\tthis.reset();\r\n\t\t},\r\n\r\n\t\treset : function() {\r\n\t\t\tvar t = this, d = t.doc;\r\n\r\n\t\t\tif (d.firstChild)\r\n\t\t\t\td.removeChild(d.firstChild);\r\n\r\n\t\t\tt.node = d.appendChild(d.createElement(\"html\"));\r\n\t\t},\r\n\r\n\t\twriteStartElement : function(n) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tt.node = t.node.appendChild(t.doc.createElement(n));\r\n\t\t},\r\n\r\n\t\twriteAttribute : function(n, v) {\r\n\t\t\tif (this.valid)\r\n\t\t\t\tv = v.replace(/>/g, '%MCGT%');\r\n\r\n\t\t\tthis.node.setAttribute(n, v);\r\n\t\t},\r\n\r\n\t\twriteEndElement : function() {\r\n\t\t\tthis.node = this.node.parentNode;\r\n\t\t},\r\n\r\n\t\twriteFullEndElement : function() {\r\n\t\t\tvar t = this, n = t.node;\r\n\r\n\t\t\tn.appendChild(t.doc.createTextNode(\"\"));\r\n\t\t\tt.node = n.parentNode;\r\n\t\t},\r\n\r\n\t\twriteText : function(v) {\r\n\t\t\tif (this.valid)\r\n\t\t\t\tv = v.replace(/>/g, '%MCGT%');\r\n\r\n\t\t\tthis.node.appendChild(this.doc.createTextNode(v));\r\n\t\t},\r\n\r\n\t\twriteCDATA : function(v) {\r\n\t\t\tthis.node.appendChild(this.doc.createCDATASection(v));\r\n\t\t},\r\n\r\n\t\twriteComment : function(v) {\r\n\t\t\t// Fix for bug #2035694\r\n\t\t\tif (tinymce.isIE)\r\n\t\t\t\tv = v.replace(/^\\-|\\-$/g, ' ');\r\n\r\n\t\t\tthis.node.appendChild(this.doc.createComment(v.replace(/\\-\\-/g, ' ')));\r\n\t\t},\r\n\r\n\t\tgetContent : function() {\r\n\t\t\tvar h;\r\n\r\n\t\t\th = this.doc.xml || new XMLSerializer().serializeToString(this.doc);\r\n\t\t\th = h.replace(/<\\?[^?]+\\?>|<html>|<\\/html>|<html\\/>|<!DOCTYPE[^>]+>/g, '');\r\n\t\t\th = h.replace(/ ?\\/>/g, ' />');\r\n\r\n\t\t\tif (this.valid)\r\n\t\t\t\th = h.replace(/\\%MCGT%/g, '&gt;');\r\n\r\n\t\t\treturn h;\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\ttinymce.create('tinymce.dom.StringWriter', {\r\n\t\tstr : null,\r\n\t\ttags : null,\r\n\t\tcount : 0,\r\n\t\tsettings : null,\r\n\t\tindent : null,\r\n\r\n\t\tStringWriter : function(s) {\r\n\t\t\tthis.settings = tinymce.extend({\r\n\t\t\t\tindent_char : ' ',\r\n\t\t\t\tindentation : 0\r\n\t\t\t}, s);\r\n\r\n\t\t\tthis.reset();\r\n\t\t},\r\n\r\n\t\treset : function() {\r\n\t\t\tthis.indent = '';\r\n\t\t\tthis.str = \"\";\r\n\t\t\tthis.tags = [];\r\n\t\t\tthis.count = 0;\r\n\t\t},\r\n\r\n\t\twriteStartElement : function(n) {\r\n\t\t\tthis._writeAttributesEnd();\r\n\t\t\tthis.writeRaw('<' + n);\r\n\t\t\tthis.tags.push(n);\r\n\t\t\tthis.inAttr = true;\r\n\t\t\tthis.count++;\r\n\t\t\tthis.elementCount = this.count;\r\n\t\t},\r\n\r\n\t\twriteAttribute : function(n, v) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tt.writeRaw(\" \" + t.encode(n) + '=\"' + t.encode(v) + '\"');\r\n\t\t},\r\n\r\n\t\twriteEndElement : function() {\r\n\t\t\tvar n;\r\n\r\n\t\t\tif (this.tags.length > 0) {\r\n\t\t\t\tn = this.tags.pop();\r\n\r\n\t\t\t\tif (this._writeAttributesEnd(1))\r\n\t\t\t\t\tthis.writeRaw('</' + n + '>');\r\n\r\n\t\t\t\tif (this.settings.indentation > 0)\r\n\t\t\t\t\tthis.writeRaw('\\n');\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\twriteFullEndElement : function() {\r\n\t\t\tif (this.tags.length > 0) {\r\n\t\t\t\tthis._writeAttributesEnd();\r\n\t\t\t\tthis.writeRaw('</' + this.tags.pop() + '>');\r\n\r\n\t\t\t\tif (this.settings.indentation > 0)\r\n\t\t\t\t\tthis.writeRaw('\\n');\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\twriteText : function(v) {\r\n\t\t\tthis._writeAttributesEnd();\r\n\t\t\tthis.writeRaw(this.encode(v));\r\n\t\t\tthis.count++;\r\n\t\t},\r\n\r\n\t\twriteCDATA : function(v) {\r\n\t\t\tthis._writeAttributesEnd();\r\n\t\t\tthis.writeRaw('<![CDATA[' + v + ']]>');\r\n\t\t\tthis.count++;\r\n\t\t},\r\n\r\n\t\twriteComment : function(v) {\r\n\t\t\tthis._writeAttributesEnd();\r\n\t\t\tthis.writeRaw('<!-- ' + v + '-->');\r\n\t\t\tthis.count++;\r\n\t\t},\r\n\r\n\t\twriteRaw : function(v) {\r\n\t\t\tthis.str += v;\r\n\t\t},\r\n\r\n\t\tencode : function(s) {\r\n\t\t\treturn s.replace(/[<>&\"]/g, function(v) {\r\n\t\t\t\tswitch (v) {\r\n\t\t\t\t\tcase '<':\r\n\t\t\t\t\t\treturn '&lt;';\r\n\r\n\t\t\t\t\tcase '>':\r\n\t\t\t\t\t\treturn '&gt;';\r\n\r\n\t\t\t\t\tcase '&':\r\n\t\t\t\t\t\treturn '&amp;';\r\n\r\n\t\t\t\t\tcase '\"':\r\n\t\t\t\t\t\treturn '&quot;';\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn v;\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tgetContent : function() {\r\n\t\t\treturn this.str;\r\n\t\t},\r\n\r\n\t\t_writeAttributesEnd : function(s) {\r\n\t\t\tif (!this.inAttr)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tthis.inAttr = false;\r\n\r\n\t\t\tif (s && this.elementCount == this.count) {\r\n\t\t\t\tthis.writeRaw(' />');\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tthis.writeRaw('>');\r\n\r\n\t\t\treturn true;\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\t// Shorten names\r\n\tvar extend = tinymce.extend, each = tinymce.each, Dispatcher = tinymce.util.Dispatcher, isIE = tinymce.isIE, isGecko = tinymce.isGecko;\r\n\r\n\tfunction wildcardToRE(s) {\r\n\t\treturn s.replace(/([?+*])/g, '.$1');\r\n\t};\r\n\r\n\ttinymce.create('tinymce.dom.Serializer', {\r\n\t\tSerializer : function(s) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tt.key = 0;\r\n\t\t\tt.onPreProcess = new Dispatcher(t);\r\n\t\t\tt.onPostProcess = new Dispatcher(t);\r\n\r\n\t\t\ttry {\r\n\t\t\t\tt.writer = new tinymce.dom.XMLWriter();\r\n\t\t\t} catch (ex) {\r\n\t\t\t\t// IE might throw exception if ActiveX is disabled so we then switch to the slightly slower StringWriter\r\n\t\t\t\tt.writer = new tinymce.dom.StringWriter();\r\n\t\t\t}\r\n\r\n\t\t\t// Default settings\r\n\t\t\tt.settings = s = extend({\r\n\t\t\t\tdom : tinymce.DOM,\r\n\t\t\t\tvalid_nodes : 0,\r\n\t\t\t\tnode_filter : 0,\r\n\t\t\t\tattr_filter : 0,\r\n\t\t\t\tinvalid_attrs : /^(_mce_|_moz_|sizset|sizcache)/,\r\n\t\t\t\tclosed : /^(br|hr|input|meta|img|link|param|area)$/,\r\n\t\t\t\tentity_encoding : '', // hostmake // named\r\n\t\t\t\tentities : '160,nbsp,161,iexcl,162,cent,163,pound,164,curren,165,yen,166,brvbar,167,sect,168,uml,169,copy,170,ordf,171,laquo,172,not,173,shy,174,reg,175,macr,176,deg,177,plusmn,178,sup2,179,sup3,180,acute,181,micro,182,para,183,middot,184,cedil,185,sup1,186,ordm,187,raquo,188,frac14,189,frac12,190,frac34,191,iquest,192,Agrave,193,Aacute,194,Acirc,195,Atilde,196,Auml,197,Aring,198,AElig,199,Ccedil,200,Egrave,201,Eacute,202,Ecirc,203,Euml,204,Igrave,205,Iacute,206,Icirc,207,Iuml,208,ETH,209,Ntilde,210,Ograve,211,Oacute,212,Ocirc,213,Otilde,214,Ouml,215,times,216,Oslash,217,Ugrave,218,Uacute,219,Ucirc,220,Uuml,221,Yacute,222,THORN,223,szlig,224,agrave,225,aacute,226,acirc,227,atilde,228,auml,229,aring,230,aelig,231,ccedil,232,egrave,233,eacute,234,ecirc,235,euml,236,igrave,237,iacute,238,icirc,239,iuml,240,eth,241,ntilde,242,ograve,243,oacute,244,ocirc,245,otilde,246,ouml,247,divide,248,oslash,249,ugrave,250,uacute,251,ucirc,252,uuml,253,yacute,254,thorn,255,yuml,402,fnof,913,Alpha,914,Beta,915,Gamma,916,Delta,917,Epsilon,918,Zeta,919,Eta,920,Theta,921,Iota,922,Kappa,923,Lambda,924,Mu,925,Nu,926,Xi,927,Omicron,928,Pi,929,Rho,931,Sigma,932,Tau,933,Upsilon,934,Phi,935,Chi,936,Psi,937,Omega,945,alpha,946,beta,947,gamma,948,delta,949,epsilon,950,zeta,951,eta,952,theta,953,iota,954,kappa,955,lambda,956,mu,957,nu,958,xi,959,omicron,960,pi,961,rho,962,sigmaf,963,sigma,964,tau,965,upsilon,966,phi,967,chi,968,psi,969,omega,977,thetasym,978,upsih,982,piv,8226,bull,8230,hellip,8242,prime,8243,Prime,8254,oline,8260,frasl,8472,weierp,8465,image,8476,real,8482,trade,8501,alefsym,8592,larr,8593,uarr,8594,rarr,8595,darr,8596,harr,8629,crarr,8656,lArr,8657,uArr,8658,rArr,8659,dArr,8660,hArr,8704,forall,8706,part,8707,exist,8709,empty,8711,nabla,8712,isin,8713,notin,8715,ni,8719,prod,8721,sum,8722,minus,8727,lowast,8730,radic,8733,prop,8734,infin,8736,ang,8743,and,8744,or,8745,cap,8746,cup,8747,int,8756,there4,8764,sim,8773,cong,8776,asymp,8800,ne,8801,equiv,8804,le,8805,ge,8834,sub,8835,sup,8836,nsub,8838,sube,8839,supe,8853,oplus,8855,otimes,8869,perp,8901,sdot,8968,lceil,8969,rceil,8970,lfloor,8971,rfloor,9001,lang,9002,rang,9674,loz,9824,spades,9827,clubs,9829,hearts,9830,diams,338,OElig,339,oelig,352,Scaron,353,scaron,376,Yuml,710,circ,732,tilde,8194,ensp,8195,emsp,8201,thinsp,8204,zwnj,8205,zwj,8206,lrm,8207,rlm,8211,ndash,8212,mdash,8216,lsquo,8217,rsquo,8218,sbquo,8220,ldquo,8221,rdquo,8222,bdquo,8224,dagger,8225,Dagger,8240,permil,8249,lsaquo,8250,rsaquo,8364,euro',\r\n\t\t\t\tvalid_elements : '*[*]',\r\n\t\t\t\textended_valid_elements : 0,\r\n\t\t\t\tinvalid_elements : 0,\r\n\t\t\t\tfix_table_elements : 1,\r\n\t\t\t\tfix_list_elements : true,\r\n\t\t\t\tfix_content_duplication : true,\r\n\t\t\t\tconvert_fonts_to_spans : false,\r\n\t\t\t\tfont_size_classes : 0,\r\n\t\t\t\tapply_source_formatting : 0,\r\n\t\t\t\tindent_mode : 'simple',\r\n\t\t\t\tindent_char : '\\t',\r\n\t\t\t\tindent_levels : 1,\r\n\t\t\t\tremove_linebreaks : 1,\r\n\t\t\t\tremove_redundant_brs : 1,\r\n\t\t\t\telement_format : 'xhtml'\r\n\t\t\t}, s);\r\n\r\n\t\t\tt.dom = s.dom;\r\n\t\t\tt.schema = s.schema;\r\n\r\n\t\t\t// Use raw entities if no entities are defined\r\n\t\t\tif (s.entity_encoding == 'named' && !s.entities)\r\n\t\t\t\ts.entity_encoding = 'raw';\r\n\r\n\t\t\tif (s.remove_redundant_brs) {\r\n\t\t\t\tt.onPostProcess.add(function(se, o) {\r\n\t\t\t\t\t// Remove single BR at end of block elements since they get rendered\r\n\t\t\t\t\to.content = o.content.replace(/(<br \\/>\\s*)+<\\/(p|h[1-6]|div|li)>/gi, function(a, b, c) {\r\n\t\t\t\t\t\t// Check if it's a single element\r\n\t\t\t\t\t\tif (/^<br \\/>\\s*<\\//.test(a))\r\n\t\t\t\t\t\t\treturn '</' + c + '>';\r\n\r\n\t\t\t\t\t\treturn a;\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Remove XHTML element endings i.e. produce crap :) XHTML is better\r\n\t\t\tif (s.element_format == 'html') {\r\n\t\t\t\tt.onPostProcess.add(function(se, o) {\r\n\t\t\t\t\to.content = o.content.replace(/<([^>]+) \\/>/g, '<$1>');\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (s.fix_list_elements) {\r\n\t\t\t\tt.onPreProcess.add(function(se, o) {\r\n\t\t\t\t\tvar nl, x, a = ['ol', 'ul'], i, n, p, r = /^(OL|UL)$/, np;\r\n\r\n\t\t\t\t\tfunction prevNode(e, n) {\r\n\t\t\t\t\t\tvar a = n.split(','), i;\r\n\r\n\t\t\t\t\t\twhile ((e = e.previousSibling) != null) {\r\n\t\t\t\t\t\t\tfor (i=0; i<a.length; i++) {\r\n\t\t\t\t\t\t\t\tif (e.nodeName == a[i])\r\n\t\t\t\t\t\t\t\t\treturn e;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tfor (x=0; x<a.length; x++) {\r\n\t\t\t\t\t\tnl = t.dom.select(a[x], o.node);\r\n\r\n\t\t\t\t\t\tfor (i=0; i<nl.length; i++) {\r\n\t\t\t\t\t\t\tn = nl[i];\r\n\t\t\t\t\t\t\tp = n.parentNode;\r\n\r\n\t\t\t\t\t\t\tif (r.test(p.nodeName)) {\r\n\t\t\t\t\t\t\t\tnp = prevNode(n, 'LI');\r\n\r\n\t\t\t\t\t\t\t\tif (!np) {\r\n\t\t\t\t\t\t\t\t\tnp = t.dom.create('li');\r\n\t\t\t\t\t\t\t\t\tnp.innerHTML = '&nbsp;';\r\n\t\t\t\t\t\t\t\t\tnp.appendChild(n);\r\n\t\t\t\t\t\t\t\t\tp.insertBefore(np, p.firstChild);\r\n\t\t\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\t\t\tnp.appendChild(n);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (s.fix_table_elements) {\r\n\t\t\t\tt.onPreProcess.add(function(se, o) {\r\n\t\t\t\t\t// Since Opera will crash if you attach the node to a dynamic document we need to brrowser sniff a specific build\r\n\t\t\t\t\t// so Opera users with an older version will have to live with less compaible output not much we can do here\r\n\t\t\t\t\tif (!tinymce.isOpera || opera.buildNumber() >= 1767) {\r\n\t\t\t\t\t\teach(t.dom.select('p table', o.node).reverse(), function(n) {\r\n\t\t\t\t\t\t\tvar parent = t.dom.getParent(n.parentNode, 'table,p');\r\n\r\n\t\t\t\t\t\t\tif (parent.nodeName != 'TABLE') {\r\n\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\tt.dom.split(parent, n);\r\n\t\t\t\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t\t\t\t// IE can sometimes fire an unknown runtime error so we just ignore it\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tsetEntities : function(s) {\r\n\t\t\tvar t = this, a, i, l = {}, v;\r\n\r\n\t\t\t// No need to setup more than once\r\n\t\t\tif (t.entityLookup)\r\n\t\t\t\treturn;\r\n\r\n\t\t\t// Build regex and lookup array\r\n\t\t\ta = s.split(',');\r\n\t\t\tfor (i = 0; i < a.length; i += 2) {\r\n\t\t\t\tv = a[i];\r\n\r\n\t\t\t\t// Don't add default &amp; &quot; etc.\r\n\t\t\t\tif (v == 34 || v == 38 || v == 60 || v == 62)\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\tl[String.fromCharCode(a[i])] = a[i + 1];\r\n\r\n\t\t\t\tv = parseInt(a[i]).toString(16);\r\n\t\t\t}\r\n\r\n\t\t\tt.entityLookup = l;\r\n\t\t},\r\n\r\n\t\tsetRules : function(s) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tt._setup();\r\n\t\t\tt.rules = {};\r\n\t\t\tt.wildRules = [];\r\n\t\t\tt.validElements = {};\r\n\r\n\t\t\treturn t.addRules(s);\r\n\t\t},\r\n\r\n\t\taddRules : function(s) {\r\n\t\t\tvar t = this, dr;\r\n\r\n\t\t\tif (!s)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tt._setup();\r\n\r\n\t\t\teach(s.split(','), function(s) {\r\n\t\t\t\tvar p = s.split(/\\[|\\]/), tn = p[0].split('/'), ra, at, wat, va = [];\r\n\r\n\t\t\t\t// Extend with default rules\r\n\t\t\t\tif (dr)\r\n\t\t\t\t\tat = tinymce.extend([], dr.attribs);\r\n\r\n\t\t\t\t// Parse attributes\r\n\t\t\t\tif (p.length > 1) {\r\n\t\t\t\t\teach(p[1].split('|'), function(s) {\r\n\t\t\t\t\t\tvar ar = {}, i;\r\n\r\n\t\t\t\t\t\tat = at || [];\r\n\r\n\t\t\t\t\t\t// Parse attribute rule\r\n\t\t\t\t\t\ts = s.replace(/::/g, '~');\r\n\t\t\t\t\t\ts = /^([!\\-])?([\\w*.?~_\\-]+|)([=:<])?(.+)?$/.exec(s);\r\n\t\t\t\t\t\ts[2] = s[2].replace(/~/g, ':');\r\n\r\n\t\t\t\t\t\t// Add required attributes\r\n\t\t\t\t\t\tif (s[1] == '!') {\r\n\t\t\t\t\t\t\tra = ra || [];\r\n\t\t\t\t\t\t\tra.push(s[2]);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Remove inherited attributes\r\n\t\t\t\t\t\tif (s[1] == '-') {\r\n\t\t\t\t\t\t\tfor (i = 0; i <at.length; i++) {\r\n\t\t\t\t\t\t\t\tif (at[i].name == s[2]) {\r\n\t\t\t\t\t\t\t\t\tat.splice(i, 1);\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tswitch (s[3]) {\r\n\t\t\t\t\t\t\t// Add default attrib values\r\n\t\t\t\t\t\t\tcase '=':\r\n\t\t\t\t\t\t\t\tar.defaultVal = s[4] || '';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t// Add forced attrib values\r\n\t\t\t\t\t\t\tcase ':':\r\n\t\t\t\t\t\t\t\tar.forcedVal = s[4];\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t// Add validation values\r\n\t\t\t\t\t\t\tcase '<':\r\n\t\t\t\t\t\t\t\tar.validVals = s[4].split('?');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (/[*.?]/.test(s[2])) {\r\n\t\t\t\t\t\t\twat = wat || [];\r\n\t\t\t\t\t\t\tar.nameRE = new RegExp('^' + wildcardToRE(s[2]) + '$');\r\n\t\t\t\t\t\t\twat.push(ar);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tar.name = s[2];\r\n\t\t\t\t\t\t\tat.push(ar);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tva.push(s[2]);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Handle element names\r\n\t\t\t\teach(tn, function(s, i) {\r\n\t\t\t\t\tvar pr = s.charAt(0), x = 1, ru = {};\r\n\r\n\t\t\t\t\t// Extend with default rule data\r\n\t\t\t\t\tif (dr) {\r\n\t\t\t\t\t\tif (dr.noEmpty)\r\n\t\t\t\t\t\t\tru.noEmpty = dr.noEmpty;\r\n\r\n\t\t\t\t\t\tif (dr.fullEnd)\r\n\t\t\t\t\t\t\tru.fullEnd = dr.fullEnd;\r\n\r\n\t\t\t\t\t\tif (dr.padd)\r\n\t\t\t\t\t\t\tru.padd = dr.padd;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Handle prefixes\r\n\t\t\t\t\tswitch (pr) {\r\n\t\t\t\t\t\tcase '-':\r\n\t\t\t\t\t\t\tru.noEmpty = true;\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase '+':\r\n\t\t\t\t\t\t\tru.fullEnd = true;\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase '#':\r\n\t\t\t\t\t\t\tru.padd = true;\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tx = 0;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttn[i] = s = s.substring(x);\r\n\t\t\t\t\tt.validElements[s] = 1;\r\n\r\n\t\t\t\t\t// Add element name or element regex\r\n\t\t\t\t\tif (/[*.?]/.test(tn[0])) {\r\n\t\t\t\t\t\tru.nameRE = new RegExp('^' + wildcardToRE(tn[0]) + '$');\r\n\t\t\t\t\t\tt.wildRules = t.wildRules || {};\r\n\t\t\t\t\t\tt.wildRules.push(ru);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tru.name = tn[0];\r\n\r\n\t\t\t\t\t\t// Store away default rule\r\n\t\t\t\t\t\tif (tn[0] == '@')\r\n\t\t\t\t\t\t\tdr = ru;\r\n\r\n\t\t\t\t\t\tt.rules[s] = ru;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tru.attribs = at;\r\n\r\n\t\t\t\t\tif (ra)\r\n\t\t\t\t\t\tru.requiredAttribs = ra;\r\n\r\n\t\t\t\t\tif (wat) {\r\n\t\t\t\t\t\t// Build valid attributes regexp\r\n\t\t\t\t\t\ts = '';\r\n\t\t\t\t\t\teach(va, function(v) {\r\n\t\t\t\t\t\t\tif (s)\r\n\t\t\t\t\t\t\t\ts += '|';\r\n\r\n\t\t\t\t\t\t\ts += '(' + wildcardToRE(v) + ')';\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tru.validAttribsRE = new RegExp('^' + s.toLowerCase() + '$');\r\n\t\t\t\t\t\tru.wildAttribs = wat;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t// Build valid elements regexp\r\n\t\t\ts = '';\r\n\t\t\teach(t.validElements, function(v, k) {\r\n\t\t\t\tif (s)\r\n\t\t\t\t\ts += '|';\r\n\r\n\t\t\t\tif (k != '@')\r\n\t\t\t\t\ts += k;\r\n\t\t\t});\r\n\t\t\tt.validElementsRE = new RegExp('^(' + wildcardToRE(s.toLowerCase()) + ')$');\r\n\r\n\t\t\t//console.debug(t.validElementsRE.toString());\r\n\t\t\t//console.dir(t.rules);\r\n\t\t\t//console.dir(t.wildRules);\r\n\t\t},\r\n\r\n\t\tfindRule : function(n) {\r\n\t\t\tvar t = this, rl = t.rules, i, r;\r\n\r\n\t\t\tt._setup();\r\n\r\n\t\t\t// Exact match\r\n\t\t\tr = rl[n];\r\n\t\t\tif (r)\r\n\t\t\t\treturn r;\r\n\r\n\t\t\t// Try wildcards\r\n\t\t\trl = t.wildRules;\r\n\t\t\tfor (i = 0; i < rl.length; i++) {\r\n\t\t\t\tif (rl[i].nameRE.test(n))\r\n\t\t\t\t\treturn rl[i];\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\t\t},\r\n\r\n\t\tfindAttribRule : function(ru, n) {\r\n\t\t\tvar i, wa = ru.wildAttribs;\r\n\r\n\t\t\tfor (i = 0; i < wa.length; i++) {\r\n\t\t\t\tif (wa[i].nameRE.test(n))\r\n\t\t\t\t\treturn wa[i];\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\t\t},\r\n\r\n\t\tserialize : function(n, o) {\r\n\t\t\tvar h, t = this, doc, oldDoc, impl, selected;\r\n\r\n\t\t\tt._setup();\r\n\t\t\to = o || {};\r\n\t\t\to.format = o.format || 'html';\r\n\t\t\tt.processObj = o;\r\n\r\n\t\t\t// IE looses the selected attribute on option elements so we need to store it\r\n\t\t\t// See: http://support.microsoft.com/kb/829907\r\n\t\t\tif (isIE) {\r\n\t\t\t\tselected = [];\r\n\t\t\t\teach(n.getElementsByTagName('option'), function(n) {\r\n\t\t\t\t\tvar v = t.dom.getAttrib(n, 'selected');\r\n\r\n\t\t\t\t\tselected.push(v ? v : null);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tn = n.cloneNode(true);\r\n\r\n\t\t\t// IE looses the selected attribute on option elements so we need to restore it\r\n\t\t\tif (isIE) {\r\n\t\t\t\teach(n.getElementsByTagName('option'), function(n, i) {\r\n\t\t\t\t\tt.dom.setAttrib(n, 'selected', selected[i]);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Nodes needs to be attached to something in WebKit/Opera\r\n\t\t\t// Older builds of Opera crashes if you attach the node to an document created dynamically\r\n\t\t\t// and since we can't feature detect a crash we need to sniff the acutal build number\r\n\t\t\t// This fix will make DOM ranges and make Sizzle happy!\r\n\t\t\timpl = n.ownerDocument.implementation;\r\n\t\t\tif (impl.createHTMLDocument && (tinymce.isOpera && opera.buildNumber() >= 1767)) {\r\n\t\t\t\t// Create an empty HTML document\r\n\t\t\t\tdoc = impl.createHTMLDocument(\"\");\r\n\r\n\t\t\t\t// Add the element or it's children if it's a body element to the new document\r\n\t\t\t\teach(n.nodeName == 'BODY' ? n.childNodes : [n], function(node) {\r\n\t\t\t\t\tdoc.body.appendChild(doc.importNode(node, true));\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Grab first child or body element for serialization\r\n\t\t\t\tif (n.nodeName != 'BODY')\r\n\t\t\t\t\tn = doc.body.firstChild;\r\n\t\t\t\telse\r\n\t\t\t\t\tn = doc.body;\r\n\r\n\t\t\t\t// set the new document in DOMUtils so createElement etc works\r\n\t\t\t\toldDoc = t.dom.doc;\r\n\t\t\t\tt.dom.doc = doc;\r\n\t\t\t}\r\n\r\n\t\t\tt.key = '' + (parseInt(t.key) + 1);\r\n\r\n\t\t\t// Pre process\r\n\t\t\tif (!o.no_events) {\r\n\t\t\t\to.node = n;\r\n\t\t\t\tt.onPreProcess.dispatch(t, o);\r\n\t\t\t}\r\n\r\n\t\t\t// Serialize HTML DOM into a string\r\n\t\t\tt.writer.reset();\r\n\t\t\tt._info = o;\r\n\t\t\tt._serializeNode(n, o.getInner);\r\n\r\n\t\t\t// Post process\r\n\t\t\to.content = t.writer.getContent();\r\n\r\n\t\t\t// Restore the old document if it was changed\r\n\t\t\tif (oldDoc)\r\n\t\t\t\tt.dom.doc = oldDoc;\r\n\r\n\t\t\tif (!o.no_events)\r\n\t\t\t\tt.onPostProcess.dispatch(t, o);\r\n\r\n\t\t\tt._postProcess(o);\r\n\t\t\to.node = null;\r\n\r\n\t\t\treturn tinymce.trim(o.content);\r\n\t\t},\r\n\r\n\t\t// Internal functions\r\n\r\n\t\t_postProcess : function(o) {\r\n\t\t\tvar t = this, s = t.settings, h = o.content, sc = [], p;\r\n\r\n\t\t\tif (o.format == 'html') {\r\n\t\t\t\t// Protect some elements\r\n\t\t\t\tp = t._protect({\r\n\t\t\t\t\tcontent : h,\r\n\t\t\t\t\tpatterns : [\r\n\t\t\t\t\t\t{pattern : /(<script[^>]*>)(.*?)(<\\/script>)/g},\r\n\t\t\t\t\t\t{pattern : /(<noscript[^>]*>)(.*?)(<\\/noscript>)/g},\r\n\t\t\t\t\t\t{pattern : /(<style[^>]*>)(.*?)(<\\/style>)/g},\r\n\t\t\t\t\t\t{pattern : /(<pre[^>]*>)(.*?)(<\\/pre>)/g, encode : 1},\r\n\t\t\t\t\t\t{pattern : /(<!--\\[CDATA\\[)(.*?)(\\]\\]-->)/g}\r\n\t\t\t\t\t]\r\n\t\t\t\t});\r\n\r\n\t\t\t\th = p.content;\r\n\r\n\t\t\t\t// Entity encode\r\n\t\t\t\tif (s.entity_encoding !== 'raw')\r\n\t\t\t\t\th = t._encode(h);\r\n\r\n\t\t\t\t// Use BR instead of &nbsp; padded P elements inside editor and use <p>&nbsp;</p> outside editor\r\n/*\t\t\t\tif (o.set)\r\n\t\t\t\t\th = h.replace(/<p>\\s+(&nbsp;|&#160;|\\u00a0|<br \\/>)\\s+<\\/p>/g, '<p><br /></p>');\r\n\t\t\t\telse\r\n\t\t\t\t\th = h.replace(/<p>\\s+(&nbsp;|&#160;|\\u00a0|<br \\/>)\\s+<\\/p>/g, '<p>$1</p>');*/\r\n\r\n\t\t\t\t// Since Gecko and Safari keeps whitespace in the DOM we need to\r\n\t\t\t\t// remove it inorder to match other browsers. But I think Gecko and Safari is right.\r\n\t\t\t\t// This process is only done when getting contents out from the editor.\r\n\t\t\t\tif (!o.set) {\r\n\t\t\t\t\t// We need to replace paragraph whitespace with an nbsp before indentation to keep the \\u00a0 char\r\n\t\t\t\t\th = h.replace(/<p>\\s+<\\/p>|<p([^>]+)>\\s+<\\/p>/g, s.entity_encoding == 'numeric' ? '<p$1>&#160;</p>' : '<p$1>&nbsp;</p>');\r\n\r\n\t\t\t\t\tif (s.remove_linebreaks) {\r\n\t\t\t\t\t\th = h.replace(/\\r?\\n|\\r/g, ' ');\r\n\t\t\t\t\t\th = h.replace(/(<[^>]+>)\\s+/g, '$1 ');\r\n\t\t\t\t\t\th = h.replace(/\\s+(<\\/[^>]+>)/g, ' $1');\r\n\t\t\t\t\t\th = h.replace(/<(p|h[1-6]|blockquote|hr|div|table|tbody|tr|td|body|head|html|title|meta|style|pre|script|link|object) ([^>]+)>\\s+/g, '<$1 $2>'); // Trim block start\r\n\t\t\t\t\t\th = h.replace(/<(p|h[1-6]|blockquote|hr|div|table|tbody|tr|td|body|head|html|title|meta|style|pre|script|link|object)>\\s+/g, '<$1>'); // Trim block start\r\n\t\t\t\t\t\th = h.replace(/\\s+<\\/(p|h[1-6]|blockquote|hr|div|table|tbody|tr|td|body|head|html|title|meta|style|pre|script|link|object)>/g, '</$1>'); // Trim block end\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Simple indentation\r\n\t\t\t\t\tif (s.apply_source_formatting && s.indent_mode == 'simple') {\r\n\t\t\t\t\t\t// Add line breaks before and after block elements\r\n\t\t\t\t\t\th = h.replace(/<(\\/?)(ul|hr|table|meta|link|tbody|tr|object|body|head|html|map)(|[^>]+)>\\s*/g, '\\n<$1$2$3>\\n');\r\n\t\t\t\t\t\th = h.replace(/\\s*<(p|h[1-6]|blockquote|div|title|style|pre|script|td|li|area)(|[^>]+)>/g, '\\n<$1$2>');\r\n\t\t\t\t\t\th = h.replace(/<\\/(p|h[1-6]|blockquote|div|title|style|pre|script|td|li)>\\s*/g, '</$1>\\n');\r\n\t\t\t\t\t\th = h.replace(/\\n\\n/g, '\\n');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\th = t._unprotect(h, p);\r\n\r\n\t\t\t\t// Restore CDATA sections\r\n\t\t\t\th = h.replace(/<!--\\[CDATA\\[([\\s\\S]+)\\]\\]-->/g, '<![CDATA[$1]]>');\r\n\r\n\t\t\t\t// Restore the \\u00a0 character if raw mode is enabled\r\n\t\t\t\tif (s.entity_encoding == 'raw')\r\n\t\t\t\t\th = h.replace(/<p>&nbsp;<\\/p>|<p([^>]+)>&nbsp;<\\/p>/g, '<p$1>\\u00a0</p>');\r\n\r\n\t\t\t\t// Restore noscript elements\r\n\t\t\t\th = h.replace(/<noscript([^>]+|)>([\\s\\S]*?)<\\/noscript>/g, function(v, attribs, text) {\r\n\t\t\t\t\treturn '<noscript' + attribs + '>' + t.dom.decode(text.replace(/<!--|-->/g, '')) + '</noscript>';\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\to.content = h;\r\n\t\t},\r\n\r\n\t\t_serializeNode : function(n, inner) {\r\n\t\t\tvar t = this, s = t.settings, w = t.writer, hc, el, cn, i, l, a, at, no, v, nn, ru, ar, iv, closed, keep, type, scopeName;\r\n\r\n\t\t\tif (!s.node_filter || s.node_filter(n)) {\r\n\t\t\t\tswitch (n.nodeType) {\r\n\t\t\t\t\tcase 1: // Element\r\n\t\t\t\t\t\tif (n.hasAttribute ? n.hasAttribute('_mce_bogus') : n.getAttribute('_mce_bogus'))\r\n\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\tiv = keep = false;\r\n\t\t\t\t\t\thc = n.hasChildNodes();\r\n\t\t\t\t\t\tnn = n.getAttribute('_mce_name') || n.nodeName.toLowerCase();\r\n\r\n\t\t\t\t\t\t// Get internal type\r\n\t\t\t\t\t\ttype = n.getAttribute('_mce_type');\r\n\t\t\t\t\t\tif (type) {\r\n\t\t\t\t\t\t\tif (!t._info.cleanup) {\r\n\t\t\t\t\t\t\t\tiv = true;\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\t\tkeep = 1;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Add correct prefix on IE\r\n\t\t\t\t\t\tif (isIE) {\r\n\t\t\t\t\t\t\tscopeName = n.scopeName;\r\n\t\t\t\t\t\t\tif (scopeName && scopeName !== 'HTML' && scopeName !== 'html')\r\n\t\t\t\t\t\t\t\tnn = scopeName + ':' + nn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Remove mce prefix on IE needed for the abbr element\r\n\t\t\t\t\t\tif (nn.indexOf('mce:') === 0)\r\n\t\t\t\t\t\t\tnn = nn.substring(4);\r\n\r\n\t\t\t\t\t\t// Check if valid\r\n\t\t\t\t\t\tif (!keep) {\r\n\t\t\t\t\t\t\tif (!t.validElementsRE || !t.validElementsRE.test(nn) || (t.invalidElementsRE && t.invalidElementsRE.test(nn)) || inner) {\r\n\t\t\t\t\t\t\t\tiv = true;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (isIE) {\r\n\t\t\t\t\t\t\t// Fix IE content duplication (DOM can have multiple copies of the same node)\r\n\t\t\t\t\t\t\tif (s.fix_content_duplication) {\r\n\t\t\t\t\t\t\t\tif (n._mce_serialized == t.key)\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\t\t\tn._mce_serialized = t.key;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// IE sometimes adds a / infront of the node name\r\n\t\t\t\t\t\t\tif (nn.charAt(0) == '/')\r\n\t\t\t\t\t\t\t\tnn = nn.substring(1);\r\n\t\t\t\t\t\t} else if (isGecko) {\r\n\t\t\t\t\t\t\t// Ignore br elements\r\n\t\t\t\t\t\t\tif (n.nodeName === 'BR' && n.getAttribute('type') == '_moz')\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Check if valid child\r\n\t\t\t\t\t\tif (s.validate_children) {\r\n\t\t\t\t\t\t\tif (t.elementName && !t.schema.isValid(t.elementName, nn)) {\r\n\t\t\t\t\t\t\t\tiv = true;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tt.elementName = nn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tru = t.findRule(nn);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// No valid rule for this element could be found then skip it\r\n\t\t\t\t\t\tif (!ru) {\r\n\t\t\t\t\t\t\tiv = true;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tnn = ru.name || nn;\r\n\t\t\t\t\t\tclosed = s.closed.test(nn);\r\n\r\n\t\t\t\t\t\t// Skip empty nodes or empty node name in IE\r\n\t\t\t\t\t\tif ((!hc && ru.noEmpty) || (isIE && !nn)) {\r\n\t\t\t\t\t\t\tiv = true;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Check required\r\n\t\t\t\t\t\tif (ru.requiredAttribs) {\r\n\t\t\t\t\t\t\ta = ru.requiredAttribs;\r\n\r\n\t\t\t\t\t\t\tfor (i = a.length - 1; i >= 0; i--) {\r\n\t\t\t\t\t\t\t\tif (this.dom.getAttrib(n, a[i]) !== '')\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// None of the required was there\r\n\t\t\t\t\t\t\tif (i == -1) {\r\n\t\t\t\t\t\t\t\tiv = true;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tw.writeStartElement(nn);\r\n\r\n\t\t\t\t\t\t// Add ordered attributes\r\n\t\t\t\t\t\tif (ru.attribs) {\r\n\t\t\t\t\t\t\tfor (i=0, at = ru.attribs, l = at.length; i<l; i++) {\r\n\t\t\t\t\t\t\t\ta = at[i];\r\n\t\t\t\t\t\t\t\tv = t._getAttrib(n, a);\r\n\r\n\t\t\t\t\t\t\t\tif (v !== null)\r\n\t\t\t\t\t\t\t\t\tw.writeAttribute(a.name, v);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Add wild attributes\r\n\t\t\t\t\t\tif (ru.validAttribsRE) {\r\n\t\t\t\t\t\t\tat = t.dom.getAttribs(n);\r\n\t\t\t\t\t\t\tfor (i=at.length-1; i>-1; i--) {\r\n\t\t\t\t\t\t\t\tno = at[i];\r\n\r\n\t\t\t\t\t\t\t\tif (no.specified) {\r\n\t\t\t\t\t\t\t\t\ta = no.nodeName.toLowerCase();\r\n\r\n\t\t\t\t\t\t\t\t\tif (s.invalid_attrs.test(a) || !ru.validAttribsRE.test(a))\r\n\t\t\t\t\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\t\t\t\t\tar = t.findAttribRule(ru, a);\r\n\t\t\t\t\t\t\t\t\tv = t._getAttrib(n, ar, a);\r\n\r\n\t\t\t\t\t\t\t\t\tif (v !== null)\r\n\t\t\t\t\t\t\t\t\t\tw.writeAttribute(a, v);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Keep type attribute\r\n\t\t\t\t\t\tif (type && keep)\r\n\t\t\t\t\t\t\tw.writeAttribute('_mce_type', type);\r\n\r\n\t\t\t\t\t\t// Write text from script\r\n\t\t\t\t\t\tif (nn === 'script' && tinymce.trim(n.innerHTML)) {\r\n\t\t\t\t\t\t\tw.writeText('// '); // Padd it with a comment so it will parse on older browsers\r\n\t\t\t\t\t\t\tw.writeCDATA(n.innerHTML.replace(/<!--|-->|<\\[CDATA\\[|\\]\\]>/g, '')); // Remove comments and cdata stuctures\r\n\t\t\t\t\t\t\thc = false;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Padd empty nodes with a &nbsp;\r\n\t\t\t\t\t\tif (ru.padd) {\r\n\t\t\t\t\t\t\t// If it has only one bogus child, padd it anyway workaround for <td><br /></td> bug\r\n\t\t\t\t\t\t\tif (hc && (cn = n.firstChild) && cn.nodeType === 1 && n.childNodes.length === 1) {\r\n\t\t\t\t\t\t\t\tif (cn.hasAttribute ? cn.hasAttribute('_mce_bogus') : cn.getAttribute('_mce_bogus'))\r\n\t\t\t\t\t\t\t\t\tw.writeText('\\u00a0');\r\n\t\t\t\t\t\t\t} else if (!hc)\r\n\t\t\t\t\t\t\t\tw.writeText('\\u00a0'); // No children then padd it\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 3: // Text\r\n\t\t\t\t\t\t// Check if valid child\r\n\t\t\t\t\t\tif (s.validate_children && t.elementName && !t.schema.isValid(t.elementName, '#text'))\r\n\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\treturn w.writeText(n.nodeValue);\r\n\r\n\t\t\t\t\tcase 4: // CDATA\r\n\t\t\t\t\t\treturn w.writeCDATA(n.nodeValue);\r\n\r\n\t\t\t\t\tcase 8: // Comment\r\n\t\t\t\t\t\treturn w.writeComment(n.nodeValue);\r\n\t\t\t\t}\r\n\t\t\t} else if (n.nodeType == 1)\r\n\t\t\t\thc = n.hasChildNodes();\r\n\r\n\t\t\tif (hc && !closed) {\r\n\t\t\t\tcn = n.firstChild;\r\n\r\n\t\t\t\twhile (cn) {\r\n\t\t\t\t\tt._serializeNode(cn);\r\n\t\t\t\t\tt.elementName = nn;\r\n\t\t\t\t\tcn = cn.nextSibling;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Write element end\r\n\t\t\tif (!iv) {\r\n\t\t\t\tif (!closed)\r\n\t\t\t\t\tw.writeFullEndElement();\r\n\t\t\t\telse\r\n\t\t\t\t\tw.writeEndElement();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_protect : function(o) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\to.items = o.items || [];\r\n\r\n\t\t\tfunction enc(s) {\r\n\t\t\t\treturn s.replace(/[\\r\\n\\\\]/g, function(c) {\r\n\t\t\t\t\tif (c === '\\n')\r\n\t\t\t\t\t\treturn '\\\\n';\r\n\t\t\t\t\telse if (c === '\\\\')\r\n\t\t\t\t\t\treturn '\\\\\\\\';\r\n\r\n\t\t\t\t\treturn '\\\\r';\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\tfunction dec(s) {\r\n\t\t\t\treturn s.replace(/\\\\[\\\\rn]/g, function(c) {\r\n\t\t\t\t\tif (c === '\\\\n')\r\n\t\t\t\t\t\treturn '\\n';\r\n\t\t\t\t\telse if (c === '\\\\\\\\')\r\n\t\t\t\t\t\treturn '\\\\';\r\n\r\n\t\t\t\t\treturn '\\r';\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\teach(o.patterns, function(p) {\r\n\t\t\t\to.content = dec(enc(o.content).replace(p.pattern, function(x, a, b, c) {\r\n\t\t\t\t\tb = dec(b);\r\n\r\n\t\t\t\t\tif (p.encode)\r\n\t\t\t\t\t\tb = t._encode(b);\r\n\r\n\t\t\t\t\to.items.push(b);\r\n\t\t\t\t\treturn a + '<!--mce:' + (o.items.length - 1) + '-->' + c;\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\r\n\t\t\treturn o;\r\n\t\t},\r\n\r\n\t\t_unprotect : function(h, o) {\r\n\t\t\th = h.replace(/\\<!--mce:([0-9]+)--\\>/g, function(a, b) {\r\n\t\t\t\treturn o.items[parseInt(b)];\r\n\t\t\t});\r\n\r\n\t\t\to.items = [];\r\n\r\n\t\t\treturn h;\r\n\t\t},\r\n\r\n\t\t_encode : function(h) {\r\n\t\t\tvar t = this, s = t.settings, l;\r\n\r\n\t\t\t// Entity encode\r\n\t\t\tif (s.entity_encoding !== 'raw') {\r\n\t\t\t\tif (s.entity_encoding.indexOf('named') != -1) {\r\n\t\t\t\t\tt.setEntities(s.entities);\r\n\t\t\t\t\tl = t.entityLookup;\r\n\r\n\t\t\t\t\th = h.replace(/[\\u007E-\\uFFFF]/g, function(a) {\r\n\t\t\t\t\t\tvar v;\r\n\r\n\t\t\t\t\t\tif (v = l[a])\r\n\t\t\t\t\t\t\ta = '&' + v + ';';\r\n\r\n\t\t\t\t\t\treturn a;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (s.entity_encoding.indexOf('numeric') != -1) {\r\n\t\t\t\t\th = h.replace(/[\\u007E-\\uFFFF]/g, function(a) {\r\n\t\t\t\t\t\treturn '&#' + a.charCodeAt(0) + ';';\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn h;\r\n\t\t},\r\n\r\n\t\t_setup : function() {\r\n\t\t\tvar t = this, s = this.settings;\r\n\r\n\t\t\tif (t.done)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tt.done = 1;\r\n\r\n\t\t\tt.setRules(s.valid_elements);\r\n\t\t\tt.addRules(s.extended_valid_elements);\r\n\r\n\t\t\tif (s.invalid_elements)\r\n\t\t\t\tt.invalidElementsRE = new RegExp('^(' + wildcardToRE(s.invalid_elements.replace(/,/g, '|').toLowerCase()) + ')$');\r\n\r\n\t\t\tif (s.attrib_value_filter)\r\n\t\t\t\tt.attribValueFilter = s.attribValueFilter;\r\n\t\t},\r\n\r\n\t\t_getAttrib : function(n, a, na) {\r\n\t\t\tvar i, v;\r\n\r\n\t\t\tna = na || a.name;\r\n\r\n\t\t\tif (a.forcedVal && (v = a.forcedVal)) {\r\n\t\t\t\tif (v === '{$uid}')\r\n\t\t\t\t\treturn this.dom.uniqueId();\r\n\r\n\t\t\t\treturn v;\r\n\t\t\t}\r\n\r\n\t\t\tv = this.dom.getAttrib(n, na);\r\n\r\n\t\t\tswitch (na) {\r\n\t\t\t\tcase 'rowspan':\r\n\t\t\t\tcase 'colspan':\r\n\t\t\t\t\t// Whats the point? Remove usless attribute value\r\n\t\t\t\t\tif (v == '1')\r\n\t\t\t\t\t\tv = '';\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.attribValueFilter)\r\n\t\t\t\tv = this.attribValueFilter(na, v, n);\r\n\r\n\t\t\tif (a.validVals) {\r\n\t\t\t\tfor (i = a.validVals.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tif (v == a.validVals[i])\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (i == -1)\r\n\t\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tif (v === '' && typeof(a.defaultVal) != 'undefined') {\r\n\t\t\t\tv = a.defaultVal;\r\n\r\n\t\t\t\tif (v === '{$uid}')\r\n\t\t\t\t\treturn this.dom.uniqueId();\r\n\r\n\t\t\t\treturn v;\r\n\t\t\t} else {\r\n\t\t\t\t// Remove internal mceItemXX classes when content is extracted from editor\r\n\t\t\t\tif (na == 'class' && this.processObj.get)\r\n\t\t\t\t\tv = v.replace(/\\s?mceItem\\w+\\s?/g, '');\r\n\t\t\t}\r\n\r\n\t\t\tif (v === '')\r\n\t\t\t\treturn null;\r\n\r\n\r\n\t\t\treturn v;\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\ttinymce.dom.ScriptLoader = function(settings) {\r\n\t\tvar QUEUED = 0,\r\n\t\t\tLOADING = 1,\r\n\t\t\tLOADED = 2,\r\n\t\t\tstates = {},\r\n\t\t\tqueue = [],\r\n\t\t\tscriptLoadedCallbacks = {},\r\n\t\t\tqueueLoadedCallbacks = [],\r\n\t\t\tloading = 0,\r\n\t\t\tundefined;\r\n\r\n\t\tfunction loadScript(url, callback) {\r\n\t\t\tvar t = this, dom = tinymce.DOM, elm, uri, loc, id;\r\n\r\n\t\t\t// Execute callback when script is loaded\r\n\t\t\tfunction done() {\r\n\t\t\t\tdom.remove(id);\r\n\r\n\t\t\t\tif (elm)\r\n\t\t\t\t\telm.onreadystatechange = elm.onload = elm = null;\r\n\r\n\t\t\t\tcallback();\r\n\t\t\t};\r\n\r\n\t\t\tid = dom.uniqueId();\r\n\r\n\t\t\tif (tinymce.isIE6) {\r\n\t\t\t\turi = new tinymce.util.URI(url);\r\n\t\t\t\tloc = location;\r\n\r\n\t\t\t\t// If script is from same domain and we\r\n\t\t\t\t// use IE 6 then use XHR since it's more reliable\r\n\t\t\t\tif (uri.host == loc.hostname && uri.port == loc.port && (uri.protocol + ':') == loc.protocol) {\r\n\t\t\t\t\ttinymce.util.XHR.send({\r\n\t\t\t\t\t\turl : tinymce._addVer(uri.getURI()),\r\n\t\t\t\t\t\tsuccess : function(content) {\r\n\t\t\t\t\t\t\t// Create new temp script element\r\n\t\t\t\t\t\t\tvar script = dom.create('script', {\r\n\t\t\t\t\t\t\t\ttype : 'text/javascript'\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t// Evaluate script in global scope\r\n\t\t\t\t\t\t\tscript.text = content;\r\n\t\t\t\t\t\t\tdocument.getElementsByTagName('head')[0].appendChild(script);\r\n\t\t\t\t\t\t\tdom.remove(script);\r\n\r\n\t\t\t\t\t\t\tdone();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Create new script element\r\n\t\t\telm = dom.create('script', {\r\n\t\t\t\tid : id,\r\n\t\t\t\ttype : 'text/javascript',\r\n\t\t\t\tsrc : tinymce._addVer(url)\r\n\t\t\t});\r\n\r\n\t\t\t// Add onload and readystate listeners\r\n\t\t\telm.onload = done;\r\n\t\t\telm.onreadystatechange = function() {\r\n\t\t\t\tvar state = elm.readyState;\r\n\r\n\t\t\t\t// Loaded state is passed on IE 6 however there\r\n\t\t\t\t// are known issues with this method but we can't use\r\n\t\t\t\t// XHR in a cross domain loading\r\n\t\t\t\tif (state == 'complete' || state == 'loaded')\r\n\t\t\t\t\tdone();\r\n\t\t\t};\r\n\r\n\t\t\t// Most browsers support this feature so we report errors\r\n\t\t\t// for those at least to help users track their missing plugins etc\r\n\t\t\t// todo: Removed since it produced error if the document is unloaded by navigating away, re-add it as an option\r\n\t\t\t/*elm.onerror = function() {\r\n\t\t\t\talert('Failed to load: ' + url);\r\n\t\t\t};*/\r\n\r\n\t\t\t// Add script to document\r\n\t\t\t(document.getElementsByTagName('head')[0] || document.body).appendChild(elm);\r\n\t\t};\r\n\r\n\t\tthis.isDone = function(url) {\r\n\t\t\treturn states[url] == LOADED;\r\n\t\t};\r\n\r\n\t\tthis.markDone = function(url) {\r\n\t\t\tstates[url] = LOADED;\r\n\t\t};\r\n\r\n\t\tthis.add = this.load = function(url, callback, scope) {\r\n\t\t\tvar item, state = states[url];\r\n\r\n\t\t\t// Add url to load queue\r\n\t\t\tif (state == undefined) {\r\n\t\t\t\tqueue.push(url);\r\n\t\t\t\tstates[url] = QUEUED;\r\n\t\t\t}\r\n\r\n\t\t\tif (callback) {\r\n\t\t\t\t// Store away callback for later execution\r\n\t\t\t\tif (!scriptLoadedCallbacks[url])\r\n\t\t\t\t\tscriptLoadedCallbacks[url] = [];\r\n\r\n\t\t\t\tscriptLoadedCallbacks[url].push({\r\n\t\t\t\t\tfunc : callback,\r\n\t\t\t\t\tscope : scope || this\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.loadQueue = function(callback, scope) {\r\n\t\t\tthis.loadScripts(queue, callback, scope);\r\n\t\t};\r\n\r\n\t\tthis.loadScripts = function(scripts, callback, scope) {\r\n\t\t\tvar loadScripts;\r\n\r\n\t\t\tfunction execScriptLoadedCallbacks(url) {\r\n\t\t\t\t// Execute URL callback functions\r\n\t\t\t\ttinymce.each(scriptLoadedCallbacks[url], function(callback) {\r\n\t\t\t\t\tcallback.func.call(callback.scope);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tscriptLoadedCallbacks[url] = undefined;\r\n\t\t\t};\r\n\r\n\t\t\tqueueLoadedCallbacks.push({\r\n\t\t\t\tfunc : callback,\r\n\t\t\t\tscope : scope || this\r\n\t\t\t});\r\n\r\n\t\t\tloadScripts = function() {\r\n\t\t\t\tvar loadingScripts = tinymce.grep(scripts);\r\n\r\n\t\t\t\t// Current scripts has been handled\r\n\t\t\t\tscripts.length = 0;\r\n\r\n\t\t\t\t// Load scripts that needs to be loaded\r\n\t\t\t\ttinymce.each(loadingScripts, function(url) {\r\n\t\t\t\t\t// Script is already loaded then execute script callbacks directly\r\n\t\t\t\t\tif (states[url] == LOADED) {\r\n\t\t\t\t\t\texecScriptLoadedCallbacks(url);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Is script not loading then start loading it\r\n\t\t\t\t\tif (states[url] != LOADING) {\r\n\t\t\t\t\t\tstates[url] = LOADING;\r\n\t\t\t\t\t\tloading++;\r\n\r\n\t\t\t\t\t\tloadScript(url, function() {\r\n\t\t\t\t\t\t\tstates[url] = LOADED;\r\n\t\t\t\t\t\t\tloading--;\r\n\r\n\t\t\t\t\t\t\texecScriptLoadedCallbacks(url);\r\n\r\n\t\t\t\t\t\t\t// Load more scripts if they where added by the recently loaded script\r\n\t\t\t\t\t\t\tloadScripts();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// No scripts are currently loading then execute all pending queue loaded callbacks\r\n\t\t\t\tif (!loading) {\r\n\t\t\t\t\ttinymce.each(queueLoadedCallbacks, function(callback) {\r\n\t\t\t\t\t\tcallback.func.call(callback.scope);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tqueueLoadedCallbacks.length = 0;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tloadScripts();\r\n\t\t};\r\n\t};\r\n\r\n\t// Global script loader\r\n\ttinymce.ScriptLoader = new tinymce.dom.ScriptLoader();\r\n})(tinymce);\r\n\r\ntinymce.dom.TreeWalker = function(start_node, root_node) {\r\n\tvar node = start_node;\r\n\r\n\tfunction findSibling(node, start_name, sibling_name, shallow) {\r\n\t\tvar sibling, parent;\r\n\r\n\t\tif (node) {\r\n\t\t\t// Walk into nodes if it has a start\r\n\t\t\tif (!shallow && node[start_name])\r\n\t\t\t\treturn node[start_name];\r\n\r\n\t\t\t// Return the sibling if it has one\r\n\t\t\tif (node != root_node) {\r\n\t\t\t\tsibling = node[sibling_name];\r\n\t\t\t\tif (sibling)\r\n\t\t\t\t\treturn sibling;\r\n\r\n\t\t\t\t// Walk up the parents to look for siblings\r\n\t\t\t\tfor (parent = node.parentNode; parent && parent != root_node; parent = parent.parentNode) {\r\n\t\t\t\t\tsibling = parent[sibling_name];\r\n\t\t\t\t\tif (sibling)\r\n\t\t\t\t\t\treturn sibling;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tthis.current = function() {\r\n\t\treturn node;\r\n\t};\r\n\r\n\tthis.next = function(shallow) {\r\n\t\treturn (node = findSibling(node, 'firstChild', 'nextSibling', shallow));\r\n\t};\r\n\r\n\tthis.prev = function(shallow) {\r\n\t\treturn (node = findSibling(node, 'lastChild', 'lastSibling', shallow));\r\n\t};\r\n};\r\n\r\n(function() {\r\n\tvar transitional = {};\r\n\r\n\tfunction unpack(lookup, data) {\r\n\t\tvar key;\r\n\r\n\t\tfunction replace(value) {\r\n\t\t\treturn value.replace(/[A-Z]+/g, function(key) {\r\n\t\t\t\treturn replace(lookup[key]);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t// Unpack lookup\r\n\t\tfor (key in lookup) {\r\n\t\t\tif (lookup.hasOwnProperty(key))\r\n\t\t\t\tlookup[key] = replace(lookup[key]);\r\n\t\t}\r\n\r\n\t\t// Unpack and parse data into object map\r\n\t\treplace(data).replace(/#/g, '#text').replace(/(\\w+)\\[([^\\]]+)\\]/g, function(str, name, children) {\r\n\t\t\tvar i, map = {};\r\n\r\n\t\t\tchildren = children.split(/\\|/);\r\n\r\n\t\t\tfor (i = children.length - 1; i >= 0; i--)\r\n\t\t\t\tmap[children[i]] = 1;\r\n\r\n\t\t\ttransitional[name] = map;\r\n\t\t});\r\n\t};\r\n\r\n\t// This is the XHTML 1.0 transitional elements with it's children packed to reduce it's size\r\n\t// we will later include the attributes here and use it as a default for valid elements but it\r\n\t// requires us to rewrite the serializer engine\r\n\tunpack({\r\n\t\tZ : '#|H|K|N|O|P',\r\n\t\tY : '#|X|form|R|Q',\r\n\t\tX : 'p|T|div|U|W|isindex|fieldset|table',\r\n\t\tW : 'pre|hr|blockquote|address|center|noframes',\r\n\t\tU : 'ul|ol|dl|menu|dir',\r\n\t\tZC : '#|p|Y|div|U|W|table|br|span|bdo|object|applet|img|map|K|N|Q',\r\n\t\tT : 'h1|h2|h3|h4|h5|h6',\r\n\t\tZB : '#|X|S|Q',\r\n\t\tS : 'R|P',\r\n\t\tZA : '#|a|G|J|M|O|P',\r\n\t\tR : '#|a|H|K|N|O',\r\n\t\tQ : 'noscript|P',\r\n\t\tP : 'ins|del|script',\r\n\t\tO : 'input|select|textarea|label|button',\r\n\t\tN : 'M|L',\r\n\t\tM : 'em|strong|dfn|code|q|samp|kbd|var|cite|abbr|acronym',\r\n\t\tL : 'sub|sup',\r\n\t\tK : 'J|I',\r\n\t\tJ : 'tt|i|b|u|s|strike',\r\n\t\tI : 'big|small|font|basefont',\r\n\t\tH : 'G|F',\r\n\t\tG : 'br|span|bdo',\r\n\t\tF : 'object|applet|img|map|iframe'\r\n\t}, 'script[]' + \r\n\t\t'style[]' + \r\n\t\t'object[#|param|X|form|a|H|K|N|O|Q]' + \r\n\t\t'param[]' + \r\n\t\t'p[S]' + \r\n\t\t'a[Z]' + \r\n\t\t'br[]' + \r\n\t\t'span[S]' + \r\n\t\t'bdo[S]' + \r\n\t\t'applet[#|param|X|form|a|H|K|N|O|Q]' + \r\n\t\t'h1[S]' + \r\n\t\t'img[]' + \r\n\t\t'map[X|form|Q|area]' + \r\n\t\t'h2[S]' + \r\n\t\t'iframe[#|X|form|a|H|K|N|O|Q]' + \r\n\t\t'h3[S]' + \r\n\t\t'tt[S]' + \r\n\t\t'i[S]' + \r\n\t\t'b[S]' + \r\n\t\t'u[S]' + \r\n\t\t's[S]' + \r\n\t\t'strike[S]' + \r\n\t\t'big[S]' + \r\n\t\t'small[S]' + \r\n\t\t'font[S]' + \r\n\t\t'basefont[]' + \r\n\t\t'em[S]' + \r\n\t\t'strong[S]' + \r\n\t\t'dfn[S]' + \r\n\t\t'code[S]' + \r\n\t\t'q[S]' + \r\n\t\t'samp[S]' + \r\n\t\t'kbd[S]' + \r\n\t\t'var[S]' + \r\n\t\t'cite[S]' + \r\n\t\t'abbr[S]' + \r\n\t\t'acronym[S]' + \r\n\t\t'sub[S]' + \r\n\t\t'sup[S]' + \r\n\t\t'input[]' + \r\n\t\t'select[optgroup|option]' + \r\n\t\t'optgroup[option]' + \r\n\t\t'option[]' + \r\n\t\t'textarea[]' + \r\n\t\t'label[S]' + \r\n\t\t'button[#|p|T|div|U|W|table|G|object|applet|img|map|K|N|Q]' + \r\n\t\t'h4[S]' + \r\n\t\t'ins[#|X|form|a|H|K|N|O|Q]' + \r\n\t\t'h5[S]' + \r\n\t\t'del[#|X|form|a|H|K|N|O|Q]' + \r\n\t\t'h6[S]' + \r\n\t\t'div[#|X|form|a|H|K|N|O|Q]' + \r\n\t\t'ul[li]' + \r\n\t\t'li[#|X|form|a|H|K|N|O|Q]' + \r\n\t\t'ol[li]' + \r\n\t\t'dl[dt|dd]' + \r\n\t\t'dt[S]' + \r\n\t\t'dd[#|X|form|a|H|K|N|O|Q]' + \r\n\t\t'menu[li]' + \r\n\t\t'dir[li]' + \r\n\t\t'pre[ZA]' + \r\n\t\t'hr[]' + \r\n\t\t'blockquote[#|X|form|a|H|K|N|O|Q]' + \r\n\t\t'address[S|p]' + \r\n\t\t'center[#|X|form|a|H|K|N|O|Q]' + \r\n\t\t'noframes[#|X|form|a|H|K|N|O|Q]' + \r\n\t\t'isindex[]' + \r\n\t\t'fieldset[#|legend|X|form|a|H|K|N|O|Q]' + \r\n\t\t'legend[S]' + \r\n\t\t'table[caption|col|colgroup|thead|tfoot|tbody|tr]' + \r\n\t\t'caption[S]' + \r\n\t\t'col[]' + \r\n\t\t'colgroup[col]' + \r\n\t\t'thead[tr]' + \r\n\t\t'tr[th|td]' + \r\n\t\t'th[#|X|form|a|H|K|N|O|Q]' + \r\n\t\t'form[#|X|a|H|K|N|O|Q]' + \r\n\t\t'noscript[#|X|form|a|H|K|N|O|Q]' + \r\n\t\t'td[#|X|form|a|H|K|N|O|Q]' + \r\n\t\t'tfoot[tr]' + \r\n\t\t'tbody[tr]' + \r\n\t\t'area[]' + \r\n\t\t'base[]' + \r\n\t\t'body[#|X|form|a|H|K|N|O|Q]'\r\n\t);\r\n\r\n\ttinymce.dom.Schema = function() {\r\n\t\tvar t = this, elements = transitional;\r\n\r\n\t\tt.isValid = function(name, child_name) {\r\n\t\t\tvar element = elements[name];\r\n\r\n\t\t\treturn !!(element && (!child_name || element[child_name]));\r\n\t\t};\r\n\t};\r\n})();\r\n(function(tinymce) {\r\n\ttinymce.dom.RangeUtils = function(dom) {\r\n\t\tvar INVISIBLE_CHAR = '\\uFEFF';\r\n\r\n\t\tthis.walk = function(rng, callback) {\r\n\t\t\tvar startContainer = rng.startContainer,\r\n\t\t\t\tstartOffset = rng.startOffset,\r\n\t\t\t\tendContainer = rng.endContainer,\r\n\t\t\t\tendOffset = rng.endOffset,\r\n\t\t\t\tancestor, startPoint,\r\n\t\t\t\tendPoint, node, parent, siblings, nodes;\r\n\r\n\t\t\t// Handle table cell selection the table plugin enables\r\n\t\t\t// you to fake select table cells and perform formatting actions on them\r\n\t\t\tnodes = dom.select('td.mceSelected,th.mceSelected');\r\n\t\t\tif (nodes.length > 0) {\r\n\t\t\t\ttinymce.each(nodes, function(node) {\r\n\t\t\t\t\tcallback([node]);\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tfunction collectSiblings(node, name, end_node) {\r\n\t\t\t\tvar siblings = [];\r\n\r\n\t\t\t\tfor (; node && node != end_node; node = node[name])\r\n\t\t\t\t\tsiblings.push(node);\r\n\r\n\t\t\t\treturn siblings;\r\n\t\t\t};\r\n\r\n\t\t\tfunction findEndPoint(node, root) {\r\n\t\t\t\tdo {\r\n\t\t\t\t\tif (node.parentNode == root)\r\n\t\t\t\t\t\treturn node;\r\n\r\n\t\t\t\t\tnode = node.parentNode;\r\n\t\t\t\t} while(node);\r\n\t\t\t};\r\n\r\n\t\t\tfunction walkBoundary(start_node, end_node, next) {\r\n\t\t\t\tvar siblingName = next ? 'nextSibling' : 'previousSibling';\r\n\r\n\t\t\t\tfor (node = start_node, parent = node.parentNode; node && node != end_node; node = parent) {\r\n\t\t\t\t\tparent = node.parentNode;\r\n\t\t\t\t\tsiblings = collectSiblings(node == start_node ? node : node[siblingName], siblingName);\r\n\r\n\t\t\t\t\tif (siblings.length) {\r\n\t\t\t\t\t\tif (!next)\r\n\t\t\t\t\t\t\tsiblings.reverse();\r\n\r\n\t\t\t\t\t\tcallback(siblings);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t// If index based start position then resolve it\r\n\t\t\tif (startContainer.nodeType == 1 && startContainer.hasChildNodes())\r\n\t\t\t\tstartContainer = startContainer.childNodes[startOffset];\r\n\r\n\t\t\t// If index based end position then resolve it\r\n\t\t\tif (endContainer.nodeType == 1 && endContainer.hasChildNodes())\r\n\t\t\t\tendContainer = endContainer.childNodes[Math.min(startOffset == endOffset ? endOffset : endOffset - 1, endContainer.childNodes.length - 1)];\r\n\r\n\t\t\t// Find common ancestor and end points\r\n\t\t\tancestor = dom.findCommonAncestor(startContainer, endContainer);\r\n\r\n\t\t\t// Same container\r\n\t\t\tif (startContainer == endContainer)\r\n\t\t\t\treturn callback([startContainer]);\r\n\r\n\t\t\t// Process left side\r\n\t\t\tfor (node = startContainer; node; node = node.parentNode) {\r\n\t\t\t\tif (node == endContainer)\r\n\t\t\t\t\treturn walkBoundary(startContainer, ancestor, true);\r\n\r\n\t\t\t\tif (node == ancestor)\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\t// Process right side\r\n\t\t\tfor (node = endContainer; node; node = node.parentNode) {\r\n\t\t\t\tif (node == startContainer)\r\n\t\t\t\t\treturn walkBoundary(endContainer, ancestor);\r\n\r\n\t\t\t\tif (node == ancestor)\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\t// Find start/end point\r\n\t\t\tstartPoint = findEndPoint(startContainer, ancestor) || startContainer;\r\n\t\t\tendPoint = findEndPoint(endContainer, ancestor) || endContainer;\r\n\r\n\t\t\t// Walk left leaf\r\n\t\t\twalkBoundary(startContainer, startPoint, true);\r\n\r\n\t\t\t// Walk the middle from start to end point\r\n\t\t\tsiblings = collectSiblings(\r\n\t\t\t\tstartPoint == startContainer ? startPoint : startPoint.nextSibling,\r\n\t\t\t\t'nextSibling',\r\n\t\t\t\tendPoint == endContainer ? endPoint.nextSibling : endPoint\r\n\t\t\t);\r\n\r\n\t\t\tif (siblings.length)\r\n\t\t\t\tcallback(siblings);\r\n\r\n\t\t\t// Walk right leaf\r\n\t\t\twalkBoundary(endContainer, endPoint);\r\n\t\t};\r\n\r\n\t\t/*\t\tthis.split = function(rng) {\r\n\t\t\tvar startContainer = rng.startContainer,\r\n\t\t\t\tstartOffset = rng.startOffset,\r\n\t\t\t\tendContainer = rng.endContainer,\r\n\t\t\t\tendOffset = rng.endOffset;\r\n\r\n\t\t\tfunction splitText(node, offset) {\r\n\t\t\t\tif (offset == node.nodeValue.length)\r\n\t\t\t\t\tnode.appendData(INVISIBLE_CHAR);\r\n\r\n\t\t\t\tnode = node.splitText(offset);\r\n\r\n\t\t\t\tif (node.nodeValue === INVISIBLE_CHAR)\r\n\t\t\t\t\tnode.nodeValue = '';\r\n\r\n\t\t\t\treturn node;\r\n\t\t\t};\r\n\r\n\t\t\t// Handle single text node\r\n\t\t\tif (startContainer == endContainer) {\r\n\t\t\t\tif (startContainer.nodeType == 3) {\r\n\t\t\t\t\tif (startOffset != 0)\r\n\t\t\t\t\t\tstartContainer = endContainer = splitText(startContainer, startOffset);\r\n\r\n\t\t\t\t\tif (endOffset - startOffset != startContainer.nodeValue.length)\r\n\t\t\t\t\t\tsplitText(startContainer, endOffset - startOffset);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// Split startContainer text node if needed\r\n\t\t\t\tif (startContainer.nodeType == 3 && startOffset != 0) {\r\n\t\t\t\t\tstartContainer = splitText(startContainer, startOffset);\r\n\t\t\t\t\tstartOffset = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Split endContainer text node if needed\r\n\t\t\t\tif (endContainer.nodeType == 3 && endOffset != endContainer.nodeValue.length) {\r\n\t\t\t\t\tendContainer = splitText(endContainer, endOffset).previousSibling;\r\n\t\t\t\t\tendOffset = endContainer.nodeValue.length;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\tstartContainer : startContainer,\r\n\t\t\t\tstartOffset : startOffset,\r\n\t\t\t\tendContainer : endContainer,\r\n\t\t\t\tendOffset : endOffset\r\n\t\t\t};\r\n\t\t};\r\n*/\r\n\t};\r\n\r\n\ttinymce.dom.RangeUtils.compareRanges = function(rng1, rng2) {\r\n\t\tif (rng1 && rng2) {\r\n\t\t\t// Compare native IE ranges\r\n\t\t\tif (rng1.item || rng1.duplicate) {\r\n\t\t\t\t// Both are control ranges and the selected element matches\r\n\t\t\t\tif (rng1.item && rng2.item && rng1.item(0) === rng2.item(0))\r\n\t\t\t\t\treturn true;\r\n\r\n\t\t\t\t// Both are text ranges and the range matches\r\n\t\t\t\tif (rng1.isEqual && rng2.isEqual && rng2.isEqual(rng1))\r\n\t\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\t// Compare w3c ranges\r\n\t\t\t\treturn rng1.startContainer == rng2.startContainer && rng1.startOffset == rng2.startOffset;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t};\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\t// Shorten class names\r\n\tvar DOM = tinymce.DOM, is = tinymce.is;\r\n\r\n\ttinymce.create('tinymce.ui.Control', {\r\n\t\tControl : function(id, s) {\r\n\t\t\tthis.id = id;\r\n\t\t\tthis.settings = s = s || {};\r\n\t\t\tthis.rendered = false;\r\n\t\t\tthis.onRender = new tinymce.util.Dispatcher(this);\r\n\t\t\tthis.classPrefix = '';\r\n\t\t\tthis.scope = s.scope || this;\r\n\t\t\tthis.disabled = 0;\r\n\t\t\tthis.active = 0;\r\n\t\t},\r\n\r\n\t\tsetDisabled : function(s) {\r\n\t\t\tvar e;\r\n\r\n\t\t\tif (s != this.disabled) {\r\n\t\t\t\te = DOM.get(this.id);\r\n\r\n\t\t\t\t// Add accessibility title for unavailable actions\r\n\t\t\t\tif (e && this.settings.unavailable_prefix) {\r\n\t\t\t\t\tif (s) {\r\n\t\t\t\t\t\tthis.prevTitle = e.title;\r\n\t\t\t\t\t\te.title = this.settings.unavailable_prefix + \": \" + e.title;\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\te.title = this.prevTitle;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.setState('Disabled', s);\r\n\t\t\t\tthis.setState('Enabled', !s);\r\n\t\t\t\tthis.disabled = s;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tisDisabled : function() {\r\n\t\t\treturn this.disabled;\r\n\t\t},\r\n\r\n\t\tsetActive : function(s) {\r\n\t\t\tif (s != this.active) {\r\n\t\t\t\tthis.setState('Active', s);\r\n\t\t\t\tthis.active = s;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tisActive : function() {\r\n\t\t\treturn this.active;\r\n\t\t},\r\n\r\n\t\tsetState : function(c, s) {\r\n\t\t\tvar n = DOM.get(this.id);\r\n\r\n\t\t\tc = this.classPrefix + c;\r\n\r\n\t\t\tif (s)\r\n\t\t\t\tDOM.addClass(n, c);\r\n\t\t\telse\r\n\t\t\t\tDOM.removeClass(n, c);\r\n\t\t},\r\n\r\n\t\tisRendered : function() {\r\n\t\t\treturn this.rendered;\r\n\t\t},\r\n\r\n\t\trenderHTML : function() {\r\n\t\t},\r\n\r\n\t\trenderTo : function(n) {\r\n\t\t\tDOM.setHTML(n, this.renderHTML());\r\n\t\t},\r\n\r\n\t\tpostRender : function() {\r\n\t\t\tvar t = this, b;\r\n\r\n\t\t\t// Set pending states\r\n\t\t\tif (is(t.disabled)) {\r\n\t\t\t\tb = t.disabled;\r\n\t\t\t\tt.disabled = -1;\r\n\t\t\t\tt.setDisabled(b);\r\n\t\t\t}\r\n\r\n\t\t\tif (is(t.active)) {\r\n\t\t\t\tb = t.active;\r\n\t\t\t\tt.active = -1;\r\n\t\t\t\tt.setActive(b);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tremove : function() {\r\n\t\t\tDOM.remove(this.id);\r\n\t\t\tthis.destroy();\r\n\t\t},\r\n\r\n\t\tdestroy : function() {\r\n\t\t\ttinymce.dom.Event.clear(this.id);\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\ntinymce.create('tinymce.ui.Container:tinymce.ui.Control', {\r\n\tContainer : function(id, s) {\r\n\t\tthis.parent(id, s);\r\n\r\n\t\tthis.controls = [];\r\n\r\n\t\tthis.lookup = {};\r\n\t},\r\n\r\n\tadd : function(c) {\r\n\t\tthis.lookup[c.id] = c;\r\n\t\tthis.controls.push(c);\r\n\r\n\t\treturn c;\r\n\t},\r\n\r\n\tget : function(n) {\r\n\t\treturn this.lookup[n];\r\n\t}\r\n});\r\n\r\n\r\ntinymce.create('tinymce.ui.Separator:tinymce.ui.Control', {\r\n\tSeparator : function(id, s) {\r\n\t\tthis.parent(id, s);\r\n\t\tthis.classPrefix = 'mceSeparator';\r\n\t},\r\n\r\n\trenderHTML : function() {\r\n\t\treturn tinymce.DOM.createHTML('span', {'class' : this.classPrefix});\r\n\t}\r\n});\r\n\r\n(function(tinymce) {\r\n\tvar is = tinymce.is, DOM = tinymce.DOM, each = tinymce.each, walk = tinymce.walk;\r\n\r\n\ttinymce.create('tinymce.ui.MenuItem:tinymce.ui.Control', {\r\n\t\tMenuItem : function(id, s) {\r\n\t\t\tthis.parent(id, s);\r\n\t\t\tthis.classPrefix = 'mceMenuItem';\r\n\t\t},\r\n\r\n\t\tsetSelected : function(s) {\r\n\t\t\tthis.setState('Selected', s);\r\n\t\t\tthis.selected = s;\r\n\t\t},\r\n\r\n\t\tisSelected : function() {\r\n\t\t\treturn this.selected;\r\n\t\t},\r\n\r\n\t\tpostRender : function() {\r\n\t\t\tvar t = this;\r\n\t\t\t\r\n\t\t\tt.parent();\r\n\r\n\t\t\t// Set pending state\r\n\t\t\tif (is(t.selected))\r\n\t\t\t\tt.setSelected(t.selected);\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\tvar is = tinymce.is, DOM = tinymce.DOM, each = tinymce.each, walk = tinymce.walk;\r\n\r\n\ttinymce.create('tinymce.ui.Menu:tinymce.ui.MenuItem', {\r\n\t\tMenu : function(id, s) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tt.parent(id, s);\r\n\t\t\tt.items = {};\r\n\t\t\tt.collapsed = false;\r\n\t\t\tt.menuCount = 0;\r\n\t\t\tt.onAddItem = new tinymce.util.Dispatcher(this);\r\n\t\t},\r\n\r\n\t\texpand : function(d) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tif (d) {\r\n\t\t\t\twalk(t, function(o) {\r\n\t\t\t\t\tif (o.expand)\r\n\t\t\t\t\t\to.expand();\r\n\t\t\t\t}, 'items', t);\r\n\t\t\t}\r\n\r\n\t\t\tt.collapsed = false;\r\n\t\t},\r\n\r\n\t\tcollapse : function(d) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tif (d) {\r\n\t\t\t\twalk(t, function(o) {\r\n\t\t\t\t\tif (o.collapse)\r\n\t\t\t\t\t\to.collapse();\r\n\t\t\t\t}, 'items', t);\r\n\t\t\t}\r\n\r\n\t\t\tt.collapsed = true;\r\n\t\t},\r\n\r\n\t\tisCollapsed : function() {\r\n\t\t\treturn this.collapsed;\r\n\t\t},\r\n\r\n\t\tadd : function(o) {\r\n\t\t\tif (!o.settings)\r\n\t\t\t\to = new tinymce.ui.MenuItem(o.id || DOM.uniqueId(), o);\r\n\r\n\t\t\tthis.onAddItem.dispatch(this, o);\r\n\r\n\t\t\treturn this.items[o.id] = o;\r\n\t\t},\r\n\r\n\t\taddSeparator : function() {\r\n\t\t\treturn this.add({separator : true});\r\n\t\t},\r\n\r\n\t\taddMenu : function(o) {\r\n\t\t\tif (!o.collapse)\r\n\t\t\t\to = this.createMenu(o);\r\n\r\n\t\t\tthis.menuCount++;\r\n\r\n\t\t\treturn this.add(o);\r\n\t\t},\r\n\r\n\t\thasMenus : function() {\r\n\t\t\treturn this.menuCount !== 0;\r\n\t\t},\r\n\r\n\t\tremove : function(o) {\r\n\t\t\tdelete this.items[o.id];\r\n\t\t},\r\n\r\n\t\tremoveAll : function() {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\twalk(t, function(o) {\r\n\t\t\t\tif (o.removeAll)\r\n\t\t\t\t\to.removeAll();\r\n\t\t\t\telse\r\n\t\t\t\t\to.remove();\r\n\r\n\t\t\t\to.destroy();\r\n\t\t\t}, 'items', t);\r\n\r\n\t\t\tt.items = {};\r\n\t\t},\r\n\r\n\t\tcreateMenu : function(o) {\r\n\t\t\tvar m = new tinymce.ui.Menu(o.id || DOM.uniqueId(), o);\r\n\r\n\t\t\tm.onAddItem.add(this.onAddItem.dispatch, this.onAddItem);\r\n\r\n\t\t\treturn m;\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n(function(tinymce) {\r\n\tvar is = tinymce.is, DOM = tinymce.DOM, each = tinymce.each, Event = tinymce.dom.Event, Element = tinymce.dom.Element;\r\n\r\n\ttinymce.create('tinymce.ui.DropMenu:tinymce.ui.Menu', {\r\n\t\tDropMenu : function(id, s) {\r\n\t\t\ts = s || {};\r\n\t\t\ts.container = s.container || DOM.doc.body;\r\n\t\t\ts.offset_x = s.offset_x || 0;\r\n\t\t\ts.offset_y = s.offset_y || 0;\r\n\t\t\ts.vp_offset_x = s.vp_offset_x || 0;\r\n\t\t\ts.vp_offset_y = s.vp_offset_y || 0;\r\n\r\n\t\t\tif (is(s.icons) && !s.icons)\r\n\t\t\t\ts['class'] += ' mceNoIcons';\r\n\r\n\t\t\tthis.parent(id, s);\r\n\t\t\tthis.onShowMenu = new tinymce.util.Dispatcher(this);\r\n\t\t\tthis.onHideMenu = new tinymce.util.Dispatcher(this);\r\n\t\t\tthis.classPrefix = 'mceMenu';\r\n\t\t},\r\n\r\n\t\tcreateMenu : function(s) {\r\n\t\t\tvar t = this, cs = t.settings, m;\r\n\r\n\t\t\ts.container = s.container || cs.container;\r\n\t\t\ts.parent = t;\r\n\t\t\ts.constrain = s.constrain || cs.constrain;\r\n\t\t\ts['class'] = s['class'] || cs['class'];\r\n\t\t\ts.vp_offset_x = s.vp_offset_x || cs.vp_offset_x;\r\n\t\t\ts.vp_offset_y = s.vp_offset_y || cs.vp_offset_y;\r\n\t\t\tm = new tinymce.ui.DropMenu(s.id || DOM.uniqueId(), s);\r\n\r\n\t\t\tm.onAddItem.add(t.onAddItem.dispatch, t.onAddItem);\r\n\r\n\t\t\treturn m;\r\n\t\t},\r\n\r\n\t\tupdate : function() {\r\n\t\t\tvar t = this, s = t.settings, tb = DOM.get('menu_' + t.id + '_tbl'), co = DOM.get('menu_' + t.id + '_co'), tw, th;\r\n\r\n\t\t\ttw = s.max_width ? Math.min(tb.clientWidth, s.max_width) : tb.clientWidth;\r\n\t\t\tth = s.max_height ? Math.min(tb.clientHeight, s.max_height) : tb.clientHeight;\r\n\r\n\t\t\tif (!DOM.boxModel)\r\n\t\t\t\tt.element.setStyles({width : tw + 2, height : th + 2});\r\n\t\t\telse\r\n\t\t\t\tt.element.setStyles({width : tw, height : th});\r\n\r\n\t\t\tif (s.max_width)\r\n\t\t\t\tDOM.setStyle(co, 'width', tw);\r\n\r\n\t\t\tif (s.max_height) {\r\n\t\t\t\tDOM.setStyle(co, 'height', th);\r\n\r\n\t\t\t\tif (tb.clientHeight < s.max_height)\r\n\t\t\t\t\tDOM.setStyle(co, 'overflow', 'hidden');\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tshowMenu : function(x, y, px) {\r\n\t\t\tvar t = this, s = t.settings, co, vp = DOM.getViewPort(), w, h, mx, my, ot = 2, dm, tb, cp = t.classPrefix;\r\n\r\n\t\t\tt.collapse(1);\r\n\r\n\t\t\tif (t.isMenuVisible)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (!t.rendered) {\r\n\t\t\t\tco = DOM.add(t.settings.container, t.renderNode());\r\n\r\n\t\t\t\teach(t.items, function(o) {\r\n\t\t\t\t\to.postRender();\r\n\t\t\t\t});\r\n\r\n\t\t\t\tt.element = new Element('menu_' + t.id, {blocker : 1, container : s.container});\r\n\t\t\t} else\r\n\t\t\t\tco = DOM.get('menu_' + t.id);\r\n\r\n\t\t\t// Move layer out of sight unless it's Opera since it scrolls to top of page due to an bug\r\n\t\t\tif (!tinymce.isOpera)\r\n\t\t\t\tDOM.setStyles(co, {left : -0xFFFF , top : -0xFFFF});\r\n\r\n\t\t\tDOM.show(co);\r\n\t\t\tt.update();\r\n\r\n\t\t\tx += s.offset_x || 0;\r\n\t\t\ty += s.offset_y || 0;\r\n\t\t\tvp.w -= 4;\r\n\t\t\tvp.h -= 4;\r\n\r\n\t\t\t// Move inside viewport if not submenu\r\n\t\t\tif (s.constrain) {\r\n\t\t\t\tw = co.clientWidth - ot;\r\n\t\t\t\th = co.clientHeight - ot;\r\n\t\t\t\tmx = vp.x + vp.w;\r\n\t\t\t\tmy = vp.y + vp.h;\r\n\r\n\t\t\t\tif ((x + s.vp_offset_x + w) > mx)\r\n\t\t\t\t\tx = px ? px - w : Math.max(0, (mx - s.vp_offset_x) - w);\r\n\r\n\t\t\t\tif ((y + s.vp_offset_y + h) > my)\r\n\t\t\t\t\ty = Math.max(0, (my - s.vp_offset_y) - h);\r\n\t\t\t}\r\n\r\n\t\t\tDOM.setStyles(co, {left : x , top : y});\r\n\t\t\tt.element.update();\r\n\r\n\t\t\tt.isMenuVisible = 1;\r\n\t\t\tt.mouseClickFunc = Event.add(co, 'click', function(e) {\r\n\t\t\t\tvar m;\r\n\r\n\t\t\t\te = e.target;\r\n\r\n\t\t\t\tif (e && (e = DOM.getParent(e, 'tr')) && !DOM.hasClass(e, cp + 'ItemSub')) {\r\n\t\t\t\t\tm = t.items[e.id];\r\n\r\n\t\t\t\t\tif (m.isDisabled())\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tdm = t;\r\n\r\n\t\t\t\t\twhile (dm) {\r\n\t\t\t\t\t\tif (dm.hideMenu)\r\n\t\t\t\t\t\t\tdm.hideMenu();\r\n\r\n\t\t\t\t\t\tdm = dm.settings.parent;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (m.settings.onclick)\r\n\t\t\t\t\t\tm.settings.onclick(e);\r\n\r\n\t\t\t\t\treturn Event.cancel(e); // Cancel to fix onbeforeunload problem\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (t.hasMenus()) {\r\n\t\t\t\tt.mouseOverFunc = Event.add(co, 'mouseover', function(e) {\r\n\t\t\t\t\tvar m, r, mi;\r\n\r\n\t\t\t\t\te = e.target;\r\n\t\t\t\t\tif (e && (e = DOM.getParent(e, 'tr'))) {\r\n\t\t\t\t\t\tm = t.items[e.id];\r\n\r\n\t\t\t\t\t\tif (t.lastMenu)\r\n\t\t\t\t\t\t\tt.lastMenu.collapse(1);\r\n\r\n\t\t\t\t\t\tif (m.isDisabled())\r\n\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\tif (e && DOM.hasClass(e, cp + 'ItemSub')) {\r\n\t\t\t\t\t\t\t//p = DOM.getPos(s.container);\r\n\t\t\t\t\t\t\tr = DOM.getRect(e);\r\n\t\t\t\t\t\t\tm.showMenu((r.x + r.w - ot), r.y - ot, r.x);\r\n\t\t\t\t\t\t\tt.lastMenu = m;\r\n\t\t\t\t\t\t\tDOM.addClass(DOM.get(m.id).firstChild, cp + 'ItemActive');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tt.onShowMenu.dispatch(t);\r\n\r\n\t\t\tif (s.keyboard_focus) {\r\n\t\t\t\tEvent.add(co, 'keydown', t._keyHandler, t);\r\n\t\t\t\tDOM.select('a', 'menu_' + t.id)[0].focus(); // Select first link\r\n\t\t\t\tt._focusIdx = 0;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\thideMenu : function(c) {\r\n\t\t\tvar t = this, co = DOM.get('menu_' + t.id), e;\r\n\r\n\t\t\tif (!t.isMenuVisible)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tEvent.remove(co, 'mouseover', t.mouseOverFunc);\r\n\t\t\tEvent.remove(co, 'click', t.mouseClickFunc);\r\n\t\t\tEvent.remove(co, 'keydown', t._keyHandler);\r\n\t\t\tDOM.hide(co);\r\n\t\t\tt.isMenuVisible = 0;\r\n\r\n\t\t\tif (!c)\r\n\t\t\t\tt.collapse(1);\r\n\r\n\t\t\tif (t.element)\r\n\t\t\t\tt.element.hide();\r\n\r\n\t\t\tif (e = DOM.get(t.id))\r\n\t\t\t\tDOM.removeClass(e.firstChild, t.classPrefix + 'ItemActive');\r\n\r\n\t\t\tt.onHideMenu.dispatch(t);\r\n\t\t},\r\n\r\n\t\tadd : function(o) {\r\n\t\t\tvar t = this, co;\r\n\r\n\t\t\to = t.parent(o);\r\n\r\n\t\t\tif (t.isRendered && (co = DOM.get('menu_' + t.id)))\r\n\t\t\t\tt._add(DOM.select('tbody', co)[0], o);\r\n\r\n\t\t\treturn o;\r\n\t\t},\r\n\r\n\t\tcollapse : function(d) {\r\n\t\t\tthis.parent(d);\r\n\t\t\tthis.hideMenu(1);\r\n\t\t},\r\n\r\n\t\tremove : function(o) {\r\n\t\t\tDOM.remove(o.id);\r\n\t\t\tthis.destroy();\r\n\r\n\t\t\treturn this.parent(o);\r\n\t\t},\r\n\r\n\t\tdestroy : function() {\r\n\t\t\tvar t = this, co = DOM.get('menu_' + t.id);\r\n\r\n\t\t\tEvent.remove(co, 'mouseover', t.mouseOverFunc);\r\n\t\t\tEvent.remove(co, 'click', t.mouseClickFunc);\r\n\r\n\t\t\tif (t.element)\r\n\t\t\t\tt.element.remove();\r\n\r\n\t\t\tDOM.remove(co);\r\n\t\t},\r\n\r\n\t\trenderNode : function() {\r\n\t\t\tvar t = this, s = t.settings, n, tb, co, w;\r\n\r\n\t\t\tw = DOM.create('div', {id : 'menu_' + t.id, 'class' : s['class'], 'style' : 'position:absolute;left:0;top:0;z-index:200000'});\r\n\t\t\tco = DOM.add(w, 'div', {id : 'menu_' + t.id + '_co', 'class' : t.classPrefix + (s['class'] ? ' ' + s['class'] : '')});\r\n\t\t\tt.element = new Element('menu_' + t.id, {blocker : 1, container : s.container});\r\n\r\n\t\t\tif (s.menu_line)\r\n\t\t\t\tDOM.add(co, 'span', {'class' : t.classPrefix + 'Line'});\r\n\r\n//\t\t\tn = DOM.add(co, 'div', {id : 'menu_' + t.id + '_co', 'class' : 'mceMenuContainer'});\r\n\t\t\tn = DOM.add(co, 'table', {id : 'menu_' + t.id + '_tbl', border : 0, cellPadding : 0, cellSpacing : 0});\r\n\t\t\ttb = DOM.add(n, 'tbody');\r\n\r\n\t\t\teach(t.items, function(o) {\r\n\t\t\t\tt._add(tb, o);\r\n\t\t\t});\r\n\r\n\t\t\tt.rendered = true;\r\n\r\n\t\t\treturn w;\r\n\t\t},\r\n\r\n\t\t// Internal functions\r\n\r\n\t\t_keyHandler : function(e) {\r\n\t\t\tvar t = this, kc = e.keyCode;\r\n\r\n\t\t\tfunction focus(d) {\r\n\t\t\t\tvar i = t._focusIdx + d, e = DOM.select('a', 'menu_' + t.id)[i];\r\n\r\n\t\t\t\tif (e) {\r\n\t\t\t\t\tt._focusIdx = i;\r\n\t\t\t\t\te.focus();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tswitch (kc) {\r\n\t\t\t\tcase 38:\r\n\t\t\t\t\tfocus(-1); // Select first link\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tcase 40:\r\n\t\t\t\t\tfocus(1);\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tcase 13:\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tcase 27:\r\n\t\t\t\t\treturn this.hideMenu();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_add : function(tb, o) {\r\n\t\t\tvar n, s = o.settings, a, ro, it, cp = this.classPrefix, ic;\r\n\r\n\t\t\tif (s.separator) {\r\n\t\t\t\tro = DOM.add(tb, 'tr', {id : o.id, 'class' : cp + 'ItemSeparator'});\r\n\t\t\t\tDOM.add(ro, 'td', {'class' : cp + 'ItemSeparator'});\r\n\r\n\t\t\t\tif (n = ro.previousSibling)\r\n\t\t\t\t\tDOM.addClass(n, 'mceLast');\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tn = ro = DOM.add(tb, 'tr', {id : o.id, 'class' : cp + 'Item ' + cp + 'ItemEnabled'});\r\n\t\t\tn = it = DOM.add(n, 'td');\r\n\t\t\tn = a = DOM.add(n, 'a', {href : 'javascript:;', onclick : \"return false;\", onmousedown : 'return false;'});\r\n\r\n\t\t\tDOM.addClass(it, s['class']);\r\n//\t\t\tn = DOM.add(n, 'span', {'class' : 'item'});\r\n\r\n\t\t\tic = DOM.add(n, 'span', {'class' : 'mceIcon' + (s.icon ? ' mce_' + s.icon : '')});\r\n\r\n\t\t\tif (s.icon_src)\r\n\t\t\t\tDOM.add(ic, 'img', {src : s.icon_src});\r\n\r\n\t\t\tn = DOM.add(n, s.element || 'span', {'class' : 'mceText', title : o.settings.title}, o.settings.title);\r\n\r\n\t\t\tif (o.settings.style)\r\n\t\t\t\tDOM.setAttrib(n, 'style', o.settings.style);\r\n\r\n\t\t\tif (tb.childNodes.length == 1)\r\n\t\t\t\tDOM.addClass(ro, 'mceFirst');\r\n\r\n\t\t\tif ((n = ro.previousSibling) && DOM.hasClass(n, cp + 'ItemSeparator'))\r\n\t\t\t\tDOM.addClass(ro, 'mceFirst');\r\n\r\n\t\t\tif (o.collapse)\r\n\t\t\t\tDOM.addClass(ro, cp + 'ItemSub');\r\n\r\n\t\t\tif (n = ro.previousSibling)\r\n\t\t\t\tDOM.removeClass(n, 'mceLast');\r\n\r\n\t\t\tDOM.addClass(ro, 'mceLast');\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n(function(tinymce) {\r\n\tvar DOM = tinymce.DOM;\r\n\r\n\ttinymce.create('tinymce.ui.Button:tinymce.ui.Control', {\r\n\t\tButton : function(id, s) {\r\n\t\t\tthis.parent(id, s);\r\n\t\t\tthis.classPrefix = 'mceButton';\r\n\t\t},\r\n\r\n\t\trenderHTML : function() {\r\n\t\t\tvar cp = this.classPrefix, s = this.settings, h, l;\r\n\r\n\t\t\tl = DOM.encode(s.label || '');\r\n\t\t\th = '<a id=\"' + this.id + '\" href=\"javascript:;\" class=\"' + cp + ' ' + cp + 'Enabled ' + s['class'] + (l ? ' ' + cp + 'Labeled' : '') +'\" onmousedown=\"return false;\" onclick=\"return false;\" title=\"' + DOM.encode(s.title) + '\">';\r\n\r\n\t\t\tif (s.image)\r\n\t\t\t\th += '<img class=\"mceIcon\" src=\"' + s.image + '\" />' + l + '</a>';\r\n\t\t\telse\r\n\t\t\t\th += '<span class=\"mceIcon ' + s['class'] + '\"></span>' + (l ? '<span class=\"' + cp + 'Label\">' + l + '</span>' : '') + '</a>';\r\n\r\n\t\t\treturn h;\r\n\t\t},\r\n\r\n\t\tpostRender : function() {\r\n\t\t\tvar t = this, s = t.settings;\r\n\r\n\t\t\ttinymce.dom.Event.add(t.id, 'click', function(e) {\r\n\t\t\t\tif (!t.isDisabled())\r\n\t\t\t\t\treturn s.onclick.call(s.scope, e);\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\tvar DOM = tinymce.DOM, Event = tinymce.dom.Event, each = tinymce.each, Dispatcher = tinymce.util.Dispatcher;\r\n\r\n\ttinymce.create('tinymce.ui.ListBox:tinymce.ui.Control', {\r\n\t\tListBox : function(id, s) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tt.parent(id, s);\r\n\r\n\t\t\tt.items = [];\r\n\r\n\t\t\tt.onChange = new Dispatcher(t);\r\n\r\n\t\t\tt.onPostRender = new Dispatcher(t);\r\n\r\n\t\t\tt.onAdd = new Dispatcher(t);\r\n\r\n\t\t\tt.onRenderMenu = new tinymce.util.Dispatcher(this);\r\n\r\n\t\t\tt.classPrefix = 'mceListBox';\r\n\t\t},\r\n\r\n\t\tselect : function(va) {\r\n\t\t\tvar t = this, fv, f;\r\n\r\n\t\t\tif (va == undefined)\r\n\t\t\t\treturn t.selectByIndex(-1);\r\n\r\n\t\t\t// Is string or number make function selector\r\n\t\t\tif (va && va.call)\r\n\t\t\t\tf = va;\r\n\t\t\telse {\r\n\t\t\t\tf = function(v) {\r\n\t\t\t\t\treturn v == va;\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\t// Do we need to do something?\r\n\t\t\tif (va != t.selectedValue) {\r\n\t\t\t\t// Find item\r\n\t\t\t\teach(t.items, function(o, i) {\r\n\t\t\t\t\tif (f(o.value)) {\r\n\t\t\t\t\t\tfv = 1;\r\n\t\t\t\t\t\tt.selectByIndex(i);\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (!fv)\r\n\t\t\t\t\tt.selectByIndex(-1);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tselectByIndex : function(idx) {\r\n\t\t\tvar t = this, e, o;\r\n\r\n\t\t\tif (idx != t.selectedIndex) {\r\n\t\t\t\te = DOM.get(t.id + '_text');\r\n\t\t\t\to = t.items[idx];\r\n\r\n\t\t\t\tif (o) {\r\n\t\t\t\t\tt.selectedValue = o.value;\r\n\t\t\t\t\tt.selectedIndex = idx;\r\n\t\t\t\t\tDOM.setHTML(e, DOM.encode(o.title));\r\n\t\t\t\t\tDOM.removeClass(e, 'mceTitle');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tDOM.setHTML(e, DOM.encode(t.settings.title));\r\n\t\t\t\t\tDOM.addClass(e, 'mceTitle');\r\n\t\t\t\t\tt.selectedValue = t.selectedIndex = null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\te = 0;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tadd : function(n, v, o) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\to = o || {};\r\n\t\t\to = tinymce.extend(o, {\r\n\t\t\t\ttitle : n,\r\n\t\t\t\tvalue : v\r\n\t\t\t});\r\n\r\n\t\t\tt.items.push(o);\r\n\t\t\tt.onAdd.dispatch(t, o);\r\n\t\t},\r\n\r\n\t\tgetLength : function() {\r\n\t\t\treturn this.items.length;\r\n\t\t},\r\n\r\n\t\trenderHTML : function() {\r\n\t\t\tvar h = '', t = this, s = t.settings, cp = t.classPrefix;\r\n\r\n\t\t\th = '<table id=\"' + t.id + '\" cellpadding=\"0\" cellspacing=\"0\" class=\"' + cp + ' ' + cp + 'Enabled' + (s['class'] ? (' ' + s['class']) : '') + '\"><tbody><tr>';\r\n\t\t\th += '<td>' + DOM.createHTML('a', {id : t.id + '_text', href : 'javascript:;', 'class' : 'mceText', onclick : \"return false;\", onmousedown : 'return false;'}, DOM.encode(t.settings.title)) + '</td>';\r\n\t\t\th += '<td>' + DOM.createHTML('a', {id : t.id + '_open', tabindex : -1, href : 'javascript:;', 'class' : 'mceOpen', onclick : \"return false;\", onmousedown : 'return false;'}, '<span></span>') + '</td>';\r\n\t\t\th += '</tr></tbody></table>';\r\n\r\n\t\t\treturn h;\r\n\t\t},\r\n\r\n\t\tshowMenu : function() {\r\n\t\t\tvar t = this, p1, p2, e = DOM.get(this.id), m;\r\n\r\n\t\t\tif (t.isDisabled() || t.items.length == 0)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (t.menu && t.menu.isMenuVisible)\r\n\t\t\t\treturn t.hideMenu();\r\n\r\n\t\t\tif (!t.isMenuRendered) {\r\n\t\t\t\tt.renderMenu();\r\n\t\t\t\tt.isMenuRendered = true;\r\n\t\t\t}\r\n\r\n\t\t\tp1 = DOM.getPos(this.settings.menu_container);\r\n\t\t\tp2 = DOM.getPos(e);\r\n\r\n\t\t\tm = t.menu;\r\n\t\t\tm.settings.offset_x = p2.x;\r\n\t\t\tm.settings.offset_y = p2.y;\r\n\t\t\tm.settings.keyboard_focus = !tinymce.isOpera; // Opera is buggy when it comes to auto focus\r\n\r\n\t\t\t// Select in menu\r\n\t\t\tif (t.oldID)\r\n\t\t\t\tm.items[t.oldID].setSelected(0);\r\n\r\n\t\t\teach(t.items, function(o) {\r\n\t\t\t\tif (o.value === t.selectedValue) {\r\n\t\t\t\t\tm.items[o.id].setSelected(1);\r\n\t\t\t\t\tt.oldID = o.id;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tm.showMenu(0, e.clientHeight);\r\n\r\n\t\t\tEvent.add(DOM.doc, 'mousedown', t.hideMenu, t);\r\n\t\t\tDOM.addClass(t.id, t.classPrefix + 'Selected');\r\n\r\n\t\t\t//DOM.get(t.id + '_text').focus();\r\n\t\t},\r\n\r\n\t\thideMenu : function(e) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tif (t.menu && t.menu.isMenuVisible) {\r\n\t\t\t\t// Prevent double toogles by canceling the mouse click event to the button\r\n\t\t\t\tif (e && e.type == \"mousedown\" && (e.target.id == t.id + '_text' || e.target.id == t.id + '_open'))\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tif (!e || !DOM.getParent(e.target, '.mceMenu')) {\r\n\t\t\t\t\tDOM.removeClass(t.id, t.classPrefix + 'Selected');\r\n\t\t\t\t\tEvent.remove(DOM.doc, 'mousedown', t.hideMenu, t);\r\n\t\t\t\t\tt.menu.hideMenu();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\trenderMenu : function() {\r\n\t\t\tvar t = this, m;\r\n\r\n\t\t\tm = t.settings.control_manager.createDropMenu(t.id + '_menu', {\r\n\t\t\t\tmenu_line : 1,\r\n\t\t\t\t'class' : t.classPrefix + 'Menu mceNoIcons',\r\n\t\t\t\tmax_width : 150,\r\n\t\t\t\tmax_height : 150\r\n\t\t\t});\r\n\r\n\t\t\tm.onHideMenu.add(t.hideMenu, t);\r\n\r\n\t\t\tm.add({\r\n\t\t\t\ttitle : t.settings.title,\r\n\t\t\t\t'class' : 'mceMenuItemTitle',\r\n\t\t\t\tonclick : function() {\r\n\t\t\t\t\tif (t.settings.onselect('') !== false)\r\n\t\t\t\t\t\tt.select(''); // Must be runned after\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\teach(t.items, function(o) {\r\n\t\t\t\t// No value then treat it as a title\r\n\t\t\t\tif (o.value === undefined) {\r\n\t\t\t\t\tm.add({\r\n\t\t\t\t\t\ttitle : o.title,\r\n\t\t\t\t\t\t'class' : 'mceMenuItemTitle',\r\n\t\t\t\t\t\tonclick : function() {\r\n\t\t\t\t\t\t\tif (t.settings.onselect('') !== false)\r\n\t\t\t\t\t\t\t\tt.select(''); // Must be runned after\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\to.id = DOM.uniqueId();\r\n\t\t\t\t\to.onclick = function() {\r\n\t\t\t\t\t\tif (t.settings.onselect(o.value) !== false)\r\n\t\t\t\t\t\t\tt.select(o.value); // Must be runned after\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tm.add(o);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tt.onRenderMenu.dispatch(t, m);\r\n\t\t\tt.menu = m;\r\n\t\t},\r\n\r\n\t\tpostRender : function() {\r\n\t\t\tvar t = this, cp = t.classPrefix;\r\n\r\n\t\t\tEvent.add(t.id, 'click', t.showMenu, t);\r\n\t\t\tEvent.add(t.id + '_text', 'focus', function() {\r\n\t\t\t\tif (!t._focused) {\r\n\t\t\t\t\tt.keyDownHandler = Event.add(t.id + '_text', 'keydown', function(e) {\r\n\t\t\t\t\t\tvar idx = -1, v, kc = e.keyCode;\r\n\r\n\t\t\t\t\t\t// Find current index\r\n\t\t\t\t\t\teach(t.items, function(v, i) {\r\n\t\t\t\t\t\t\tif (t.selectedValue == v.value)\r\n\t\t\t\t\t\t\t\tidx = i;\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t// Move up/down\r\n\t\t\t\t\t\tif (kc == 38)\r\n\t\t\t\t\t\t\tv = t.items[idx - 1];\r\n\t\t\t\t\t\telse if (kc == 40)\r\n\t\t\t\t\t\t\tv = t.items[idx + 1];\r\n\t\t\t\t\t\telse if (kc == 13) {\r\n\t\t\t\t\t\t\t// Fake select on enter\r\n\t\t\t\t\t\t\tv = t.selectedValue;\r\n\t\t\t\t\t\t\tt.selectedValue = null; // Needs to be null to fake change\r\n\t\t\t\t\t\t\tt.settings.onselect(v);\r\n\t\t\t\t\t\t\treturn Event.cancel(e);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (v) {\r\n\t\t\t\t\t\t\tt.hideMenu();\r\n\t\t\t\t\t\t\tt.select(v.value);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tt._focused = 1;\r\n\t\t\t});\r\n\t\t\tEvent.add(t.id + '_text', 'blur', function() {Event.remove(t.id + '_text', 'keydown', t.keyDownHandler); t._focused = 0;});\r\n\r\n\t\t\t// Old IE doesn't have hover on all elements\r\n\t\t\tif (tinymce.isIE6 || !DOM.boxModel) {\r\n\t\t\t\tEvent.add(t.id, 'mouseover', function() {\r\n\t\t\t\t\tif (!DOM.hasClass(t.id, cp + 'Disabled'))\r\n\t\t\t\t\t\tDOM.addClass(t.id, cp + 'Hover');\r\n\t\t\t\t});\r\n\r\n\t\t\t\tEvent.add(t.id, 'mouseout', function() {\r\n\t\t\t\t\tif (!DOM.hasClass(t.id, cp + 'Disabled'))\r\n\t\t\t\t\t\tDOM.removeClass(t.id, cp + 'Hover');\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tt.onPostRender.dispatch(t, DOM.get(t.id));\r\n\t\t},\r\n\r\n\t\tdestroy : function() {\r\n\t\t\tthis.parent();\r\n\r\n\t\t\tEvent.clear(this.id + '_text');\r\n\t\t\tEvent.clear(this.id + '_open');\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n(function(tinymce) {\r\n\tvar DOM = tinymce.DOM, Event = tinymce.dom.Event, each = tinymce.each, Dispatcher = tinymce.util.Dispatcher;\r\n\r\n\ttinymce.create('tinymce.ui.NativeListBox:tinymce.ui.ListBox', {\r\n\t\tNativeListBox : function(id, s) {\r\n\t\t\tthis.parent(id, s);\r\n\t\t\tthis.classPrefix = 'mceNativeListBox';\r\n\t\t},\r\n\r\n\t\tsetDisabled : function(s) {\r\n\t\t\tDOM.get(this.id).disabled = s;\r\n\t\t},\r\n\r\n\t\tisDisabled : function() {\r\n\t\t\treturn DOM.get(this.id).disabled;\r\n\t\t},\r\n\r\n\t\tselect : function(va) {\r\n\t\t\tvar t = this, fv, f;\r\n\r\n\t\t\tif (va == undefined)\r\n\t\t\t\treturn t.selectByIndex(-1);\r\n\r\n\t\t\t// Is string or number make function selector\r\n\t\t\tif (va && va.call)\r\n\t\t\t\tf = va;\r\n\t\t\telse {\r\n\t\t\t\tf = function(v) {\r\n\t\t\t\t\treturn v == va;\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\t// Do we need to do something?\r\n\t\t\tif (va != t.selectedValue) {\r\n\t\t\t\t// Find item\r\n\t\t\t\teach(t.items, function(o, i) {\r\n\t\t\t\t\tif (f(o.value)) {\r\n\t\t\t\t\t\tfv = 1;\r\n\t\t\t\t\t\tt.selectByIndex(i);\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (!fv)\r\n\t\t\t\t\tt.selectByIndex(-1);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tselectByIndex : function(idx) {\r\n\t\t\tDOM.get(this.id).selectedIndex = idx + 1;\r\n\t\t\tthis.selectedValue = this.items[idx] ? this.items[idx].value : null;\r\n\t\t},\r\n\r\n\t\tadd : function(n, v, a) {\r\n\t\t\tvar o, t = this;\r\n\r\n\t\t\ta = a || {};\r\n\t\t\ta.value = v;\r\n\r\n\t\t\tif (t.isRendered())\r\n\t\t\t\tDOM.add(DOM.get(this.id), 'option', a, n);\r\n\r\n\t\t\to = {\r\n\t\t\t\ttitle : n,\r\n\t\t\t\tvalue : v,\r\n\t\t\t\tattribs : a\r\n\t\t\t};\r\n\r\n\t\t\tt.items.push(o);\r\n\t\t\tt.onAdd.dispatch(t, o);\r\n\t\t},\r\n\r\n\t\tgetLength : function() {\r\n\t\t\treturn this.items.length;\r\n\t\t},\r\n\r\n\t\trenderHTML : function() {\r\n\t\t\tvar h, t = this;\r\n\r\n\t\t\th = DOM.createHTML('option', {value : ''}, '-- ' + t.settings.title + ' --');\r\n\r\n\t\t\teach(t.items, function(it) {\r\n\t\t\t\th += DOM.createHTML('option', {value : it.value}, it.title);\r\n\t\t\t});\r\n\r\n\t\t\th = DOM.createHTML('select', {id : t.id, 'class' : 'mceNativeListBox'}, h);\r\n\r\n\t\t\treturn h;\r\n\t\t},\r\n\r\n\t\tpostRender : function() {\r\n\t\t\tvar t = this, ch;\r\n\r\n\t\t\tt.rendered = true;\r\n\r\n\t\t\tfunction onChange(e) {\r\n\t\t\t\tvar v = t.items[e.target.selectedIndex - 1];\r\n\r\n\t\t\t\tif (v && (v = v.value)) {\r\n\t\t\t\t\tt.onChange.dispatch(t, v);\r\n\r\n\t\t\t\t\tif (t.settings.onselect)\r\n\t\t\t\t\t\tt.settings.onselect(v);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tEvent.add(t.id, 'change', onChange);\r\n\r\n\t\t\t// Accessibility keyhandler\r\n\t\t\tEvent.add(t.id, 'keydown', function(e) {\r\n\t\t\t\tvar bf;\r\n\r\n\t\t\t\tEvent.remove(t.id, 'change', ch);\r\n\r\n\t\t\t\tbf = Event.add(t.id, 'blur', function() {\r\n\t\t\t\t\tEvent.add(t.id, 'change', onChange);\r\n\t\t\t\t\tEvent.remove(t.id, 'blur', bf);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (e.keyCode == 13 || e.keyCode == 32) {\r\n\t\t\t\t\tonChange(e);\r\n\t\t\t\t\treturn Event.cancel(e);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tt.onPostRender.dispatch(t, DOM.get(t.id));\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n(function(tinymce) {\r\n\tvar DOM = tinymce.DOM, Event = tinymce.dom.Event, each = tinymce.each;\r\n\r\n\ttinymce.create('tinymce.ui.MenuButton:tinymce.ui.Button', {\r\n\t\tMenuButton : function(id, s) {\r\n\t\t\tthis.parent(id, s);\r\n\r\n\t\t\tthis.onRenderMenu = new tinymce.util.Dispatcher(this);\r\n\r\n\t\t\ts.menu_container = s.menu_container || DOM.doc.body;\r\n\t\t},\r\n\r\n\t\tshowMenu : function() {\r\n\t\t\tvar t = this, p1, p2, e = DOM.get(t.id), m;\r\n\r\n\t\t\tif (t.isDisabled())\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (!t.isMenuRendered) {\r\n\t\t\t\tt.renderMenu();\r\n\t\t\t\tt.isMenuRendered = true;\r\n\t\t\t}\r\n\r\n\t\t\tif (t.isMenuVisible)\r\n\t\t\t\treturn t.hideMenu();\r\n\r\n\t\t\tp1 = DOM.getPos(t.settings.menu_container);\r\n\t\t\tp2 = DOM.getPos(e);\r\n\r\n\t\t\tm = t.menu;\r\n\t\t\tm.settings.offset_x = p2.x;\r\n\t\t\tm.settings.offset_y = p2.y;\r\n\t\t\tm.settings.vp_offset_x = p2.x;\r\n\t\t\tm.settings.vp_offset_y = p2.y;\r\n\t\t\tm.settings.keyboard_focus = t._focused;\r\n\t\t\tm.showMenu(0, e.clientHeight);\r\n\r\n\t\t\tEvent.add(DOM.doc, 'mousedown', t.hideMenu, t);\r\n\t\t\tt.setState('Selected', 1);\r\n\r\n\t\t\tt.isMenuVisible = 1;\r\n\t\t},\r\n\r\n\t\trenderMenu : function() {\r\n\t\t\tvar t = this, m;\r\n\r\n\t\t\tm = t.settings.control_manager.createDropMenu(t.id + '_menu', {\r\n\t\t\t\tmenu_line : 1,\r\n\t\t\t\t'class' : this.classPrefix + 'Menu',\r\n\t\t\t\ticons : t.settings.icons\r\n\t\t\t});\r\n\r\n\t\t\tm.onHideMenu.add(t.hideMenu, t);\r\n\r\n\t\t\tt.onRenderMenu.dispatch(t, m);\r\n\t\t\tt.menu = m;\r\n\t\t},\r\n\r\n\t\thideMenu : function(e) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\t// Prevent double toogles by canceling the mouse click event to the button\r\n\t\t\tif (e && e.type == \"mousedown\" && DOM.getParent(e.target, function(e) {return e.id === t.id || e.id === t.id + '_open';}))\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (!e || !DOM.getParent(e.target, '.mceMenu')) {\r\n\t\t\t\tt.setState('Selected', 0);\r\n\t\t\t\tEvent.remove(DOM.doc, 'mousedown', t.hideMenu, t);\r\n\t\t\t\tif (t.menu)\r\n\t\t\t\t\tt.menu.hideMenu();\r\n\t\t\t}\r\n\r\n\t\t\tt.isMenuVisible = 0;\r\n\t\t},\r\n\r\n\t\tpostRender : function() {\r\n\t\t\tvar t = this, s = t.settings;\r\n\r\n\t\t\tEvent.add(t.id, 'click', function() {\r\n\t\t\t\tif (!t.isDisabled()) {\r\n\t\t\t\t\tif (s.onclick)\r\n\t\t\t\t\t\ts.onclick(t.value);\r\n\r\n\t\t\t\t\tt.showMenu();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\tvar DOM = tinymce.DOM, Event = tinymce.dom.Event, each = tinymce.each;\r\n\r\n\ttinymce.create('tinymce.ui.SplitButton:tinymce.ui.MenuButton', {\r\n\t\tSplitButton : function(id, s) {\r\n\t\t\tthis.parent(id, s);\r\n\t\t\tthis.classPrefix = 'mceSplitButton';\r\n\t\t},\r\n\r\n\t\trenderHTML : function() {\r\n\t\t\tvar h, t = this, s = t.settings, h1;\r\n\r\n\t\t\th = '<tbody><tr>';\r\n\r\n\t\t\tif (s.image)\r\n\t\t\t\th1 = DOM.createHTML('img ', {src : s.image, 'class' : 'mceAction ' + s['class']});\r\n\t\t\telse\r\n\t\t\t\th1 = DOM.createHTML('span', {'class' : 'mceAction ' + s['class']}, '');\r\n\r\n\t\t\th += '<td>' + DOM.createHTML('a', {id : t.id + '_action', href : 'javascript:;', 'class' : 'mceAction ' + s['class'], onclick : \"return false;\", onmousedown : 'return false;', title : s.title}, h1) + '</td>';\r\n\t\r\n\t\t\th1 = DOM.createHTML('span', {'class' : 'mceOpen ' + s['class']});\r\n\t\t\th += '<td>' + DOM.createHTML('a', {id : t.id + '_open', href : 'javascript:;', 'class' : 'mceOpen ' + s['class'], onclick : \"return false;\", onmousedown : 'return false;', title : s.title}, h1) + '</td>';\r\n\r\n\t\t\th += '</tr></tbody>';\r\n\r\n\t\t\treturn DOM.createHTML('table', {id : t.id, 'class' : 'mceSplitButton mceSplitButtonEnabled ' + s['class'], cellpadding : '0', cellspacing : '0', onmousedown : 'return false;', title : s.title}, h);\r\n\t\t},\r\n\r\n\t\tpostRender : function() {\r\n\t\t\tvar t = this, s = t.settings;\r\n\r\n\t\t\tif (s.onclick) {\r\n\t\t\t\tEvent.add(t.id + '_action', 'click', function() {\r\n\t\t\t\t\tif (!t.isDisabled())\r\n\t\t\t\t\t\ts.onclick(t.value);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tEvent.add(t.id + '_open', 'click', t.showMenu, t);\r\n\t\t\tEvent.add(t.id + '_open', 'focus', function() {t._focused = 1;});\r\n\t\t\tEvent.add(t.id + '_open', 'blur', function() {t._focused = 0;});\r\n\r\n\t\t\t// Old IE doesn't have hover on all elements\r\n\t\t\tif (tinymce.isIE6 || !DOM.boxModel) {\r\n\t\t\t\tEvent.add(t.id, 'mouseover', function() {\r\n\t\t\t\t\tif (!DOM.hasClass(t.id, 'mceSplitButtonDisabled'))\r\n\t\t\t\t\t\tDOM.addClass(t.id, 'mceSplitButtonHover');\r\n\t\t\t\t});\r\n\r\n\t\t\t\tEvent.add(t.id, 'mouseout', function() {\r\n\t\t\t\t\tif (!DOM.hasClass(t.id, 'mceSplitButtonDisabled'))\r\n\t\t\t\t\t\tDOM.removeClass(t.id, 'mceSplitButtonHover');\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tdestroy : function() {\r\n\t\t\tthis.parent();\r\n\r\n\t\t\tEvent.clear(this.id + '_action');\r\n\t\t\tEvent.clear(this.id + '_open');\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\tvar DOM = tinymce.DOM, Event = tinymce.dom.Event, is = tinymce.is, each = tinymce.each;\r\n\r\n\ttinymce.create('tinymce.ui.ColorSplitButton:tinymce.ui.SplitButton', {\r\n\t\tColorSplitButton : function(id, s) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tt.parent(id, s);\r\n\r\n\t\t\tt.settings = s = tinymce.extend({\r\n\t\t\t\tcolors : '000000,993300,333300,003300,003366,000080,333399,333333,800000,FF6600,808000,008000,008080,0000FF,666699,808080,FF0000,FF9900,99CC00,339966,33CCCC,3366FF,800080,999999,FF00FF,FFCC00,FFFF00,00FF00,00FFFF,00CCFF,993366,C0C0C0,FF99CC,FFCC99,FFFF99,CCFFCC,CCFFFF,99CCFF,CC99FF,FFFFFF',\r\n\t\t\t\tgrid_width : 8,\r\n\t\t\t\tdefault_color : '#888888'\r\n\t\t\t}, t.settings);\r\n\r\n\t\t\tt.onShowMenu = new tinymce.util.Dispatcher(t);\r\n\r\n\t\t\tt.onHideMenu = new tinymce.util.Dispatcher(t);\r\n\r\n\t\t\tt.value = s.default_color;\r\n\t\t},\r\n\r\n\t\tshowMenu : function() {\r\n\t\t\tvar t = this, r, p, e, p2;\r\n\r\n\t\t\tif (t.isDisabled())\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (!t.isMenuRendered) {\r\n\t\t\t\tt.renderMenu();\r\n\t\t\t\tt.isMenuRendered = true;\r\n\t\t\t}\r\n\r\n\t\t\tif (t.isMenuVisible)\r\n\t\t\t\treturn t.hideMenu();\r\n\r\n\t\t\te = DOM.get(t.id);\r\n\t\t\tDOM.show(t.id + '_menu');\r\n\t\t\tDOM.addClass(e, 'mceSplitButtonSelected');\r\n\t\t\tp2 = DOM.getPos(e);\r\n\t\t\tDOM.setStyles(t.id + '_menu', {\r\n\t\t\t\tleft : p2.x,\r\n\t\t\t\ttop : p2.y + e.clientHeight,\r\n\t\t\t\tzIndex : 200000\r\n\t\t\t});\r\n\t\t\te = 0;\r\n\r\n\t\t\tEvent.add(DOM.doc, 'mousedown', t.hideMenu, t);\r\n\t\t\tt.onShowMenu.dispatch(t);\r\n\r\n\t\t\tif (t._focused) {\r\n\t\t\t\tt._keyHandler = Event.add(t.id + '_menu', 'keydown', function(e) {\r\n\t\t\t\t\tif (e.keyCode == 27)\r\n\t\t\t\t\t\tt.hideMenu();\r\n\t\t\t\t});\r\n\r\n\t\t\t\tDOM.select('a', t.id + '_menu')[0].focus(); // Select first link\r\n\t\t\t}\r\n\r\n\t\t\tt.isMenuVisible = 1;\r\n\t\t},\r\n\r\n\t\thideMenu : function(e) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\t// Prevent double toogles by canceling the mouse click event to the button\r\n\t\t\tif (e && e.type == \"mousedown\" && DOM.getParent(e.target, function(e) {return e.id === t.id + '_open';}))\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (!e || !DOM.getParent(e.target, '.mceSplitButtonMenu')) {\r\n\t\t\t\tDOM.removeClass(t.id, 'mceSplitButtonSelected');\r\n\t\t\t\tEvent.remove(DOM.doc, 'mousedown', t.hideMenu, t);\r\n\t\t\t\tEvent.remove(t.id + '_menu', 'keydown', t._keyHandler);\r\n\t\t\t\tDOM.hide(t.id + '_menu');\r\n\t\t\t}\r\n\r\n\t\t\tt.onHideMenu.dispatch(t);\r\n\r\n\t\t\tt.isMenuVisible = 0;\r\n\t\t},\r\n\r\n\t\trenderMenu : function() {\r\n\t\t\tvar t = this, m, i = 0, s = t.settings, n, tb, tr, w;\r\n\r\n\t\t\tw = DOM.add(s.menu_container, 'div', {id : t.id + '_menu', 'class' : s['menu_class'] + ' ' + s['class'], style : 'position:absolute;left:0;top:-1000px;'});\r\n\t\t\tm = DOM.add(w, 'div', {'class' : s['class'] + ' mceSplitButtonMenu'});\r\n\t\t\tDOM.add(m, 'span', {'class' : 'mceMenuLine'});\r\n\r\n\t\t\tn = DOM.add(m, 'table', {'class' : 'mceColorSplitMenu'});\r\n\t\t\ttb = DOM.add(n, 'tbody');\r\n\r\n\t\t\t// Generate color grid\r\n\t\t\ti = 0;\r\n\t\t\teach(is(s.colors, 'array') ? s.colors : s.colors.split(','), function(c) {\r\n\t\t\t\tc = c.replace(/^#/, '');\r\n\r\n\t\t\t\tif (!i--) {\r\n\t\t\t\t\ttr = DOM.add(tb, 'tr');\r\n\t\t\t\t\ti = s.grid_width - 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tn = DOM.add(tr, 'td');\r\n\r\n\t\t\t\tn = DOM.add(n, 'a', {\r\n\t\t\t\t\thref : 'javascript:;',\r\n\t\t\t\t\tstyle : {\r\n\t\t\t\t\t\tbackgroundColor : '#' + c\r\n\t\t\t\t\t},\r\n\t\t\t\t\t_mce_color : '#' + c\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\tif (s.more_colors_func) {\r\n\t\t\t\tn = DOM.add(tb, 'tr');\r\n\t\t\t\tn = DOM.add(n, 'td', {colspan : s.grid_width, 'class' : 'mceMoreColors'});\r\n\t\t\t\tn = DOM.add(n, 'a', {id : t.id + '_more', href : 'javascript:;', onclick : 'return false;', 'class' : 'mceMoreColors'}, s.more_colors_title);\r\n\r\n\t\t\t\tEvent.add(n, 'click', function(e) {\r\n\t\t\t\t\ts.more_colors_func.call(s.more_colors_scope || this);\r\n\t\t\t\t\treturn Event.cancel(e); // Cancel to fix onbeforeunload problem\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tDOM.addClass(m, 'mceColorSplitMenu');\r\n\r\n\t\t\tEvent.add(t.id + '_menu', 'click', function(e) {\r\n\t\t\t\tvar c;\r\n\r\n\t\t\t\te = e.target;\r\n\r\n\t\t\t\tif (e.nodeName == 'A' && (c = e.getAttribute('_mce_color')))\r\n\t\t\t\t\tt.setColor(c);\r\n\r\n\t\t\t\treturn Event.cancel(e); // Prevent IE auto save warning\r\n\t\t\t});\r\n\r\n\t\t\treturn w;\r\n\t\t},\r\n\r\n\t\tsetColor : function(c) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tDOM.setStyle(t.id + '_preview', 'backgroundColor', c);\r\n\r\n\t\t\tt.value = c;\r\n\t\t\tt.hideMenu();\r\n\t\t\tt.settings.onselect(c);\r\n\t\t},\r\n\r\n\t\tpostRender : function() {\r\n\t\t\tvar t = this, id = t.id;\r\n\r\n\t\t\tt.parent();\r\n\t\t\tDOM.add(id + '_action', 'div', {id : id + '_preview', 'class' : 'mceColorPreview'});\r\n\t\t\tDOM.setStyle(t.id + '_preview', 'backgroundColor', t.value);\r\n\t\t},\r\n\r\n\t\tdestroy : function() {\r\n\t\t\tthis.parent();\r\n\r\n\t\t\tEvent.clear(this.id + '_menu');\r\n\t\t\tEvent.clear(this.id + '_more');\r\n\t\t\tDOM.remove(this.id + '_menu');\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n\r\ntinymce.create('tinymce.ui.Toolbar:tinymce.ui.Container', {\r\n\trenderHTML : function() {\r\n\t\tvar t = this, h = '', c, co, dom = tinymce.DOM, s = t.settings, i, pr, nx, cl;\r\n\r\n\t\tcl = t.controls;\r\n\t\tfor (i=0; i<cl.length; i++) {\r\n\t\t\t// Get current control, prev control, next control and if the control is a list box or not\r\n\t\t\tco = cl[i];\r\n\t\t\tpr = cl[i - 1];\r\n\t\t\tnx = cl[i + 1];\r\n\r\n\t\t\t// Add toolbar start\r\n\t\t\tif (i === 0) {\r\n\t\t\t\tc = 'mceToolbarStart';\r\n\r\n\t\t\t\tif (co.Button)\r\n\t\t\t\t\tc += ' mceToolbarStartButton';\r\n\t\t\t\telse if (co.SplitButton)\r\n\t\t\t\t\tc += ' mceToolbarStartSplitButton';\r\n\t\t\t\telse if (co.ListBox)\r\n\t\t\t\t\tc += ' mceToolbarStartListBox';\r\n\r\n\t\t\t\th += dom.createHTML('td', {'class' : c}, dom.createHTML('span', null, '<!-- IE -->'));\r\n\t\t\t}\r\n\r\n\t\t\t// Add toolbar end before list box and after the previous button\r\n\t\t\t// This is to fix the o2k7 editor skins\r\n\t\t\tif (pr && co.ListBox) {\r\n\t\t\t\tif (pr.Button || pr.SplitButton)\r\n\t\t\t\t\th += dom.createHTML('td', {'class' : 'mceToolbarEnd'}, dom.createHTML('span', null, '<!-- IE -->'));\r\n\t\t\t}\r\n\r\n\t\t\t// Render control HTML\r\n\r\n\t\t\t// IE 8 quick fix, needed to propertly generate a hit area for anchors\r\n\t\t\tif (dom.stdMode)\r\n\t\t\t\th += '<td style=\"position: relative\">' + co.renderHTML() + '</td>';\r\n\t\t\telse\r\n\t\t\t\th += '<td>' + co.renderHTML() + '</td>';\r\n\r\n\t\t\t// Add toolbar start after list box and before the next button\r\n\t\t\t// This is to fix the o2k7 editor skins\r\n\t\t\tif (nx && co.ListBox) {\r\n\t\t\t\tif (nx.Button || nx.SplitButton)\r\n\t\t\t\t\th += dom.createHTML('td', {'class' : 'mceToolbarStart'}, dom.createHTML('span', null, '<!-- IE -->'));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tc = 'mceToolbarEnd';\r\n\r\n\t\tif (co.Button)\r\n\t\t\tc += ' mceToolbarEndButton';\r\n\t\telse if (co.SplitButton)\r\n\t\t\tc += ' mceToolbarEndSplitButton';\r\n\t\telse if (co.ListBox)\r\n\t\t\tc += ' mceToolbarEndListBox';\r\n\r\n\t\th += dom.createHTML('td', {'class' : c}, dom.createHTML('span', null, '<!-- IE -->'));\r\n\r\n\t\treturn dom.createHTML('table', {id : t.id, 'class' : 'mceToolbar' + (s['class'] ? ' ' + s['class'] : ''), cellpadding : '0', cellspacing : '0', align : t.settings.align || ''}, '<tbody><tr>' + h + '</tr></tbody>');\r\n\t}\r\n});\r\n\r\n(function(tinymce) {\r\n\tvar Dispatcher = tinymce.util.Dispatcher, each = tinymce.each;\r\n\r\n\ttinymce.create('tinymce.AddOnManager', {\r\n\t\tAddOnManager : function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself.items = [];\r\n\t\t\tself.urls = {};\r\n\t\t\tself.lookup = {};\r\n\t\t\tself.onAdd = new Dispatcher(self);\r\n\t\t},\r\n\r\n\t\tget : function(n) {\r\n\t\t\treturn this.lookup[n];\r\n\t\t},\r\n\r\n\t\trequireLangPack : function(n) {\r\n\t\t\tvar s = tinymce.settings;\r\n\r\n\t\t\tif (s && s.language)\r\n\t\t\t\ttinymce.ScriptLoader.add(this.urls[n] + '/langs/' + s.language + '.js');\r\n\t\t},\r\n\r\n\t\tadd : function(id, o) {\r\n\t\t\tthis.items.push(o);\r\n\t\t\tthis.lookup[id] = o;\r\n\t\t\tthis.onAdd.dispatch(this, id, o);\r\n\r\n\t\t\treturn o;\r\n\t\t},\r\n\r\n\t\tload : function(n, u, cb, s) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tif (t.urls[n])\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (u.indexOf('/') != 0 && u.indexOf('://') == -1)\r\n\t\t\t\tu = tinymce.baseURL + '/' +  u;\r\n\r\n\t\t\tt.urls[n] = u.substring(0, u.lastIndexOf('/'));\r\n\r\n\t\t\tif (!t.lookup[n])\r\n\t\t\t\ttinymce.ScriptLoader.add(u, cb, s);\r\n\t\t}\r\n\t});\r\n\r\n\t// Create plugin and theme managers\r\n\ttinymce.PluginManager = new tinymce.AddOnManager();\r\n\ttinymce.ThemeManager = new tinymce.AddOnManager();\r\n}(tinymce));\r\n\r\n(function(tinymce) {\r\n\t// Shorten names\r\n\tvar each = tinymce.each, extend = tinymce.extend,\r\n\t\tDOM = tinymce.DOM, Event = tinymce.dom.Event,\r\n\t\tThemeManager = tinymce.ThemeManager, PluginManager = tinymce.PluginManager,\r\n\t\texplode = tinymce.explode,\r\n\t\tDispatcher = tinymce.util.Dispatcher, undefined, instanceCounter = 0;\r\n\r\n\t// Setup some URLs where the editor API is located and where the document is\r\n\ttinymce.documentBaseURL = window.location.href.replace(/[\\?#].*$/, '').replace(/[\\/\\\\][^\\/]+$/, '');\r\n\tif (!/[\\/\\\\]$/.test(tinymce.documentBaseURL))\r\n\t\ttinymce.documentBaseURL += '/';\r\n\r\n\ttinymce.baseURL = new tinymce.util.URI(tinymce.documentBaseURL).toAbsolute(tinymce.baseURL);\r\n\r\n\ttinymce.baseURI = new tinymce.util.URI(tinymce.baseURL);\r\n\r\n\t// Add before unload listener\r\n\t// This was required since IE was leaking memory if you added and removed beforeunload listeners\r\n\t// with attachEvent/detatchEvent so this only adds one listener and instances can the attach to the onBeforeUnload event\r\n\ttinymce.onBeforeUnload = new Dispatcher(tinymce);\r\n\r\n\t// Must be on window or IE will leak if the editor is placed in frame or iframe\r\n\tEvent.add(window, 'beforeunload', function(e) {\r\n\t\ttinymce.onBeforeUnload.dispatch(tinymce, e);\r\n\t});\r\n\r\n\ttinymce.onAddEditor = new Dispatcher(tinymce);\r\n\r\n\ttinymce.onRemoveEditor = new Dispatcher(tinymce);\r\n\r\n\ttinymce.EditorManager = extend(tinymce, {\r\n\t\teditors : [],\r\n\r\n\t\ti18n : {},\r\n\r\n\t\tactiveEditor : null,\r\n\r\n\t\tinit : function(s) {\r\n\t\t\tvar t = this, pl, sl = tinymce.ScriptLoader, e, el = [], ed;\r\n\r\n\t\t\tfunction execCallback(se, n, s) {\r\n\t\t\t\tvar f = se[n];\r\n\r\n\t\t\t\tif (!f)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tif (tinymce.is(f, 'string')) {\r\n\t\t\t\t\ts = f.replace(/\\.\\w+$/, '');\r\n\t\t\t\t\ts = s ? tinymce.resolve(s) : 0;\r\n\t\t\t\t\tf = tinymce.resolve(f);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn f.apply(s || this, Array.prototype.slice.call(arguments, 2));\r\n\t\t\t};\r\n\r\n\t\t\ts = extend({\r\n\t\t\t\ttheme : \"simple\",\r\n\t\t\t\tlanguage : \"en\"\r\n\t\t\t}, s);\r\n\r\n\t\t\tt.settings = s;\r\n\r\n\t\t\t// Legacy call\r\n\t\t\tEvent.add(document, 'init', function() {\r\n\t\t\t\tvar l, co;\r\n\r\n\t\t\t\texecCallback(s, 'onpageload');\r\n\r\n\t\t\t\tswitch (s.mode) {\r\n\t\t\t\t\tcase \"exact\":\r\n\t\t\t\t\t\tl = s.elements || '';\r\n\r\n\t\t\t\t\t\tif(l.length > 0) {\r\n\t\t\t\t\t\t\teach(explode(l), function(v) {\r\n\t\t\t\t\t\t\t\tif (DOM.get(v)) {\r\n\t\t\t\t\t\t\t\t\ted = new tinymce.Editor(v, s);\r\n\t\t\t\t\t\t\t\t\tel.push(ed);\r\n\t\t\t\t\t\t\t\t\ted.render(1);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\teach(document.forms, function(f) {\r\n\t\t\t\t\t\t\t\t\t\teach(f.elements, function(e) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (e.name === v) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tv = 'mce_editor_' + instanceCounter++;\r\n\t\t\t\t\t\t\t\t\t\t\t\tDOM.setAttrib(e, 'id', v);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\ted = new tinymce.Editor(v, s);\r\n\t\t\t\t\t\t\t\t\t\t\t\tel.push(ed);\r\n\t\t\t\t\t\t\t\t\t\t\t\ted.render(1);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase \"textareas\":\r\n\t\t\t\t\tcase \"specific_textareas\":\r\n\t\t\t\t\t\tfunction hasClass(n, c) {\r\n\t\t\t\t\t\t\treturn c.constructor === RegExp ? c.test(n.className) : DOM.hasClass(n, c);\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\teach(DOM.select('textarea'), function(v) {\r\n\t\t\t\t\t\t\tif (s.editor_deselector && hasClass(v, s.editor_deselector))\r\n\t\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\t\tif (!s.editor_selector || hasClass(v, s.editor_selector)) {\r\n\t\t\t\t\t\t\t\t// Can we use the name\r\n\t\t\t\t\t\t\t\te = DOM.get(v.name);\r\n\t\t\t\t\t\t\t\tif (!v.id && !e)\r\n\t\t\t\t\t\t\t\t\tv.id = v.name;\r\n\r\n\t\t\t\t\t\t\t\t// Generate unique name if missing or already exists\r\n\t\t\t\t\t\t\t\tif (!v.id || t.get(v.id))\r\n\t\t\t\t\t\t\t\t\tv.id = DOM.uniqueId();\r\n\r\n\t\t\t\t\t\t\t\ted = new tinymce.Editor(v.id, s);\r\n\t\t\t\t\t\t\t\tel.push(ed);\r\n\t\t\t\t\t\t\t\ted.render(1);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Call onInit when all editors are initialized\r\n\t\t\t\tif (s.oninit) {\r\n\t\t\t\t\tl = co = 0;\r\n\r\n\t\t\t\t\teach(el, function(ed) {\r\n\t\t\t\t\t\tco++;\r\n\r\n\t\t\t\t\t\tif (!ed.initialized) {\r\n\t\t\t\t\t\t\t// Wait for it\r\n\t\t\t\t\t\t\ted.onInit.add(function() {\r\n\t\t\t\t\t\t\t\tl++;\r\n\r\n\t\t\t\t\t\t\t\t// All done\r\n\t\t\t\t\t\t\t\tif (l == co)\r\n\t\t\t\t\t\t\t\t\texecCallback(s, 'oninit');\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\tl++;\r\n\r\n\t\t\t\t\t\t// All done\r\n\t\t\t\t\t\tif (l == co)\r\n\t\t\t\t\t\t\texecCallback(s, 'oninit');\t\t\t\t\t\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tget : function(id) {\r\n\t\t\tif (id === undefined)\r\n\t\t\t\treturn this.editors;\r\n\r\n\t\t\treturn this.editors[id];\r\n\t\t},\r\n\r\n\t\tgetInstanceById : function(id) {\r\n\t\t\treturn this.get(id);\r\n\t\t},\r\n\r\n\t\tadd : function(editor) {\r\n\t\t\tvar self = this, editors = self.editors;\r\n\r\n\t\t\t// Add named and index editor instance\r\n\t\t\teditors[editor.id] = editor;\r\n\t\t\teditors.push(editor);\r\n\r\n\t\t\tself._setActive(editor);\r\n\t\t\tself.onAddEditor.dispatch(self, editor);\r\n\r\n\r\n\t\t\treturn editor;\r\n\t\t},\r\n\r\n\t\tremove : function(editor) {\r\n\t\t\tvar t = this, i, editors = t.editors;\r\n\r\n\t\t\t// Not in the collection\r\n\t\t\tif (!editors[editor.id])\r\n\t\t\t\treturn null;\r\n\r\n\t\t\tdelete editors[editor.id];\r\n\r\n\t\t\tfor (i = 0; i < editors.length; i++) {\r\n\t\t\t\tif (editors[i] == editor) {\r\n\t\t\t\t\teditors.splice(i, 1);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Select another editor since the active one was removed\r\n\t\t\tif (t.activeEditor == editor)\r\n\t\t\t\tt._setActive(editors[0]);\r\n\r\n\t\t\teditor.destroy();\r\n\t\t\tt.onRemoveEditor.dispatch(t, editor);\r\n\r\n\t\t\treturn editor;\r\n\t\t},\r\n\r\n\t\texecCommand : function(c, u, v) {\r\n\t\t\tvar t = this, ed = t.get(v), w;\r\n\r\n\t\t\t// Manager commands\r\n\t\t\tswitch (c) {\r\n\t\t\t\tcase \"mceFocus\":\r\n\t\t\t\t\ted.focus();\r\n\t\t\t\t\treturn true;\r\n\r\n\t\t\t\tcase \"mceAddEditor\":\r\n\t\t\t\tcase \"mceAddControl\":\r\n\t\t\t\t\tif (!t.get(v))\r\n\t\t\t\t\t\tnew tinymce.Editor(v, t.settings).render();\r\n\r\n\t\t\t\t\treturn true;\r\n\r\n\t\t\t\tcase \"mceAddFrameControl\":\r\n\t\t\t\t\tw = v.window;\r\n\r\n\t\t\t\t\t// Add tinyMCE global instance and tinymce namespace to specified window\r\n\t\t\t\t\tw.tinyMCE = tinyMCE;\r\n\t\t\t\t\tw.tinymce = tinymce;\r\n\r\n\t\t\t\t\ttinymce.DOM.doc = w.document;\r\n\t\t\t\t\ttinymce.DOM.win = w;\r\n\r\n\t\t\t\t\ted = new tinymce.Editor(v.element_id, v);\r\n\t\t\t\t\ted.render();\r\n\r\n\t\t\t\t\t// Fix IE memory leaks\r\n\t\t\t\t\tif (tinymce.isIE) {\r\n\t\t\t\t\t\tfunction clr() {\r\n\t\t\t\t\t\t\ted.destroy();\r\n\t\t\t\t\t\t\tw.detachEvent('onunload', clr);\r\n\t\t\t\t\t\t\tw = w.tinyMCE = w.tinymce = null; // IE leak\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tw.attachEvent('onunload', clr);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tv.page_window = null;\r\n\r\n\t\t\t\t\treturn true;\r\n\r\n\t\t\t\tcase \"mceRemoveEditor\":\r\n\t\t\t\tcase \"mceRemoveControl\":\r\n\t\t\t\t\tif (ed)\r\n\t\t\t\t\t\ted.remove();\r\n\r\n\t\t\t\t\treturn true;\r\n\r\n\t\t\t\tcase 'mceToggleEditor':\r\n\t\t\t\t\tif (!ed) {\r\n\t\t\t\t\t\tt.execCommand('mceAddControl', 0, v);\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (ed.isHidden())\r\n\t\t\t\t\t\ted.show();\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\ted.hide();\r\n\r\n\t\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\t// Run command on active editor\r\n\t\t\tif (t.activeEditor)\r\n\t\t\t\treturn t.activeEditor.execCommand(c, u, v);\r\n\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\texecInstanceCommand : function(id, c, u, v) {\r\n\t\t\tvar ed = this.get(id);\r\n\r\n\t\t\tif (ed)\r\n\t\t\t\treturn ed.execCommand(c, u, v);\r\n\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\ttriggerSave : function() {\r\n\t\t\teach(this.editors, function(e) {\r\n\t\t\t\te.save();\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\taddI18n : function(p, o) {\r\n\t\t\tvar lo, i18n = this.i18n;\r\n\r\n\t\t\tif (!tinymce.is(p, 'string')) {\r\n\t\t\t\teach(p, function(o, lc) {\r\n\t\t\t\t\teach(o, function(o, g) {\r\n\t\t\t\t\t\teach(o, function(o, k) {\r\n\t\t\t\t\t\t\tif (g === 'common')\r\n\t\t\t\t\t\t\t\ti18n[lc + '.' + k] = o;\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\ti18n[lc + '.' + g + '.' + k] = o;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\teach(o, function(o, k) {\r\n\t\t\t\t\ti18n[p + '.' + k] = o;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t// Private methods\r\n\r\n\t\t_setActive : function(editor) {\r\n\t\t\tthis.selectedInstance = this.activeEditor = editor;\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\t// Shorten these names\r\n\tvar DOM = tinymce.DOM, Event = tinymce.dom.Event, extend = tinymce.extend,\r\n\t\tDispatcher = tinymce.util.Dispatcher, each = tinymce.each, isGecko = tinymce.isGecko,\r\n\t\tisIE = tinymce.isIE, isWebKit = tinymce.isWebKit, is = tinymce.is,\r\n\t\tThemeManager = tinymce.ThemeManager, PluginManager = tinymce.PluginManager,\r\n\t\tinArray = tinymce.inArray, grep = tinymce.grep, explode = tinymce.explode;\r\n\r\n\ttinymce.create('tinymce.Editor', {\r\n\t\tEditor : function(id, s) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tt.id = t.editorId = id;\r\n\r\n\t\t\tt.execCommands = {};\r\n\t\t\tt.queryStateCommands = {};\r\n\t\t\tt.queryValueCommands = {};\r\n\r\n\t\t\tt.isNotDirty = false;\r\n\r\n\t\t\tt.plugins = {};\r\n\r\n\t\t\t// Add events to the editor\r\n\t\t\teach([\r\n\t\t\t\t'onPreInit',\r\n\r\n\t\t\t\t'onBeforeRenderUI',\r\n\r\n\t\t\t\t'onPostRender',\r\n\r\n\t\t\t\t'onInit',\r\n\r\n\t\t\t\t'onRemove',\r\n\r\n\t\t\t\t'onActivate',\r\n\r\n\t\t\t\t'onDeactivate',\r\n\r\n\t\t\t\t'onClick',\r\n\r\n\t\t\t\t'onEvent',\r\n\r\n\t\t\t\t'onMouseUp',\r\n\r\n\t\t\t\t'onMouseDown',\r\n\r\n\t\t\t\t'onDblClick',\r\n\r\n\t\t\t\t'onKeyDown',\r\n\r\n\t\t\t\t'onKeyUp',\r\n\r\n\t\t\t\t'onKeyPress',\r\n\r\n\t\t\t\t'onContextMenu',\r\n\r\n\t\t\t\t'onSubmit',\r\n\r\n\t\t\t\t'onReset',\r\n\r\n\t\t\t\t'onPaste',\r\n\r\n\t\t\t\t'onPreProcess',\r\n\r\n\t\t\t\t'onPostProcess',\r\n\r\n\t\t\t\t'onBeforeSetContent',\r\n\r\n\t\t\t\t'onBeforeGetContent',\r\n\r\n\t\t\t\t'onSetContent',\r\n\r\n\t\t\t\t'onGetContent',\r\n\r\n\t\t\t\t'onLoadContent',\r\n\r\n\t\t\t\t'onSaveContent',\r\n\r\n\t\t\t\t'onNodeChange',\r\n\r\n\t\t\t\t'onChange',\r\n\r\n\t\t\t\t'onBeforeExecCommand',\r\n\r\n\t\t\t\t'onExecCommand',\r\n\r\n\t\t\t\t'onUndo',\r\n\r\n\t\t\t\t'onRedo',\r\n\r\n\t\t\t\t'onVisualAid',\r\n\r\n\t\t\t\t'onSetProgressState'\r\n\t\t\t], function(e) {\r\n\t\t\t\tt[e] = new Dispatcher(t);\r\n\t\t\t});\r\n\r\n\t\t\tt.settings = s = extend({\r\n\t\t\t\tid : id,\r\n\t\t\t\tlanguage : 'en',\r\n\t\t\t\tdocs_language : 'en',\r\n\t\t\t\ttheme : 'simple',\r\n\t\t\t\tskin : 'default',\r\n\t\t\t\tdelta_width : 0,\r\n\t\t\t\tdelta_height : 0,\r\n\t\t\t\tpopup_css : '',\r\n\t\t\t\tplugins : '',\r\n\t\t\t\tdocument_base_url : tinymce.documentBaseURL,\r\n\t\t\t\tadd_form_submit_trigger : 1,\r\n\t\t\t\tmedia_strict: 0, // ADD Hostmake\r\n\t\t\t\tsubmit_patch : 1,\r\n\t\t\t\tadd_unload_trigger : 1,\r\n\t\t\t\tconvert_urls : 0, // 1 // Hostmake\r\n\t\t\t\trelative_urls : 0, // 1 // Hostmake\r\n\t\t\t\tremove_script_host : 1,\r\n\t\t\t\ttable_inline_editing : 0,\r\n\t\t\t\tobject_resizing : 1,\r\n\t\t\t\tcleanup : 1,\r\n\t\t\t\taccessibility_focus : 1,\r\n\t\t\t\tcustom_shortcuts : 1,\r\n\t\t\t\tcustom_undo_redo_keyboard_shortcuts : 1,\r\n\t\t\t\tcustom_undo_redo_restore_selection : 1,\r\n\t\t\t\tcustom_undo_redo : 1,\r\n\t\t\t\tdoctype : tinymce.isIE6 ? '<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\">' : '<!DOCTYPE>', // Use old doctype on IE 6 to avoid horizontal scroll\r\n\t\t\t\tvisual_table_class : 'mceItemTable',\r\n\t\t\t\tvisual : 1,\r\n\t\t\t\tfont_size_style_values : 'xx-small,x-small,small,medium,large,x-large,xx-large',\r\n\t\t\t\tapply_source_formatting : 1,\r\n\t\t\t\tdirectionality : 'ltr',\r\n\t\t\t\tforced_root_block :  '', // p Hostmake\r\n\t\t\t\t// Hostmake add br[clear]\r\n\t\t\t\t// replace -div,-span -> div,span \r\n\t\t\t\tvalid_elements : '@[id|class|style|title|dir<ltr?rtl|lang|xml::lang|onclick|ondblclick|onmousedown|onmouseup|onmouseover|onmousemove|onmouseout|onkeypress|onkeydown|onkeyup],a[rel|rev|charset|hreflang|tabindex|accesskey|type|name|href|target|title|class|onfocus|onblur],strong/b,em/i,strike,u,#p,-ol[type|compact],-ul[type|compact],-li,br[clear],img[longdesc|usemap|src|border|alt=|title|hspace|vspace|width|height|align],-sub,-sup,-blockquote[cite],-table[border|cellspacing|cellpadding|width|frame|rules|height|align|summary|bgcolor|background|bordercolor],-tr[rowspan|width|height|align|valign|bgcolor|background|bordercolor],tbody,thead,tfoot,#td[colspan|rowspan|width|height|align|valign|bgcolor|background|bordercolor|scope],#th[colspan|rowspan|width|height|align|valign|scope],caption,div,span,-code,-pre,address,-h1,-h2,-h3,-h4,-h5,-h6,hr[size|noshade],-font[face|size|color],dd,dl,dt,cite,abbr,acronym,del[datetime|cite],ins[datetime|cite],object[classid|width|height|codebase|*],param[name|value],embed[type|width|height|src|*],script[src|type],map[name],area[shape|coords|href|alt|target],bdo,button,col[align|char|charoff|span|valign|width],colgroup[align|char|charoff|span|valign|width],dfn,fieldset,form[action|accept|accept-charset|enctype|method],input[accept|alt|checked|disabled|maxlength|name|readonly|size|src|type|value|tabindex|accesskey],kbd,label[for],legend,noscript,optgroup[label|disabled],option[disabled|label|selected|value],q[cite],samp,select[disabled|multiple|name|size],small,textarea[cols|rows|disabled|name|readonly],tt,var,big',\r\n\t\t\t\thidden_input : 1,\r\n\t\t\t\tpadd_empty_editor : 1,\r\n\t\t\t\trender_ui : 1,\r\n\t\t\t\tinit_theme : 1,\r\n\t\t\t\tforce_p_newlines : 1,\r\n\t\t\t\tindentation : '30px',\r\n\t\t\t\tkeep_styles : 1,\r\n\t\t\t\tfix_table_elements : 1,\r\n\t\t\t\tinline_styles : 1,\r\n\t\t\t\tconvert_fonts_to_spans : true\r\n\t\t\t}, s);\r\n\r\n\t\t\tt.documentBaseURI = new tinymce.util.URI(s.document_base_url || tinymce.documentBaseURL, {\r\n\t\t\t\tbase_uri : tinyMCE.baseURI\r\n\t\t\t});\r\n\r\n\t\t\tt.baseURI = tinymce.baseURI;\r\n\r\n\t\t\t// Call setup\r\n\t\t\tt.execCallback('setup', t);\r\n\t\t},\r\n\r\n\t\trender : function(nst) {\r\n\t\t\tvar t = this, s = t.settings, id = t.id, sl = tinymce.ScriptLoader;\r\n\r\n\t\t\t// Page is not loaded yet, wait for it\r\n\t\t\tif (!Event.domLoaded) {\r\n\t\t\t\tEvent.add(document, 'init', function() {\r\n\t\t\t\t\tt.render();\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\ttinyMCE.settings = s;\r\n\r\n\t\t\t// Element not found, then skip initialization\r\n\t\t\tif (!t.getElement())\r\n\t\t\t\treturn;\r\n\r\n\t\t\t// Is a iPad/iPhone, then skip initialization. We need to sniff here since the\r\n\t\t\t// browser says it has contentEditable support but there is no visible caret\r\n\t\t\t// We will remove this check ones Apple implements full contentEditable support\r\n\t\t\tif (tinymce.isIDevice)\r\n\t\t\t\treturn;\r\n\r\n\t\t\t// Add hidden input for non input elements inside form elements\r\n\t\t\tif (!/TEXTAREA|INPUT/i.test(t.getElement().nodeName) && s.hidden_input && DOM.getParent(id, 'form'))\r\n\t\t\t\tDOM.insertAfter(DOM.create('input', {type : 'hidden', name : id}), id);\r\n\r\n\t\t\tif (tinymce.WindowManager)\r\n\t\t\t\tt.windowManager = new tinymce.WindowManager(t);\r\n\r\n\t\t\tif (s.encoding == 'xml') {\r\n\t\t\t\tt.onGetContent.add(function(ed, o) {\r\n\t\t\t\t\tif (o.save)\r\n\t\t\t\t\t\to.content = DOM.encode(o.content);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (s.add_form_submit_trigger) {\r\n\t\t\t\tt.onSubmit.addToTop(function() {\r\n\t\t\t\t\tif (t.initialized) {\r\n\t\t\t\t\t\tt.save();\r\n\t\t\t\t\t\tt.isNotDirty = 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (s.add_unload_trigger) {\r\n\t\t\t\tt._beforeUnload = tinyMCE.onBeforeUnload.add(function() {\r\n\t\t\t\t\tif (t.initialized && !t.destroyed && !t.isHidden())\r\n\t\t\t\t\t\tt.save({format : 'raw', no_events : true});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\ttinymce.addUnload(t.destroy, t);\r\n\r\n\t\t\tif (s.submit_patch) {\r\n\t\t\t\tt.onBeforeRenderUI.add(function() {\r\n\t\t\t\t\tvar n = t.getElement().form;\r\n\r\n\t\t\t\t\tif (!n)\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t// Already patched\r\n\t\t\t\t\tif (n._mceOldSubmit)\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t// Check page uses id=\"submit\" or name=\"submit\" for it's submit button\r\n\t\t\t\t\tif (!n.submit.nodeType && !n.submit.length) {\r\n\t\t\t\t\t\tt.formElement = n;\r\n\t\t\t\t\t\tn._mceOldSubmit = n.submit;\r\n\t\t\t\t\t\tn.submit = function() {\r\n\t\t\t\t\t\t\t// Save all instances\r\n\t\t\t\t\t\t\ttinymce.triggerSave();\r\n\t\t\t\t\t\t\tt.isNotDirty = 1;\r\n\r\n\t\t\t\t\t\t\treturn t.formElement._mceOldSubmit(t.formElement);\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tn = null;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Load scripts\r\n\t\t\tfunction loadScripts() {\r\n\t\t\t\tif (s.language)\r\n\t\t\t\t\tsl.add(tinymce.baseURL + '/langs/' + s.language + '.js');\r\n\r\n\t\t\t\tif (s.theme && s.theme.charAt(0) != '-' && !ThemeManager.urls[s.theme])\r\n\t\t\t\t\tThemeManager.load(s.theme, 'themes/' + s.theme + '/editor_template' + tinymce.suffix + '.js');\r\n\r\n\t\t\t\teach(explode(s.plugins), function(p) {\r\n\t\t\t\t\tif (p && p.charAt(0) != '-' && !PluginManager.urls[p]) {\r\n\t\t\t\t\t\t// Skip safari plugin, since it is removed as of 3.3b1\r\n\t\t\t\t\t\tif (p == 'safari')\r\n\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\tPluginManager.load(p, 'plugins/' + p + '/editor_plugin' + tinymce.suffix + '.js');\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Init when que is loaded\r\n\t\t\t\tsl.loadQueue(function() {\r\n\t\t\t\t\tif (!t.removed)\r\n\t\t\t\t\t\tt.init();\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\tloadScripts();\r\n\t\t},\r\n\r\n\t\tinit : function() {\r\n\t\t\tvar n, t = this, s = t.settings, w, h, e = t.getElement(), o, ti, u, bi, bc, re;\r\n\r\n\t\t\ttinymce.add(t);\r\n\r\n\t\t\tif (s.theme) {\r\n\t\t\t\ts.theme = s.theme.replace(/-/, '');\r\n\t\t\t\to = ThemeManager.get(s.theme);\r\n\t\t\t\tt.theme = new o();\r\n\r\n\t\t\t\tif (t.theme.init && s.init_theme)\r\n\t\t\t\t\tt.theme.init(t, ThemeManager.urls[s.theme] || tinymce.documentBaseURL.replace(/\\/$/, ''));\r\n\t\t\t}\r\n\r\n\t\t\t// Create all plugins\r\n\t\t\teach(explode(s.plugins.replace(/\\-/g, '')), function(p) {\r\n\t\t\t\tvar c = PluginManager.get(p), u = PluginManager.urls[p] || tinymce.documentBaseURL.replace(/\\/$/, ''), po;\r\n\r\n\t\t\t\tif (c) {\r\n\t\t\t\t\tpo = new c(t, u);\r\n\r\n\t\t\t\t\tt.plugins[p] = po;\r\n\r\n\t\t\t\t\tif (po.init)\r\n\t\t\t\t\t\tpo.init(t, u);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Setup popup CSS path(s)\r\n\t\t\tif (s.popup_css !== false) {\r\n\t\t\t\tif (s.popup_css)\r\n\t\t\t\t\ts.popup_css = t.documentBaseURI.toAbsolute(s.popup_css);\r\n\t\t\t\telse\r\n\t\t\t\t\ts.popup_css = t.baseURI.toAbsolute(\"themes/\" + s.theme + \"/skins/\" + s.skin + \"/dialog.css\");\r\n\t\t\t}\r\n\r\n\t\t\tif (s.popup_css_add)\r\n\t\t\t\ts.popup_css += ',' + t.documentBaseURI.toAbsolute(s.popup_css_add);\r\n\r\n\t\t\tt.controlManager = new tinymce.ControlManager(t);\r\n\r\n\t\t\tif (s.custom_undo_redo) {\r\n\t\t\t\t// Add initial undo level\r\n\t\t\t\tt.onBeforeExecCommand.add(function(ed, cmd, ui, val, a) {\r\n\t\t\t\t\tif (cmd != 'Undo' && cmd != 'Redo' && cmd != 'mceRepaint' && (!a || !a.skip_undo)) {\r\n\t\t\t\t\t\tif (!t.undoManager.hasUndo())\r\n\t\t\t\t\t\t\tt.undoManager.add();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tt.onExecCommand.add(function(ed, cmd, ui, val, a) {\r\n\t\t\t\t\tif (cmd != 'Undo' && cmd != 'Redo' && cmd != 'mceRepaint' && (!a || !a.skip_undo))\r\n\t\t\t\t\t\tt.undoManager.add();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tt.onExecCommand.add(function(ed, c) {\r\n\t\t\t\t// Don't refresh the select lists until caret move\r\n\t\t\t\tif (!/^(FontName|FontSize)$/.test(c))\r\n\t\t\t\t\tt.nodeChanged();\r\n\t\t\t});\r\n\r\n\t\t\t// Remove ghost selections on images and tables in Gecko\r\n\t\t\tif (isGecko) {\r\n\t\t\t\tfunction repaint(a, o) {\r\n\t\t\t\t\tif (!o || !o.initial)\r\n\t\t\t\t\t\tt.execCommand('mceRepaint');\r\n\t\t\t\t};\r\n\r\n\t\t\t\tt.onUndo.add(repaint);\r\n\t\t\t\tt.onRedo.add(repaint);\r\n\t\t\t\tt.onSetContent.add(repaint);\r\n\t\t\t}\r\n\r\n\t\t\t// Enables users to override the control factory\r\n\t\t\tt.onBeforeRenderUI.dispatch(t, t.controlManager);\r\n\r\n\t\t\t// Measure box\r\n\t\t\tif (s.render_ui) {\r\n\t\t\t\tw = s.width || e.style.width || e.offsetWidth;\r\n\t\t\t\th = s.height || e.style.height || e.offsetHeight;\r\n\t\t\t\tt.orgDisplay = e.style.display;\r\n\t\t\t\tre = /^[0-9\\.]+(|px)$/i;\r\n\r\n\t\t\t\tif (re.test('' + w))\r\n\t\t\t\t\tw = Math.max(parseInt(w) + (o.deltaWidth || 0), 100);\r\n\r\n\t\t\t\tif (re.test('' + h))\r\n\t\t\t\t\th = Math.max(parseInt(h) + (o.deltaHeight || 0), 100);\r\n\r\n\t\t\t\t// Render UI\r\n\t\t\t\to = t.theme.renderUI({\r\n\t\t\t\t\ttargetNode : e,\r\n\t\t\t\t\twidth : w,\r\n\t\t\t\t\theight : h,\r\n\t\t\t\t\tdeltaWidth : s.delta_width,\r\n\t\t\t\t\tdeltaHeight : s.delta_height\r\n\t\t\t\t});\r\n\r\n\t\t\t\tt.editorContainer = o.editorContainer;\r\n\t\t\t}\r\n\r\n\r\n\t\t\t// User specified a document.domain value\r\n\t\t\tif (document.domain && location.hostname != document.domain)\r\n\t\t\t\ttinymce.relaxedDomain = document.domain;\r\n\r\n\t\t\t// Resize editor\r\n\t\t\tDOM.setStyles(o.sizeContainer || o.editorContainer, {\r\n\t\t\t\twidth : w,\r\n\t\t\t\theight : h\r\n\t\t\t});\r\n\r\n\t\t\th = (o.iframeHeight || h) + (typeof(h) == 'number' ? (o.deltaHeight || 0) : '');\r\n\t\t\tif (h < 100)\r\n\t\t\t\th = 100;\r\n\r\n\t\t\tt.iframeHTML = s.doctype + '<html><head xmlns=\"http://www.w3.org/1999/xhtml\">';\r\n\r\n\t\t\t// We only need to override paths if we have to\r\n\t\t\t// IE has a bug where it remove site absolute urls to relative ones if this is specified\r\n\t\t\tif (s.document_base_url != tinymce.documentBaseURL)\r\n\t\t\t\tt.iframeHTML += '<base href=\"' + t.documentBaseURI.getURI() + '\" />';\r\n\r\n\t\t\tt.iframeHTML += '<meta http-equiv=\"X-UA-Compatible\" content=\"IE=7\" /><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />';\r\n\r\n\t\t\tif (tinymce.relaxedDomain)\r\n\t\t\t\tt.iframeHTML += '<script type=\"text/javascript\">document.domain = \"' + tinymce.relaxedDomain + '\";</script>';\r\n\r\n\t\t\tbi = s.body_id || 'tinymce';\r\n\t\t\tif (bi.indexOf('=') != -1) {\r\n\t\t\t\tbi = t.getParam('body_id', '', 'hash');\r\n\t\t\t\tbi = bi[t.id] || bi;\r\n\t\t\t}\r\n\r\n\t\t\tbc = s.body_class || '';\r\n\t\t\tif (bc.indexOf('=') != -1) {\r\n\t\t\t\tbc = t.getParam('body_class', '', 'hash');\r\n\t\t\t\tbc = bc[t.id] || '';\r\n\t\t\t}\r\n\r\n\t\t\tt.iframeHTML += '</head><body id=\"' + bi + '\" class=\"mceContentBody ' + bc + '\"></body></html>';\r\n\r\n\t\t\t// Domain relaxing enabled, then set document domain\r\n\t\t\tif (tinymce.relaxedDomain) {\r\n\t\t\t\t// We need to write the contents here in IE since multiple writes messes up refresh button and back button\r\n\t\t\t\tif (isIE || (tinymce.isOpera && parseFloat(opera.version()) >= 9.5))\r\n\t\t\t\t\tu = 'javascript:(function(){document.open();document.domain=\"' + document.domain + '\";var ed = window.parent.tinyMCE.get(\"' + t.id + '\");document.write(ed.iframeHTML);document.close();ed.setupIframe();})()';\r\n\t\t\t\telse if (tinymce.isOpera)\r\n\t\t\t\t\tu = 'javascript:(function(){document.open();document.domain=\"' + document.domain + '\";document.close();ed.setupIframe();})()';\t\t\t\t\t\r\n\t\t\t}\r\n\r\n\t\t\t// Create iframe\r\n\t\t\tn = DOM.add(o.iframeContainer, 'iframe', {\r\n\t\t\t\tid : t.id + \"_ifr\",\r\n\t\t\t\tsrc : u || 'javascript:\"\"', // Workaround for HTTPS warning in IE6/7\r\n\t\t\t\tframeBorder : '0',\r\n\t\t\t\tstyle : {\r\n\t\t\t\t\twidth : '100%',\r\n\t\t\t\t\theight : h\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tt.contentAreaContainer = o.iframeContainer;\r\n\t\t\tDOM.get(o.editorContainer).style.display = t.orgDisplay;\r\n\t\t\tDOM.get(t.id).style.display = 'none';\r\n\r\n\t\t\tif (!isIE || !tinymce.relaxedDomain)\r\n\t\t\t\tt.setupIframe();\r\n\r\n\t\t\te = n = o = null; // Cleanup\r\n\t\t},\r\n\r\n\t\tsetupIframe : function() {\r\n\t\t\tvar t = this, s = t.settings, e = DOM.get(t.id), d = t.getDoc(), h, b;\r\n\r\n\t\t\t// Setup iframe body\r\n\t\t\tif (!isIE || !tinymce.relaxedDomain) {\r\n\t\t\t\td.open();\r\n\t\t\t\td.write(t.iframeHTML);\r\n\t\t\t\td.close();\r\n\t\t\t}\r\n\r\n\t\t\t// Design mode needs to be added here Ctrl+A will fail otherwise\r\n\t\t\tif (!isIE) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif (!s.readonly)\r\n\t\t\t\t\t\td.designMode = 'On';\r\n\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t// Will fail on Gecko if the editor is placed in an hidden container element\r\n\t\t\t\t\t// The design mode will be set ones the editor is focused\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// IE needs to use contentEditable or it will display non secure items for HTTPS\r\n\t\t\tif (isIE) {\r\n\t\t\t\t// It will not steal focus if we hide it while setting contentEditable\r\n\t\t\t\tb = t.getBody();\r\n\t\t\t\tDOM.hide(b);\r\n\r\n\t\t\t\tif (!s.readonly)\r\n\t\t\t\t\tb.contentEditable = true;\r\n\r\n\t\t\t\tDOM.show(b);\r\n\t\t\t}\r\n\r\n\t\t\tt.dom = new tinymce.dom.DOMUtils(t.getDoc(), {\r\n\t\t\t\tkeep_values : true,\r\n\t\t\t\turl_converter : t.convertURL,\r\n\t\t\t\turl_converter_scope : t,\r\n\t\t\t\thex_colors : s.force_hex_style_colors,\r\n\t\t\t\tclass_filter : s.class_filter,\r\n\t\t\t\tupdate_styles : 1,\r\n\t\t\t\tfix_ie_paragraphs : 1,\r\n\t\t\t\tvalid_styles : s.valid_styles\r\n\t\t\t});\r\n\r\n\t\t\tt.schema = new tinymce.dom.Schema();\r\n\r\n\t\t\tt.serializer = new tinymce.dom.Serializer(extend(s, {\r\n\t\t\t\tvalid_elements : s.verify_html === false ? '*[*]' : s.valid_elements,\r\n\t\t\t\tdom : t.dom,\r\n\t\t\t\tschema : t.schema\r\n\t\t\t}));\r\n\r\n\t\t\tt.selection = new tinymce.dom.Selection(t.dom, t.getWin(), t.serializer);\r\n\r\n\t\t\tt.formatter = new tinymce.Formatter(this);\r\n\r\n\t\t\t// Register default formats\r\n\t\t\tt.formatter.register({\r\n\t\t\t\talignleft : [\r\n\t\t\t\t\t{selector : 'p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li', styles : {textAlign : 'left'}},\r\n\t\t\t\t\t{selector : 'img,table', styles : {'float' : 'left'}}\r\n\t\t\t\t],\r\n\r\n\t\t\t\taligncenter : [\r\n\t\t\t\t\t{selector : 'p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li', styles : {textAlign : 'center'}},\r\n\t\t\t\t\t{selector : 'img', styles : {display : 'block', marginLeft : 'auto', marginRight : 'auto'}},\r\n\t\t\t\t\t{selector : 'table', styles : {marginLeft : 'auto', marginRight : 'auto'}}\r\n\t\t\t\t],\r\n\r\n\t\t\t\talignright : [\r\n\t\t\t\t\t{selector : 'p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li', styles : {textAlign : 'right'}},\r\n\t\t\t\t\t{selector : 'img,table', styles : {'float' : 'right'}}\r\n\t\t\t\t],\r\n\r\n\t\t\t\talignfull : [\r\n\t\t\t\t\t{selector : 'p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li', styles : {textAlign : 'justify'}}\r\n\t\t\t\t],\r\n\r\n\t\t\t\tbold : [\r\n\t\t\t\t\t{inline : 'strong'},\r\n\t\t\t\t\t{inline : 'span', styles : {fontWeight : 'bold'}},\r\n\t\t\t\t\t{inline : 'b'}\r\n\t\t\t\t],\r\n\r\n\t\t\t\titalic : [\r\n\t\t\t\t\t{inline : 'em'},\r\n\t\t\t\t\t{inline : 'span', styles : {fontStyle : 'italic'}},\r\n\t\t\t\t\t{inline : 'i'}\r\n\t\t\t\t],\r\n\r\n\t\t\t\tunderline : [\r\n\t\t\t\t\t{inline : 'span', styles : {textDecoration : 'underline'}, exact : true},\r\n\t\t\t\t\t{inline : 'u'}\r\n\t\t\t\t],\r\n\r\n\t\t\t\tstrikethrough : [\r\n\t\t\t\t\t{inline : 'span', styles : {textDecoration : 'line-through'}, exact : true},\r\n\t\t\t\t\t{inline : 'u'}\r\n\t\t\t\t],\r\n\r\n\t\t\t\tforecolor : {inline : 'span', styles : {color : '%value'}},\r\n\t\t\t\thilitecolor : {inline : 'span', styles : {backgroundColor : '%value'}},\r\n\t\t\t\tfontname : {inline : 'span', styles : {fontFamily : '%value'}},\r\n\t\t\t\tfontsize : {inline : 'span', styles : {fontSize : '%value'}},\r\n\t\t\t\tfontsize_class : {inline : 'span', attributes : {'class' : '%value'}},\r\n\t\t\t\tblockquote : {block : 'blockquote', wrapper : 1, remove : 'all'},\r\n\r\n\t\t\t\tremoveformat : [\r\n\t\t\t\t\t{selector : 'b,strong,em,i,font,u,strike', remove : 'all', split : true, expand : false, block_expand : true, deep : true},\r\n\t\t\t\t\t{selector : 'span', attributes : ['style', 'class'], remove : 'empty', split : true, expand : false, deep : true},\r\n\t\t\t\t\t{selector : '*', attributes : ['style', 'class'], split : false, expand : false, deep : true}\r\n\t\t\t\t]\r\n\t\t\t});\r\n\r\n\t\t\t// Register default block formats\r\n\t\t\teach('p h1 h2 h3 h4 h5 h6 div address pre div code dt dd samp'.split(/\\s/), function(name) {\r\n\t\t\t\tt.formatter.register(name, {block : name, remove : 'all'});\r\n\t\t\t});\r\n\r\n\t\t\t// Register user defined formats\r\n\t\t\tt.formatter.register(t.settings.formats);\r\n\r\n\t\t\tt.undoManager = new tinymce.UndoManager(t);\r\n\r\n\t\t\t// Pass through\r\n\t\t\tt.undoManager.onAdd.add(function(um, l) {\r\n\t\t\t\tif (!l.initial)\r\n\t\t\t\t\treturn t.onChange.dispatch(t, l, um);\r\n\t\t\t});\r\n\r\n\t\t\tt.undoManager.onUndo.add(function(um, l) {\r\n\t\t\t\treturn t.onUndo.dispatch(t, l, um);\r\n\t\t\t});\r\n\r\n\t\t\tt.undoManager.onRedo.add(function(um, l) {\r\n\t\t\t\treturn t.onRedo.dispatch(t, l, um);\r\n\t\t\t});\r\n\r\n\t\t\tt.forceBlocks = new tinymce.ForceBlocks(t, {\r\n\t\t\t\tforced_root_block : s.forced_root_block\r\n\t\t\t});\r\n\r\n\t\t\tt.editorCommands = new tinymce.EditorCommands(t);\r\n\r\n\t\t\t// Pass through\r\n\t\t\tt.serializer.onPreProcess.add(function(se, o) {\r\n\t\t\t\treturn t.onPreProcess.dispatch(t, o, se);\r\n\t\t\t});\r\n\r\n\t\t\tt.serializer.onPostProcess.add(function(se, o) {\r\n\t\t\t\treturn t.onPostProcess.dispatch(t, o, se);\r\n\t\t\t});\r\n\r\n\t\t\tt.onPreInit.dispatch(t);\r\n\r\n\t\t\tif (!s.gecko_spellcheck)\r\n\t\t\t\tt.getBody().spellcheck = 0;\r\n\r\n\t\t\tif (!s.readonly)\r\n\t\t\t\tt._addEvents();\r\n\r\n\t\t\tt.controlManager.onPostRender.dispatch(t, t.controlManager);\r\n\t\t\tt.onPostRender.dispatch(t);\r\n\r\n\t\t\tif (s.directionality)\r\n\t\t\t\tt.getBody().dir = s.directionality;\r\n\r\n\t\t\tif (s.nowrap)\r\n\t\t\t\tt.getBody().style.whiteSpace = \"nowrap\";\r\n\r\n\t\t\tif (s.custom_elements) {\r\n\t\t\t\tfunction handleCustom(ed, o) {\r\n\t\t\t\t\teach(explode(s.custom_elements), function(v) {\r\n\t\t\t\t\t\tvar n;\r\n\r\n\t\t\t\t\t\tif (v.indexOf('~') === 0) {\r\n\t\t\t\t\t\t\tv = v.substring(1);\r\n\t\t\t\t\t\t\tn = 'span';\r\n\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\tn = 'div';\r\n\r\n\t\t\t\t\t\to.content = o.content.replace(new RegExp('<(' + v + ')([^>]*)>', 'g'), '<' + n + ' _mce_name=\"$1\"$2>');\r\n\t\t\t\t\t\to.content = o.content.replace(new RegExp('</(' + v + ')>', 'g'), '</' + n + '>');\r\n\t\t\t\t\t});\r\n\t\t\t\t};\r\n\r\n\t\t\t\tt.onBeforeSetContent.add(handleCustom);\r\n\t\t\t\tt.onPostProcess.add(function(ed, o) {\r\n\t\t\t\t\tif (o.set)\r\n\t\t\t\t\t\thandleCustom(ed, o);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (s.handle_node_change_callback) {\r\n\t\t\t\tt.onNodeChange.add(function(ed, cm, n) {\r\n\t\t\t\t\tt.execCallback('handle_node_change_callback', t.id, n, -1, -1, true, t.selection.isCollapsed());\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (s.save_callback) {\r\n\t\t\t\tt.onSaveContent.add(function(ed, o) {\r\n\t\t\t\t\tvar h = t.execCallback('save_callback', t.id, o.content, t.getBody());\r\n\r\n\t\t\t\t\tif (h)\r\n\t\t\t\t\t\to.content = h;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (s.onchange_callback) {\r\n\t\t\t\tt.onChange.add(function(ed, l) {\r\n\t\t\t\t\tt.execCallback('onchange_callback', t, l);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (s.convert_newlines_to_brs) {\r\n\t\t\t\tt.onBeforeSetContent.add(function(ed, o) {\r\n\t\t\t\t\tif (o.initial)\r\n\t\t\t\t\t\to.content = o.content.replace(/\\r?\\n/g, '<br />');\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (s.fix_nesting && isIE) {\r\n\t\t\t\tt.onBeforeSetContent.add(function(ed, o) {\r\n\t\t\t\t\to.content = t._fixNesting(o.content);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (s.preformatted) {\r\n\t\t\t\tt.onPostProcess.add(function(ed, o) {\r\n\t\t\t\t\to.content = o.content.replace(/^\\s*<pre.*?>/, '');\r\n\t\t\t\t\to.content = o.content.replace(/<\\/pre>\\s*$/, '');\r\n\r\n\t\t\t\t\tif (o.set)\r\n\t\t\t\t\t\to.content = '<pre class=\"mceItemHidden\">' + o.content + '</pre>';\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (s.verify_css_classes) {\r\n\t\t\t\tt.serializer.attribValueFilter = function(n, v) {\r\n\t\t\t\t\tvar s, cl;\r\n\r\n\t\t\t\t\tif (n == 'class') {\r\n\t\t\t\t\t\t// Build regexp for classes\r\n\t\t\t\t\t\tif (!t.classesRE) {\r\n\t\t\t\t\t\t\tcl = t.dom.getClasses();\r\n\r\n\t\t\t\t\t\t\tif (cl.length > 0) {\r\n\t\t\t\t\t\t\t\ts = '';\r\n\r\n\t\t\t\t\t\t\t\teach (cl, function(o) {\r\n\t\t\t\t\t\t\t\t\ts += (s ? '|' : '') + o['class'];\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\tt.classesRE = new RegExp('(' + s + ')', 'gi');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn !t.classesRE || /(\\bmceItem\\w+\\b|\\bmceTemp\\w+\\b)/g.test(v) || t.classesRE.test(v) ? v : '';\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn v;\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tif (s.cleanup_callback) {\r\n\t\t\t\tt.onBeforeSetContent.add(function(ed, o) {\r\n\t\t\t\t\to.content = t.execCallback('cleanup_callback', 'insert_to_editor', o.content, o);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tt.onPreProcess.add(function(ed, o) {\r\n\t\t\t\t\tif (o.set)\r\n\t\t\t\t\t\tt.execCallback('cleanup_callback', 'insert_to_editor_dom', o.node, o);\r\n\r\n\t\t\t\t\tif (o.get)\r\n\t\t\t\t\t\tt.execCallback('cleanup_callback', 'get_from_editor_dom', o.node, o);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tt.onPostProcess.add(function(ed, o) {\r\n\t\t\t\t\tif (o.set)\r\n\t\t\t\t\t\to.content = t.execCallback('cleanup_callback', 'insert_to_editor', o.content, o);\r\n\r\n\t\t\t\t\tif (o.get)\t\t\t\t\t\t\r\n\t\t\t\t\t\to.content = t.execCallback('cleanup_callback', 'get_from_editor', o.content, o);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (s.save_callback) {\r\n\t\t\t\tt.onGetContent.add(function(ed, o) {\r\n\t\t\t\t\tif (o.save)\r\n\t\t\t\t\t\to.content = t.execCallback('save_callback', t.id, o.content, t.getBody());\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (s.handle_event_callback) {\r\n\t\t\t\tt.onEvent.add(function(ed, e, o) {\r\n\t\t\t\t\tif (t.execCallback('handle_event_callback', e, ed, o) === false)\r\n\t\t\t\t\t\tEvent.cancel(e);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Add visual aids when new contents is added\r\n\t\t\tt.onSetContent.add(function() {\r\n\t\t\t\tt.addVisual(t.getBody());\r\n\t\t\t});\r\n\r\n\t\t\t// Remove empty contents\r\n\t\t\tif (s.padd_empty_editor) {\r\n\t\t\t\tt.onPostProcess.add(function(ed, o) {\r\n\t\t\t\t\to.content = o.content.replace(/^(<p[^>]*>(&nbsp;|&#160;|\\s|\\u00a0|)<\\/p>[\\r\\n]*|<br \\/>[\\r\\n]*)$/, '');\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (isGecko) {\r\n\t\t\t\t// Fix gecko link bug, when a link is placed at the end of block elements there is\r\n\t\t\t\t// no way to move the caret behind the link. This fix adds a bogus br element after the link\r\n\t\t\t\tfunction fixLinks(ed, o) {\r\n\t\t\t\t\teach(ed.dom.select('a'), function(n) {\r\n\t\t\t\t\t\tvar pn = n.parentNode;\r\n\r\n\t\t\t\t\t\tif (ed.dom.isBlock(pn) && pn.lastChild === n)\r\n\t\t\t\t\t\t\ted.dom.add(pn, 'br', {'_mce_bogus' : 1});\r\n\t\t\t\t\t});\r\n\t\t\t\t};\r\n\r\n\t\t\t\tt.onExecCommand.add(function(ed, cmd) {\r\n\t\t\t\t\tif (cmd === 'CreateLink')\r\n\t\t\t\t\t\tfixLinks(ed);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tt.onSetContent.add(t.selection.onSetContent.add(fixLinks));\r\n\r\n\t\t\t\tif (!s.readonly) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\t// Design mode must be set here once again to fix a bug where\r\n\t\t\t\t\t\t// Ctrl+A/Delete/Backspace didn't work if the editor was added using mceAddControl then removed then added again\r\n\t\t\t\t\t\td.designMode = 'Off';\r\n\t\t\t\t\t\td.designMode = 'On';\r\n\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t// Will fail on Gecko if the editor is placed in an hidden container element\r\n\t\t\t\t\t\t// The design mode will be set ones the editor is focused\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// A small timeout was needed since firefox will remove. Bug: #1838304\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\tif (t.removed)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tt.load({initial : true, format : (s.cleanup_on_startup ? 'html' : 'raw')});\r\n\t\t\t\tt.startContent = t.getContent({format : 'raw'});\r\n\t\t\t\tt.initialized = true;\r\n\r\n\t\t\t\tt.onInit.dispatch(t);\r\n\t\t\t\tt.execCallback('setupcontent_callback', t.id, t.getBody(), t.getDoc());\r\n\t\t\t\tt.execCallback('init_instance_callback', t);\r\n\t\t\t\tt.focus(true);\r\n\t\t\t\tt.nodeChanged({initial : 1});\r\n\r\n\t\t\t\t// Load specified content CSS last\r\n\t\t\t\tif (s.content_css) {\r\n\t\t\t\t\ttinymce.each(explode(s.content_css), function(u) {\r\n\t\t\t\t\t\tt.dom.loadCSS(t.documentBaseURI.toAbsolute(u));\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Handle auto focus\r\n\t\t\t\tif (s.auto_focus) {\r\n\t\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\t\tvar ed = tinymce.get(s.auto_focus);\r\n\r\n\t\t\t\t\t\ted.selection.select(ed.getBody(), 1);\r\n\t\t\t\t\t\ted.selection.collapse(1);\r\n\t\t\t\t\t\ted.getWin().focus();\r\n\t\t\t\t\t}, 100);\r\n\t\t\t\t}\r\n\t\t\t}, 1);\r\n\t\r\n\t\t\te = null;\r\n\t\t},\r\n\r\n\r\n\t\tfocus : function(sf) {\r\n\t\t\tvar oed, t = this, ce = t.settings.content_editable, ieRng, controlElm, doc = t.getDoc();\r\n\r\n\t\t\tif (!sf) {\r\n\t\t\t\t// Get selected control element\r\n\t\t\t\tieRng = t.selection.getRng();\r\n\t\t\t\tif (ieRng.item) {\r\n\t\t\t\t\tcontrolElm = ieRng.item(0);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Is not content editable\r\n\t\t\t\tif (!ce)\r\n\t\t\t\t\tt.getWin().focus();\r\n\r\n\t\t\t\t// Restore selected control element\r\n\t\t\t\t// This is needed when for example an image is selected within a\r\n\t\t\t\t// layer a call to focus will then remove the control selection\r\n\t\t\t\tif (controlElm && controlElm.ownerDocument == doc) {\r\n\t\t\t\t\tieRng = doc.body.createControlRange();\r\n\t\t\t\t\tieRng.addElement(controlElm);\r\n\t\t\t\t\tieRng.select();\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif (tinymce.activeEditor != t) {\r\n\t\t\t\tif ((oed = tinymce.activeEditor) != null)\r\n\t\t\t\t\toed.onDeactivate.dispatch(oed, t);\r\n\r\n\t\t\t\tt.onActivate.dispatch(t, oed);\r\n\t\t\t}\r\n\r\n\t\t\ttinymce._setActive(t);\r\n\t\t},\r\n\r\n\t\texecCallback : function(n) {\r\n\t\t\tvar t = this, f = t.settings[n], s;\r\n\r\n\t\t\tif (!f)\r\n\t\t\t\treturn;\r\n\r\n\t\t\t// Look through lookup\r\n\t\t\tif (t.callbackLookup && (s = t.callbackLookup[n])) {\r\n\t\t\t\tf = s.func;\r\n\t\t\t\ts = s.scope;\r\n\t\t\t}\r\n\r\n\t\t\tif (is(f, 'string')) {\r\n\t\t\t\ts = f.replace(/\\.\\w+$/, '');\r\n\t\t\t\ts = s ? tinymce.resolve(s) : 0;\r\n\t\t\t\tf = tinymce.resolve(f);\r\n\t\t\t\tt.callbackLookup = t.callbackLookup || {};\r\n\t\t\t\tt.callbackLookup[n] = {func : f, scope : s};\r\n\t\t\t}\r\n\r\n\t\t\treturn f.apply(s || t, Array.prototype.slice.call(arguments, 1));\r\n\t\t},\r\n\r\n\t\ttranslate : function(s) {\r\n\t\t\tvar c = this.settings.language || 'en', i18n = tinymce.i18n;\r\n\r\n\t\t\tif (!s)\r\n\t\t\t\treturn '';\r\n\r\n\t\t\treturn i18n[c + '.' + s] || s.replace(/{\\#([^}]+)\\}/g, function(a, b) {\r\n\t\t\t\treturn i18n[c + '.' + b] || '{#' + b + '}';\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tgetLang : function(n, dv) {\r\n\t\t\treturn tinymce.i18n[(this.settings.language || 'en') + '.' + n] || (is(dv) ? dv : '{#' + n + '}');\r\n\t\t},\r\n\r\n\t\tgetParam : function(n, dv, ty) {\r\n\t\t\tvar tr = tinymce.trim, v = is(this.settings[n]) ? this.settings[n] : dv, o;\r\n\r\n\t\t\tif (ty === 'hash') {\r\n\t\t\t\to = {};\r\n\r\n\t\t\t\tif (is(v, 'string')) {\r\n\t\t\t\t\teach(v.indexOf('=') > 0 ? v.split(/[;,](?![^=;,]*(?:[;,]|$))/) : v.split(','), function(v) {\r\n\t\t\t\t\t\tv = v.split('=');\r\n\r\n\t\t\t\t\t\tif (v.length > 1)\r\n\t\t\t\t\t\t\to[tr(v[0])] = tr(v[1]);\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\to[tr(v[0])] = tr(v);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else\r\n\t\t\t\t\to = v;\r\n\r\n\t\t\t\treturn o;\r\n\t\t\t}\r\n\r\n\t\t\treturn v;\r\n\t\t},\r\n\r\n\t\tnodeChanged : function(o) {\r\n\t\t\tvar t = this, s = t.selection, n = (isIE ? s.getNode() : s.getStart()) || t.getBody();\r\n\r\n\t\t\t// Fix for bug #1896577 it seems that this can not be fired while the editor is loading\r\n\t\t\tif (t.initialized) {\r\n\t\t\t\to = o || {};\r\n\t\t\t\tn = isIE && n.ownerDocument != t.getDoc() ? t.getBody() : n; // Fix for IE initial state\r\n\r\n\t\t\t\t// Get parents and add them to object\r\n\t\t\t\to.parents = [];\r\n\t\t\t\tt.dom.getParent(n, function(node) {\r\n\t\t\t\t\tif (node.nodeName == 'BODY')\r\n\t\t\t\t\t\treturn true;\r\n\r\n\t\t\t\t\to.parents.push(node);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tt.onNodeChange.dispatch(\r\n\t\t\t\t\tt,\r\n\t\t\t\t\to ? o.controlManager || t.controlManager : t.controlManager,\r\n\t\t\t\t\tn,\r\n\t\t\t\t\ts.isCollapsed(),\r\n\t\t\t\t\to\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\taddButton : function(n, s) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tt.buttons = t.buttons || {};\r\n\t\t\tt.buttons[n] = s;\r\n\t\t},\r\n\r\n\t\taddCommand : function(n, f, s) {\r\n\t\t\tthis.execCommands[n] = {func : f, scope : s || this};\r\n\t\t},\r\n\r\n\t\taddQueryStateHandler : function(n, f, s) {\r\n\t\t\tthis.queryStateCommands[n] = {func : f, scope : s || this};\r\n\t\t},\r\n\r\n\t\taddQueryValueHandler : function(n, f, s) {\r\n\t\t\tthis.queryValueCommands[n] = {func : f, scope : s || this};\r\n\t\t},\r\n\r\n\t\taddShortcut : function(pa, desc, cmd_func, sc) {\r\n\t\t\tvar t = this, c;\r\n\r\n\t\t\tif (!t.settings.custom_shortcuts)\r\n\t\t\t\treturn false;\r\n\r\n\t\t\tt.shortcuts = t.shortcuts || {};\r\n\r\n\t\t\tif (is(cmd_func, 'string')) {\r\n\t\t\t\tc = cmd_func;\r\n\r\n\t\t\t\tcmd_func = function() {\r\n\t\t\t\t\tt.execCommand(c, false, null);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tif (is(cmd_func, 'object')) {\r\n\t\t\t\tc = cmd_func;\r\n\r\n\t\t\t\tcmd_func = function() {\r\n\t\t\t\t\tt.execCommand(c[0], c[1], c[2]);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\teach(explode(pa), function(pa) {\r\n\t\t\t\tvar o = {\r\n\t\t\t\t\tfunc : cmd_func,\r\n\t\t\t\t\tscope : sc || this,\r\n\t\t\t\t\tdesc : desc,\r\n\t\t\t\t\talt : false,\r\n\t\t\t\t\tctrl : false,\r\n\t\t\t\t\tshift : false\r\n\t\t\t\t};\r\n\r\n\t\t\t\teach(explode(pa, '+'), function(v) {\r\n\t\t\t\t\tswitch (v) {\r\n\t\t\t\t\t\tcase 'alt':\r\n\t\t\t\t\t\tcase 'ctrl':\r\n\t\t\t\t\t\tcase 'shift':\r\n\t\t\t\t\t\t\to[v] = true;\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\to.charCode = v.charCodeAt(0);\r\n\t\t\t\t\t\t\to.keyCode = v.toUpperCase().charCodeAt(0);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tt.shortcuts[(o.ctrl ? 'ctrl' : '') + ',' + (o.alt ? 'alt' : '') + ',' + (o.shift ? 'shift' : '') + ',' + o.keyCode] = o;\r\n\t\t\t});\r\n\r\n\t\t\treturn true;\r\n\t\t},\r\n\r\n\t\texecCommand : function(cmd, ui, val, a) {\r\n\t\t\tvar t = this, s = 0, o, st;\r\n\r\n\t\t\tif (!/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint|SelectAll)$/.test(cmd) && (!a || !a.skip_focus))\r\n\t\t\t\tt.focus();\r\n\r\n\t\t\to = {};\r\n\t\t\tt.onBeforeExecCommand.dispatch(t, cmd, ui, val, o);\r\n\t\t\tif (o.terminate)\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t// Command callback\r\n\t\t\tif (t.execCallback('execcommand_callback', t.id, t.selection.getNode(), cmd, ui, val)) {\r\n\t\t\t\tt.onExecCommand.dispatch(t, cmd, ui, val, a);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\t// Registred commands\r\n\t\t\tif (o = t.execCommands[cmd]) {\r\n\t\t\t\tst = o.func.call(o.scope, ui, val);\r\n\r\n\t\t\t\t// Fall through on true\r\n\t\t\t\tif (st !== true) {\r\n\t\t\t\t\tt.onExecCommand.dispatch(t, cmd, ui, val, a);\r\n\t\t\t\t\treturn st;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Plugin commands\r\n\t\t\teach(t.plugins, function(p) {\r\n\t\t\t\tif (p.execCommand && p.execCommand(cmd, ui, val)) {\r\n\t\t\t\t\tt.onExecCommand.dispatch(t, cmd, ui, val, a);\r\n\t\t\t\t\ts = 1;\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (s)\r\n\t\t\t\treturn true;\r\n\r\n\t\t\t// Theme commands\r\n\t\t\tif (t.theme && t.theme.execCommand && t.theme.execCommand(cmd, ui, val)) {\r\n\t\t\t\tt.onExecCommand.dispatch(t, cmd, ui, val, a);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\t// Execute global commands\r\n\t\t\tif (tinymce.GlobalCommands.execCommand(t, cmd, ui, val)) {\r\n\t\t\t\tt.onExecCommand.dispatch(t, cmd, ui, val, a);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\t// Editor commands\r\n\t\t\tif (t.editorCommands.execCommand(cmd, ui, val)) {\r\n\t\t\t\tt.onExecCommand.dispatch(t, cmd, ui, val, a);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\t// Browser commands\r\n\t\t\tt.getDoc().execCommand(cmd, ui, val);\r\n\t\t\tt.onExecCommand.dispatch(t, cmd, ui, val, a);\r\n\t\t},\r\n\r\n\t\tqueryCommandState : function(cmd) {\r\n\t\t\tvar t = this, o, s;\r\n\r\n\t\t\t// Is hidden then return undefined\r\n\t\t\tif (t._isHidden())\r\n\t\t\t\treturn;\r\n\r\n\t\t\t// Registred commands\r\n\t\t\tif (o = t.queryStateCommands[cmd]) {\r\n\t\t\t\ts = o.func.call(o.scope);\r\n\r\n\t\t\t\t// Fall though on true\r\n\t\t\t\tif (s !== true)\r\n\t\t\t\t\treturn s;\r\n\t\t\t}\r\n\r\n\t\t\t// Registred commands\r\n\t\t\to = t.editorCommands.queryCommandState(cmd);\r\n\t\t\tif (o !== -1)\r\n\t\t\t\treturn o;\r\n\r\n\t\t\t// Browser commands\r\n\t\t\ttry {\r\n\t\t\t\treturn this.getDoc().queryCommandState(cmd);\r\n\t\t\t} catch (ex) {\r\n\t\t\t\t// Fails sometimes see bug: 1896577\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tqueryCommandValue : function(c) {\r\n\t\t\tvar t = this, o, s;\r\n\r\n\t\t\t// Is hidden then return undefined\r\n\t\t\tif (t._isHidden())\r\n\t\t\t\treturn;\r\n\r\n\t\t\t// Registred commands\r\n\t\t\tif (o = t.queryValueCommands[c]) {\r\n\t\t\t\ts = o.func.call(o.scope);\r\n\r\n\t\t\t\t// Fall though on true\r\n\t\t\t\tif (s !== true)\r\n\t\t\t\t\treturn s;\r\n\t\t\t}\r\n\r\n\t\t\t// Registred commands\r\n\t\t\to = t.editorCommands.queryCommandValue(c);\r\n\t\t\tif (is(o))\r\n\t\t\t\treturn o;\r\n\r\n\t\t\t// Browser commands\r\n\t\t\ttry {\r\n\t\t\t\treturn this.getDoc().queryCommandValue(c);\r\n\t\t\t} catch (ex) {\r\n\t\t\t\t// Fails sometimes see bug: 1896577\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tshow : function() {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tDOM.show(t.getContainer());\r\n\t\t\tDOM.hide(t.id);\r\n\t\t\tt.load();\r\n\t\t},\r\n\r\n\t\thide : function() {\r\n\t\t\tvar t = this, d = t.getDoc();\r\n\r\n\t\t\t// Fixed bug where IE has a blinking cursor left from the editor\r\n\t\t\tif (isIE && d)\r\n\t\t\t\td.execCommand('SelectAll');\r\n\r\n\t\t\t// We must save before we hide so Safari doesn't crash\r\n\t\t\tt.save();\r\n\t\t\tDOM.hide(t.getContainer());\r\n\t\t\tDOM.setStyle(t.id, 'display', t.orgDisplay);\r\n\t\t},\r\n\r\n\t\tisHidden : function() {\r\n\t\t\treturn !DOM.isHidden(this.id);\r\n\t\t},\r\n\r\n\t\tsetProgressState : function(b, ti, o) {\r\n\t\t\tthis.onSetProgressState.dispatch(this, b, ti, o);\r\n\r\n\t\t\treturn b;\r\n\t\t},\r\n\r\n\t\tload : function(o) {\r\n\t\t\tvar t = this, e = t.getElement(), h;\r\n\r\n\t\t\tif (e) {\r\n\t\t\t\to = o || {};\r\n\t\t\t\to.load = true;\r\n\r\n\t\t\t\t// Double encode existing entities in the value\r\n\t\t\t\th = t.setContent(is(e.value) ? e.value : e.innerHTML, o);\r\n\t\t\t\to.element = e;\r\n\r\n\t\t\t\tif (!o.no_events)\r\n\t\t\t\t\tt.onLoadContent.dispatch(t, o);\r\n\r\n\t\t\t\to.element = e = null;\r\n\r\n\t\t\t\treturn h;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tsave : function(o) {\r\n\t\t\tvar t = this, e = t.getElement(), h, f;\r\n\r\n\t\t\tif (!e || !t.initialized)\r\n\t\t\t\treturn;\r\n\r\n\t\t\to = o || {};\r\n\t\t\to.save = true;\r\n\r\n\t\t\t// Add undo level will trigger onchange event\r\n\t\t\tif (!o.no_events) {\r\n\t\t\t\tt.undoManager.typing = 0;\r\n\t\t\t\tt.undoManager.add();\r\n\t\t\t}\r\n\r\n\t\t\to.element = e;\r\n\t\t\th = o.content = t.getContent(o);\r\n\r\n\t\t\tif (!o.no_events)\r\n\t\t\t\tt.onSaveContent.dispatch(t, o);\r\n\r\n\t\t\th = o.content;\r\n\r\n\t\t\tif (!/TEXTAREA|INPUT/i.test(e.nodeName)) {\r\n\t\t\t\te.innerHTML = h;\r\n\r\n\t\t\t\t// Update hidden form element\r\n\t\t\t\tif (f = DOM.getParent(t.id, 'form')) {\r\n\t\t\t\t\teach(f.elements, function(e) {\r\n\t\t\t\t\t\tif (e.name == t.id) {\r\n\t\t\t\t\t\t\te.value = h;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t} else\r\n\t\t\t\te.value = h;\r\n\r\n\t\t\to.element = e = null;\r\n\r\n\t\t\treturn h;\r\n\t\t},\r\n\r\n\t\tsetContent : function(h, o) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\to = o || {};\r\n\t\t\to.format = o.format || 'html';\r\n\t\t\to.set = true;\r\n\t\t\to.content = h;\r\n\r\n\t\t\tif (!o.no_events)\r\n\t\t\t\tt.onBeforeSetContent.dispatch(t, o);\r\n\r\n\t\t\t// Padd empty content in Gecko and Safari. Commands will otherwise fail on the content\r\n\t\t\t// It will also be impossible to place the caret in the editor unless there is a BR element present\r\n\t\t\tif (!tinymce.isIE && (h.length === 0 || /^\\s+$/.test(h))) {\r\n\t\t\t\to.content = t.dom.setHTML(t.getBody(), '<br _mce_bogus=\"1\" />');\r\n\t\t\t\to.format = 'raw';\r\n\t\t\t}\r\n\r\n\t\t\to.content = t.dom.setHTML(t.getBody(), tinymce.trim(o.content));\r\n\r\n\t\t\tif (o.format != 'raw' && t.settings.cleanup) {\r\n\t\t\t\to.getInner = true;\r\n\t\t\t\to.content = t.dom.setHTML(t.getBody(), t.serializer.serialize(t.getBody(), o));\r\n\t\t\t}\r\n\r\n\t\t\tif (!o.no_events)\r\n\t\t\t\tt.onSetContent.dispatch(t, o);\r\n\r\n\t\t\treturn o.content;\r\n\t\t},\r\n\r\n\t\tgetContent : function(o) {\r\n\t\t\tvar t = this, h;\r\n\r\n\t\t\to = o || {};\r\n\t\t\to.format = o.format || 'html';\r\n\t\t\to.get = true;\r\n\r\n\t\t\tif (!o.no_events)\r\n\t\t\t\tt.onBeforeGetContent.dispatch(t, o);\r\n\r\n\t\t\tif (o.format != 'raw' && t.settings.cleanup) {\r\n\t\t\t\to.getInner = true;\r\n\t\t\t\th = t.serializer.serialize(t.getBody(), o);\r\n\t\t\t} else\r\n\t\t\t\th = t.getBody().innerHTML;\r\n\r\n\t\t\th = h.replace(/^\\s*|\\s*$/g, '');\r\n\t\t\to.content = h;\r\n\r\n\t\t\tif (!o.no_events)\r\n\t\t\t\tt.onGetContent.dispatch(t, o);\r\n\r\n\t\t\treturn o.content;\r\n\t\t},\r\n\r\n\t\tisDirty : function() {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\treturn tinymce.trim(t.startContent) != tinymce.trim(t.getContent({format : 'raw', no_events : 1})) && !t.isNotDirty;\r\n\t\t},\r\n\r\n\t\tgetContainer : function() {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tif (!t.container)\r\n\t\t\t\tt.container = DOM.get(t.editorContainer || t.id + '_parent');\r\n\r\n\t\t\treturn t.container;\r\n\t\t},\r\n\r\n\t\tgetContentAreaContainer : function() {\r\n\t\t\treturn this.contentAreaContainer;\r\n\t\t},\r\n\r\n\t\tgetElement : function() {\r\n\t\t\treturn DOM.get(this.settings.content_element || this.id);\r\n\t\t},\r\n\r\n\t\tgetWin : function() {\r\n\t\t\tvar t = this, e;\r\n\r\n\t\t\tif (!t.contentWindow) {\r\n\t\t\t\te = DOM.get(t.id + \"_ifr\");\r\n\r\n\t\t\t\tif (e)\r\n\t\t\t\t\tt.contentWindow = e.contentWindow;\r\n\t\t\t}\r\n\r\n\t\t\treturn t.contentWindow;\r\n\t\t},\r\n\r\n\t\tgetDoc : function() {\r\n\t\t\tvar t = this, w;\r\n\r\n\t\t\tif (!t.contentDocument) {\r\n\t\t\t\tw = t.getWin();\r\n\r\n\t\t\t\tif (w)\r\n\t\t\t\t\tt.contentDocument = w.document;\r\n\t\t\t}\r\n\r\n\t\t\treturn t.contentDocument;\r\n\t\t},\r\n\r\n\t\tgetBody : function() {\r\n\t\t\treturn this.bodyElement || this.getDoc().body;\r\n\t\t},\r\n\r\n\t\tconvertURL : function(u, n, e) {\r\n\t\t\tvar t = this, s = t.settings;\r\n\r\n\t\t\t// Use callback instead\r\n\t\t\tif (s.urlconverter_callback)\r\n\t\t\t\treturn t.execCallback('urlconverter_callback', u, e, true, n);\r\n\r\n\t\t\t// Don't convert link href since thats the CSS files that gets loaded into the editor also skip local file URLs\r\n\t\t\tif (!s.convert_urls || (e && e.nodeName == 'LINK') || u.indexOf('file:') === 0)\r\n\t\t\t\treturn u;\r\n\r\n\t\t\t// Convert to relative\r\n\t\t\tif (s.relative_urls)\r\n\t\t\t\treturn t.documentBaseURI.toRelative(u);\r\n\r\n\t\t\t// Convert to absolute\r\n\t\t\tu = t.documentBaseURI.toAbsolute(u, s.remove_script_host);\r\n\r\n\t\t\treturn u;\r\n\t\t},\r\n\r\n\t\taddVisual : function(e) {\r\n\t\t\tvar t = this, s = t.settings;\r\n\r\n\t\t\te = e || t.getBody();\r\n\r\n\t\t\tif (!is(t.hasVisual))\r\n\t\t\t\tt.hasVisual = s.visual;\r\n\r\n\t\t\teach(t.dom.select('table,a', e), function(e) {\r\n\t\t\t\tvar v;\r\n\r\n\t\t\t\tswitch (e.nodeName) {\r\n\t\t\t\t\tcase 'TABLE':\r\n\t\t\t\t\t\tv = t.dom.getAttrib(e, 'border');\r\n\r\n\t\t\t\t\t\tif (!v || v == '0') {\r\n\t\t\t\t\t\t\tif (t.hasVisual)\r\n\t\t\t\t\t\t\t\tt.dom.addClass(e, s.visual_table_class);\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tt.dom.removeClass(e, s.visual_table_class);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tcase 'A':\r\n\t\t\t\t\t\tv = t.dom.getAttrib(e, 'name');\r\n\r\n\t\t\t\t\t\tif (v) {\r\n\t\t\t\t\t\t\tif (t.hasVisual)\r\n\t\t\t\t\t\t\t\tt.dom.addClass(e, 'mceItemAnchor');\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tt.dom.removeClass(e, 'mceItemAnchor');\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tt.onVisualAid.dispatch(t, e, t.hasVisual);\r\n\t\t},\r\n\r\n\t\tremove : function() {\r\n\t\t\tvar t = this, e = t.getContainer();\r\n\r\n\t\t\tt.removed = 1; // Cancels post remove event execution\r\n\t\t\tt.hide();\r\n\r\n\t\t\tt.execCallback('remove_instance_callback', t);\r\n\t\t\tt.onRemove.dispatch(t);\r\n\r\n\t\t\t// Clear all execCommand listeners this is required to avoid errors if the editor was removed inside another command\r\n\t\t\tt.onExecCommand.listeners = [];\r\n\r\n\t\t\ttinymce.remove(t);\r\n\t\t\tDOM.remove(e);\r\n\t\t},\r\n\r\n\t\tdestroy : function(s) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\t// One time is enough\r\n\t\t\tif (t.destroyed)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (!s) {\r\n\t\t\t\ttinymce.removeUnload(t.destroy);\r\n\t\t\t\ttinyMCE.onBeforeUnload.remove(t._beforeUnload);\r\n\r\n\t\t\t\t// Manual destroy\r\n\t\t\t\tif (t.theme && t.theme.destroy)\r\n\t\t\t\t\tt.theme.destroy();\r\n\r\n\t\t\t\t// Destroy controls, selection and dom\r\n\t\t\t\tt.controlManager.destroy();\r\n\t\t\t\tt.selection.destroy();\r\n\t\t\t\tt.dom.destroy();\r\n\r\n\t\t\t\t// Remove all events\r\n\r\n\t\t\t\t// Don't clear the window or document if content editable\r\n\t\t\t\t// is enabled since other instances might still be present\r\n\t\t\t\tif (!t.settings.content_editable) {\r\n\t\t\t\t\tEvent.clear(t.getWin());\r\n\t\t\t\t\tEvent.clear(t.getDoc());\r\n\t\t\t\t}\r\n\r\n\t\t\t\tEvent.clear(t.getBody());\r\n\t\t\t\tEvent.clear(t.formElement);\r\n\t\t\t}\r\n\r\n\t\t\tif (t.formElement) {\r\n\t\t\t\tt.formElement.submit = t.formElement._mceOldSubmit;\r\n\t\t\t\tt.formElement._mceOldSubmit = null;\r\n\t\t\t}\r\n\r\n\t\t\tt.contentAreaContainer = t.formElement = t.container = t.settings.content_element = t.bodyElement = t.contentDocument = t.contentWindow = null;\r\n\r\n\t\t\tif (t.selection)\r\n\t\t\t\tt.selection = t.selection.win = t.selection.dom = t.selection.dom.doc = null;\r\n\r\n\t\t\tt.destroyed = 1;\r\n\t\t},\r\n\r\n\t\t// Internal functions\r\n\r\n\t\t_addEvents : function() {\r\n\t\t\t// 'focus', 'blur', 'dblclick', 'beforedeactivate', submit, reset\r\n\t\t\tvar t = this, i, s = t.settings, lo = {\r\n\t\t\t\tmouseup : 'onMouseUp',\r\n\t\t\t\tmousedown : 'onMouseDown',\r\n\t\t\t\tclick : 'onClick',\r\n\t\t\t\tkeyup : 'onKeyUp',\r\n\t\t\t\tkeydown : 'onKeyDown',\r\n\t\t\t\tkeypress : 'onKeyPress',\r\n\t\t\t\tsubmit : 'onSubmit',\r\n\t\t\t\treset : 'onReset',\r\n\t\t\t\tcontextmenu : 'onContextMenu',\r\n\t\t\t\tdblclick : 'onDblClick',\r\n\t\t\t\tpaste : 'onPaste' // Doesn't work in all browsers yet\r\n\t\t\t};\r\n\r\n\t\t\tfunction eventHandler(e, o) {\r\n\t\t\t\tvar ty = e.type;\r\n\r\n\t\t\t\t// Don't fire events when it's removed\r\n\t\t\t\tif (t.removed)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t// Generic event handler\r\n\t\t\t\tif (t.onEvent.dispatch(t, e, o) !== false) {\r\n\t\t\t\t\t// Specific event handler\r\n\t\t\t\t\tt[lo[e.fakeType || e.type]].dispatch(t, e, o);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t// Add DOM events\r\n\t\t\teach(lo, function(v, k) {\r\n\t\t\t\tswitch (k) {\r\n\t\t\t\t\tcase 'contextmenu':\r\n\t\t\t\t\t\tif (tinymce.isOpera) {\r\n\t\t\t\t\t\t\t// Fake contextmenu on Opera\r\n\t\t\t\t\t\t\tt.dom.bind(t.getBody(), 'mousedown', function(e) {\r\n\t\t\t\t\t\t\t\tif (e.ctrlKey) {\r\n\t\t\t\t\t\t\t\t\te.fakeType = 'contextmenu';\r\n\t\t\t\t\t\t\t\t\teventHandler(e);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\tt.dom.bind(t.getBody(), k, eventHandler);\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'paste':\r\n\t\t\t\t\t\tt.dom.bind(t.getBody(), k, function(e) {\r\n\t\t\t\t\t\t\teventHandler(e);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'submit':\r\n\t\t\t\t\tcase 'reset':\r\n\t\t\t\t\t\tt.dom.bind(t.getElement().form || DOM.getParent(t.id, 'form'), k, eventHandler);\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tt.dom.bind(s.content_editable ? t.getBody() : t.getDoc(), k, eventHandler);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tt.dom.bind(s.content_editable ? t.getBody() : (isGecko ? t.getDoc() : t.getWin()), 'focus', function(e) {\r\n\t\t\t\tt.focus(true);\r\n\t\t\t});\r\n\r\n\r\n\t\t\t// Fixes bug where a specified document_base_uri could result in broken images\r\n\t\t\t// This will also fix drag drop of images in Gecko\r\n\t\t\tif (tinymce.isGecko) {\r\n\t\t\t\t// Convert all images to absolute URLs\r\n/*\t\t\t\tt.onSetContent.add(function(ed, o) {\r\n\t\t\t\t\teach(ed.dom.select('img'), function(e) {\r\n\t\t\t\t\t\tvar v;\r\n\r\n\t\t\t\t\t\tif (v = e.getAttribute('_mce_src'))\r\n\t\t\t\t\t\t\te.src = t.documentBaseURI.toAbsolute(v);\r\n\t\t\t\t\t})\r\n\t\t\t\t});*/\r\n\r\n\t\t\t\tt.dom.bind(t.getDoc(), 'DOMNodeInserted', function(e) {\r\n\t\t\t\t\tvar v;\r\n\r\n\t\t\t\t\te = e.target;\r\n\r\n\t\t\t\t\tif (e.nodeType === 1 && e.nodeName === 'IMG' && (v = e.getAttribute('_mce_src')))\r\n\t\t\t\t\t\te.src = t.documentBaseURI.toAbsolute(v);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Set various midas options in Gecko\r\n\t\t\tif (isGecko) {\r\n\t\t\t\tfunction setOpts() {\r\n\t\t\t\t\tvar t = this, d = t.getDoc(), s = t.settings;\r\n\r\n\t\t\t\t\tif (isGecko && !s.readonly) {\r\n\t\t\t\t\t\tif (t._isHidden()) {\r\n\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\tif (!s.content_editable)\r\n\t\t\t\t\t\t\t\t\td.designMode = 'On';\r\n\t\t\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t\t\t// Fails if it's hidden\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t// Try new Gecko method\r\n\t\t\t\t\t\t\td.execCommand(\"styleWithCSS\", 0, false);\r\n\t\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t\t// Use old method\r\n\t\t\t\t\t\t\tif (!t._isHidden())\r\n\t\t\t\t\t\t\t\ttry {d.execCommand(\"useCSS\", 0, true);} catch (ex) {}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (!s.table_inline_editing)\r\n\t\t\t\t\t\t\ttry {d.execCommand('enableInlineTableEditing', false, false);} catch (ex) {}\r\n\r\n\t\t\t\t\t\tif (!s.object_resizing)\r\n\t\t\t\t\t\t\ttry {d.execCommand('enableObjectResizing', false, false);} catch (ex) {}\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\tt.onBeforeExecCommand.add(setOpts);\r\n\t\t\t\tt.onMouseDown.add(setOpts);\r\n\t\t\t}\r\n\r\n\t\t\t// Workaround for bug, http://bugs.webkit.org/show_bug.cgi?id=12250\r\n\t\t\t// WebKit can't even do simple things like selecting an image\r\n\t\t\t// This also fixes so it's possible to select mceItemAnchors\r\n\t\t\tif (tinymce.isWebKit) {\r\n\t\t\t\tt.onClick.add(function(ed, e) {\r\n\t\t\t\t\te = e.target;\r\n\r\n\t\t\t\t\t// Needs tobe the setBaseAndExtend or it will fail to select floated images\r\n\t\t\t\t\tif (e.nodeName == 'IMG' || (e.nodeName == 'A' && t.dom.hasClass(e, 'mceItemAnchor')))\r\n\t\t\t\t\t\tt.selection.getSel().setBaseAndExtent(e, 0, e, 1);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Add node change handlers\r\n\t\t\tt.onMouseUp.add(t.nodeChanged);\r\n\t\t\t//t.onClick.add(t.nodeChanged);\r\n\t\t\tt.onKeyUp.add(function(ed, e) {\r\n\t\t\t\tvar c = e.keyCode;\r\n\r\n\t\t\t\tif ((c >= 33 && c <= 36) || (c >= 37 && c <= 40) || c == 13 || c == 45 || c == 46 || c == 8 || (tinymce.isMac && (c == 91 || c == 93)) || e.ctrlKey)\r\n\t\t\t\t\tt.nodeChanged();\r\n\t\t\t});\r\n\r\n\t\t\t// Add reset handler\r\n\t\t\tt.onReset.add(function() {\r\n\t\t\t\tt.setContent(t.startContent, {format : 'raw'});\r\n\t\t\t});\r\n\r\n\t\t\t// Add shortcuts\r\n\t\t\tif (s.custom_shortcuts) {\r\n\t\t\t\tif (s.custom_undo_redo_keyboard_shortcuts) {\r\n\t\t\t\t\tt.addShortcut('ctrl+z', t.getLang('undo_desc'), 'Undo');\r\n\t\t\t\t\tt.addShortcut('ctrl+y', t.getLang('redo_desc'), 'Redo');\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Add default shortcuts for gecko\r\n\t\t\t\tt.addShortcut('ctrl+b', t.getLang('bold_desc'), 'Bold');\r\n\t\t\t\tt.addShortcut('ctrl+i', t.getLang('italic_desc'), 'Italic');\r\n\t\t\t\tt.addShortcut('ctrl+u', t.getLang('underline_desc'), 'Underline');\r\n\r\n\t\t\t\t// BlockFormat shortcuts keys\r\n\t\t\t\tfor (i=1; i<=6; i++)\r\n\t\t\t\t\tt.addShortcut('ctrl+' + i, '', ['FormatBlock', false, 'h' + i]);\r\n\r\n\t\t\t\tt.addShortcut('ctrl+7', '', ['FormatBlock', false, '<p>']);\r\n\t\t\t\tt.addShortcut('ctrl+8', '', ['FormatBlock', false, '<div>']);\r\n\t\t\t\tt.addShortcut('ctrl+9', '', ['FormatBlock', false, '<address>']);\r\n\r\n\t\t\t\tfunction find(e) {\r\n\t\t\t\t\tvar v = null;\r\n\r\n\t\t\t\t\tif (!e.altKey && !e.ctrlKey && !e.metaKey)\r\n\t\t\t\t\t\treturn v;\r\n\r\n\t\t\t\t\teach(t.shortcuts, function(o) {\r\n\t\t\t\t\t\tif (tinymce.isMac && o.ctrl != e.metaKey)\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\telse if (!tinymce.isMac && o.ctrl != e.ctrlKey)\r\n\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\tif (o.alt != e.altKey)\r\n\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\tif (o.shift != e.shiftKey)\r\n\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\tif (e.keyCode == o.keyCode || (e.charCode && e.charCode == o.charCode)) {\r\n\t\t\t\t\t\t\tv = o;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\treturn v;\r\n\t\t\t\t};\r\n\r\n\t\t\t\tt.onKeyUp.add(function(ed, e) {\r\n\t\t\t\t\tvar o = find(e);\r\n\r\n\t\t\t\t\tif (o)\r\n\t\t\t\t\t\treturn Event.cancel(e);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tt.onKeyPress.add(function(ed, e) {\r\n\t\t\t\t\tvar o = find(e);\r\n\r\n\t\t\t\t\tif (o)\r\n\t\t\t\t\t\treturn Event.cancel(e);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tt.onKeyDown.add(function(ed, e) {\r\n\t\t\t\t\tvar o = find(e);\r\n\r\n\t\t\t\t\tif (o) {\r\n\t\t\t\t\t\to.func.call(o.scope);\r\n\t\t\t\t\t\treturn Event.cancel(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (tinymce.isIE) {\r\n\t\t\t\t// Fix so resize will only update the width and height attributes not the styles of an image\r\n\t\t\t\t// It will also block mceItemNoResize items\r\n\t\t\t\tt.dom.bind(t.getDoc(), 'controlselect', function(e) {\r\n\t\t\t\t\tvar re = t.resizeInfo, cb;\r\n\r\n\t\t\t\t\te = e.target;\r\n\r\n\t\t\t\t\t// Don't do this action for non image elements\r\n\t\t\t\t\tif (e.nodeName !== 'IMG')\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tif (re)\r\n\t\t\t\t\t\tt.dom.unbind(re.node, re.ev, re.cb);\r\n\r\n\t\t\t\t\tif (!t.dom.hasClass(e, 'mceItemNoResize')) {\r\n\t\t\t\t\t\tev = 'resizeend';\r\n\t\t\t\t\t\tcb = t.dom.bind(e, ev, function(e) {\r\n\t\t\t\t\t\t\tvar v;\r\n\r\n\t\t\t\t\t\t\te = e.target;\r\n\r\n\t\t\t\t\t\t\tif (v = t.dom.getStyle(e, 'width')) {\r\n\t\t\t\t\t\t\t\tt.dom.setAttrib(e, 'width', v.replace(/[^0-9%]+/g, ''));\r\n\t\t\t\t\t\t\t\tt.dom.setStyle(e, 'width', '');\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (v = t.dom.getStyle(e, 'height')) {\r\n\t\t\t\t\t\t\t\tt.dom.setAttrib(e, 'height', v.replace(/[^0-9%]+/g, ''));\r\n\t\t\t\t\t\t\t\tt.dom.setStyle(e, 'height', '');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tev = 'resizestart';\r\n\t\t\t\t\t\tcb = t.dom.bind(e, 'resizestart', Event.cancel, Event);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tre = t.resizeInfo = {\r\n\t\t\t\t\t\tnode : e,\r\n\t\t\t\t\t\tev : ev,\r\n\t\t\t\t\t\tcb : cb\r\n\t\t\t\t\t};\r\n\t\t\t\t});\r\n\r\n\t\t\t\tt.onKeyDown.add(function(ed, e) {\r\n\t\t\t\t\tswitch (e.keyCode) {\r\n\t\t\t\t\t\tcase 8:\r\n\t\t\t\t\t\t\t// Fix IE control + backspace browser bug\r\n\t\t\t\t\t\t\tif (t.selection.getRng().item) {\r\n\t\t\t\t\t\t\t\ted.dom.remove(t.selection.getRng().item(0));\r\n\t\t\t\t\t\t\t\treturn Event.cancel(e);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t/*if (t.dom.boxModel) {\r\n\t\t\t\t\tt.getBody().style.height = '100%';\r\n\r\n\t\t\t\t\tEvent.add(t.getWin(), 'resize', function(e) {\r\n\t\t\t\t\t\tvar docElm = t.getDoc().documentElement;\r\n\r\n\t\t\t\t\t\tdocElm.style.height = (docElm.offsetHeight - 10) + 'px';\r\n\t\t\t\t\t});\r\n\t\t\t\t}*/\r\n\t\t\t}\r\n\r\n\t\t\tif (tinymce.isOpera) {\r\n\t\t\t\tt.onClick.add(function(ed, e) {\r\n\t\t\t\t\tEvent.prevent(e);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Add custom undo/redo handlers\r\n\t\t\tif (s.custom_undo_redo) {\r\n\t\t\t\tfunction addUndo() {\r\n\t\t\t\t\tt.undoManager.typing = 0;\r\n\t\t\t\t\tt.undoManager.add();\r\n\t\t\t\t};\r\n\r\n\t\t\t\tt.dom.bind(t.getDoc(), 'focusout', function(e) {\r\n\t\t\t\t\tif (!t.removed && t.undoManager.typing)\r\n\t\t\t\t\t\taddUndo();\r\n\t\t\t\t});\r\n\r\n\t\t\t\tt.onKeyUp.add(function(ed, e) {\r\n\t\t\t\t\tif ((e.keyCode >= 33 && e.keyCode <= 36) || (e.keyCode >= 37 && e.keyCode <= 40) || e.keyCode == 13 || e.keyCode == 45 || e.ctrlKey)\r\n\t\t\t\t\t\taddUndo();\r\n\t\t\t\t});\r\n\r\n\t\t\t\tt.onKeyDown.add(function(ed, e) {\r\n\t\t\t\t\tvar rng, parent, bookmark;\r\n\r\n\t\t\t\t\t// IE has a really odd bug where the DOM might include an node that doesn't have\r\n\t\t\t\t\t// a proper structure. If you try to access nodeValue it would throw an illegal value exception.\r\n\t\t\t\t\t// This seems to only happen when you delete contents and it seems to be avoidable if you refresh the element\r\n\t\t\t\t\t// after you delete contents from it. See: #3008923\r\n\t\t\t\t\tif (isIE && e.keyCode == 46) {\r\n\t\t\t\t\t\trng = t.selection.getRng();\r\n\r\n\t\t\t\t\t\tif (rng.parentElement) {\r\n\t\t\t\t\t\t\tparent = rng.parentElement();\r\n\r\n\t\t\t\t\t\t\t// Select next word when ctrl key is used in combo with delete\r\n\t\t\t\t\t\t\tif (e.ctrlKey) {\r\n\t\t\t\t\t\t\t\trng.moveEnd('word', 1);\r\n\t\t\t\t\t\t\t\trng.select();\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Delete contents\r\n\t\t\t\t\t\t\tt.selection.getSel().clear();\r\n\r\n\t\t\t\t\t\t\t// Check if we are within the same parent\r\n\t\t\t\t\t\t\tif (rng.parentElement() == parent) {\r\n\t\t\t\t\t\t\t\tbookmark = t.selection.getBookmark();\r\n\r\n\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\t// Update the HTML and hopefully it will remove the artifacts\r\n\t\t\t\t\t\t\t\t\tparent.innerHTML = parent.innerHTML;\r\n\t\t\t\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t\t\t\t// And since it's IE it can sometimes produce an unknown runtime error\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Restore the caret position\r\n\t\t\t\t\t\t\t\tt.selection.moveToBookmark(bookmark);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Block the default delete behavior since it might be broken\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Is caracter positon keys\r\n\t\t\t\t\tif ((e.keyCode >= 33 && e.keyCode <= 36) || (e.keyCode >= 37 && e.keyCode <= 40) || e.keyCode == 13 || e.keyCode == 45) {\r\n\t\t\t\t\t\tif (t.undoManager.typing)\r\n\t\t\t\t\t\t\taddUndo();\r\n\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!t.undoManager.typing) {\r\n\t\t\t\t\t\tt.undoManager.add();\r\n\t\t\t\t\t\tt.undoManager.typing = 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tt.onMouseDown.add(function() {\r\n\t\t\t\t\tif (t.undoManager.typing)\r\n\t\t\t\t\t\taddUndo();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_isHidden : function() {\r\n\t\t\tvar s;\r\n\r\n\t\t\tif (!isGecko)\r\n\t\t\t\treturn 0;\r\n\r\n\t\t\t// Weird, wheres that cursor selection?\r\n\t\t\ts = this.selection.getSel();\r\n\t\t\treturn (!s || !s.rangeCount || s.rangeCount == 0);\r\n\t\t},\r\n\r\n\t\t// Fix for bug #1867292\r\n\t\t_fixNesting : function(s) {\r\n\t\t\tvar d = [], i;\r\n\r\n\t\t\ts = s.replace(/<(\\/)?([^\\s>]+)[^>]*?>/g, function(a, b, c) {\r\n\t\t\t\tvar e;\r\n\r\n\t\t\t\t// Handle end element\r\n\t\t\t\tif (b === '/') {\r\n\t\t\t\t\tif (!d.length)\r\n\t\t\t\t\t\treturn '';\r\n\r\n\t\t\t\t\tif (c !== d[d.length - 1].tag) {\r\n\t\t\t\t\t\tfor (i=d.length - 1; i>=0; i--) {\r\n\t\t\t\t\t\t\tif (d[i].tag === c) {\r\n\t\t\t\t\t\t\t\td[i].close = 1;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn '';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\td.pop();\r\n\r\n\t\t\t\t\t\tif (d.length && d[d.length - 1].close) {\r\n\t\t\t\t\t\t\ta = a + '</' + d[d.length - 1].tag + '>';\r\n\t\t\t\t\t\t\td.pop();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Ignore these\r\n\t\t\t\t\tif (/^(br|hr|input|meta|img|link|param)$/i.test(c))\r\n\t\t\t\t\t\treturn a;\r\n\r\n\t\t\t\t\t// Ignore closed ones\r\n\t\t\t\t\tif (/\\/>$/.test(a))\r\n\t\t\t\t\t\treturn a;\r\n\r\n\t\t\t\t\td.push({tag : c}); // Push start element\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn a;\r\n\t\t\t});\r\n\r\n\t\t\t// End all open tags\r\n\t\t\tfor (i=d.length - 1; i>=0; i--)\r\n\t\t\t\ts += '</' + d[i].tag + '>';\r\n\r\n\t\t\treturn s;\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\t// Added for compression purposes\r\n\tvar each = tinymce.each, undefined, TRUE = true, FALSE = false;\r\n\r\n\ttinymce.EditorCommands = function(editor) {\r\n\t\tvar dom = editor.dom,\r\n\t\t\tselection = editor.selection,\r\n\t\t\tcommands = {state: {}, exec : {}, value : {}},\r\n\t\t\tsettings = editor.settings,\r\n\t\t\tbookmark;\r\n\r\n\t\tfunction execCommand(command, ui, value) {\r\n\t\t\tvar func;\r\n\r\n\t\t\tcommand = command.toLowerCase();\r\n\t\t\tif (func = commands.exec[command]) {\r\n\t\t\t\tfunc(command, ui, value);\r\n\t\t\t\treturn TRUE;\r\n\t\t\t}\r\n\r\n\t\t\treturn FALSE;\r\n\t\t};\r\n\r\n\t\tfunction queryCommandState(command) {\r\n\t\t\tvar func;\r\n\r\n\t\t\tcommand = command.toLowerCase();\r\n\t\t\tif (func = commands.state[command])\r\n\t\t\t\treturn func(command);\r\n\r\n\t\t\treturn -1;\r\n\t\t};\r\n\r\n\t\tfunction queryCommandValue(command) {\r\n\t\t\tvar func;\r\n\r\n\t\t\tcommand = command.toLowerCase();\r\n\t\t\tif (func = commands.value[command])\r\n\t\t\t\treturn func(command);\r\n\r\n\t\t\treturn FALSE;\r\n\t\t};\r\n\r\n\t\tfunction addCommands(command_list, type) {\r\n\t\t\ttype = type || 'exec';\r\n\r\n\t\t\teach(command_list, function(callback, command) {\r\n\t\t\t\teach(command.toLowerCase().split(','), function(command) {\r\n\t\t\t\t\tcommands[type][command] = callback;\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t// Expose public methods\r\n\t\ttinymce.extend(this, {\r\n\t\t\texecCommand : execCommand,\r\n\t\t\tqueryCommandState : queryCommandState,\r\n\t\t\tqueryCommandValue : queryCommandValue,\r\n\t\t\taddCommands : addCommands\r\n\t\t});\r\n\r\n\t\t// Private methods\r\n\r\n\t\tfunction execNativeCommand(command, ui, value) {\r\n\t\t\tif (ui === undefined)\r\n\t\t\t\tui = FALSE;\r\n\r\n\t\t\tif (value === undefined)\r\n\t\t\t\tvalue = null;\r\n\r\n\t\t\treturn editor.getDoc().execCommand(command, ui, value);\r\n\t\t};\r\n\r\n\t\tfunction isFormatMatch(name) {\r\n\t\t\treturn editor.formatter.match(name);\r\n\t\t};\r\n\r\n\t\tfunction toggleFormat(name, value) {\r\n\t\t\teditor.formatter.toggle(name, value ? {value : value} : undefined);\r\n\t\t};\r\n\r\n\t\tfunction storeSelection(type) {\r\n\t\t\tbookmark = selection.getBookmark(type);\r\n\t\t};\r\n\r\n\t\tfunction restoreSelection() {\r\n\t\t\tselection.moveToBookmark(bookmark);\r\n\t\t};\r\n\r\n\t\t// Add execCommand overrides\r\n\t\taddCommands({\r\n\t\t\t// Ignore these, added for compatibility\r\n\t\t\t'mceResetDesignMode,mceBeginUndoLevel' : function() {},\r\n\r\n\t\t\t// Add undo manager logic\r\n\t\t\t'mceEndUndoLevel,mceAddUndoLevel' : function() {\r\n\t\t\t\teditor.undoManager.add();\r\n\t\t\t},\r\n\r\n\t\t\t'Cut,Copy,Paste' : function(command) {\r\n\t\t\t\tvar doc = editor.getDoc(), failed;\r\n\r\n\t\t\t\t// Try executing the native command\r\n\t\t\t\ttry {\r\n\t\t\t\t\texecNativeCommand(command);\r\n\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t// Command failed\r\n\t\t\t\t\tfailed = TRUE;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Present alert message about clipboard access not being available\r\n\t\t\t\tif (failed || !doc.queryCommandSupported(command)) {\r\n\t\t\t\t\tif (tinymce.isGecko) {\r\n\t\t\t\t\t\teditor.windowManager.confirm(editor.getLang('clipboard_msg'), function(state) {\r\n\t\t\t\t\t\t\tif (state)\r\n\t\t\t\t\t\t\t\topen('http://www.mozilla.org/editor/midasdemo/securityprefs.html', '_blank');\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\teditor.windowManager.alert(editor.getLang('clipboard_no_support'));\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t// Override unlink command\r\n\t\t\tunlink : function(command) {\r\n\t\t\t\tif (selection.isCollapsed())\r\n\t\t\t\t\tselection.select(selection.getNode());\r\n\r\n\t\t\t\texecNativeCommand(command);\r\n\t\t\t\tselection.collapse(FALSE);\r\n\t\t\t},\r\n\r\n\t\t\t// Override justify commands to use the text formatter engine\r\n\t\t\t'JustifyLeft,JustifyCenter,JustifyRight,JustifyFull' : function(command) {\r\n\t\t\t\tvar align = command.substring(7);\r\n\r\n\t\t\t\t// Remove all other alignments first\r\n\t\t\t\teach('left,center,right,full'.split(','), function(name) {\r\n\t\t\t\t\tif (align != name)\r\n\t\t\t\t\t\teditor.formatter.remove('align' + name);\r\n\t\t\t\t});\r\n\r\n\t\t\t\ttoggleFormat('align' + align);\r\n\t\t\t},\r\n\r\n\t\t\t// Override list commands to fix WebKit bug\r\n\t\t\t'InsertUnorderedList,InsertOrderedList' : function(command) {\r\n\t\t\t\tvar listElm, listParent;\r\n\r\n\t\t\t\texecNativeCommand(command);\r\n\r\n\t\t\t\t// WebKit produces lists within block elements so we need to split them\r\n\t\t\t\t// we will replace the native list creation logic to custom logic later on\r\n\t\t\t\t// TODO: Remove this when the list creation logic is removed\r\n\t\t\t\tlistElm = dom.getParent(selection.getNode(), 'ol,ul');\r\n\t\t\t\tif (listElm) {\r\n\t\t\t\t\tlistParent = listElm.parentNode;\r\n\r\n\t\t\t\t\t// If list is within a text block then split that block\r\n\t\t\t\t\tif (/^(H[1-6]|P|ADDRESS|PRE)$/.test(listParent.nodeName)) {\r\n\t\t\t\t\t\tstoreSelection();\r\n\t\t\t\t\t\tdom.split(listParent, listElm);\r\n\t\t\t\t\t\trestoreSelection();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t// Override commands to use the text formatter engine\r\n\t\t\t'Bold,Italic,Underline,Strikethrough' : function(command) {\r\n\t\t\t\ttoggleFormat(command);\r\n\t\t\t},\r\n\r\n\t\t\t// Override commands to use the text formatter engine\r\n\t\t\t'ForeColor,HiliteColor,FontName' : function(command, ui, value) {\r\n\t\t\t\ttoggleFormat(command, value);\r\n\t\t\t},\r\n\r\n\t\t\tFontSize : function(command, ui, value) {\r\n\t\t\t\tvar fontClasses, fontSizes;\r\n\r\n\t\t\t\t// Convert font size 1-7 to styles\r\n\t\t\t\tif (value >= 1 && value <= 7) {\r\n\t\t\t\t\tfontSizes = tinymce.explode(settings.font_size_style_values);\r\n\t\t\t\t\tfontClasses = tinymce.explode(settings.font_size_classes);\r\n\r\n\t\t\t\t\tif (fontClasses)\r\n\t\t\t\t\t\tvalue = fontClasses[value - 1] || value;\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tvalue = fontSizes[value - 1] || value;\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttoggleFormat(command, value);\r\n\t\t\t},\r\n\r\n\t\t\tRemoveFormat : function(command) {\r\n\t\t\t\teditor.formatter.remove(command);\r\n\t\t\t},\r\n\r\n\t\t\tmceBlockQuote : function(command) {\r\n\t\t\t\ttoggleFormat('blockquote');\r\n\t\t\t},\r\n\r\n\t\t\tFormatBlock : function(command, ui, value) {\r\n\t\t\t\treturn toggleFormat(value || 'p');\r\n\t\t\t},\r\n\r\n\t\t\tmceCleanup : function() {\r\n\t\t\t\tvar bookmark = selection.getBookmark();\r\n\r\n\t\t\t\teditor.setContent(editor.getContent({cleanup : TRUE}), {cleanup : TRUE});\r\n\r\n\t\t\t\tselection.moveToBookmark(bookmark);\r\n\t\t\t},\r\n\r\n\t\t\tmceRemoveNode : function(command, ui, value) {\r\n\t\t\t\tvar node = value || selection.getNode();\r\n\r\n\t\t\t\t// Make sure that the body node isn't removed\r\n\t\t\t\tif (node != editor.getBody()) {\r\n\t\t\t\t\tstoreSelection();\r\n\t\t\t\t\teditor.dom.remove(node, TRUE);\r\n\t\t\t\t\trestoreSelection();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tmceSelectNodeDepth : function(command, ui, value) {\r\n\t\t\t\tvar counter = 0;\r\n\r\n\t\t\t\tdom.getParent(selection.getNode(), function(node) {\r\n\t\t\t\t\tif (node.nodeType == 1 && counter++ == value) {\r\n\t\t\t\t\t\tselection.select(node);\r\n\t\t\t\t\t\treturn FALSE;\r\n\t\t\t\t\t}\r\n\t\t\t\t}, editor.getBody());\r\n\t\t\t},\r\n\r\n\t\t\tmceSelectNode : function(command, ui, value) {\r\n\t\t\t\tselection.select(value);\r\n\t\t\t},\r\n\r\n\t\t\tmceInsertContent : function(command, ui, value) {\r\n\t\t\t\tselection.setContent(value);\r\n\t\t\t},\r\n\r\n\t\t\tmceInsertRawHTML : function(command, ui, value) {\r\n\t\t\t\tselection.setContent('tiny_mce_marker');\r\n\t\t\t\teditor.setContent(editor.getContent().replace(/tiny_mce_marker/g, function() { return value }));\r\n\t\t\t},\r\n\r\n\t\t\tmceSetContent : function(command, ui, value) {\r\n\t\t\t\teditor.setContent(value);\r\n\t\t\t},\r\n\r\n\t\t\t'Indent,Outdent' : function(command) {\r\n\t\t\t\tvar intentValue, indentUnit, value;\r\n\r\n\t\t\t\t// Setup indent level\r\n\t\t\t\tintentValue = settings.indentation;\r\n\t\t\t\tindentUnit = /[a-z%]+$/i.exec(intentValue);\r\n\t\t\t\tintentValue = parseInt(intentValue);\r\n\r\n\t\t\t\tif (!queryCommandState('InsertUnorderedList') && !queryCommandState('InsertOrderedList')) {\r\n\t\t\t\t\teach(selection.getSelectedBlocks(), function(element) {\r\n\t\t\t\t\t\tif (command == 'outdent') {\r\n\t\t\t\t\t\t\tvalue = Math.max(0, parseInt(element.style.paddingLeft || 0) - intentValue);\r\n\t\t\t\t\t\t\tdom.setStyle(element, 'paddingLeft', value ? value + indentUnit : '');\r\n\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\tdom.setStyle(element, 'paddingLeft', (parseInt(element.style.paddingLeft || 0) + intentValue) + indentUnit);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else\r\n\t\t\t\t\texecNativeCommand(command);\r\n\t\t\t},\r\n\r\n\t\t\tmceRepaint : function() {\r\n\t\t\t\tvar bookmark;\r\n\r\n\t\t\t\tif (tinymce.isGecko) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tstoreSelection(TRUE);\r\n\r\n\t\t\t\t\t\tif (selection.getSel())\r\n\t\t\t\t\t\t\tselection.getSel().selectAllChildren(editor.getBody());\r\n\r\n\t\t\t\t\t\tselection.collapse(TRUE);\r\n\t\t\t\t\t\trestoreSelection();\r\n\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t// Ignore\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tmceToggleFormat : function(command, ui, value) {\r\n\t\t\t\teditor.formatter.toggle(value);\r\n\t\t\t},\r\n\r\n\t\t\tInsertHorizontalRule : function() {\r\n\t\t\t\tselection.setContent('<hr />');\r\n\t\t\t},\r\n\r\n\t\t\tmceToggleVisualAid : function() {\r\n\t\t\t\teditor.hasVisual = !editor.hasVisual;\r\n\t\t\t\teditor.addVisual();\r\n\t\t\t},\r\n\r\n\t\t\tmceReplaceContent : function(command, ui, value) {\r\n\t\t\t\tselection.setContent(value.replace(/\\{\\$selection\\}/g, selection.getContent({format : 'text'})));\r\n\t\t\t},\r\n\r\n\t\t\tmceInsertLink : function(command, ui, value) {\r\n\t\t\t\tvar link = dom.getParent(selection.getNode(), 'a');\r\n\r\n\t\t\t\tif (tinymce.is(value, 'string'))\r\n\t\t\t\t\tvalue = {href : value};\r\n\r\n\t\t\t\tif (!link) {\r\n\t\t\t\t\texecNativeCommand('CreateLink', FALSE, 'javascript:mctmp(0);');\r\n\t\t\t\t\teach(dom.select('a[href=javascript:mctmp(0);]'), function(link) {\r\n\t\t\t\t\t\tdom.setAttribs(link, value);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (value.href)\r\n\t\t\t\t\t\tdom.setAttribs(link, value);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\teditor.dom.remove(link, TRUE);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tselectAll : function() {\r\n\t\t\t\tvar root = dom.getRoot(), rng = dom.createRng();\r\n\r\n\t\t\t\trng.setStart(root, 0);\r\n\t\t\t\trng.setEnd(root, root.childNodes.length);\r\n\r\n\t\t\t\teditor.selection.setRng(rng);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Add queryCommandState overrides\r\n\t\taddCommands({\r\n\t\t\t// Override justify commands\r\n\t\t\t'JustifyLeft,JustifyCenter,JustifyRight,JustifyFull' : function(command) {\r\n\t\t\t\treturn isFormatMatch('align' + command.substring(7));\r\n\t\t\t},\r\n\r\n\t\t\t'Bold,Italic,Underline,Strikethrough' : function(command) {\r\n\t\t\t\treturn isFormatMatch(command);\r\n\t\t\t},\r\n\r\n\t\t\tmceBlockQuote : function() {\r\n\t\t\t\treturn isFormatMatch('blockquote');\r\n\t\t\t},\r\n\r\n\t\t\tOutdent : function() {\r\n\t\t\t\tvar node;\r\n\r\n\t\t\t\tif (settings.inline_styles) {\r\n\t\t\t\t\tif ((node = dom.getParent(selection.getStart(), dom.isBlock)) && parseInt(node.style.paddingLeft) > 0)\r\n\t\t\t\t\t\treturn TRUE;\r\n\r\n\t\t\t\t\tif ((node = dom.getParent(selection.getEnd(), dom.isBlock)) && parseInt(node.style.paddingLeft) > 0)\r\n\t\t\t\t\t\treturn TRUE;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn queryCommandState('InsertUnorderedList') || queryCommandState('InsertOrderedList') || (!settings.inline_styles && !!dom.getParent(selection.getNode(), 'BLOCKQUOTE'));\r\n\t\t\t},\r\n\r\n\t\t\t'InsertUnorderedList,InsertOrderedList' : function(command) {\r\n\t\t\t\treturn dom.getParent(selection.getNode(), command == 'insertunorderedlist' ? 'UL' : 'OL');\r\n\t\t\t}\r\n\t\t}, 'state');\r\n\r\n\t\t// Add queryCommandValue overrides\r\n\t\taddCommands({\r\n\t\t\t'FontSize,FontName' : function(command) {\r\n\t\t\t\tvar value = 0, parent;\r\n\r\n\t\t\t\tif (parent = dom.getParent(selection.getNode(), 'span')) {\r\n\t\t\t\t\tif (command == 'fontsize')\r\n\t\t\t\t\t\tvalue = parent.style.fontSize;\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tvalue = parent.style.fontFamily.replace(/, /g, ',').replace(/[\\'\\\"]/g, '').toLowerCase();\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t}, 'value');\r\n\r\n\t\t// Add undo manager logic\r\n\t\tif (settings.custom_undo_redo) {\r\n\t\t\taddCommands({\r\n\t\t\t\tUndo : function() {\r\n\t\t\t\t\teditor.undoManager.undo();\r\n\t\t\t\t},\r\n\r\n\t\t\t\tRedo : function() {\r\n\t\t\t\t\teditor.undoManager.redo();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n})(tinymce);\r\n(function(tinymce) {\r\n\tvar Dispatcher = tinymce.util.Dispatcher;\r\n\r\n\ttinymce.UndoManager = function(editor) {\r\n\t\tvar self, index = 0, data = [];\r\n\r\n\t\tfunction getContent() {\r\n\t\t\treturn tinymce.trim(editor.getContent({format : 'raw', no_events : 1}));\r\n\t\t};\r\n\r\n\t\treturn self = {\r\n\t\t\ttyping : 0,\r\n\r\n\t\t\tonAdd : new Dispatcher(self),\r\n\t\t\tonUndo : new Dispatcher(self),\r\n\t\t\tonRedo : new Dispatcher(self),\r\n\r\n\t\t\tadd : function(level) {\r\n\t\t\t\tvar i, settings = editor.settings, lastLevel;\r\n\r\n\t\t\t\tlevel = level || {};\r\n\t\t\t\tlevel.content = getContent();\r\n\r\n\t\t\t\t// Add undo level if needed\r\n\t\t\t\tlastLevel = data[index];\r\n\t\t\t\tif (lastLevel && lastLevel.content == level.content) {\r\n\t\t\t\t\tif (index > 0 || data.length == 1)\r\n\t\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Time to compress\r\n\t\t\t\tif (settings.custom_undo_redo_levels) {\r\n\t\t\t\t\tif (data.length > settings.custom_undo_redo_levels) {\r\n\t\t\t\t\t\tfor (i = 0; i < data.length - 1; i++)\r\n\t\t\t\t\t\t\tdata[i] = data[i + 1];\r\n\r\n\t\t\t\t\t\tdata.length--;\r\n\t\t\t\t\t\tindex = data.length;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Get a non intrusive normalized bookmark\r\n\t\t\t\tlevel.bookmark = editor.selection.getBookmark(2, true);\r\n\r\n\t\t\t\t// Crop array if needed\r\n\t\t\t\tif (index < data.length - 1) {\r\n\t\t\t\t\t// Treat first level as initial\r\n\t\t\t\t\tif (index == 0)\r\n\t\t\t\t\t\tdata = [];\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tdata.length = index + 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdata.push(level);\r\n\t\t\t\tindex = data.length - 1;\r\n\r\n\t\t\t\tself.onAdd.dispatch(self, level);\r\n\t\t\t\teditor.isNotDirty = 0;\r\n\r\n\t\t\t\treturn level;\r\n\t\t\t},\r\n\r\n\t\t\tundo : function() {\r\n\t\t\t\tvar level, i;\r\n\r\n\t\t\t\tif (self.typing) {\r\n\t\t\t\t\tself.add();\r\n\t\t\t\t\tself.typing = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (index > 0) {\r\n\t\t\t\t\tlevel = data[--index];\r\n\r\n\t\t\t\t\teditor.setContent(level.content, {format : 'raw'});\r\n\t\t\t\t\teditor.selection.moveToBookmark(level.bookmark);\r\n\r\n\t\t\t\t\tself.onUndo.dispatch(self, level);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn level;\r\n\t\t\t},\r\n\r\n\t\t\tredo : function() {\r\n\t\t\t\tvar level;\r\n\r\n\t\t\t\tif (index < data.length - 1) {\r\n\t\t\t\t\tlevel = data[++index];\r\n\r\n\t\t\t\t\teditor.setContent(level.content, {format : 'raw'});\r\n\t\t\t\t\teditor.selection.moveToBookmark(level.bookmark);\r\n\r\n\t\t\t\t\tself.onRedo.dispatch(self, level);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn level;\r\n\t\t\t},\r\n\r\n\t\t\tclear : function() {\r\n\t\t\t\tdata = [];\r\n\t\t\t\tindex = self.typing = 0;\r\n\t\t\t},\r\n\r\n\t\t\thasUndo : function() {\r\n\t\t\t\treturn index > 0 || self.typing;\r\n\t\t\t},\r\n\r\n\t\t\thasRedo : function() {\r\n\t\t\t\treturn index < data.length - 1;\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\t// Shorten names\r\n\tvar Event = tinymce.dom.Event,\r\n\t\tisIE = tinymce.isIE,\r\n\t\tisGecko = tinymce.isGecko,\r\n\t\tisOpera = tinymce.isOpera,\r\n\t\teach = tinymce.each,\r\n\t\textend = tinymce.extend,\r\n\t\tTRUE = true,\r\n\t\tFALSE = false;\r\n\r\n\tfunction cloneFormats(node) {\r\n\t\tvar clone, temp, inner;\r\n\r\n\t\tdo {\r\n\t\t\tif (/^(SPAN|STRONG|B|EM|I|FONT|STRIKE|U)$/.test(node.nodeName)) {\r\n\t\t\t\tif (clone) {\r\n\t\t\t\t\ttemp = node.cloneNode(false);\r\n\t\t\t\t\ttemp.appendChild(clone);\r\n\t\t\t\t\tclone = temp;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tclone = inner = node.cloneNode(false);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tclone.removeAttribute('id');\r\n\t\t\t}\r\n\t\t} while (node = node.parentNode);\r\n\r\n\t\tif (clone)\r\n\t\t\treturn {wrapper : clone, inner : inner};\r\n\t};\r\n\r\n\t// Checks if the selection/caret is at the end of the specified block element\r\n\tfunction isAtEnd(rng, par) {\r\n\t\tvar rng2 = par.ownerDocument.createRange();\r\n\r\n\t\trng2.setStart(rng.endContainer, rng.endOffset);\r\n\t\trng2.setEndAfter(par);\r\n\r\n\t\t// Get number of characters to the right of the cursor if it's zero then we are at the end and need to merge the next block element\r\n\t\treturn rng2.cloneContents().textContent.length == 0;\r\n\t};\r\n\r\n\tfunction isEmpty(n) {\r\n\t\tn = n.innerHTML;\r\n\r\n\t\tn = n.replace(/<(img|hr|table|input|select|textarea)[ \\>]/gi, '-'); // Keep these convert them to - chars\r\n\t\tn = n.replace(/<[^>]+>/g, ''); // Remove all tags\r\n\r\n\t\treturn n.replace(/[ \\u00a0\\t\\r\\n]+/g, '') == '';\r\n\t};\r\n\r\n\tfunction splitList(selection, dom, li) {\r\n\t\tvar listBlock, block;\r\n\r\n\t\tif (isEmpty(li)) {\r\n\t\t\tlistBlock = dom.getParent(li, 'ul,ol');\r\n\r\n\t\t\tif (!dom.getParent(listBlock.parentNode, 'ul,ol')) {\r\n\t\t\t\tdom.split(listBlock, li);\r\n\t\t\t\tblock = dom.create('p', 0, '<br _mce_bogus=\"1\" />');\r\n\t\t\t\tdom.replace(block, li);\r\n\t\t\t\tselection.select(block, 1);\r\n\t\t\t}\r\n\r\n\t\t\treturn FALSE;\r\n\t\t}\r\n\r\n\t\treturn TRUE;\r\n\t};\r\n\r\n\ttinymce.create('tinymce.ForceBlocks', {\r\n\t\tForceBlocks : function(ed) {\r\n\t\t\tvar t = this, s = ed.settings, elm;\r\n\r\n\t\t\tt.editor = ed;\r\n\t\t\tt.dom = ed.dom;\r\n\t\t\telm = (s.forced_root_block || 'p').toLowerCase();\r\n\t\t\ts.element = elm.toUpperCase();\r\n\r\n\t\t\ted.onPreInit.add(t.setup, t);\r\n\r\n\t\t\tt.reOpera = new RegExp('(\\\\u00a0|&#160;|&nbsp;)<\\/' + elm + '>', 'gi');\r\n\t\t\tt.rePadd = new RegExp('<p( )([^>]+)><\\\\\\/p>|<p( )([^>]+)\\\\\\/>|<p( )([^>]+)>\\\\s+<\\\\\\/p>|<p><\\\\\\/p>|<p\\\\\\/>|<p>\\\\s+<\\\\\\/p>'.replace(/p/g, elm), 'gi');\r\n\t\t\tt.reNbsp2BR1 = new RegExp('<p( )([^>]+)>[\\\\s\\\\u00a0]+<\\\\\\/p>|<p>[\\\\s\\\\u00a0]+<\\\\\\/p>'.replace(/p/g, elm), 'gi');\r\n\t\t\tt.reNbsp2BR2 = new RegExp('<%p()([^>]+)>(&nbsp;|&#160;)<\\\\\\/%p>|<%p>(&nbsp;|&#160;)<\\\\\\/%p>'.replace(/%p/g, elm), 'gi');\r\n\t\t\tt.reBR2Nbsp = new RegExp('<p( )([^>]+)>\\\\s*<br \\\\\\/>\\\\s*<\\\\\\/p>|<p>\\\\s*<br \\\\\\/>\\\\s*<\\\\\\/p>'.replace(/p/g, elm), 'gi');\r\n\r\n\t\t\tfunction padd(ed, o) {\r\n\t\t\t\tif (isOpera)\r\n\t\t\t\t\to.content = o.content.replace(t.reOpera, '</' + elm + '>');\r\n\r\n\t\t\t\to.content = o.content.replace(t.rePadd, '<' + elm + '$1$2$3$4$5$6>\\u00a0</' + elm + '>');\r\n\r\n\t\t\t\tif (!isIE && !isOpera && o.set) {\r\n\t\t\t\t\t// Use &nbsp; instead of BR in padded paragraphs\r\n\t\t\t\t\to.content = o.content.replace(t.reNbsp2BR1, '<' + elm + '$1$2><br /></' + elm + '>');\r\n\t\t\t\t\to.content = o.content.replace(t.reNbsp2BR2, '<' + elm + '$1$2><br /></' + elm + '>');\r\n\t\t\t\t} else\r\n\t\t\t\t\to.content = o.content.replace(t.reBR2Nbsp, '<' + elm + '$1$2>\\u00a0</' + elm + '>');\r\n\t\t\t};\r\n\r\n\t\t\ted.onBeforeSetContent.add(padd);\r\n\t\t\ted.onPostProcess.add(padd);\r\n\r\n\t\t\tif (s.forced_root_block) {\r\n\t\t\t\ted.onInit.add(t.forceRoots, t);\r\n\t\t\t\ted.onSetContent.add(t.forceRoots, t);\r\n\t\t\t\ted.onBeforeGetContent.add(t.forceRoots, t);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tsetup : function() {\r\n\t\t\tvar t = this, ed = t.editor, s = ed.settings, dom = ed.dom, selection = ed.selection;\r\n\r\n\t\t\t// Force root blocks when typing and when getting output\r\n\t\t\tif (s.forced_root_block) {\r\n\t\t\t\ted.onBeforeExecCommand.add(t.forceRoots, t);\r\n\t\t\t\ted.onKeyUp.add(t.forceRoots, t);\r\n\t\t\t\ted.onPreProcess.add(t.forceRoots, t);\r\n\t\t\t}\r\n\r\n\t\t\tif (s.force_br_newlines) {\r\n\t\t\t\t// Force IE to produce BRs on enter\r\n\t\t\t\tif (isIE) {\r\n\t\t\t\t\ted.onKeyPress.add(function(ed, e) {\r\n\t\t\t\t\t\tvar n;\r\n\r\n\t\t\t\t\t\tif (e.keyCode == 13 && selection.getNode().nodeName != 'LI') {\r\n\t\t\t\t\t\t\tselection.setContent('<br id=\"__\" /> ', {format : 'raw'});\r\n\t\t\t\t\t\t\tn = dom.get('__');\r\n\t\t\t\t\t\t\tn.removeAttribute('id');\r\n\t\t\t\t\t\t\tselection.select(n);\r\n\t\t\t\t\t\t\tselection.collapse();\r\n\t\t\t\t\t\t\treturn Event.cancel(e);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (s.force_p_newlines) {\r\n\t\t\t\tif (!isIE) {\r\n\t\t\t\t\ted.onKeyPress.add(function(ed, e) {\r\n\t\t\t\t\t\tif (e.keyCode == 13 && !e.shiftKey && !t.insertPara(e))\r\n\t\t\t\t\t\t\tEvent.cancel(e);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Ungly hack to for IE to preserve the formatting when you press\r\n\t\t\t\t\t// enter at the end of a block element with formatted contents\r\n\t\t\t\t\t// This logic overrides the browsers default logic with\r\n\t\t\t\t\t// custom logic that enables us to control the output\r\n\t\t\t\t\ttinymce.addUnload(function() {\r\n\t\t\t\t\t\tt._previousFormats = 0; // Fix IE leak\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\ted.onKeyPress.add(function(ed, e) {\r\n\t\t\t\t\t\tt._previousFormats = 0;\r\n\r\n\t\t\t\t\t\t// Clone the current formats, this will later be applied to the new block contents\r\n\t\t\t\t\t\tif (e.keyCode == 13 && !e.shiftKey && ed.selection.isCollapsed() && s.keep_styles)\r\n\t\t\t\t\t\t\tt._previousFormats = cloneFormats(ed.selection.getStart());\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\ted.onKeyUp.add(function(ed, e) {\r\n\t\t\t\t\t\t// Let IE break the element and the wrap the new caret location in the previous formats\r\n\t\t\t\t\t\tif (e.keyCode == 13 && !e.shiftKey) {\r\n\t\t\t\t\t\t\tvar parent = ed.selection.getStart(), fmt = t._previousFormats;\r\n\r\n\t\t\t\t\t\t\t// Parent is an empty block\r\n\t\t\t\t\t\t\tif (!parent.hasChildNodes() && fmt) {\r\n\t\t\t\t\t\t\t\tparent = dom.getParent(parent, dom.isBlock);\r\n\r\n\t\t\t\t\t\t\t\tif (parent && parent.nodeName != 'LI') {\r\n\t\t\t\t\t\t\t\t\tparent.innerHTML = '';\r\n\r\n\t\t\t\t\t\t\t\t\tif (t._previousFormats) {\r\n\t\t\t\t\t\t\t\t\t\tparent.appendChild(fmt.wrapper);\r\n\t\t\t\t\t\t\t\t\t\tfmt.inner.innerHTML = '\\uFEFF';\r\n\t\t\t\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\t\t\t\tparent.innerHTML = '\\uFEFF';\r\n\r\n\t\t\t\t\t\t\t\t\tselection.select(parent, 1);\r\n\t\t\t\t\t\t\t\t\ted.getDoc().execCommand('Delete', false, null);\r\n\t\t\t\t\t\t\t\t\tt._previousFormats = 0;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (isGecko) {\r\n\t\t\t\t\ted.onKeyDown.add(function(ed, e) {\r\n\t\t\t\t\t\tif ((e.keyCode == 8 || e.keyCode == 46) && !e.shiftKey)\r\n\t\t\t\t\t\t\tt.backspaceDelete(e, e.keyCode == 8);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Workaround for missing shift+enter support, http://bugs.webkit.org/show_bug.cgi?id=16973\r\n\t\t\tif (tinymce.isWebKit) {\r\n\t\t\t\tfunction insertBr(ed) {\r\n\t\t\t\t\tvar rng = selection.getRng(), br, div = dom.create('div', null, ' '), divYPos, vpHeight = dom.getViewPort(ed.getWin()).h;\r\n\r\n\t\t\t\t\t// Insert BR element\r\n\t\t\t\t\trng.insertNode(br = dom.create('br'));\r\n\r\n\t\t\t\t\t// Place caret after BR\r\n\t\t\t\t\trng.setStartAfter(br);\r\n\t\t\t\t\trng.setEndAfter(br);\r\n\t\t\t\t\tselection.setRng(rng);\r\n\r\n\t\t\t\t\t// Could not place caret after BR then insert an nbsp entity and move the caret\r\n\t\t\t\t\tif (selection.getSel().focusNode == br.previousSibling) {\r\n\t\t\t\t\t\tselection.select(dom.insertAfter(dom.doc.createTextNode('\\u00a0'), br));\r\n\t\t\t\t\t\tselection.collapse(TRUE);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Create a temporary DIV after the BR and get the position as it\r\n\t\t\t\t\t// seems like getPos() returns 0 for text nodes and BR elements.\r\n\t\t\t\t\tdom.insertAfter(div, br);\r\n\t\t\t\t\tdivYPos = dom.getPos(div).y;\r\n\t\t\t\t\tdom.remove(div);\r\n\r\n\t\t\t\t\t// Scroll to new position, scrollIntoView can't be used due to bug: http://bugs.webkit.org/show_bug.cgi?id=16117\r\n\t\t\t\t\tif (divYPos > vpHeight) // It is not necessary to scroll if the DIV is inside the view port.\r\n\t\t\t\t\t\ted.getWin().scrollTo(0, divYPos);\r\n\t\t\t\t};\r\n\r\n\t\t\t\ted.onKeyPress.add(function(ed, e) {\r\n\t\t\t\t\tif (e.keyCode == 13 && (e.shiftKey || (s.force_br_newlines && !dom.getParent(selection.getNode(), 'h1,h2,h3,h4,h5,h6,ol,ul')))) {\r\n\t\t\t\t\t\tinsertBr(ed);\r\n\t\t\t\t\t\tEvent.cancel(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Padd empty inline elements within block elements\r\n\t\t\t// For example: <p><strong><em></em></strong></p> becomes <p><strong><em>&nbsp;</em></strong></p>\r\n\t\t\ted.onPreProcess.add(function(ed, o) {\r\n\t\t\t\teach(dom.select('p,h1,h2,h3,h4,h5,h6,div', o.node), function(p) {\r\n\t\t\t\t\tif (isEmpty(p)) {\r\n\t\t\t\t\t\teach(dom.select('span,em,strong,b,i', o.node), function(n) {\r\n\t\t\t\t\t\t\tif (!n.hasChildNodes()) {\r\n\t\t\t\t\t\t\t\tn.appendChild(ed.getDoc().createTextNode('\\u00a0'));\r\n\t\t\t\t\t\t\t\treturn FALSE; // Break the loop one padding is enough\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t// IE specific fixes\r\n\t\t\tif (isIE) {\r\n\t\t\t\t// Replaces IE:s auto generated paragraphs with the specified element name\r\n\t\t\t\tif (s.element != 'P') {\r\n\t\t\t\t\ted.onKeyPress.add(function(ed, e) {\r\n\t\t\t\t\t\tt.lastElm = selection.getNode().nodeName;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\ted.onKeyUp.add(function(ed, e) {\r\n\t\t\t\t\t\tvar bl, n = selection.getNode(), b = ed.getBody();\r\n\r\n\t\t\t\t\t\tif (b.childNodes.length === 1 && n.nodeName == 'P') {\r\n\t\t\t\t\t\t\tn = dom.rename(n, s.element);\r\n\t\t\t\t\t\t\tselection.select(n);\r\n\t\t\t\t\t\t\tselection.collapse();\r\n\t\t\t\t\t\t\ted.nodeChanged();\r\n\t\t\t\t\t\t} else if (e.keyCode == 13 && !e.shiftKey && t.lastElm != 'P') {\r\n\t\t\t\t\t\t\tbl = dom.getParent(n, 'p');\r\n\r\n\t\t\t\t\t\t\tif (bl) {\r\n\t\t\t\t\t\t\t\tdom.rename(bl, s.element);\r\n\t\t\t\t\t\t\t\ted.nodeChanged();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tfind : function(n, t, s) {\r\n\t\t\tvar ed = this.editor, w = ed.getDoc().createTreeWalker(n, 4, null, FALSE), c = -1;\r\n\r\n\t\t\twhile (n = w.nextNode()) {\r\n\t\t\t\tc++;\r\n\r\n\t\t\t\t// Index by node\r\n\t\t\t\tif (t == 0 && n == s)\r\n\t\t\t\t\treturn c;\r\n\r\n\t\t\t\t// Node by index\r\n\t\t\t\tif (t == 1 && c == s)\r\n\t\t\t\t\treturn n;\r\n\t\t\t}\r\n\r\n\t\t\treturn -1;\r\n\t\t},\r\n\r\n\t\tforceRoots : function(ed, e) {\r\n\t\t\tvar t = this, ed = t.editor, b = ed.getBody(), d = ed.getDoc(), se = ed.selection, s = se.getSel(), r = se.getRng(), si = -2, ei, so, eo, tr, c = -0xFFFFFF;\r\n\t\t\tvar nx, bl, bp, sp, le, nl = b.childNodes, i, n, eid;\r\n\r\n\t\t\t// Fix for bug #1863847\r\n\t\t\t//if (e && e.keyCode == 13)\r\n\t\t\t//\treturn TRUE;\r\n\r\n\t\t\t// Wrap non blocks into blocks\r\n\t\t\tfor (i = nl.length - 1; i >= 0; i--) {\r\n\t\t\t\tnx = nl[i];\r\n\r\n\t\t\t\t// Ignore internal elements\r\n\t\t\t\tif (nx.nodeType === 1 && nx.getAttribute('_mce_type')) {\r\n\t\t\t\t\tbl = null;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Is text or non block element\r\n\t\t\t\tif (nx.nodeType === 3 || (!t.dom.isBlock(nx) && nx.nodeType !== 8 && !/^(script|mce:script|style|mce:style)$/i.test(nx.nodeName))) {\r\n\t\t\t\t\tif (!bl) {\r\n\t\t\t\t\t\t// Create new block but ignore whitespace\r\n\t\t\t\t\t\tif (nx.nodeType != 3 || /[^\\s]/g.test(nx.nodeValue)) {\r\n\t\t\t\t\t\t\t// Store selection\r\n\t\t\t\t\t\t\tif (si == -2 && r) {\r\n\t\t\t\t\t\t\t\tif (!isIE) {\r\n\t\t\t\t\t\t\t\t\t// If selection is element then mark it\r\n\t\t\t\t\t\t\t\t\tif (r.startContainer.nodeType == 1 && (n = r.startContainer.childNodes[r.startOffset]) && n.nodeType == 1) {\r\n\t\t\t\t\t\t\t\t\t\t// Save the id of the selected element\r\n\t\t\t\t\t\t\t\t\t\teid = n.getAttribute(\"id\");\r\n\t\t\t\t\t\t\t\t\t\tn.setAttribute(\"id\", \"__mce\");\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t// If element is inside body, might not be the case in contentEdiable mode\r\n\t\t\t\t\t\t\t\t\t\tif (ed.dom.getParent(r.startContainer, function(e) {return e === b;})) {\r\n\t\t\t\t\t\t\t\t\t\t\tso = r.startOffset;\r\n\t\t\t\t\t\t\t\t\t\t\teo = r.endOffset;\r\n\t\t\t\t\t\t\t\t\t\t\tsi = t.find(b, 0, r.startContainer);\r\n\t\t\t\t\t\t\t\t\t\t\tei = t.find(b, 0, r.endContainer);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t// Force control range into text range\r\n\t\t\t\t\t\t\t\t\tif (r.item) {\r\n\t\t\t\t\t\t\t\t\t\ttr = d.body.createTextRange();\r\n\t\t\t\t\t\t\t\t\t\ttr.moveToElementText(r.item(0));\r\n\t\t\t\t\t\t\t\t\t\tr = tr;\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\ttr = d.body.createTextRange();\r\n\t\t\t\t\t\t\t\t\ttr.moveToElementText(b);\r\n\t\t\t\t\t\t\t\t\ttr.collapse(1);\r\n\t\t\t\t\t\t\t\t\tbp = tr.move('character', c) * -1;\r\n\r\n\t\t\t\t\t\t\t\t\ttr = r.duplicate();\r\n\t\t\t\t\t\t\t\t\ttr.collapse(1);\r\n\t\t\t\t\t\t\t\t\tsp = tr.move('character', c) * -1;\r\n\r\n\t\t\t\t\t\t\t\t\ttr = r.duplicate();\r\n\t\t\t\t\t\t\t\t\ttr.collapse(0);\r\n\t\t\t\t\t\t\t\t\tle = (tr.move('character', c) * -1) - sp;\r\n\r\n\t\t\t\t\t\t\t\t\tsi = sp - bp;\r\n\t\t\t\t\t\t\t\t\tei = le;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Uses replaceChild instead of cloneNode since it removes selected attribute from option elements on IE\r\n\t\t\t\t\t\t\t// See: http://support.microsoft.com/kb/829907\r\n\t\t\t\t\t\t\tbl = ed.dom.create(ed.settings.forced_root_block);\r\n\t\t\t\t\t\t\tnx.parentNode.replaceChild(bl, nx);\r\n\t\t\t\t\t\t\tbl.appendChild(nx);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (bl.hasChildNodes())\r\n\t\t\t\t\t\t\tbl.insertBefore(nx, bl.firstChild);\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tbl.appendChild(nx);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else\r\n\t\t\t\t\tbl = null; // Time to create new block\r\n\t\t\t}\r\n\r\n\t\t\t// Restore selection\r\n\t\t\tif (si != -2) {\r\n\t\t\t\tif (!isIE) {\r\n\t\t\t\t\tbl = b.getElementsByTagName(ed.settings.element)[0];\r\n\t\t\t\t\tr = d.createRange();\r\n\r\n\t\t\t\t\t// Select last location or generated block\r\n\t\t\t\t\tif (si != -1)\r\n\t\t\t\t\t\tr.setStart(t.find(b, 1, si), so);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tr.setStart(bl, 0);\r\n\r\n\t\t\t\t\t// Select last location or generated block\r\n\t\t\t\t\tif (ei != -1)\r\n\t\t\t\t\t\tr.setEnd(t.find(b, 1, ei), eo);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tr.setEnd(bl, 0);\r\n\r\n\t\t\t\t\tif (s) {\r\n\t\t\t\t\t\ts.removeAllRanges();\r\n\t\t\t\t\t\ts.addRange(r);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tr = s.createRange();\r\n\t\t\t\t\t\tr.moveToElementText(b);\r\n\t\t\t\t\t\tr.collapse(1);\r\n\t\t\t\t\t\tr.moveStart('character', si);\r\n\t\t\t\t\t\tr.moveEnd('character', ei);\r\n\t\t\t\t\t\tr.select();\r\n\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t// Ignore\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if (!isIE && (n = ed.dom.get('__mce'))) {\r\n\t\t\t\t// Restore the id of the selected element\r\n\t\t\t\tif (eid)\r\n\t\t\t\t\tn.setAttribute('id', eid);\r\n\t\t\t\telse\r\n\t\t\t\t\tn.removeAttribute('id');\r\n\r\n\t\t\t\t// Move caret before selected element\r\n\t\t\t\tr = d.createRange();\r\n\t\t\t\tr.setStartBefore(n);\r\n\t\t\t\tr.setEndBefore(n);\r\n\t\t\t\tse.setRng(r);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetParentBlock : function(n) {\r\n\t\t\tvar d = this.dom;\r\n\r\n\t\t\treturn d.getParent(n, d.isBlock);\r\n\t\t},\r\n\r\n\t\tinsertPara : function(e) {\r\n\t\t\tvar t = this, ed = t.editor, dom = ed.dom, d = ed.getDoc(), se = ed.settings, s = ed.selection.getSel(), r = s.getRangeAt(0), b = d.body;\r\n\t\t\tvar rb, ra, dir, sn, so, en, eo, sb, eb, bn, bef, aft, sc, ec, n, vp = dom.getViewPort(ed.getWin()), y, ch, car;\r\n\r\n\t\t\t// If root blocks are forced then use Operas default behavior since it's really good\r\n// Removed due to bug: #1853816\r\n//\t\t\tif (se.forced_root_block && isOpera)\r\n//\t\t\t\treturn TRUE;\r\n\r\n\t\t\t// Setup before range\r\n\t\t\trb = d.createRange();\r\n\r\n\t\t\t// If is before the first block element and in body, then move it into first block element\r\n\t\t\trb.setStart(s.anchorNode, s.anchorOffset);\r\n\t\t\trb.collapse(TRUE);\r\n\r\n\t\t\t// Setup after range\r\n\t\t\tra = d.createRange();\r\n\r\n\t\t\t// If is before the first block element and in body, then move it into first block element\r\n\t\t\tra.setStart(s.focusNode, s.focusOffset);\r\n\t\t\tra.collapse(TRUE);\r\n\r\n\t\t\t// Setup start/end points\r\n\t\t\tdir = rb.compareBoundaryPoints(rb.START_TO_END, ra) < 0;\r\n\t\t\tsn = dir ? s.anchorNode : s.focusNode;\r\n\t\t\tso = dir ? s.anchorOffset : s.focusOffset;\r\n\t\t\ten = dir ? s.focusNode : s.anchorNode;\r\n\t\t\teo = dir ? s.focusOffset : s.anchorOffset;\r\n\r\n\t\t\t// If selection is in empty table cell\r\n\t\t\tif (sn === en && /^(TD|TH)$/.test(sn.nodeName)) {\r\n\t\t\t\tif (sn.firstChild.nodeName == 'BR')\r\n\t\t\t\t\tdom.remove(sn.firstChild); // Remove BR\r\n\r\n\t\t\t\t// Create two new block elements\r\n\t\t\t\tif (sn.childNodes.length == 0) {\r\n\t\t\t\t\ted.dom.add(sn, se.element, null, '<br />');\r\n\t\t\t\t\taft = ed.dom.add(sn, se.element, null, '<br />');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tn = sn.innerHTML;\r\n\t\t\t\t\tsn.innerHTML = '';\r\n\t\t\t\t\ted.dom.add(sn, se.element, null, n);\r\n\t\t\t\t\taft = ed.dom.add(sn, se.element, null, '<br />');\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Move caret into the last one\r\n\t\t\t\tr = d.createRange();\r\n\t\t\t\tr.selectNodeContents(aft);\r\n\t\t\t\tr.collapse(1);\r\n\t\t\t\ted.selection.setRng(r);\r\n\r\n\t\t\t\treturn FALSE;\r\n\t\t\t}\r\n\r\n\t\t\t// If the caret is in an invalid location in FF we need to move it into the first block\r\n\t\t\tif (sn == b && en == b && b.firstChild && ed.dom.isBlock(b.firstChild)) {\r\n\t\t\t\tsn = en = sn.firstChild;\r\n\t\t\t\tso = eo = 0;\r\n\t\t\t\trb = d.createRange();\r\n\t\t\t\trb.setStart(sn, 0);\r\n\t\t\t\tra = d.createRange();\r\n\t\t\t\tra.setStart(en, 0);\r\n\t\t\t}\r\n\r\n\t\t\t// Never use body as start or end node\r\n\t\t\tsn = sn.nodeName == \"HTML\" ? d.body : sn; // Fix for Opera bug: https://bugs.opera.com/show_bug.cgi?id=273224&comments=yes\r\n\t\t\tsn = sn.nodeName == \"BODY\" ? sn.firstChild : sn;\r\n\t\t\ten = en.nodeName == \"HTML\" ? d.body : en; // Fix for Opera bug: https://bugs.opera.com/show_bug.cgi?id=273224&comments=yes\r\n\t\t\ten = en.nodeName == \"BODY\" ? en.firstChild : en;\r\n\r\n\t\t\t// Get start and end blocks\r\n\t\t\tsb = t.getParentBlock(sn);\r\n\t\t\teb = t.getParentBlock(en);\r\n\t\t\tbn = sb ? sb.nodeName : se.element; // Get block name to create\r\n\r\n\t\t\t// Return inside list use default browser behavior\r\n\t\t\tif (n = t.dom.getParent(sb, 'li,pre')) {\r\n\t\t\t\tif (n.nodeName == 'LI')\r\n\t\t\t\t\treturn splitList(ed.selection, t.dom, n);\r\n\r\n\t\t\t\treturn TRUE;\r\n\t\t\t}\r\n\r\n\t\t\t// If caption or absolute layers then always generate new blocks within\r\n\t\t\tif (sb && (sb.nodeName == 'CAPTION' || /absolute|relative|fixed/gi.test(dom.getStyle(sb, 'position', 1)))) {\r\n\t\t\t\tbn = se.element;\r\n\t\t\t\tsb = null;\r\n\t\t\t}\r\n\r\n\t\t\t// If caption or absolute layers then always generate new blocks within\r\n\t\t\tif (eb && (eb.nodeName == 'CAPTION' || /absolute|relative|fixed/gi.test(dom.getStyle(sb, 'position', 1)))) {\r\n\t\t\t\tbn = se.element;\r\n\t\t\t\teb = null;\r\n\t\t\t}\r\n\r\n\t\t\t// Use P instead\r\n\t\t\tif (/(TD|TABLE|TH|CAPTION)/.test(bn) || (sb && bn == \"DIV\" && /left|right/gi.test(dom.getStyle(sb, 'float', 1)))) {\r\n\t\t\t\tbn = se.element;\r\n\t\t\t\tsb = eb = null;\r\n\t\t\t}\r\n\r\n\t\t\t// Setup new before and after blocks\r\n\t\t\tbef = (sb && sb.nodeName == bn) ? sb.cloneNode(0) : ed.dom.create(bn);\r\n\t\t\taft = (eb && eb.nodeName == bn) ? eb.cloneNode(0) : ed.dom.create(bn);\r\n\r\n\t\t\t// Remove id from after clone\r\n\t\t\taft.removeAttribute('id');\r\n\r\n\t\t\t// Is header and cursor is at the end, then force paragraph under\r\n\t\t\tif (/^(H[1-6])$/.test(bn) && isAtEnd(r, sb))\r\n\t\t\t\taft = ed.dom.create(se.element);\r\n\r\n\t\t\t// Find start chop node\r\n\t\t\tn = sc = sn;\r\n\t\t\tdo {\r\n\t\t\t\tif (n == b || n.nodeType == 9 || t.dom.isBlock(n) || /(TD|TABLE|TH|CAPTION)/.test(n.nodeName))\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tsc = n;\r\n\t\t\t} while ((n = n.previousSibling ? n.previousSibling : n.parentNode));\r\n\r\n\t\t\t// Find end chop node\r\n\t\t\tn = ec = en;\r\n\t\t\tdo {\r\n\t\t\t\tif (n == b || n.nodeType == 9 || t.dom.isBlock(n) || /(TD|TABLE|TH|CAPTION)/.test(n.nodeName))\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tec = n;\r\n\t\t\t} while ((n = n.nextSibling ? n.nextSibling : n.parentNode));\r\n\r\n\t\t\t// Place first chop part into before block element\r\n\t\t\tif (sc.nodeName == bn)\r\n\t\t\t\trb.setStart(sc, 0);\r\n\t\t\telse\r\n\t\t\t\trb.setStartBefore(sc);\r\n\r\n\t\t\trb.setEnd(sn, so);\r\n\t\t\tbef.appendChild(rb.cloneContents() || d.createTextNode('')); // Empty text node needed for Safari\r\n\r\n\t\t\t// Place secnd chop part within new block element\r\n\t\t\ttry {\r\n\t\t\t\tra.setEndAfter(ec);\r\n\t\t\t} catch(ex) {\r\n\t\t\t\t//console.debug(s.focusNode, s.focusOffset);\r\n\t\t\t}\r\n\r\n\t\t\tra.setStart(en, eo);\r\n\t\t\taft.appendChild(ra.cloneContents() || d.createTextNode('')); // Empty text node needed for Safari\r\n\r\n\t\t\t// Create range around everything\r\n\t\t\tr = d.createRange();\r\n\t\t\tif (!sc.previousSibling && sc.parentNode.nodeName == bn) {\r\n\t\t\t\tr.setStartBefore(sc.parentNode);\r\n\t\t\t} else {\r\n\t\t\t\tif (rb.startContainer.nodeName == bn && rb.startOffset == 0)\r\n\t\t\t\t\tr.setStartBefore(rb.startContainer);\r\n\t\t\t\telse\r\n\t\t\t\t\tr.setStart(rb.startContainer, rb.startOffset);\r\n\t\t\t}\r\n\r\n\t\t\tif (!ec.nextSibling && ec.parentNode.nodeName == bn)\r\n\t\t\t\tr.setEndAfter(ec.parentNode);\r\n\t\t\telse\r\n\t\t\t\tr.setEnd(ra.endContainer, ra.endOffset);\r\n\r\n\t\t\t// Delete and replace it with new block elements\r\n\t\t\tr.deleteContents();\r\n\r\n\t\t\tif (isOpera)\r\n\t\t\t\ted.getWin().scrollTo(0, vp.y);\r\n\r\n\t\t\t// Never wrap blocks in blocks\r\n\t\t\tif (bef.firstChild && bef.firstChild.nodeName == bn)\r\n\t\t\t\tbef.innerHTML = bef.firstChild.innerHTML;\r\n\r\n\t\t\tif (aft.firstChild && aft.firstChild.nodeName == bn)\r\n\t\t\t\taft.innerHTML = aft.firstChild.innerHTML;\r\n\r\n\t\t\t// Padd empty blocks\r\n\t\t\tif (isEmpty(bef))\r\n\t\t\t\tbef.innerHTML = '<br />';\r\n\r\n\t\t\tfunction appendStyles(e, en) {\r\n\t\t\t\tvar nl = [], nn, n, i;\r\n\r\n\t\t\t\te.innerHTML = '';\r\n\r\n\t\t\t\t// Make clones of style elements\r\n\t\t\t\tif (se.keep_styles) {\r\n\t\t\t\t\tn = en;\r\n\t\t\t\t\tdo {\r\n\t\t\t\t\t\t// We only want style specific elements\r\n\t\t\t\t\t\tif (/^(SPAN|STRONG|B|EM|I|FONT|STRIKE|U)$/.test(n.nodeName)) {\r\n\t\t\t\t\t\t\tnn = n.cloneNode(FALSE);\r\n\t\t\t\t\t\t\tdom.setAttrib(nn, 'id', ''); // Remove ID since it needs to be unique\r\n\t\t\t\t\t\t\tnl.push(nn);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} while (n = n.parentNode);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Append style elements to aft\r\n\t\t\t\tif (nl.length > 0) {\r\n\t\t\t\t\tfor (i = nl.length - 1, nn = e; i >= 0; i--)\r\n\t\t\t\t\t\tnn = nn.appendChild(nl[i]);\r\n\r\n\t\t\t\t\t// Padd most inner style element\r\n\t\t\t\t\tnl[0].innerHTML = isOpera ? '&nbsp;' : '<br />'; // Extra space for Opera so that the caret can move there\r\n\t\t\t\t\treturn nl[0]; // Move caret to most inner element\r\n\t\t\t\t} else\r\n\t\t\t\t\te.innerHTML = isOpera ? '&nbsp;' : '<br />'; // Extra space for Opera so that the caret can move there\r\n\t\t\t};\r\n\r\n\t\t\t// Fill empty afterblook with current style\r\n\t\t\tif (isEmpty(aft))\r\n\t\t\t\tcar = appendStyles(aft, en);\r\n\r\n\t\t\t// Opera needs this one backwards for older versions\r\n\t\t\tif (isOpera && parseFloat(opera.version()) < 9.5) {\r\n\t\t\t\tr.insertNode(bef);\r\n\t\t\t\tr.insertNode(aft);\r\n\t\t\t} else {\r\n\t\t\t\tr.insertNode(aft);\r\n\t\t\t\tr.insertNode(bef);\r\n\t\t\t}\r\n\r\n\t\t\t// Normalize\r\n\t\t\taft.normalize();\r\n\t\t\tbef.normalize();\r\n\r\n\t\t\tfunction first(n) {\r\n\t\t\t\treturn d.createTreeWalker(n, NodeFilter.SHOW_TEXT, null, FALSE).nextNode() || n;\r\n\t\t\t};\r\n\r\n\t\t\t// Move cursor and scroll into view\r\n\t\t\tr = d.createRange();\r\n\t\t\tr.selectNodeContents(isGecko ? first(car || aft) : car || aft);\r\n\t\t\tr.collapse(1);\r\n\t\t\ts.removeAllRanges();\r\n\t\t\ts.addRange(r);\r\n\r\n\t\t\t// scrollIntoView seems to scroll the parent window in most browsers now including FF 3.0b4 so it's time to stop using it and do it our selfs\r\n\t\t\ty = ed.dom.getPos(aft).y;\r\n\t\t\tch = aft.clientHeight;\r\n\r\n\t\t\t// Is element within viewport\r\n\t\t\tif (y < vp.y || y + ch > vp.y + vp.h) {\r\n\t\t\t\ted.getWin().scrollTo(0, y < vp.y ? y : y - vp.h + 25); // Needs to be hardcoded to roughly one line of text if a huge text block is broken into two blocks\r\n\t\t\t\t//console.debug('SCROLL!', 'vp.y: ' + vp.y, 'y' + y, 'vp.h' + vp.h, 'clientHeight' + aft.clientHeight, 'yyy: ' + (y < vp.y ? y : y - vp.h + aft.clientHeight));\r\n\t\t\t}\r\n\r\n\t\t\treturn FALSE;\r\n\t\t},\r\n\r\n\t\tbackspaceDelete : function(e, bs) {\r\n\t\t\tvar t = this, ed = t.editor, b = ed.getBody(), dom = ed.dom, n, se = ed.selection, r = se.getRng(), sc = r.startContainer, n, w, tn, walker;\r\n\r\n\t\t\t// Delete when caret is behind a element doesn't work correctly on Gecko see #3011651\r\n\t\t\tif (!bs && r.collapsed && sc.nodeType == 1 && r.startOffset == sc.childNodes.length) {\r\n\t\t\t\twalker = new tinymce.dom.TreeWalker(sc.lastChild, sc);\r\n\r\n\t\t\t\t// Walk the dom backwards until we find a text node\r\n\t\t\t\tfor (n = sc.lastChild; n; n = walker.prev()) {\r\n\t\t\t\t\tif (n.nodeType == 3) {\r\n\t\t\t\t\t\tr.setStart(n, n.nodeValue.length);\r\n\t\t\t\t\t\tr.collapse(true);\r\n\t\t\t\t\t\tse.setRng(r);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// The caret sometimes gets stuck in Gecko if you delete empty paragraphs\r\n\t\t\t// This workaround removes the element by hand and moves the caret to the previous element\r\n\t\t\tif (sc && ed.dom.isBlock(sc) && !/^(TD|TH)$/.test(sc.nodeName) && bs) {\r\n\t\t\t\tif (sc.childNodes.length == 0 || (sc.childNodes.length == 1 && sc.firstChild.nodeName == 'BR')) {\r\n\t\t\t\t\t// Find previous block element\r\n\t\t\t\t\tn = sc;\r\n\t\t\t\t\twhile ((n = n.previousSibling) && !ed.dom.isBlock(n)) ;\r\n\r\n\t\t\t\t\tif (n) {\r\n\t\t\t\t\t\tif (sc != b.firstChild) {\r\n\t\t\t\t\t\t\t// Find last text node\r\n\t\t\t\t\t\t\tw = ed.dom.doc.createTreeWalker(n, NodeFilter.SHOW_TEXT, null, FALSE);\r\n\t\t\t\t\t\t\twhile (tn = w.nextNode())\r\n\t\t\t\t\t\t\t\tn = tn;\r\n\r\n\t\t\t\t\t\t\t// Place caret at the end of last text node\r\n\t\t\t\t\t\t\tr = ed.getDoc().createRange();\r\n\t\t\t\t\t\t\tr.setStart(n, n.nodeValue ? n.nodeValue.length : 0);\r\n\t\t\t\t\t\t\tr.setEnd(n, n.nodeValue ? n.nodeValue.length : 0);\r\n\t\t\t\t\t\t\tse.setRng(r);\r\n\r\n\t\t\t\t\t\t\t// Remove the target container\r\n\t\t\t\t\t\t\ted.dom.remove(sc);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn Event.cancel(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\t// Shorten names\r\n\tvar DOM = tinymce.DOM, Event = tinymce.dom.Event, each = tinymce.each, extend = tinymce.extend;\r\n\r\n\ttinymce.create('tinymce.ControlManager', {\r\n\t\tControlManager : function(ed, s) {\r\n\t\t\tvar t = this, i;\r\n\r\n\t\t\ts = s || {};\r\n\t\t\tt.editor = ed;\r\n\t\t\tt.controls = {};\r\n\t\t\tt.onAdd = new tinymce.util.Dispatcher(t);\r\n\t\t\tt.onPostRender = new tinymce.util.Dispatcher(t);\r\n\t\t\tt.prefix = s.prefix || ed.id + '_';\r\n\t\t\tt._cls = {};\r\n\r\n\t\t\tt.onPostRender.add(function() {\r\n\t\t\t\teach(t.controls, function(c) {\r\n\t\t\t\t\tc.postRender();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tget : function(id) {\r\n\t\t\treturn this.controls[this.prefix + id] || this.controls[id];\r\n\t\t},\r\n\r\n\t\tsetActive : function(id, s) {\r\n\t\t\tvar c = null;\r\n\r\n\t\t\tif (c = this.get(id))\r\n\t\t\t\tc.setActive(s);\r\n\r\n\t\t\treturn c;\r\n\t\t},\r\n\r\n\t\tsetDisabled : function(id, s) {\r\n\t\t\tvar c = null;\r\n\r\n\t\t\tif (c = this.get(id))\r\n\t\t\t\tc.setDisabled(s);\r\n\r\n\t\t\treturn c;\r\n\t\t},\r\n\r\n\t\tadd : function(c) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tif (c) {\r\n\t\t\t\tt.controls[c.id] = c;\r\n\t\t\t\tt.onAdd.dispatch(c, t);\r\n\t\t\t}\r\n\r\n\t\t\treturn c;\r\n\t\t},\r\n\r\n\t\tcreateControl : function(n) {\r\n\t\t\tvar c, t = this, ed = t.editor;\r\n\r\n\t\t\teach(ed.plugins, function(p) {\r\n\t\t\t\tif (p.createControl) {\r\n\t\t\t\t\tc = p.createControl(n, t);\r\n\r\n\t\t\t\t\tif (c)\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tswitch (n) {\r\n\t\t\t\tcase \"|\":\r\n\t\t\t\tcase \"separator\":\r\n\t\t\t\t\treturn t.createSeparator();\r\n\t\t\t}\r\n\r\n\t\t\tif (!c && ed.buttons && (c = ed.buttons[n]))\r\n\t\t\t\treturn t.createButton(n, c);\r\n\r\n\t\t\treturn t.add(c);\r\n\t\t},\r\n\r\n\t\tcreateDropMenu : function(id, s, cc) {\r\n\t\t\tvar t = this, ed = t.editor, c, bm, v, cls;\r\n\r\n\t\t\ts = extend({\r\n\t\t\t\t'class' : 'mceDropDown',\r\n\t\t\t\tconstrain : ed.settings.constrain_menus\r\n\t\t\t}, s);\r\n\r\n\t\t\ts['class'] = s['class'] + ' ' + ed.getParam('skin') + 'Skin';\r\n\t\t\tif (v = ed.getParam('skin_variant'))\r\n\t\t\t\ts['class'] += ' ' + ed.getParam('skin') + 'Skin' + v.substring(0, 1).toUpperCase() + v.substring(1);\r\n\r\n\t\t\tid = t.prefix + id;\r\n\t\t\tcls = cc || t._cls.dropmenu || tinymce.ui.DropMenu;\r\n\t\t\tc = t.controls[id] = new cls(id, s);\r\n\t\t\tc.onAddItem.add(function(c, o) {\r\n\t\t\t\tvar s = o.settings;\r\n\r\n\t\t\t\ts.title = ed.getLang(s.title, s.title);\r\n\r\n\t\t\t\tif (!s.onclick) {\r\n\t\t\t\t\ts.onclick = function(v) {\r\n\t\t\t\t\t\tif (s.cmd)\r\n\t\t\t\t\t\t\ted.execCommand(s.cmd, s.ui || false, s.value);\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\ted.onRemove.add(function() {\r\n\t\t\t\tc.destroy();\r\n\t\t\t});\r\n\r\n\t\t\t// Fix for bug #1897785, #1898007\r\n\t\t\tif (tinymce.isIE) {\r\n\t\t\t\tc.onShowMenu.add(function() {\r\n\t\t\t\t\t// IE 8 needs focus in order to store away a range with the current collapsed caret location\r\n\t\t\t\t\ted.focus();\r\n\r\n\t\t\t\t\tbm = ed.selection.getBookmark(1);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tc.onHideMenu.add(function() {\r\n\t\t\t\t\tif (bm) {\r\n\t\t\t\t\t\ted.selection.moveToBookmark(bm);\r\n\t\t\t\t\t\tbm = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn t.add(c);\r\n\t\t},\r\n\r\n\t\tcreateListBox : function(id, s, cc) {\r\n\t\t\tvar t = this, ed = t.editor, cmd, c, cls;\r\n\r\n\t\t\tif (t.get(id))\r\n\t\t\t\treturn null;\r\n\r\n\t\t\ts.title = ed.translate(s.title);\r\n\t\t\ts.scope = s.scope || ed;\r\n\r\n\t\t\tif (!s.onselect) {\r\n\t\t\t\ts.onselect = function(v) {\r\n\t\t\t\t\ted.execCommand(s.cmd, s.ui || false, v || s.value);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\ts = extend({\r\n\t\t\t\ttitle : s.title,\r\n\t\t\t\t'class' : 'mce_' + id,\r\n\t\t\t\tscope : s.scope,\r\n\t\t\t\tcontrol_manager : t\r\n\t\t\t}, s);\r\n\r\n\t\t\tid = t.prefix + id;\r\n\r\n\t\t\tif (ed.settings.use_native_selects)\r\n\t\t\t\tc = new tinymce.ui.NativeListBox(id, s);\r\n\t\t\telse {\r\n\t\t\t\tcls = cc || t._cls.listbox || tinymce.ui.ListBox;\r\n\t\t\t\tc = new cls(id, s);\r\n\t\t\t}\r\n\r\n\t\t\tt.controls[id] = c;\r\n\r\n\t\t\t// Fix focus problem in Safari\r\n\t\t\tif (tinymce.isWebKit) {\r\n\t\t\t\tc.onPostRender.add(function(c, n) {\r\n\t\t\t\t\t// Store bookmark on mousedown\r\n\t\t\t\t\tEvent.add(n, 'mousedown', function() {\r\n\t\t\t\t\t\ted.bookmark = ed.selection.getBookmark(1);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Restore on focus, since it might be lost\r\n\t\t\t\t\tEvent.add(n, 'focus', function() {\r\n\t\t\t\t\t\ted.selection.moveToBookmark(ed.bookmark);\r\n\t\t\t\t\t\ted.bookmark = null;\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (c.hideMenu)\r\n\t\t\t\ted.onMouseDown.add(c.hideMenu, c);\r\n\r\n\t\t\treturn t.add(c);\r\n\t\t},\r\n\r\n\t\tcreateButton : function(id, s, cc) {\r\n\t\t\tvar t = this, ed = t.editor, o, c, cls;\r\n\r\n\t\t\tif (t.get(id))\r\n\t\t\t\treturn null;\r\n\r\n\t\t\ts.title = ed.translate(s.title);\r\n\t\t\ts.label = ed.translate(s.label);\r\n\t\t\ts.scope = s.scope || ed;\r\n\r\n\t\t\tif (!s.onclick && !s.menu_button) {\r\n\t\t\t\ts.onclick = function() {\r\n\t\t\t\t\ted.execCommand(s.cmd, s.ui || false, s.value);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\ts = extend({\r\n\t\t\t\ttitle : s.title,\r\n\t\t\t\t'class' : 'mce_' + id,\r\n\t\t\t\tunavailable_prefix : ed.getLang('unavailable', ''),\r\n\t\t\t\tscope : s.scope,\r\n\t\t\t\tcontrol_manager : t\r\n\t\t\t}, s);\r\n\r\n\t\t\tid = t.prefix + id;\r\n\r\n\t\t\tif (s.menu_button) {\r\n\t\t\t\tcls = cc || t._cls.menubutton || tinymce.ui.MenuButton;\r\n\t\t\t\tc = new cls(id, s);\r\n\t\t\t\ted.onMouseDown.add(c.hideMenu, c);\r\n\t\t\t} else {\r\n\t\t\t\tcls = t._cls.button || tinymce.ui.Button;\r\n\t\t\t\tc = new cls(id, s);\r\n\t\t\t}\r\n\r\n\t\t\treturn t.add(c);\r\n\t\t},\r\n\r\n\t\tcreateMenuButton : function(id, s, cc) {\r\n\t\t\ts = s || {};\r\n\t\t\ts.menu_button = 1;\r\n\r\n\t\t\treturn this.createButton(id, s, cc);\r\n\t\t},\r\n\r\n\t\tcreateSplitButton : function(id, s, cc) {\r\n\t\t\tvar t = this, ed = t.editor, cmd, c, cls;\r\n\r\n\t\t\tif (t.get(id))\r\n\t\t\t\treturn null;\r\n\r\n\t\t\ts.title = ed.translate(s.title);\r\n\t\t\ts.scope = s.scope || ed;\r\n\r\n\t\t\tif (!s.onclick) {\r\n\t\t\t\ts.onclick = function(v) {\r\n\t\t\t\t\ted.execCommand(s.cmd, s.ui || false, v || s.value);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tif (!s.onselect) {\r\n\t\t\t\ts.onselect = function(v) {\r\n\t\t\t\t\ted.execCommand(s.cmd, s.ui || false, v || s.value);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\ts = extend({\r\n\t\t\t\ttitle : s.title,\r\n\t\t\t\t'class' : 'mce_' + id,\r\n\t\t\t\tscope : s.scope,\r\n\t\t\t\tcontrol_manager : t\r\n\t\t\t}, s);\r\n\r\n\t\t\tid = t.prefix + id;\r\n\t\t\tcls = cc || t._cls.splitbutton || tinymce.ui.SplitButton;\r\n\t\t\tc = t.add(new cls(id, s));\r\n\t\t\ted.onMouseDown.add(c.hideMenu, c);\r\n\r\n\t\t\treturn c;\r\n\t\t},\r\n\r\n\t\tcreateColorSplitButton : function(id, s, cc) {\r\n\t\t\tvar t = this, ed = t.editor, cmd, c, cls, bm;\r\n\r\n\t\t\tif (t.get(id))\r\n\t\t\t\treturn null;\r\n\r\n\t\t\ts.title = ed.translate(s.title);\r\n\t\t\ts.scope = s.scope || ed;\r\n\r\n\t\t\tif (!s.onclick) {\r\n\t\t\t\ts.onclick = function(v) {\r\n\t\t\t\t\tif (tinymce.isIE)\r\n\t\t\t\t\t\tbm = ed.selection.getBookmark(1);\r\n\r\n\t\t\t\t\ted.execCommand(s.cmd, s.ui || false, v || s.value);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tif (!s.onselect) {\r\n\t\t\t\ts.onselect = function(v) {\r\n\t\t\t\t\ted.execCommand(s.cmd, s.ui || false, v || s.value);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\ts = extend({\r\n\t\t\t\ttitle : s.title,\r\n\t\t\t\t'class' : 'mce_' + id,\r\n\t\t\t\t'menu_class' : ed.getParam('skin') + 'Skin',\r\n\t\t\t\tscope : s.scope,\r\n\t\t\t\tmore_colors_title : ed.getLang('more_colors')\r\n\t\t\t}, s);\r\n\r\n\t\t\tid = t.prefix + id;\r\n\t\t\tcls = cc || t._cls.colorsplitbutton || tinymce.ui.ColorSplitButton;\r\n\t\t\tc = new cls(id, s);\r\n\t\t\ted.onMouseDown.add(c.hideMenu, c);\r\n\r\n\t\t\t// Remove the menu element when the editor is removed\r\n\t\t\ted.onRemove.add(function() {\r\n\t\t\t\tc.destroy();\r\n\t\t\t});\r\n\r\n\t\t\t// Fix for bug #1897785, #1898007\r\n\t\t\tif (tinymce.isIE) {\r\n\t\t\t\tc.onShowMenu.add(function() {\r\n\t\t\t\t\t// IE 8 needs focus in order to store away a range with the current collapsed caret location\r\n\t\t\t\t\ted.focus();\r\n\t\t\t\t\tbm = ed.selection.getBookmark(1);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tc.onHideMenu.add(function() {\r\n\t\t\t\t\tif (bm) {\r\n\t\t\t\t\t\ted.selection.moveToBookmark(bm);\r\n\t\t\t\t\t\tbm = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn t.add(c);\r\n\t\t},\r\n\r\n\t\tcreateToolbar : function(id, s, cc) {\r\n\t\t\tvar c, t = this, cls;\r\n\r\n\t\t\tid = t.prefix + id;\r\n\t\t\tcls = cc || t._cls.toolbar || tinymce.ui.Toolbar;\r\n\t\t\tc = new cls(id, s);\r\n\r\n\t\t\tif (t.get(id))\r\n\t\t\t\treturn null;\r\n\r\n\t\t\treturn t.add(c);\r\n\t\t},\r\n\r\n\t\tcreateSeparator : function(cc) {\r\n\t\t\tvar cls = cc || this._cls.separator || tinymce.ui.Separator;\r\n\r\n\t\t\treturn new cls();\r\n\t\t},\r\n\r\n\t\tsetControlType : function(n, c) {\r\n\t\t\treturn this._cls[n.toLowerCase()] = c;\r\n\t\t},\r\n\t\r\n\t\tdestroy : function() {\r\n\t\t\teach(this.controls, function(c) {\r\n\t\t\t\tc.destroy();\r\n\t\t\t});\r\n\r\n\t\t\tthis.controls = null;\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\tvar Dispatcher = tinymce.util.Dispatcher, each = tinymce.each, isIE = tinymce.isIE, isOpera = tinymce.isOpera;\r\n\r\n\ttinymce.create('tinymce.WindowManager', {\r\n\t\tWindowManager : function(ed) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tt.editor = ed;\r\n\t\t\tt.onOpen = new Dispatcher(t);\r\n\t\t\tt.onClose = new Dispatcher(t);\r\n\t\t\tt.params = {};\r\n\t\t\tt.features = {};\r\n\t\t},\r\n\r\n\t\topen : function(s, p) {\r\n\t\t\tvar t = this, f = '', x, y, mo = t.editor.settings.dialog_type == 'modal', w, sw, sh, vp = tinymce.DOM.getViewPort(), u;\r\n\r\n\t\t\t// Default some options\r\n\t\t\ts = s || {};\r\n\t\t\tp = p || {};\r\n\t\t\tsw = isOpera ? vp.w : screen.width; // Opera uses windows inside the Opera window\r\n\t\t\tsh = isOpera ? vp.h : screen.height;\r\n\t\t\ts.name = s.name || 'mc_' + new Date().getTime();\r\n\t\t\ts.width = parseInt(s.width || 320);\r\n\t\t\ts.height = parseInt(s.height || 240);\r\n\t\t\ts.resizable = true;\r\n\t\t\ts.left = s.left || parseInt(sw / 2.0) - (s.width / 2.0);\r\n\t\t\ts.top = s.top || parseInt(sh / 2.0) - (s.height / 2.0);\r\n\t\t\tp.inline = false;\r\n\t\t\tp.mce_width = s.width;\r\n\t\t\tp.mce_height = s.height;\r\n\t\t\tp.mce_auto_focus = s.auto_focus;\r\n\r\n\t\t\tif (mo) {\r\n\t\t\t\tif (isIE) {\r\n\t\t\t\t\ts.center = true;\r\n\t\t\t\t\ts.help = false;\r\n\t\t\t\t\ts.dialogWidth = s.width + 'px';\r\n\t\t\t\t\ts.dialogHeight = s.height + 'px';\r\n\t\t\t\t\ts.scroll = s.scrollbars || false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Build features string\r\n\t\t\teach(s, function(v, k) {\r\n\t\t\t\tif (tinymce.is(v, 'boolean'))\r\n\t\t\t\t\tv = v ? 'yes' : 'no';\r\n\r\n\t\t\t\tif (!/^(name|url)$/.test(k)) {\r\n\t\t\t\t\tif (isIE && mo)\r\n\t\t\t\t\t\tf += (f ? ';' : '') + k + ':' + v;\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tf += (f ? ',' : '') + k + '=' + v;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tt.features = s;\r\n\t\t\tt.params = p;\r\n\t\t\tt.onOpen.dispatch(t, s, p);\r\n\r\n\t\t\tu = s.url || s.file;\r\n\t\t\tu = tinymce._addVer(u);\r\n\r\n\t\t\ttry {\r\n\t\t\t\tif (isIE && mo) {\r\n\t\t\t\t\tw = 1;\r\n\t\t\t\t\twindow.showModalDialog(u, window, f);\r\n\t\t\t\t} else\r\n\t\t\t\t\tw = window.open(u, s.name, f);\r\n\t\t\t} catch (ex) {\r\n\t\t\t\t// Ignore\r\n\t\t\t}\r\n\r\n\t\t\tif (!w)\r\n\t\t\t\talert(t.editor.getLang('popup_blocked'));\r\n\t\t},\r\n\r\n\t\tclose : function(w) {\r\n\t\t\tw.close();\r\n\t\t\tthis.onClose.dispatch(this);\r\n\t\t},\r\n\r\n\t\tcreateInstance : function(cl, a, b, c, d, e) {\r\n\t\t\tvar f = tinymce.resolve(cl);\r\n\r\n\t\t\treturn new f(a, b, c, d, e);\r\n\t\t},\r\n\r\n\t\tconfirm : function(t, cb, s, w) {\r\n\t\t\tw = w || window;\r\n\r\n\t\t\tcb.call(s || this, w.confirm(this._decode(this.editor.getLang(t, t))));\r\n\t\t},\r\n\r\n\t\talert : function(tx, cb, s, w) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tw = w || window;\r\n\t\t\tw.alert(t._decode(t.editor.getLang(tx, tx)));\r\n\r\n\t\t\tif (cb)\r\n\t\t\t\tcb.call(s || t);\r\n\t\t},\r\n\r\n\t\tresizeBy : function(dw, dh, win) {\r\n\t\t\twin.resizeBy(dw, dh);\r\n\t\t},\r\n\r\n\t\t// Internal functions\r\n\r\n\t\t_decode : function(s) {\r\n\t\t\treturn tinymce.DOM.decode(s).replace(/\\\\n/g, '\\n');\r\n\t\t}\r\n\t});\r\n}(tinymce));\r\n(function(tinymce) {\r\n\tfunction CommandManager() {\r\n\t\tvar execCommands = {}, queryStateCommands = {}, queryValueCommands = {};\r\n\r\n\t\tfunction add(collection, cmd, func, scope) {\r\n\t\t\tif (typeof(cmd) == 'string')\r\n\t\t\t\tcmd = [cmd];\r\n\r\n\t\t\ttinymce.each(cmd, function(cmd) {\r\n\t\t\t\tcollection[cmd.toLowerCase()] = {func : func, scope : scope};\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\ttinymce.extend(this, {\r\n\t\t\tadd : function(cmd, func, scope) {\r\n\t\t\t\tadd(execCommands, cmd, func, scope);\r\n\t\t\t},\r\n\r\n\t\t\taddQueryStateHandler : function(cmd, func, scope) {\r\n\t\t\t\tadd(queryStateCommands, cmd, func, scope);\r\n\t\t\t},\r\n\r\n\t\t\taddQueryValueHandler : function(cmd, func, scope) {\r\n\t\t\t\tadd(queryValueCommands, cmd, func, scope);\r\n\t\t\t},\r\n\r\n\t\t\texecCommand : function(scope, cmd, ui, value, args) {\r\n\t\t\t\tif (cmd = execCommands[cmd.toLowerCase()]) {\r\n\t\t\t\t\tif (cmd.func.call(scope || cmd.scope, ui, value, args) !== false)\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tqueryCommandValue : function() {\r\n\t\t\t\tif (cmd = queryValueCommands[cmd.toLowerCase()])\r\n\t\t\t\t\treturn cmd.func.call(scope || cmd.scope, ui, value, args);\r\n\t\t\t},\r\n\r\n\t\t\tqueryCommandState : function() {\r\n\t\t\t\tif (cmd = queryStateCommands[cmd.toLowerCase()])\r\n\t\t\t\t\treturn cmd.func.call(scope || cmd.scope, ui, value, args);\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\ttinymce.GlobalCommands = new CommandManager();\r\n})(tinymce);\r\n(function(tinymce) {\r\n\ttinymce.Formatter = function(ed) {\r\n\t\tvar formats = {},\r\n\t\t\teach = tinymce.each,\r\n\t\t\tdom = ed.dom,\r\n\t\t\tselection = ed.selection,\r\n\t\t\tTreeWalker = tinymce.dom.TreeWalker,\r\n\t\t\trangeUtils = new tinymce.dom.RangeUtils(dom),\r\n\t\t\tisValid = ed.schema.isValid,\r\n\t\t\tisBlock = dom.isBlock,\r\n\t\t\tforcedRootBlock = ed.settings.forced_root_block,\r\n\t\t\tnodeIndex = dom.nodeIndex,\r\n\t\t\tINVISIBLE_CHAR = '\\uFEFF',\r\n\t\t\tMCE_ATTR_RE = /^(src|href|style)$/,\r\n\t\t\tFALSE = false,\r\n\t\t\tTRUE = true,\r\n\t\t\tundefined,\r\n\t\t\tpendingFormats = {apply : [], remove : []};\r\n\r\n\t\tfunction isArray(obj) {\r\n\t\t\treturn obj instanceof Array;\r\n\t\t};\r\n\r\n\t\tfunction getParents(node, selector) {\r\n\t\t\treturn dom.getParents(node, selector, dom.getRoot());\r\n\t\t};\r\n\r\n\t\tfunction isCaretNode(node) {\r\n\t\t\treturn node.nodeType === 1 && (node.face === 'mceinline' || node.style.fontFamily === 'mceinline');\r\n\t\t};\r\n\r\n\t\t// Public functions\r\n\r\n\t\tfunction get(name) {\r\n\t\t\treturn name ? formats[name] : formats;\r\n\t\t};\r\n\r\n\t\tfunction register(name, format) {\r\n\t\t\tif (name) {\r\n\t\t\t\tif (typeof(name) !== 'string') {\r\n\t\t\t\t\teach(name, function(format, name) {\r\n\t\t\t\t\t\tregister(name, format);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Force format into array and add it to internal collection\r\n\t\t\t\t\tformat = format.length ? format : [format];\r\n\r\n\t\t\t\t\teach(format, function(format) {\r\n\t\t\t\t\t\t// Set deep to false by default on selector formats this to avoid removing\r\n\t\t\t\t\t\t// alignment on images inside paragraphs when alignment is changed on paragraphs\r\n\t\t\t\t\t\tif (format.deep === undefined)\r\n\t\t\t\t\t\t\tformat.deep = !format.selector;\r\n\r\n\t\t\t\t\t\t// Default to true\r\n\t\t\t\t\t\tif (format.split === undefined)\r\n\t\t\t\t\t\t\tformat.split = !format.selector || format.inline;\r\n\r\n\t\t\t\t\t\t// Default to true\r\n\t\t\t\t\t\tif (format.remove === undefined && format.selector && !format.inline)\r\n\t\t\t\t\t\t\tformat.remove = 'none';\r\n\r\n\t\t\t\t\t\t// Mark format as a mixed format inline + block level\r\n\t\t\t\t\t\tif (format.selector && format.inline) {\r\n\t\t\t\t\t\t\tformat.mixed = true;\r\n\t\t\t\t\t\t\tformat.block_expand = true;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Split classes if needed\r\n\t\t\t\t\t\tif (typeof(format.classes) === 'string')\r\n\t\t\t\t\t\t\tformat.classes = format.classes.split(/\\s+/);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tformats[name] = format;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction apply(name, vars, node) {\r\n\t\t\tvar formatList = get(name), format = formatList[0], bookmark, rng, i;\r\n\r\n\t\t\tfunction moveStart(rng) {\r\n\t\t\t\tvar container = rng.startContainer,\r\n\t\t\t\t\toffset = rng.startOffset,\r\n\t\t\t\t\twalker, node;\r\n\r\n\t\t\t\t// Move startContainer/startOffset in to a suitable node\r\n\t\t\t\tif (container.nodeType == 1 || container.nodeValue === \"\") {\r\n\t\t\t\t\tcontainer = container.nodeType == 1 ? container.childNodes[offset] : container;\r\n\r\n\t\t\t\t\t// Might fail if the offset is behind the last element in it's container\r\n\t\t\t\t\tif (container) {\r\n\t\t\t\t\t\twalker = new TreeWalker(container, container.parentNode);\r\n\t\t\t\t\t\tfor (node = walker.current(); node; node = walker.next()) {\r\n\t\t\t\t\t\t\tif (node.nodeType == 3 && !isWhiteSpaceNode(node)) {\r\n\t\t\t\t\t\t\t\trng.setStart(node, 0);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn rng;\r\n\t\t\t};\r\n\r\n\t\t\tfunction setElementFormat(elm, fmt) {\r\n\t\t\t\tfmt = fmt || format;\r\n\r\n\t\t\t\tif (elm) {\r\n\t\t\t\t\teach(fmt.styles, function(value, name) {\r\n\t\t\t\t\t\tdom.setStyle(elm, name, replaceVars(value, vars));\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\teach(fmt.attributes, function(value, name) {\r\n\t\t\t\t\t\tdom.setAttrib(elm, name, replaceVars(value, vars));\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\teach(fmt.classes, function(value) {\r\n\t\t\t\t\t\tvalue = replaceVars(value, vars);\r\n\r\n\t\t\t\t\t\tif (!dom.hasClass(elm, value))\r\n\t\t\t\t\t\t\tdom.addClass(elm, value);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tfunction applyRngStyle(rng) {\r\n\t\t\t\tvar newWrappers = [], wrapName, wrapElm;\r\n\r\n\t\t\t\t// Setup wrapper element\r\n\t\t\t\twrapName = format.inline || format.block;\r\n\t\t\t\twrapElm = dom.create(wrapName);\r\n\t\t\t\tsetElementFormat(wrapElm);\r\n\r\n\t\t\t\trangeUtils.walk(rng, function(nodes) {\r\n\t\t\t\t\tvar currentWrapElm;\r\n\r\n\t\t\t\t\tfunction process(node) {\r\n\t\t\t\t\t\tvar nodeName = node.nodeName.toLowerCase(), parentName = node.parentNode.nodeName.toLowerCase(), found;\r\n\r\n\t\t\t\t\t\t// Stop wrapping on br elements\r\n\t\t\t\t\t\tif (isEq(nodeName, 'br')) {\r\n\t\t\t\t\t\t\tcurrentWrapElm = 0;\r\n\r\n\t\t\t\t\t\t\t// Remove any br elements when we wrap things\r\n\t\t\t\t\t\t\tif (format.block)\r\n\t\t\t\t\t\t\t\tdom.remove(node);\r\n\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// If node is wrapper type\r\n\t\t\t\t\t\tif (format.wrapper && matchNode(node, name, vars)) {\r\n\t\t\t\t\t\t\tcurrentWrapElm = 0;\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Can we rename the block\r\n\t\t\t\t\t\tif (format.block && !format.wrapper && isTextBlock(nodeName)) {\r\n\t\t\t\t\t\t\tnode = dom.rename(node, wrapName);\r\n\t\t\t\t\t\t\tsetElementFormat(node);\r\n\t\t\t\t\t\t\tnewWrappers.push(node);\r\n\t\t\t\t\t\t\tcurrentWrapElm = 0;\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Handle selector patterns\r\n\t\t\t\t\t\tif (format.selector) {\r\n\t\t\t\t\t\t\t// Look for matching formats\r\n\t\t\t\t\t\t\teach(formatList, function(format) {\r\n\t\t\t\t\t\t\t\tif (dom.is(node, format.selector) && !isCaretNode(node)) {\r\n\t\t\t\t\t\t\t\t\tsetElementFormat(node, format);\r\n\t\t\t\t\t\t\t\t\tfound = true;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t// Continue processing if a selector match wasn't found and a inline element is defined\r\n\t\t\t\t\t\t\tif (!format.inline || found) {\r\n\t\t\t\t\t\t\t\tcurrentWrapElm = 0;\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Is it valid to wrap this item\r\n\t\t\t\t\t\tif (isValid(wrapName, nodeName) && isValid(parentName, wrapName)) {\r\n\t\t\t\t\t\t\t// Start wrapping\r\n\t\t\t\t\t\t\tif (!currentWrapElm) {\r\n\t\t\t\t\t\t\t\t// Wrap the node\r\n\t\t\t\t\t\t\t\tcurrentWrapElm = wrapElm.cloneNode(FALSE);\r\n\t\t\t\t\t\t\t\tnode.parentNode.insertBefore(currentWrapElm, node);\r\n\t\t\t\t\t\t\t\tnewWrappers.push(currentWrapElm);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tcurrentWrapElm.appendChild(node);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// Start a new wrapper for possible children\r\n\t\t\t\t\t\t\tcurrentWrapElm = 0;\r\n\r\n\t\t\t\t\t\t\teach(tinymce.grep(node.childNodes), process);\r\n\r\n\t\t\t\t\t\t\t// End the last wrapper\r\n\t\t\t\t\t\t\tcurrentWrapElm = 0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\t// Process siblings from range\r\n\t\t\t\t\teach(nodes, process);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Cleanup\r\n\t\t\t\teach(newWrappers, function(node) {\r\n\t\t\t\t\tvar childCount;\r\n\r\n\t\t\t\t\tfunction getChildCount(node) {\r\n\t\t\t\t\t\tvar count = 0;\r\n\r\n\t\t\t\t\t\teach(node.childNodes, function(node) {\r\n\t\t\t\t\t\t\tif (!isWhiteSpaceNode(node) && !isBookmarkNode(node))\r\n\t\t\t\t\t\t\t\tcount++;\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\treturn count;\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tfunction mergeStyles(node) {\r\n\t\t\t\t\t\tvar child, clone;\r\n\r\n\t\t\t\t\t\teach(node.childNodes, function(node) {\r\n\t\t\t\t\t\t\tif (node.nodeType == 1 && !isBookmarkNode(node) && !isCaretNode(node)) {\r\n\t\t\t\t\t\t\t\tchild = node;\r\n\t\t\t\t\t\t\t\treturn FALSE; // break loop\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t// If child was found and of the same type as the current node\r\n\t\t\t\t\t\tif (child && matchName(child, format)) {\r\n\t\t\t\t\t\t\tclone = child.cloneNode(FALSE);\r\n\t\t\t\t\t\t\tsetElementFormat(clone);\r\n\r\n\t\t\t\t\t\t\tdom.replace(clone, node, TRUE);\r\n\t\t\t\t\t\t\tdom.remove(child, 1);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn clone || node;\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tchildCount = getChildCount(node);\r\n\r\n\t\t\t\t\t// Remove empty nodes\r\n\t\t\t\t\tif (childCount === 0) {\r\n\t\t\t\t\t\tdom.remove(node, 1);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (format.inline || format.wrapper) {\r\n\t\t\t\t\t\t// Merges the current node with it's children of similar type to reduce the number of elements\r\n\t\t\t\t\t\tif (!format.exact && childCount === 1)\r\n\t\t\t\t\t\t\tnode = mergeStyles(node);\r\n\r\n\t\t\t\t\t\t// Remove/merge children\r\n\t\t\t\t\t\teach(formatList, function(format) {\r\n\t\t\t\t\t\t\t// Merge all children of similar type will move styles from child to parent\r\n\t\t\t\t\t\t\t// this: <span style=\"color:red\"><b><span style=\"color:red; font-size:10px\">text</span></b></span>\r\n\t\t\t\t\t\t\t// will become: <span style=\"color:red\"><b><span style=\"font-size:10px\">text</span></b></span>\r\n\t\t\t\t\t\t\teach(dom.select(format.inline, node), function(child) {\r\n\t\t\t\t\t\t\t\tremoveFormat(format, vars, child, format.exact ? child : null);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t// Remove child if direct parent is of same type\r\n\t\t\t\t\t\tif (matchNode(node.parentNode, name, vars)) {\r\n\t\t\t\t\t\t\tdom.remove(node, 1);\r\n\t\t\t\t\t\t\tnode = 0;\r\n\t\t\t\t\t\t\treturn TRUE;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Look for parent with similar style format\r\n\t\t\t\t\t\tif (format.merge_with_parents) {\r\n\t\t\t\t\t\t\tdom.getParent(node.parentNode, function(parent) {\r\n\t\t\t\t\t\t\t\tif (matchNode(parent, name, vars)) {\r\n\t\t\t\t\t\t\t\t\tdom.remove(node, 1);\r\n\t\t\t\t\t\t\t\t\tnode = 0;\r\n\t\t\t\t\t\t\t\t\treturn TRUE;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Merge next and previous siblings if they are similar <b>text</b><b>text</b> becomes <b>texttext</b>\r\n\t\t\t\t\t\tif (node) {\r\n\t\t\t\t\t\t\tnode = mergeSiblings(getNonWhiteSpaceSibling(node), node);\r\n\t\t\t\t\t\t\tnode = mergeSiblings(node, getNonWhiteSpaceSibling(node, TRUE));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\tif (format) {\r\n\t\t\t\tif (node) {\r\n\t\t\t\t\trng = dom.createRng();\r\n\r\n\t\t\t\t\trng.setStartBefore(node);\r\n\t\t\t\t\trng.setEndAfter(node);\r\n\r\n\t\t\t\t\tapplyRngStyle(expandRng(rng, formatList));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (!selection.isCollapsed() || !format.inline) {\r\n\t\t\t\t\t\t// Apply formatting to selection\r\n\t\t\t\t\t\tbookmark = selection.getBookmark();\r\n\t\t\t\t\t\tapplyRngStyle(expandRng(selection.getRng(TRUE), formatList));\r\n\r\n\t\t\t\t\t\tselection.moveToBookmark(bookmark);\r\n\t\t\t\t\t\tselection.setRng(moveStart(selection.getRng(TRUE)));\r\n\t\t\t\t\t\ted.nodeChanged();\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\tperformCaretAction('apply', name, vars);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction remove(name, vars, node) {\r\n\t\t\tvar formatList = get(name), format = formatList[0], bookmark, i, rng;\r\n\r\n\t\t\tfunction moveStart(rng) {\r\n\t\t\t\tvar container = rng.startContainer,\r\n\t\t\t\t\toffset = rng.startOffset,\r\n\t\t\t\t\twalker, node, nodes, tmpNode;\r\n\r\n\t\t\t\t// Convert text node into index if possible\r\n\t\t\t\tif (container.nodeType == 3 && offset >= container.nodeValue.length - 1) {\r\n\t\t\t\t\tcontainer = container.parentNode;\r\n\t\t\t\t\toffset = nodeIndex(container) + 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Move startContainer/startOffset in to a suitable node\r\n\t\t\t\tif (container.nodeType == 1) {\r\n\t\t\t\t\tnodes = container.childNodes;\r\n\t\t\t\t\tcontainer = nodes[Math.min(offset, nodes.length - 1)];\r\n\t\t\t\t\twalker = new TreeWalker(container);\r\n\r\n\t\t\t\t\t// If offset is at end of the parent node walk to the next one\r\n\t\t\t\t\tif (offset > nodes.length - 1)\r\n\t\t\t\t\t\twalker.next();\r\n\r\n\t\t\t\t\tfor (node = walker.current(); node; node = walker.next()) {\r\n\t\t\t\t\t\tif (node.nodeType == 3 && !isWhiteSpaceNode(node)) {\r\n\t\t\t\t\t\t\t// IE has a \"neat\" feature where it moves the start node into the closest element\r\n\t\t\t\t\t\t\t// we can avoid this by inserting an element before it and then remove it after we set the selection\r\n\t\t\t\t\t\t\ttmpNode = dom.create('a', null, INVISIBLE_CHAR);\r\n\t\t\t\t\t\t\tnode.parentNode.insertBefore(tmpNode, node);\r\n\r\n\t\t\t\t\t\t\t// Set selection and remove tmpNode\r\n\t\t\t\t\t\t\trng.setStart(node, 0);\r\n\t\t\t\t\t\t\tselection.setRng(rng);\r\n\t\t\t\t\t\t\tdom.remove(tmpNode);\r\n\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t// Merges the styles for each node\r\n\t\t\tfunction process(node) {\r\n\t\t\t\tvar children, i, l;\r\n\r\n\t\t\t\t// Grab the children first since the nodelist might be changed\r\n\t\t\t\tchildren = tinymce.grep(node.childNodes);\r\n\r\n\t\t\t\t// Process current node\r\n\t\t\t\tfor (i = 0, l = formatList.length; i < l; i++) {\r\n\t\t\t\t\tif (removeFormat(formatList[i], vars, node, node))\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Process the children\r\n\t\t\t\tif (format.deep) {\r\n\t\t\t\t\tfor (i = 0, l = children.length; i < l; i++)\r\n\t\t\t\t\t\tprocess(children[i]);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tfunction findFormatRoot(container) {\r\n\t\t\t\tvar formatRoot;\r\n\r\n\t\t\t\t// Find format root\r\n\t\t\t\teach(getParents(container.parentNode).reverse(), function(parent) {\r\n\t\t\t\t\tvar format;\r\n\r\n\t\t\t\t\t// Find format root element\r\n\t\t\t\t\tif (!formatRoot && parent.id != '_start' && parent.id != '_end') {\r\n\t\t\t\t\t\t// Is the node matching the format we are looking for\r\n\t\t\t\t\t\tformat = matchNode(parent, name, vars);\r\n\t\t\t\t\t\tif (format && format.split !== false)\r\n\t\t\t\t\t\t\tformatRoot = parent;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn formatRoot;\r\n\t\t\t};\r\n\r\n\t\t\tfunction wrapAndSplit(format_root, container, target, split) {\r\n\t\t\t\tvar parent, clone, lastClone, firstClone, i, formatRootParent;\r\n\r\n\t\t\t\t// Format root found then clone formats and split it\r\n\t\t\t\tif (format_root) {\r\n\t\t\t\t\tformatRootParent = format_root.parentNode;\r\n\r\n\t\t\t\t\tfor (parent = container.parentNode; parent && parent != formatRootParent; parent = parent.parentNode) {\r\n\t\t\t\t\t\tclone = parent.cloneNode(FALSE);\r\n\r\n\t\t\t\t\t\tfor (i = 0; i < formatList.length; i++) {\r\n\t\t\t\t\t\t\tif (removeFormat(formatList[i], vars, clone, clone)) {\r\n\t\t\t\t\t\t\t\tclone = 0;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Build wrapper node\r\n\t\t\t\t\t\tif (clone) {\r\n\t\t\t\t\t\t\tif (lastClone)\r\n\t\t\t\t\t\t\t\tclone.appendChild(lastClone);\r\n\r\n\t\t\t\t\t\t\tif (!firstClone)\r\n\t\t\t\t\t\t\t\tfirstClone = clone;\r\n\r\n\t\t\t\t\t\t\tlastClone = clone;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Never split block elements if the format is mixed\r\n\t\t\t\t\tif (split && (!format.mixed || !isBlock(format_root)))\r\n\t\t\t\t\t\tcontainer = dom.split(format_root, container);\r\n\r\n\t\t\t\t\t// Wrap container in cloned formats\r\n\t\t\t\t\tif (lastClone) {\r\n\t\t\t\t\t\ttarget.parentNode.insertBefore(lastClone, target);\r\n\t\t\t\t\t\tfirstClone.appendChild(target);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn container;\r\n\t\t\t};\r\n\r\n\t\t\tfunction splitToFormatRoot(container) {\r\n\t\t\t\treturn wrapAndSplit(findFormatRoot(container), container, container, true);\r\n\t\t\t};\r\n\r\n\t\t\tfunction unwrap(start) {\r\n\t\t\t\tvar node = dom.get(start ? '_start' : '_end'),\r\n\t\t\t\t\tout = node[start ? 'firstChild' : 'lastChild'];\r\n\r\n\t\t\t\t// If the end is placed within the start the result will be removed\r\n\t\t\t\t// So this checks if the out node is a bookmark node if it is it\r\n\t\t\t\t// checks for another more suitable node\r\n\t\t\t\tif (isBookmarkNode(out))\r\n\t\t\t\t\tout = out[start ? 'firstChild' : 'lastChild'];\r\n\r\n\t\t\t\tdom.remove(node, true);\r\n\r\n\t\t\t\treturn out;\r\n\t\t\t};\r\n\r\n\t\t\tfunction removeRngStyle(rng) {\r\n\t\t\t\tvar startContainer, endContainer;\r\n\r\n\t\t\t\trng = expandRng(rng, formatList, TRUE);\r\n\r\n\t\t\t\tif (format.split) {\r\n\t\t\t\t\tstartContainer = getContainer(rng, TRUE);\r\n\t\t\t\t\tendContainer = getContainer(rng);\r\n\r\n\t\t\t\t\tif (startContainer != endContainer) {\r\n\t\t\t\t\t\t// Wrap start/end nodes in span element since these might be cloned/moved\r\n\t\t\t\t\t\tstartContainer = wrap(startContainer, 'span', {id : '_start', _mce_type : 'bookmark'});\r\n\t\t\t\t\t\tendContainer = wrap(endContainer, 'span', {id : '_end', _mce_type : 'bookmark'});\r\n\r\n\t\t\t\t\t\t// Split start/end\r\n\t\t\t\t\t\tsplitToFormatRoot(startContainer);\r\n\t\t\t\t\t\tsplitToFormatRoot(endContainer);\r\n\r\n\t\t\t\t\t\t// Unwrap start/end to get real elements again\r\n\t\t\t\t\t\tstartContainer = unwrap(TRUE);\r\n\t\t\t\t\t\tendContainer = unwrap();\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\tstartContainer = endContainer = splitToFormatRoot(startContainer);\r\n\r\n\t\t\t\t\t// Update range positions since they might have changed after the split operations\r\n\t\t\t\t\trng.startContainer = startContainer.parentNode;\r\n\t\t\t\t\trng.startOffset = nodeIndex(startContainer);\r\n\t\t\t\t\trng.endContainer = endContainer.parentNode;\r\n\t\t\t\t\trng.endOffset = nodeIndex(endContainer) + 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Remove items between start/end\r\n\t\t\t\trangeUtils.walk(rng, function(nodes) {\r\n\t\t\t\t\teach(nodes, function(node) {\r\n\t\t\t\t\t\tprocess(node);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\t// Handle node\r\n\t\t\tif (node) {\r\n\t\t\t\trng = dom.createRng();\r\n\t\t\t\trng.setStartBefore(node);\r\n\t\t\t\trng.setEndAfter(node);\r\n\t\t\t\tremoveRngStyle(rng);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (!selection.isCollapsed() || !format.inline) {\r\n\t\t\t\tbookmark = selection.getBookmark();\r\n\t\t\t\tremoveRngStyle(selection.getRng(TRUE));\r\n\t\t\t\tselection.moveToBookmark(bookmark);\r\n\r\n\t\t\t\t// Check if start element still has formatting then we are at: \"<b>text|</b>text\" and need to move the start into the next text node\r\n\t\t\t\tif (match(name, vars, selection.getStart())) {\r\n\t\t\t\t\tmoveStart(selection.getRng(true));\r\n\t\t\t\t}\r\n\r\n\t\t\t\ted.nodeChanged();\r\n\t\t\t} else\r\n\t\t\t\tperformCaretAction('remove', name, vars);\r\n\t\t};\r\n\r\n\t\tfunction toggle(name, vars, node) {\r\n\t\t\tif (match(name, vars, node))\r\n\t\t\t\tremove(name, vars, node);\r\n\t\t\telse\r\n\t\t\t\tapply(name, vars, node);\r\n\t\t};\r\n\r\n\t\tfunction matchNode(node, name, vars, similar) {\r\n\t\t\tvar formatList = get(name), format, i, classes;\r\n\r\n\t\t\tfunction matchItems(node, format, item_name) {\r\n\t\t\t\tvar key, value, items = format[item_name], i;\r\n\r\n\t\t\t\t// Check all items\r\n\t\t\t\tif (items) {\r\n\t\t\t\t\t// Non indexed object\r\n\t\t\t\t\tif (items.length === undefined) {\r\n\t\t\t\t\t\tfor (key in items) {\r\n\t\t\t\t\t\t\tif (items.hasOwnProperty(key)) {\r\n\t\t\t\t\t\t\t\tif (item_name === 'attributes')\r\n\t\t\t\t\t\t\t\t\tvalue = dom.getAttrib(node, key);\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tvalue = getStyle(node, key);\r\n\r\n\t\t\t\t\t\t\t\tif (similar && !value && !format.exact)\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\t\t\tif ((!similar || format.exact) && !isEq(value, replaceVars(items[key], vars)))\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Only one match needed for indexed arrays\r\n\t\t\t\t\t\tfor (i = 0; i < items.length; i++) {\r\n\t\t\t\t\t\t\tif (item_name === 'attributes' ? dom.getAttrib(node, items[i]) : getStyle(node, items[i]))\r\n\t\t\t\t\t\t\t\treturn format;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn format;\r\n\t\t\t};\r\n\r\n\t\t\tif (formatList && node) {\r\n\t\t\t\t// Check each format in list\r\n\t\t\t\tfor (i = 0; i < formatList.length; i++) {\r\n\t\t\t\t\tformat = formatList[i];\r\n\r\n\t\t\t\t\t// Name name, attributes, styles and classes\r\n\t\t\t\t\tif (matchName(node, format) && matchItems(node, format, 'attributes') && matchItems(node, format, 'styles')) {\r\n\t\t\t\t\t\t// Match classes\r\n\t\t\t\t\t\tif (classes = format.classes) {\r\n\t\t\t\t\t\t\tfor (i = 0; i < classes.length; i++) {\r\n\t\t\t\t\t\t\t\tif (!dom.hasClass(node, classes[i]))\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn format;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction match(name, vars, node) {\r\n\t\t\tvar startNode, i;\r\n\r\n\t\t\tfunction matchParents(node) {\r\n\t\t\t\t// Find first node with similar format settings\r\n\t\t\t\tnode = dom.getParent(node, function(node) {\r\n\t\t\t\t\treturn !!matchNode(node, name, vars, true);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Do an exact check on the similar format element\r\n\t\t\t\treturn matchNode(node, name, vars);\r\n\t\t\t};\r\n\r\n\t\t\t// Check specified node\r\n\t\t\tif (node)\r\n\t\t\t\treturn matchParents(node);\r\n\r\n\t\t\t// Check pending formats\r\n\t\t\tif (selection.isCollapsed()) {\r\n\t\t\t\tfor (i = pendingFormats.apply.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tif (pendingFormats.apply[i].name == name)\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (i = pendingFormats.remove.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tif (pendingFormats.remove[i].name == name)\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn matchParents(selection.getNode());\r\n\t\t\t}\r\n\r\n\t\t\t// Check selected node\r\n\t\t\tnode = selection.getNode();\r\n\t\t\tif (matchParents(node))\r\n\t\t\t\treturn TRUE;\r\n\r\n\t\t\t// Check start node if it's different\r\n\t\t\tstartNode = selection.getStart();\r\n\t\t\tif (startNode != node) {\r\n\t\t\t\tif (matchParents(startNode))\r\n\t\t\t\t\treturn TRUE;\r\n\t\t\t}\r\n\r\n\t\t\treturn FALSE;\r\n\t\t};\r\n\r\n\t\tfunction matchAll(names, vars) {\r\n\t\t\tvar startElement, matchedFormatNames = [], checkedMap = {}, i, ni, name;\r\n\r\n\t\t\t// If the selection is collapsed then check pending formats\r\n\t\t\tif (selection.isCollapsed()) {\r\n\t\t\t\tfor (ni = 0; ni < names.length; ni++) {\r\n\t\t\t\t\t// If the name is to be removed, then stop it from being added\r\n\t\t\t\t\tfor (i = pendingFormats.remove.length - 1; i >= 0; i--) {\r\n\t\t\t\t\t\tname = names[ni];\r\n\r\n\t\t\t\t\t\tif (pendingFormats.remove[i].name == name) {\r\n\t\t\t\t\t\t\tcheckedMap[name] = true;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// If the format is to be applied\r\n\t\t\t\tfor (i = pendingFormats.apply.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tfor (ni = 0; ni < names.length; ni++) {\r\n\t\t\t\t\t\tname = names[ni];\r\n\r\n\t\t\t\t\t\tif (!checkedMap[name] && pendingFormats.apply[i].name == name) {\r\n\t\t\t\t\t\t\tcheckedMap[name] = true;\r\n\t\t\t\t\t\t\tmatchedFormatNames.push(name);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Check start of selection for formats\r\n\t\t\tstartElement = selection.getStart();\r\n\t\t\tdom.getParent(startElement, function(node) {\r\n\t\t\t\tvar i, name;\r\n\r\n\t\t\t\tfor (i = 0; i < names.length; i++) {\r\n\t\t\t\t\tname = names[i];\r\n\r\n\t\t\t\t\tif (!checkedMap[name] && matchNode(node, name, vars)) {\r\n\t\t\t\t\t\tcheckedMap[name] = true;\r\n\t\t\t\t\t\tmatchedFormatNames.push(name);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn matchedFormatNames;\r\n\t\t};\r\n\r\n\t\tfunction canApply(name) {\r\n\t\t\tvar formatList = get(name), startNode, parents, i, x, selector;\r\n\r\n\t\t\tif (formatList) {\r\n\t\t\t\tstartNode = selection.getStart();\r\n\t\t\t\tparents = getParents(startNode);\r\n\r\n\t\t\t\tfor (x = formatList.length - 1; x >= 0; x--) {\r\n\t\t\t\t\tselector = formatList[x].selector;\r\n\r\n\t\t\t\t\t// Format is not selector based, then always return TRUE\r\n\t\t\t\t\tif (!selector)\r\n\t\t\t\t\t\treturn TRUE;\r\n\r\n\t\t\t\t\tfor (i = parents.length - 1; i >= 0; i--) {\r\n\t\t\t\t\t\tif (dom.is(parents[i], selector))\r\n\t\t\t\t\t\t\treturn TRUE;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn FALSE;\r\n\t\t};\r\n\r\n\t\t// Expose to public\r\n\t\ttinymce.extend(this, {\r\n\t\t\tget : get,\r\n\t\t\tregister : register,\r\n\t\t\tapply : apply,\r\n\t\t\tremove : remove,\r\n\t\t\ttoggle : toggle,\r\n\t\t\tmatch : match,\r\n\t\t\tmatchAll : matchAll,\r\n\t\t\tmatchNode : matchNode,\r\n\t\t\tcanApply : canApply\r\n\t\t});\r\n\r\n\t\t// Private functions\r\n\r\n\t\tfunction matchName(node, format) {\r\n\t\t\t// Check for inline match\r\n\t\t\tif (isEq(node, format.inline))\r\n\t\t\t\treturn TRUE;\r\n\r\n\t\t\t// Check for block match\r\n\t\t\tif (isEq(node, format.block))\r\n\t\t\t\treturn TRUE;\r\n\r\n\t\t\t// Check for selector match\r\n\t\t\tif (format.selector)\r\n\t\t\t\treturn dom.is(node, format.selector);\r\n\t\t};\r\n\r\n\t\tfunction isEq(str1, str2) {\r\n\t\t\tstr1 = str1 || '';\r\n\t\t\tstr2 = str2 || '';\r\n\r\n\t\t\tstr1 = '' + (str1.nodeName || str1);\r\n\t\t\tstr2 = '' + (str2.nodeName || str2);\r\n\r\n\t\t\treturn str1.toLowerCase() == str2.toLowerCase();\r\n\t\t};\r\n\r\n\t\tfunction getStyle(node, name) {\r\n\t\t\tvar styleVal = dom.getStyle(node, name);\r\n\r\n\t\t\t// Force the format to hex\r\n\t\t\tif (name == 'color' || name == 'backgroundColor')\r\n\t\t\t\tstyleVal = dom.toHex(styleVal);\r\n\r\n\t\t\t// Opera will return bold as 700\r\n\t\t\tif (name == 'fontWeight' && styleVal == 700)\r\n\t\t\t\tstyleVal = 'bold';\r\n\r\n\t\t\treturn '' + styleVal;\r\n\t\t};\r\n\r\n\t\tfunction replaceVars(value, vars) {\r\n\t\t\tif (typeof(value) != \"string\")\r\n\t\t\t\tvalue = value(vars);\r\n\t\t\telse if (vars) {\r\n\t\t\t\tvalue = value.replace(/%(\\w+)/g, function(str, name) {\r\n\t\t\t\t\treturn vars[name] || str;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn value;\r\n\t\t};\r\n\r\n\t\tfunction isWhiteSpaceNode(node) {\r\n\t\t\treturn node && node.nodeType === 3 && /^([\\s\\r\\n]+|)$/.test(node.nodeValue);\r\n\t\t};\r\n\r\n\t\tfunction wrap(node, name, attrs) {\r\n\t\t\tvar wrapper = dom.create(name, attrs);\r\n\r\n\t\t\tnode.parentNode.insertBefore(wrapper, node);\r\n\t\t\twrapper.appendChild(node);\r\n\r\n\t\t\treturn wrapper;\r\n\t\t};\r\n\r\n\t\tfunction expandRng(rng, format, remove) {\r\n\t\t\tvar startContainer = rng.startContainer,\r\n\t\t\t\tstartOffset = rng.startOffset,\r\n\t\t\t\tendContainer = rng.endContainer,\r\n\t\t\t\tendOffset = rng.endOffset, sibling, lastIdx;\r\n\r\n\t\t\t// This function walks up the tree if there is no siblings before/after the node\r\n\t\t\tfunction findParentContainer(container, child_name, sibling_name, root) {\r\n\t\t\t\tvar parent, child;\r\n\r\n\t\t\t\troot = root || dom.getRoot();\r\n\r\n\t\t\t\tfor (;;) {\r\n\t\t\t\t\t// Check if we can move up are we at root level or body level\r\n\t\t\t\t\tparent = container.parentNode;\r\n\r\n\t\t\t\t\t// Stop expanding on block elements or root depending on format\r\n\t\t\t\t\tif (parent == root || (!format[0].block_expand && isBlock(parent)))\r\n\t\t\t\t\t\treturn container;\r\n\r\n\t\t\t\t\tfor (sibling = parent[child_name]; sibling && sibling != container; sibling = sibling[sibling_name]) {\r\n\t\t\t\t\t\tif (sibling.nodeType == 1 && !isBookmarkNode(sibling))\r\n\t\t\t\t\t\t\treturn container;\r\n\r\n\t\t\t\t\t\tif (sibling.nodeType == 3 && !isWhiteSpaceNode(sibling))\r\n\t\t\t\t\t\t\treturn container;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcontainer = container.parentNode;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn container;\r\n\t\t\t};\r\n\r\n\t\t\t// If index based start position then resolve it\r\n\t\t\tif (startContainer.nodeType == 1 && startContainer.hasChildNodes()) {\r\n\t\t\t\tlastIdx = startContainer.childNodes.length - 1;\r\n\t\t\t\tstartContainer = startContainer.childNodes[startOffset > lastIdx ? lastIdx : startOffset];\r\n\r\n\t\t\t\tif (startContainer.nodeType == 3)\r\n\t\t\t\t\tstartOffset = 0;\r\n\t\t\t}\r\n\r\n\t\t\t// If index based end position then resolve it\r\n\t\t\tif (endContainer.nodeType == 1 && endContainer.hasChildNodes()) {\r\n\t\t\t\tlastIdx = endContainer.childNodes.length - 1;\r\n\t\t\t\tendContainer = endContainer.childNodes[endOffset > lastIdx ? lastIdx : endOffset - 1];\r\n\r\n\t\t\t\tif (endContainer.nodeType == 3)\r\n\t\t\t\t\tendOffset = endContainer.nodeValue.length;\r\n\t\t\t}\r\n\r\n\t\t\t// Exclude bookmark nodes if possible\r\n\t\t\tif (isBookmarkNode(startContainer.parentNode))\r\n\t\t\t\tstartContainer = startContainer.parentNode;\r\n\r\n\t\t\tif (isBookmarkNode(startContainer))\r\n\t\t\t\tstartContainer = startContainer.nextSibling || startContainer;\r\n\r\n\t\t\tif (isBookmarkNode(endContainer.parentNode))\r\n\t\t\t\tendContainer = endContainer.parentNode;\r\n\r\n\t\t\tif (isBookmarkNode(endContainer))\r\n\t\t\t\tendContainer = endContainer.previousSibling || endContainer;\r\n\r\n\t\t\t// Move start/end point up the tree if the leaves are sharp and if we are in different containers\r\n\t\t\t// Example * becomes !: !<p><b><i>*text</i><i>text*</i></b></p>!\r\n\t\t\t// This will reduce the number of wrapper elements that needs to be created\r\n\t\t\t// Move start point up the tree\r\n\t\t\tif (format[0].inline || format[0].block_expand) {\r\n\t\t\t\tstartContainer = findParentContainer(startContainer, 'firstChild', 'nextSibling');\r\n\t\t\t\tendContainer = findParentContainer(endContainer, 'lastChild', 'previousSibling');\r\n\t\t\t}\r\n\r\n\t\t\t// Expand start/end container to matching selector\r\n\t\t\tif (format[0].selector && format[0].expand !== FALSE && !format[0].inline) {\r\n\t\t\t\tfunction findSelectorEndPoint(container, sibling_name) {\r\n\t\t\t\t\tvar parents, i, y;\r\n\r\n\t\t\t\t\tif (container.nodeType == 3 && container.nodeValue.length == 0 && container[sibling_name])\r\n\t\t\t\t\t\tcontainer = container[sibling_name];\r\n\r\n\t\t\t\t\tparents = getParents(container);\r\n\t\t\t\t\tfor (i = 0; i < parents.length; i++) {\r\n\t\t\t\t\t\tfor (y = 0; y < format.length; y++) {\r\n\t\t\t\t\t\t\tif (dom.is(parents[i], format[y].selector))\r\n\t\t\t\t\t\t\t\treturn parents[i];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn container;\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Find new startContainer/endContainer if there is better one\r\n\t\t\t\tstartContainer = findSelectorEndPoint(startContainer, 'previousSibling');\r\n\t\t\t\tendContainer = findSelectorEndPoint(endContainer, 'nextSibling');\r\n\t\t\t}\r\n\r\n\t\t\t// Expand start/end container to matching block element or text node\r\n\t\t\tif (format[0].block || format[0].selector) {\r\n\t\t\t\tfunction findBlockEndPoint(container, sibling_name, sibling_name2) {\r\n\t\t\t\t\tvar node;\r\n\r\n\t\t\t\t\t// Expand to block of similar type\r\n\t\t\t\t\tif (!format[0].wrapper)\r\n\t\t\t\t\t\tnode = dom.getParent(container, format[0].block);\r\n\r\n\t\t\t\t\t// Expand to first wrappable block element or any block element\r\n\t\t\t\t\tif (!node)\r\n\t\t\t\t\t\tnode = dom.getParent(container.nodeType == 3 ? container.parentNode : container, isBlock);\r\n\r\n\t\t\t\t\t// Exclude inner lists from wrapping\r\n\t\t\t\t\tif (node && format[0].wrapper)\r\n\t\t\t\t\t\tnode = getParents(node, 'ul,ol').reverse()[0] || node;\r\n\r\n\t\t\t\t\t// Didn't find a block element look for first/last wrappable element\r\n\t\t\t\t\tif (!node) {\r\n\t\t\t\t\t\tnode = container;\r\n\r\n\t\t\t\t\t\twhile (node[sibling_name] && !isBlock(node[sibling_name])) {\r\n\t\t\t\t\t\t\tnode = node[sibling_name];\r\n\r\n\t\t\t\t\t\t\t// Break on BR but include it will be removed later on\r\n\t\t\t\t\t\t\t// we can't remove it now since we need to check if it can be wrapped\r\n\t\t\t\t\t\t\tif (isEq(node, 'br'))\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn node || container;\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Find new startContainer/endContainer if there is better one\r\n\t\t\t\tstartContainer = findBlockEndPoint(startContainer, 'previousSibling');\r\n\t\t\t\tendContainer = findBlockEndPoint(endContainer, 'nextSibling');\r\n\r\n\t\t\t\t// Non block element then try to expand up the leaf\r\n\t\t\t\tif (format[0].block) {\r\n\t\t\t\t\tif (!isBlock(startContainer))\r\n\t\t\t\t\t\tstartContainer = findParentContainer(startContainer, 'firstChild', 'nextSibling');\r\n\r\n\t\t\t\t\tif (!isBlock(endContainer))\r\n\t\t\t\t\t\tendContainer = findParentContainer(endContainer, 'lastChild', 'previousSibling');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Setup index for startContainer\r\n\t\t\tif (startContainer.nodeType == 1) {\r\n\t\t\t\tstartOffset = nodeIndex(startContainer);\r\n\t\t\t\tstartContainer = startContainer.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\t// Setup index for endContainer\r\n\t\t\tif (endContainer.nodeType == 1) {\r\n\t\t\t\tendOffset = nodeIndex(endContainer) + 1;\r\n\t\t\t\tendContainer = endContainer.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\t// Return new range like object\r\n\t\t\treturn {\r\n\t\t\t\tstartContainer : startContainer,\r\n\t\t\t\tstartOffset : startOffset,\r\n\t\t\t\tendContainer : endContainer,\r\n\t\t\t\tendOffset : endOffset\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tfunction removeFormat(format, vars, node, compare_node) {\r\n\t\t\tvar i, attrs, stylesModified;\r\n\r\n\t\t\t// Check if node matches format\r\n\t\t\tif (!matchName(node, format))\r\n\t\t\t\treturn FALSE;\r\n\r\n\t\t\t// Should we compare with format attribs and styles\r\n\t\t\tif (format.remove != 'all') {\r\n\t\t\t\t// Remove styles\r\n\t\t\t\teach(format.styles, function(value, name) {\r\n\t\t\t\t\tvalue = replaceVars(value, vars);\r\n\r\n\t\t\t\t\t// Indexed array\r\n\t\t\t\t\tif (typeof(name) === 'number') {\r\n\t\t\t\t\t\tname = value;\r\n\t\t\t\t\t\tcompare_node = 0;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!compare_node || isEq(getStyle(compare_node, name), value))\r\n\t\t\t\t\t\tdom.setStyle(node, name, '');\r\n\r\n\t\t\t\t\tstylesModified = 1;\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Remove style attribute if it's empty\r\n\t\t\t\tif (stylesModified && dom.getAttrib(node, 'style') == '') {\r\n\t\t\t\t\tnode.removeAttribute('style');\r\n\t\t\t\t\tnode.removeAttribute('_mce_style');\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Remove attributes\r\n\t\t\t\teach(format.attributes, function(value, name) {\r\n\t\t\t\t\tvar valueOut;\r\n\r\n\t\t\t\t\tvalue = replaceVars(value, vars);\r\n\r\n\t\t\t\t\t// Indexed array\r\n\t\t\t\t\tif (typeof(name) === 'number') {\r\n\t\t\t\t\t\tname = value;\r\n\t\t\t\t\t\tcompare_node = 0;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!compare_node || isEq(dom.getAttrib(compare_node, name), value)) {\r\n\t\t\t\t\t\t// Keep internal classes\r\n\t\t\t\t\t\tif (name == 'class') {\r\n\t\t\t\t\t\t\tvalue = dom.getAttrib(node, name);\r\n\t\t\t\t\t\t\tif (value) {\r\n\t\t\t\t\t\t\t\t// Build new class value where everything is removed except the internal prefixed classes\r\n\t\t\t\t\t\t\t\tvalueOut = '';\r\n\t\t\t\t\t\t\t\teach(value.split(/\\s+/), function(cls) {\r\n\t\t\t\t\t\t\t\t\tif (/mce\\w+/.test(cls))\r\n\t\t\t\t\t\t\t\t\t\tvalueOut += (valueOut ? ' ' : '') + cls;\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t// We got some internal classes left\r\n\t\t\t\t\t\t\t\tif (valueOut) {\r\n\t\t\t\t\t\t\t\t\tdom.setAttrib(node, name, valueOut);\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// IE6 has a bug where the attribute doesn't get removed correctly\r\n\t\t\t\t\t\tif (name == \"class\")\r\n\t\t\t\t\t\t\tnode.removeAttribute('className');\r\n\r\n\t\t\t\t\t\t// Remove mce prefixed attributes\r\n\t\t\t\t\t\tif (MCE_ATTR_RE.test(name))\r\n\t\t\t\t\t\t\tnode.removeAttribute('_mce_' + name);\r\n\r\n\t\t\t\t\t\tnode.removeAttribute(name);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Remove classes\r\n\t\t\t\teach(format.classes, function(value) {\r\n\t\t\t\t\tvalue = replaceVars(value, vars);\r\n\r\n\t\t\t\t\tif (!compare_node || dom.hasClass(compare_node, value))\r\n\t\t\t\t\t\tdom.removeClass(node, value);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Check for non internal attributes\r\n\t\t\t\tattrs = dom.getAttribs(node);\r\n\t\t\t\tfor (i = 0; i < attrs.length; i++) {\r\n\t\t\t\t\tif (attrs[i].nodeName.indexOf('_') !== 0)\r\n\t\t\t\t\t\treturn FALSE;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Remove the inline child if it's empty for example <b> or <span>\r\n\t\t\tif (format.remove != 'none') {\r\n\t\t\t\tremoveNode(node, format);\r\n\t\t\t\treturn TRUE;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction removeNode(node, format) {\r\n\t\t\tvar parentNode = node.parentNode, rootBlockElm;\r\n\r\n\t\t\tif (format.block) {\r\n\t\t\t\tif (!forcedRootBlock) {\r\n\t\t\t\t\tfunction find(node, next, inc) {\r\n\t\t\t\t\t\tnode = getNonWhiteSpaceSibling(node, next, inc);\r\n\r\n\t\t\t\t\t\treturn !node || (node.nodeName == 'BR' || isBlock(node));\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\t// Append BR elements if needed before we remove the block\r\n\t\t\t\t\tif (isBlock(node) && !isBlock(parentNode)) {\r\n\t\t\t\t\t\tif (!find(node, FALSE) && !find(node.firstChild, TRUE, 1))\r\n\t\t\t\t\t\t\tnode.insertBefore(dom.create('br'), node.firstChild);\r\n\r\n\t\t\t\t\t\tif (!find(node, TRUE) && !find(node.lastChild, FALSE, 1))\r\n\t\t\t\t\t\t\tnode.appendChild(dom.create('br'));\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Wrap the block in a forcedRootBlock if we are at the root of document\r\n\t\t\t\t\tif (parentNode == dom.getRoot()) {\r\n\t\t\t\t\t\tif (!format.list_block || !isEq(node, format.list_block)) {\r\n\t\t\t\t\t\t\teach(tinymce.grep(node.childNodes), function(node) {\r\n\t\t\t\t\t\t\t\tif (isValid(forcedRootBlock, node.nodeName.toLowerCase())) {\r\n\t\t\t\t\t\t\t\t\tif (!rootBlockElm)\r\n\t\t\t\t\t\t\t\t\t\trootBlockElm = wrap(node, forcedRootBlock);\r\n\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\trootBlockElm.appendChild(node);\r\n\t\t\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\t\t\trootBlockElm = 0;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Never remove nodes that isn't the specified inline element if a selector is specified too\r\n\t\t\tif (format.selector && format.inline && !isEq(format.inline, node))\r\n\t\t\t\treturn;\r\n\r\n\t\t\tdom.remove(node, 1);\r\n\t\t};\r\n\r\n\t\tfunction getNonWhiteSpaceSibling(node, next, inc) {\r\n\t\t\tif (node) {\r\n\t\t\t\tnext = next ? 'nextSibling' : 'previousSibling';\r\n\r\n\t\t\t\tfor (node = inc ? node : node[next]; node; node = node[next]) {\r\n\t\t\t\t\tif (node.nodeType == 1 || !isWhiteSpaceNode(node))\r\n\t\t\t\t\t\treturn node;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction isBookmarkNode(node) {\r\n\t\t\treturn node && node.nodeType == 1 && node.getAttribute('_mce_type') == 'bookmark';\r\n\t\t};\r\n\r\n\t\tfunction mergeSiblings(prev, next) {\r\n\t\t\tvar marker, sibling, tmpSibling;\r\n\r\n\t\t\tfunction compareElements(node1, node2) {\r\n\t\t\t\t// Not the same name\r\n\t\t\t\tif (node1.nodeName != node2.nodeName)\r\n\t\t\t\t\treturn FALSE;\r\n\r\n\t\t\t\tfunction getAttribs(node) {\r\n\t\t\t\t\tvar attribs = {};\r\n\r\n\t\t\t\t\teach(dom.getAttribs(node), function(attr) {\r\n\t\t\t\t\t\tvar name = attr.nodeName.toLowerCase();\r\n\r\n\t\t\t\t\t\t// Don't compare internal attributes or style\r\n\t\t\t\t\t\tif (name.indexOf('_') !== 0 && name !== 'style')\r\n\t\t\t\t\t\t\tattribs[name] = dom.getAttrib(node, name);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\treturn attribs;\r\n\t\t\t\t};\r\n\r\n\t\t\t\tfunction compareObjects(obj1, obj2) {\r\n\t\t\t\t\tvar value, name;\r\n\r\n\t\t\t\t\tfor (name in obj1) {\r\n\t\t\t\t\t\t// Obj1 has item obj2 doesn't have\r\n\t\t\t\t\t\tif (obj1.hasOwnProperty(name)) {\r\n\t\t\t\t\t\t\tvalue = obj2[name];\r\n\r\n\t\t\t\t\t\t\t// Obj2 doesn't have obj1 item\r\n\t\t\t\t\t\t\tif (value === undefined)\r\n\t\t\t\t\t\t\t\treturn FALSE;\r\n\r\n\t\t\t\t\t\t\t// Obj2 item has a different value\r\n\t\t\t\t\t\t\tif (obj1[name] != value)\r\n\t\t\t\t\t\t\t\treturn FALSE;\r\n\r\n\t\t\t\t\t\t\t// Delete similar value\r\n\t\t\t\t\t\t\tdelete obj2[name];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Check if obj 2 has something obj 1 doesn't have\r\n\t\t\t\t\tfor (name in obj2) {\r\n\t\t\t\t\t\t// Obj2 has item obj1 doesn't have\r\n\t\t\t\t\t\tif (obj2.hasOwnProperty(name))\r\n\t\t\t\t\t\t\treturn FALSE;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn TRUE;\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Attribs are not the same\r\n\t\t\t\tif (!compareObjects(getAttribs(node1), getAttribs(node2)))\r\n\t\t\t\t\treturn FALSE;\r\n\r\n\t\t\t\t// Styles are not the same\r\n\t\t\t\tif (!compareObjects(dom.parseStyle(dom.getAttrib(node1, 'style')), dom.parseStyle(dom.getAttrib(node2, 'style'))))\r\n\t\t\t\t\treturn FALSE;\r\n\r\n\t\t\t\treturn TRUE;\r\n\t\t\t};\r\n\r\n\t\t\t// Check if next/prev exists and that they are elements\r\n\t\t\tif (prev && next) {\r\n\t\t\t\tfunction findElementSibling(node, sibling_name) {\r\n\t\t\t\t\tfor (sibling = node; sibling; sibling = sibling[sibling_name]) {\r\n\t\t\t\t\t\tif (sibling.nodeType == 3 && !isWhiteSpaceNode(sibling))\r\n\t\t\t\t\t\t\treturn node;\r\n\r\n\t\t\t\t\t\tif (sibling.nodeType == 1 && !isBookmarkNode(sibling))\r\n\t\t\t\t\t\t\treturn sibling;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn node;\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// If previous sibling is empty then jump over it\r\n\t\t\t\tprev = findElementSibling(prev, 'previousSibling');\r\n\t\t\t\tnext = findElementSibling(next, 'nextSibling');\r\n\r\n\t\t\t\t// Compare next and previous nodes\r\n\t\t\t\tif (compareElements(prev, next)) {\r\n\t\t\t\t\t// Append nodes between\r\n\t\t\t\t\tfor (sibling = prev.nextSibling; sibling && sibling != next;) {\r\n\t\t\t\t\t\ttmpSibling = sibling;\r\n\t\t\t\t\t\tsibling = sibling.nextSibling;\r\n\t\t\t\t\t\tprev.appendChild(tmpSibling);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Remove next node\r\n\t\t\t\t\tdom.remove(next);\r\n\r\n\t\t\t\t\t// Move children into prev node\r\n\t\t\t\t\teach(tinymce.grep(next.childNodes), function(node) {\r\n\t\t\t\t\t\tprev.appendChild(node);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\treturn prev;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn next;\r\n\t\t};\r\n\r\n\t\tfunction isTextBlock(name) {\r\n\t\t\treturn /^(h[1-6]|p|div|pre|address|dl|dt|dd)$/.test(name);\r\n\t\t};\r\n\r\n\t\tfunction getContainer(rng, start) {\r\n\t\t\tvar container, offset, lastIdx;\r\n\r\n\t\t\tcontainer = rng[start ? 'startContainer' : 'endContainer'];\r\n\t\t\toffset = rng[start ? 'startOffset' : 'endOffset'];\r\n\r\n\t\t\tif (container.nodeType == 1) {\r\n\t\t\t\tlastIdx = container.childNodes.length - 1;\r\n\r\n\t\t\t\tif (!start && offset)\r\n\t\t\t\t\toffset--;\r\n\r\n\t\t\t\tcontainer = container.childNodes[offset > lastIdx ? lastIdx : offset];\r\n\t\t\t}\r\n\r\n\t\t\treturn container;\r\n\t\t};\r\n\r\n\t\tfunction performCaretAction(type, name, vars) {\r\n\t\t\tvar i, currentPendingFormats = pendingFormats[type],\r\n\t\t\t\totherPendingFormats = pendingFormats[type == 'apply' ? 'remove' : 'apply'];\r\n\r\n\t\t\tfunction hasPending() {\r\n\t\t\t\treturn pendingFormats.apply.length || pendingFormats.remove.length;\r\n\t\t\t};\r\n\r\n\t\t\tfunction resetPending() {\r\n\t\t\t\tpendingFormats.apply = [];\r\n\t\t\t\tpendingFormats.remove = [];\r\n\t\t\t};\r\n\r\n\t\t\tfunction perform(caret_node) {\r\n\t\t\t\t// Apply pending formats\r\n\t\t\t\teach(pendingFormats.apply.reverse(), function(item) {\r\n\t\t\t\t\tapply(item.name, item.vars, caret_node);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Remove pending formats\r\n\t\t\t\teach(pendingFormats.remove.reverse(), function(item) {\r\n\t\t\t\t\tremove(item.name, item.vars, caret_node);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tdom.remove(caret_node, 1);\r\n\t\t\t\tresetPending();\r\n\t\t\t};\r\n\r\n\t\t\t// Check if it already exists then ignore it\r\n\t\t\tfor (i = currentPendingFormats.length - 1; i >= 0; i--) {\r\n\t\t\t\tif (currentPendingFormats[i].name == name)\r\n\t\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tcurrentPendingFormats.push({name : name, vars : vars});\r\n\r\n\t\t\t// Check if it's in the other type, then remove it\r\n\t\t\tfor (i = otherPendingFormats.length - 1; i >= 0; i--) {\r\n\t\t\t\tif (otherPendingFormats[i].name == name)\r\n\t\t\t\t\totherPendingFormats.splice(i, 1);\r\n\t\t\t}\r\n\r\n\t\t\t// Pending apply or remove formats\r\n\t\t\tif (hasPending()) {\r\n\t\t\t\ted.getDoc().execCommand('FontName', false, 'mceinline');\r\n\t\t\t\tpendingFormats.lastRng = selection.getRng();\r\n\r\n\t\t\t\t// IE will convert the current word\r\n\t\t\t\teach(dom.select('font,span'), function(node) {\r\n\t\t\t\t\tvar bookmark;\r\n\r\n\t\t\t\t\tif (isCaretNode(node)) {\r\n\t\t\t\t\t\tbookmark = selection.getBookmark();\r\n\t\t\t\t\t\tperform(node);\r\n\t\t\t\t\t\tselection.moveToBookmark(bookmark);\r\n\t\t\t\t\t\ted.nodeChanged();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Only register listeners once if we need to\r\n\t\t\t\tif (!pendingFormats.isListening && hasPending()) {\r\n\t\t\t\t\tpendingFormats.isListening = true;\r\n\r\n\t\t\t\t\teach('onKeyDown,onKeyUp,onKeyPress,onMouseUp'.split(','), function(event) {\r\n\t\t\t\t\t\ted[event].addToTop(function(ed, e) {\r\n\t\t\t\t\t\t\t// Do we have pending formats and is the selection moved has moved\r\n\t\t\t\t\t\t\tif (hasPending() && !tinymce.dom.RangeUtils.compareRanges(pendingFormats.lastRng, selection.getRng())) {\r\n\t\t\t\t\t\t\t\teach(dom.select('font,span'), function(node) {\r\n\t\t\t\t\t\t\t\t\tvar textNode, rng;\r\n\r\n\t\t\t\t\t\t\t\t\t// Look for marker\r\n\t\t\t\t\t\t\t\t\tif (isCaretNode(node)) {\r\n\t\t\t\t\t\t\t\t\t\ttextNode = node.firstChild;\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (textNode) {\r\n\t\t\t\t\t\t\t\t\t\t\tperform(node);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\trng = dom.createRng();\r\n\t\t\t\t\t\t\t\t\t\t\trng.setStart(textNode, textNode.nodeValue.length);\r\n\t\t\t\t\t\t\t\t\t\t\trng.setEnd(textNode, textNode.nodeValue.length);\r\n\t\t\t\t\t\t\t\t\t\t\tselection.setRng(rng);\r\n\t\t\t\t\t\t\t\t\t\t\ted.nodeChanged();\r\n\t\t\t\t\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\t\t\t\t\tdom.remove(node);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t// Always unbind and clear pending styles on keyup\r\n\t\t\t\t\t\t\t\tif (e.type == 'keyup' || e.type == 'mouseup')\r\n\t\t\t\t\t\t\t\t\tresetPending();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n})(tinymce);\r\n\r\ntinymce.onAddEditor.add(function(tinymce, ed) {\r\n\tvar filters, fontSizes, dom, settings = ed.settings;\r\n\r\n\tif (settings.inline_styles) {\r\n\t\tfontSizes = tinymce.explode(settings.font_size_style_values);\r\n\r\n\t\tfunction replaceWithSpan(node, styles) {\r\n\t\t\ttinymce.each(styles, function(value, name) {\r\n\t\t\t\tif (value)\r\n\t\t\t\t\tdom.setStyle(node, name, value);\r\n\t\t\t});\r\n\r\n\t\t\tdom.rename(node, 'span');\r\n\t\t};\r\n\r\n\t\tfilters = {\r\n\t\t\tfont : function(dom, node) {\r\n\t\t\t\treplaceWithSpan(node, {\r\n\t\t\t\t\tbackgroundColor : node.style.backgroundColor,\r\n\t\t\t\t\tcolor : node.color,\r\n\t\t\t\t\tfontFamily : node.face,\r\n\t\t\t\t\tfontSize : fontSizes[parseInt(node.size) - 1]\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\tu : function(dom, node) {\r\n\t\t\t\treplaceWithSpan(node, {\r\n\t\t\t\t\ttextDecoration : 'underline'\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\tstrike : function(dom, node) {\r\n\t\t\t\treplaceWithSpan(node, {\r\n\t\t\t\t\ttextDecoration : 'line-through'\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction convert(editor, params) {\r\n\t\t\tdom = editor.dom;\r\n\r\n\t\t\tif (settings.convert_fonts_to_spans) {\r\n\t\t\t\ttinymce.each(dom.select('font,u,strike', params.node), function(node) {\r\n\t\t\t\t\tfilters[node.nodeName.toLowerCase()](ed.dom, node);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\ted.onPreProcess.add(convert);\r\n\r\n\t\ted.onInit.add(function() {\r\n\t\t\ted.selection.onSetContent.add(convert);\r\n\t\t});\r\n\t}\r\n});\r\n\r\ntinyMCE_GZ.start();tinyMCE.addI18n({ru:{\r\ncommon:{\r\nedit_confirm:\"\\u0418\\u0441\\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u044C WYSIWYG \\u0440\\u0435\\u0436\\u0438\\u043C \\u0434\\u043B\\u044F \\u044D\\u0442\\u043E\\u0433\\u043E \\u043F\\u043E\\u043B\\u044F?\",\r\napply:\"\\u041F\\u0440\\u0438\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C\",\r\ninsert:\"\\u0412\\u0441\\u0442\\u0430\\u0432\\u0438\\u0442\\u044C\",\r\nupdate:\"\\u041E\\u0431\\u043D\\u043E\\u0432\\u0438\\u0442\\u044C\",\r\ncancel:\"\\u041E\\u0442\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C\",\r\nclose:\"\\u0417\\u0430\\u043A\\u0440\\u044B\\u0442\\u044C\",\r\nbrowse:\"\\u041F\\u0440\\u043E\\u0441\\u043C\\u043E\\u0442\\u0440\",\r\nclass_name:\"\\u041A\\u043B\\u0430\\u0441\\u0441\",\r\nnot_set:\"- \\u041D\\u0435 \\u0443\\u0441\\u0442\\u0430\\u043D\\u043E\\u0432\\u043B\\u0435\\u043D\\u043E -\",\r\nclipboard_msg:\"\\u041A\\u043E\\u043F\\u0438\\u0440\\u043E\\u0432\\u0430\\u043D\\u0438\\u0435, \\u0432\\u044B\\u0440\\u0435\\u0437\\u043A\\u0430 \\u0438 \\u0432\\u0441\\u0442\\u0430\\u0432\\u043A\\u0430 \\u043D\\u0435 \\u0440\\u0430\\u0431\\u043E\\u0442\\u0430\\u044E\\u0442 \\u0432 Firefox.\\r\\n\\u0425\\u043E\\u0442\\u0438\\u0442\\u0435 \\u043F\\u043E\\u043B\\u0443\\u0447\\u0438\\u0442\\u044C \\u0431\\u043E\\u043B\\u0435\\u0435 \\u043F\\u043E\\u0434\\u0440\\u043E\\u0431\\u043D\\u0443\\u044E \\u0438\\u043D\\u0444\\u043E\\u0440\\u043C\\u0430\\u0446\\u0438\\u044E?\",\r\nclipboard_no_support:\"\\u041D\\u0435 \\u043F\\u043E\\u0434\\u0434\\u0435\\u0440\\u0436\\u0438\\u0432\\u0430\\u0435\\u0442\\u0441\\u044F \\u0412\\u0430\\u0448\\u0438\\u043C \\u0431\\u0440\\u0430\\u0443\\u0437\\u0435\\u0440\\u043E\\u043C, \\u0438\\u0441\\u043F\\u043E\\u043B\\u044C\\u0437\\u0443\\u0439\\u0442\\u0435 \\u0433\\u043E\\u0440\\u044F\\u0447\\u0438\\u0435 \\u043A\\u043B\\u0430\\u0432\\u0438\\u0448\\u0438.\",\r\npopup_blocked:\"\\u0411\\u043B\\u043E\\u043A\\u0438\\u0440\\u0430\\u0442\\u043E\\u0440 \\u0432\\u0441\\u043F\\u043B\\u044B\\u0432\\u0430\\u044E\\u0449\\u0438\\u0445 \\u043E\\u043A\\u043E\\u043D \\u0437\\u0430\\u043A\\u0440\\u044B\\u043B \\u043D\\u0435\\u043E\\u0431\\u0445\\u043E\\u0434\\u0438\\u043C\\u043E\\u0435 \\u043E\\u043A\\u043D\\u043E. \\u0414\\u043B\\u044F \\u043F\\u043E\\u043B\\u043D\\u043E\\u0446\\u0435\\u043D\\u043D\\u043E\\u0439 \\u0440\\u0430\\u0431\\u043E\\u0442\\u044B, \\u043E\\u0442\\u043A\\u043B\\u044E\\u0447\\u0438\\u0442\\u0435 \\u0431\\u043B\\u043E\\u043A\\u0438\\u0440\\u043E\\u0432\\u043A\\u0443 \\u043D\\u0430 \\u044D\\u0442\\u043E\\u043C \\u0441\\u0430\\u0439\\u0442\\u0435.\",\r\ninvalid_data:\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \\u0412\\u0432\\u0435\\u0434\\u0435\\u043D\\u043E \\u043D\\u0435\\u0432\\u0435\\u0440\\u043D\\u043E\\u0435 \\u0437\\u043D\\u0430\\u0447\\u0435\\u043D\\u0438\\u0435, \\u043E\\u043D\\u043E \\u043E\\u0442\\u043C\\u0435\\u0447\\u0435\\u043D\\u043E \\u043A\\u0440\\u0430\\u0441\\u043D\\u044B\\u043C.\",\r\nmore_colors:\"\\u0414\\u0440\\u0443\\u0433\\u0438\\u0435 \\u0446\\u0432\\u0435\\u0442\\u0430...\"\r\n},\r\ncontextmenu:{\r\nalign:\"\\u0412\\u044B\\u0440\\u0430\\u0432\\u043D\\u0438\\u0432\\u0430\\u043D\\u0438\\u0435\",\r\nleft:\"\\u041F\\u043E \\u043B\\u0435\\u0432\\u043E\\u043C\\u0443 \\u043A\\u0440\\u0430\\u044E\",\r\ncenter:\"\\u041F\\u043E \\u0446\\u0435\\u043D\\u0442\\u0440\\u0443\",\r\nright:\"\\u041F\\u043E \\u043F\\u0440\\u0430\\u0432\\u043E\\u043C\\u0443 \\u043A\\u0440\\u0430\\u044E\",\r\nfull:\"\\u041F\\u043E \\u0448\\u0438\\u0440\\u0438\\u043D\\u0435\"\r\n},\r\ninsertdatetime:{\r\ndate_fmt:\"%d.%m.%Y\",\r\ntime_fmt:\"%H:%M:%S\",\r\ninsertdate_desc:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0434\\u0430\\u0442\\u0443\",\r\ninserttime_desc:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0432\\u0440\\u0435\\u043C\\u044F\",\r\nmonths_long:\"\\u044F\\u043D\\u0432\\u0430\\u0440\\u044C,\\u0444\\u0435\\u0432\\u0440\\u0430\\u043B\\u044C,\\u043C\\u0430\\u0440\\u0442,\\u0430\\u043F\\u0440\\u0435\\u043B\\u044C,\\u043C\\u0430\\u0439,\\u0438\\u044E\\u043D\\u044C,\\u0438\\u044E\\u043B\\u044C,\\u0430\\u0432\\u0433\\u0443\\u0441\\u0442,\\u0441\\u0435\\u043D\\u0442\\u044F\\u0431\\u0440\\u044C,\\u043E\\u043A\\u0442\\u044F\\u0431\\u0440\\u044C,\\u043D\\u043E\\u044F\\u0431\\u0440\\u044C,\\u0434\\u0435\\u043A\\u0430\\u0431\\u0440\\u044C\",\r\nmonths_short:\"\\u044F\\u043D\\u0432,\\u0444\\u0435\\u0432,\\u043C\\u0430\\u0440\\u0442,\\u0430\\u043F\\u0440,\\u043C\\u0430\\u0439,\\u0438\\u044E\\u043D\\u044C,\\u0438\\u044E\\u043B\\u044C,\\u0430\\u0432\\u0433,\\u0441\\u0435\\u043D,\\u043E\\u043A\\u0442,\\u043D\\u043E\\u044F,\\u0434\\u0435\\u043A\",\r\nday_long:\"\\u0432\\u043E\\u0441\\u043A\\u0440\\u0435\\u0441\\u0435\\u043D\\u044C\\u0435,\\u043F\\u043E\\u043D\\u0435\\u0434\\u0435\\u043B\\u044C\\u043D\\u0438\\u043A,\\u0432\\u0442\\u043E\\u0440\\u043D\\u0438\\u043A,\\u0441\\u0440\\u0435\\u0434\\u0430,\\u0447\\u0435\\u0442\\u0432\\u0435\\u0440\\u0433,\\u043F\\u044F\\u0442\\u043D\\u0438\\u0446\\u0430,\\u0441\\u0443\\u0431\\u0431\\u043E\\u0442\\u0430,\\u0432\\u043E\\u0441\\u043A\\u0440\\u0435\\u0441\\u0435\\u043D\\u044C\\u0435\",\r\nday_short:\"\\u0432\\u0441,\\u043F\\u043D,\\u0432\\u0442,\\u0441\\u0440,\\u0447\\u0442,\\u043F\\u0442,\\u0441\\u0431,\\u0432\\u0441\"\r\n},\r\nprint:{\r\nprint_desc:\"\\u041F\\u0435\\u0447\\u0430\\u0442\\u044C\"\r\n},\r\npreview:{\r\npreview_desc:\"\\u041F\\u0440\\u0435\\u0434\\u0432\\u0430\\u0440\\u0438\\u0442\\u0435\\u043B\\u044C\\u043D\\u044B\\u0439 \\u043F\\u0440\\u043E\\u0441\\u043C\\u043E\\u0442\\u0440\"\r\n},\r\ndirectionality:{\r\nltr_desc:\"\\u041D\\u0430\\u043F\\u0440\\u0430\\u0432\\u043B\\u0435\\u043D\\u0438\\u0435 \\u0441\\u043B\\u0435\\u0432\\u0430 \\u043D\\u0430\\u043F\\u0440\\u0430\\u0432\\u043E\",\r\nrtl_desc:\"\\u041D\\u0430\\u043F\\u0440\\u0430\\u0432\\u043B\\u0435\\u043D\\u0438\\u0435 \\u0441\\u043F\\u0440\\u0430\\u0432\\u0430 \\u043D\\u0430\\u043B\\u0435\\u0432\\u043E\"\r\n},\r\nlayer:{\r\ninsertlayer_desc:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0441\\u043B\\u043E\\u0439\",\r\nforward_desc:\"\\u041D\\u0430 \\u043F\\u0435\\u0440\\u0435\\u0434\\u043D\\u0438\\u0439 \\u043F\\u043B\\u0430\\u043D\",\r\nbackward_desc:\"\\u041D\\u0430 \\u0437\\u0430\\u0434\\u043D\\u0438\\u0439 \\u043F\\u043B\\u0430\\u043D\",\r\nabsolute_desc:\"\\u0410\\u0431\\u0441\\u043E\\u043B\\u044E\\u0442\\u043D\\u043E\\u0435 \\u043F\\u043E\\u0437\\u0438\\u0446\\u0438\\u0440\\u043E\\u0432\\u0430\\u043D\\u0438\\u0435\",\r\ncontent:\"\\u041D\\u043E\\u0432\\u044B\\u0439 \\u0441\\u043B\\u043E\\u0439\"\r\n},\r\nsave:{\r\nsave_desc:\"\\u0421\\u043E\\u0445\\u0440\\u0430\\u043D\\u0438\\u0442\\u044C\",\r\ncancel_desc:\"\\u041E\\u0442\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C \\u0432\\u0441\\u0435 \\u0438\\u0437\\u043C\\u0435\\u043D\\u0435\\u043D\\u0438\\u044F\"\r\n},\r\nnonbreaking:{\r\nnonbreaking_desc:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u043D\\u0435\\u0440\\u0430\\u0437\\u0440\\u044B\\u0432\\u043D\\u044B\\u0439 \\u043F\\u0440\\u043E\\u0431\\u0435\\u043B\"\r\n},\r\niespell:{\r\niespell_desc:\"\\u041F\\u0440\\u043E\\u0432\\u0435\\u0440\\u0438\\u0442\\u044C \\u043E\\u0440\\u0444\\u043E\\u0433\\u0440\\u0430\\u0444\\u0438\\u044E\",\r\ndownload:\"ieSpell \\u043D\\u0435 \\u043D\\u0430\\u0439\\u0434\\u0435\\u043D. \\u0416\\u0435\\u043B\\u0430\\u0435\\u0442\\u0435 \\u0443\\u0441\\u0442\\u0430\\u043D\\u043E\\u0432\\u0438\\u0442\\u044C?\"\r\n},\r\nadvhr:{\r\nadvhr_desc:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0440\\u0430\\u0437\\u0434\\u0435\\u043B\\u0438\\u0442\\u0435\\u043B\\u044C\"\r\n},\r\nemotions:{\r\nemotions_desc:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0441\\u043C\\u0430\\u0439\\u043B\"\r\n},\r\nsearchreplace:{\r\nsearch_desc:\"\\u041D\\u0430\\u0439\\u0442\\u0438\",\r\nreplace_desc:\"\\u0417\\u0430\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C\"\r\n},\r\nadvimage:{\r\nimage_desc:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C/\\u0418\\u0437\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C \\u0438\\u0437\\u043E\\u0431\\u0440\\u0430\\u0436\\u0435\\u043D\\u0438\\u0435\",\r\ndelta_width:\"200\"\r\n},\r\nadvlink:{\r\nlink_desc:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C/\\u0418\\u0437\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C \\u0441\\u0441\\u044B\\u043B\\u043A\\u0443\",\r\ndelta_width:\"200\"\r\n},\r\nxhtmlxtras:{\r\ncite_desc:\"\\u0426\\u0438\\u0442\\u0438\\u0440\\u043E\\u0432\\u0430\\u043D\\u0438\\u0435\",\r\nabbr_desc:\"\\u0421\\u043E\\u043A\\u0440\\u0430\\u0449\\u0435\\u043D\\u0438\\u0435\",\r\nacronym_desc:\"\\u0410\\u0431\\u0431\\u0440\\u0435\\u0432\\u0438\\u0430\\u0446\\u0438\\u044F\",\r\ndel_desc:\"\\u0423\\u0434\\u0430\\u043B\\u0435\\u043D\\u0438\\u0435\",\r\nins_desc:\"\\u0417\\u0430\\u043C\\u0435\\u043D\\u0430\",\r\nattribs_desc:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C/\\u0418\\u0437\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C \\u044D\\u043B\\u0435\\u043C\\u0435\\u043D\\u0442\"\r\n},\r\nstyle:{\r\ndesc:\"\\u0420\\u0435\\u0434\\u0430\\u043A\\u0442\\u0438\\u0440\\u043E\\u0432\\u0430\\u0442\\u044C CSS \\u0441\\u0442\\u0438\\u043B\\u044C\"\r\n},\r\npaste:{\r\npaste_text_desc:\"\\u0412\\u0441\\u0442\\u0430\\u0432\\u0438\\u0442\\u044C \\u043A\\u0430\\u043A \\u0442\\u0435\\u043A\\u0441\\u0442\",\r\npaste_word_desc:\"\\u0412\\u0441\\u0442\\u0430\\u0432\\u0438\\u0442\\u044C \\u0438\\u0437 Word\",\r\nselectall_desc:\"\\u0412\\u044B\\u0434\\u0435\\u043B\\u0438\\u0442\\u044C \\u0432\\u0441\\u0435\",\r\nplaintext_mode_sticky:\"Paste is now in plain text mode. Click again to toggle back to regular paste mode. After you paste something you will be returned to regular paste mode.\",\r\nplaintext_mode:\"Paste is now in plain text mode. Click again to toggle back to regular paste mode.\"\r\n},\r\npaste_dlg:{\r\ntext_title:\"\\u0418\\u0441\\u043F\\u043E\\u043B\\u044C\\u0437\\u0443\\u0439\\u0442\\u0435 CTRL+V \\u0434\\u043B\\u044F \\u0432\\u0441\\u0442\\u0430\\u0432\\u043A\\u0438 \\u0442\\u0435\\u043A\\u0441\\u0442\\u0430 \\u0432 \\u043E\\u043A\\u043D\\u043E.\",\r\ntext_linebreaks:\"\\u0421\\u043E\\u0445\\u0440\\u0430\\u043D\\u0438\\u0442\\u044C \\u043F\\u0435\\u0440\\u0435\\u043D\\u043E\\u0441\\u044B \\u0441\\u0442\\u0440\\u043E\\u043A\",\r\nword_title:\"\\u0418\\u0441\\u043F\\u043E\\u043B\\u044C\\u0437\\u0443\\u0439\\u0442\\u0435 CTRL+V \\u0434\\u043B\\u044F \\u0432\\u0441\\u0442\\u0430\\u0432\\u043A\\u0438 \\u0442\\u0435\\u043A\\u0441\\u0442\\u0430 \\u0432 \\u043E\\u043A\\u043D\\u043E.\"\r\n},\r\ntable:{\r\ndesc:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u043B\\u0435\\u043D\\u0438\\u0435/\\u0418\\u0437\\u043C\\u0435\\u043D\\u0435\\u043D\\u0438\\u0435 \\u0442\\u0430\\u0431\\u043B\\u0438\\u0446\\u044B\",\r\nrow_before_desc:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0441\\u0442\\u0440\\u043E\\u043A\\u0443 \\u0441\\u0432\\u0435\\u0440\\u0445\\u0443\",\r\nrow_after_desc:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0441\\u0442\\u0440\\u043E\\u043A\\u0443 \\u0441\\u043D\\u0438\\u0437\\u0443\",\r\ndelete_row_desc:\"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C \\u0441\\u0442\\u0440\\u043E\\u043A\\u0443\",\r\ncol_before_desc:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0441\\u0442\\u043E\\u043B\\u0431\\u0435\\u0446 \\u0441\\u043B\\u0435\\u0432\\u0430\",\r\ncol_after_desc:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0441\\u0442\\u043E\\u043B\\u0431\\u0435\\u0446 \\u0441\\u043F\\u0440\\u0430\\u0432\\u0430\",\r\ndelete_col_desc:\"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C \\u0441\\u0442\\u043E\\u043B\\u0431\\u0435\\u0446\",\r\nsplit_cells_desc:\"\\u0420\\u0430\\u0437\\u0431\\u0438\\u0442\\u044C \\u044F\\u0447\\u0435\\u0439\\u043A\\u0443\",\r\nmerge_cells_desc:\"\\u041E\\u0431\\u044A\\u0435\\u0434\\u0438\\u043D\\u0438\\u0442\\u044C \\u044F\\u0447\\u0435\\u0439\\u043A\\u0438\",\r\nrow_desc:\"\\u041F\\u0430\\u0440\\u0430\\u043C\\u0435\\u0442\\u0440\\u044B \\u0441\\u0442\\u0440\\u043E\\u043A\\u0438\",\r\ncell_desc:\"\\u041F\\u0430\\u0440\\u0430\\u043C\\u0435\\u0442\\u0440\\u044B \\u044F\\u0447\\u0435\\u0439\\u043A\\u0438\",\r\nprops_desc:\"\\u041F\\u0430\\u0440\\u0430\\u043C\\u0435\\u0442\\u0440\\u044B \\u0442\\u0430\\u0431\\u043B\\u0438\\u0446\\u044B\",\r\npaste_row_before_desc:\"\\u0412\\u0441\\u0442\\u0430\\u0432\\u0438\\u0442\\u044C \\u0441\\u0442\\u0440\\u043E\\u043A\\u0443 \\u0441\\u0432\\u0435\\u0440\\u0445\\u0443\",\r\npaste_row_after_desc:\"\\u0412\\u0441\\u0442\\u0430\\u0432\\u0438\\u0442\\u044C \\u0441\\u0442\\u0440\\u043E\\u043A\\u0443 \\u0441\\u043D\\u0438\\u0437\\u0443\",\r\ncut_row_desc:\"\\u0412\\u044B\\u0440\\u0435\\u0437\\u0430\\u0442\\u044C \\u0441\\u0442\\u0440\\u043E\\u043A\\u0443\",\r\ncopy_row_desc:\"\\u041A\\u043E\\u043F\\u0438\\u0440\\u043E\\u0432\\u0430\\u0442\\u044C \\u0441\\u0442\\u0440\\u043E\\u043A\\u0443\",\r\ndel:\"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C \\u0442\\u0430\\u0431\\u043B\\u0438\\u0446\\u0443\",\r\nrow:\"\\u0421\\u0442\\u0440\\u043E\\u043A\\u0430\",\r\ncol:\"\\u0421\\u0442\\u043E\\u043B\\u0431\\u0435\\u0446\",\r\ncell:\"\\u042F\\u0447\\u0435\\u0439\\u043A\\u0430\",\r\ncellprops_delta_width:\"30\"\r\n},\r\nautosave:{\r\nunload_msg:\"\\u041F\\u0440\\u043E\\u0438\\u0437\\u0432\\u0435\\u0434\\u0435\\u043D\\u043D\\u044B\\u0435 \\u0438\\u0437\\u043C\\u0435\\u043D\\u0435\\u043D\\u0438\\u044F \\u0431\\u0443\\u0434\\u0443\\u0442 \\u0443\\u0442\\u0435\\u0440\\u044F\\u043D\\u044B, \\u0435\\u0441\\u043B\\u0438 \\u0412\\u044B \\u0443\\u0439\\u0434\\u0435\\u0442\\u0435 \\u0441 \\u044D\\u0442\\u043E\\u0439 \\u0441\\u0442\\u0440\\u0430\\u043D\\u0438\\u0446\\u044B.\",\r\nrestore_content:\"\\u0412\\u043E\\u0441\\u0441\\u0442\\u0430\\u043D\\u043E\\u0432\\u0438\\u0442\\u044C \\u0430\\u0432\\u0442\\u043E\\u043C\\u0430\\u0442\\u0438\\u0447\\u0435\\u0441\\u043A\\u043E\\u0435 \\u0441\\u043E\\u0445\\u0440\\u0430\\u043D\\u0435\\u043D\\u0438\\u0435\",\r\nwarning_message:\"\\u0412\\u0441\\u0435 \\u043F\\u0440\\u043E\\u0438\\u0437\\u0432\\u0435\\u0434\\u0435\\u043D\\u043D\\u044B\\u0435 \\u0438\\u0437\\u043C\\u0435\\u043D\\u0435\\u043D\\u0438\\u044F \\u0431\\u0443\\u0434\\u0443\\u0442 \\u0443\\u0442\\u0435\\u0440\\u044F\\u043D\\u044B.\\n\\n\\u041F\\u0440\\u043E\\u0434\\u043E\\u043B\\u0436\\u0438\\u0442\\u044C \\u0432\\u043E\\u0441\\u0441\\u0442\\u0430\\u043D\\u043E\\u0432\\u043B\\u0435\\u043D\\u0438\\u0435 \\u0430\\u0432\\u0442\\u043E\\u043C\\u0430\\u0442\\u0438\\u0447\\u0435\\u0441\\u043A\\u043E\\u0433\\u043E \\u0441\\u043E\\u0445\\u0440\\u0430\\u043D\\u0435\\u043D\\u0438\\u044F?\"\r\n},\r\nfullscreen:{\r\ndesc:\"\\u041F\\u043E\\u043B\\u043D\\u043E\\u044D\\u043A\\u0440\\u0430\\u043D\\u043D\\u044B\\u0439 \\u0440\\u0435\\u0436\\u0438\\u043C\"\r\n},\r\nmedia:{\r\ndesc:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C/\\u0418\\u0437\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C \\u043A\\u043B\\u0438\",\r\nedit:\"\\u0421\\u0432\\u043E\\u0439\\u0441\\u0442\\u0432\\u0430 \\u043A\\u043B\\u0438\\u043F\\u0430\"\r\n},\r\nfullpage:{\r\ndesc:\"\\u0421\\u0432\\u043E\\u0439\\u0441\\u0442\\u0432\\u0430 \\u0434\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u0430\"\r\n},\r\ntemplate:{\r\ndesc:\"\\u0418\\u0441\\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u044C \\u0448\\u0430\\u0431\\u043B\\u043E\\u043D\"\r\n},\r\nvisualchars:{\r\ndesc:\"\\u0412\\u0441\\u0435 \\u0437\\u043D\\u0430\\u043A\\u0438\"\r\n},\r\nspellchecker:{\r\ndesc:\"\\u041F\\u0440\\u0430\\u0432\\u043E\\u043F\\u0438\\u0441\\u0430\\u043D\\u0438\\u0435\",\r\nmenu:\"\\u0421\\u0432\\u043E\\u0439\\u0441\\u0442\\u0432\\u0430 \\u043F\\u0440\\u043E\\u0432\\u0435\\u0440\\u043A\\u0438 \\u043F\\u0440\\u0430\\u0432\\u043E\\u043F\\u0438\\u0441\\u0430\\u043D\\u0438\\u044F\",\r\nignore_word:\"\\u041F\\u0440\\u043E\\u043F\\u0443\\u0441\\u0442\\u0438\\u0442\\u044C\",\r\nignore_words:\"\\u041F\\u0440\\u043E\\u043F\\u0443\\u0441\\u0442\\u0438\\u0442\\u044C \\u0432\\u0441\\u0435\",\r\nlangs:\"\\u042F\\u0437\\u044B\\u043A\\u0438\",\r\nwait:\"\\u041F\\u043E\\u0436\\u0430\\u043B\\u0443\\u0439\\u0441\\u0442\\u0430, \\u043F\\u043E\\u0434\\u043E\\u0436\\u0434\\u0438\\u0442\\u0435...\",\r\nsug:\"\\u0412\\u0430\\u0440\\u0438\\u0430\\u043D\\u0442\\u044B\",\r\nno_sug:\"\\u041D\\u0435\\u0442 \\u0432\\u0430\\u0440\\u0438\\u0430\\u043D\\u0442\\u043E\\u0432\",\r\nno_mpell:\"\\u041E\\u0448\\u0438\\u0431\\u043E\\u043A \\u043D\\u0435 \\u043E\\u0431\\u043D\\u0430\\u0440\\u0443\\u0436\\u0435\\u043D\\u043E.\"\r\n},\r\npagebreak:{\r\ndesc:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0440\\u0430\\u0437\\u0440\\u044B\\u0432 \\u0441\\u0442\\u0440\\u0430\\u043D\\u0438\\u0446\\u044B\"\r\n},\r\nadvlist:{\r\ntypes:\"\\u0421\\u0438\\u043C\\u0432\\u043E\\u043B\\u044B\",\r\ndef:\"\\u0421\\u0442\\u0430\\u043D\\u0434\\u0430\\u0440\\u0442\\u043D\\u044B\\u0435\",\r\nlower_alpha:\"\\u0421\\u0442\\u0440\\u043E\\u0447\\u043D\\u044B\\u0435 \\u043B\\u0430\\u0442\\u0438\\u043D\\u0441\\u043A\\u0438\\u0435 \\u0431\\u0443\\u043A\\u0432\\u044B\",\r\nlower_greek:\"\\u0421\\u0442\\u0440\\u043E\\u0447\\u043D\\u044B\\u0435 \\u0433\\u0440\\u0435\\u0447\\u0435\\u0441\\u043A\\u0438\\u0435 \\u0431\\u0443\\u043A\\u0432\\u044B\",\r\nlower_roman:\"\\u0421\\u0442\\u0440\\u043E\\u0447\\u043D\\u044B\\u0435 \\u0440\\u0438\\u043C\\u0441\\u043A\\u0438\\u0435 \\u0446\\u0438\\u0444\\u0440\\u044B\",\r\nupper_alpha:\"\\u0417\\u0430\\u0433\\u043B\\u0430\\u0432\\u043D\\u044B\\u0435 \\u043B\\u0430\\u0442\\u0438\\u043D\\u0441\\u043A\\u0438\\u0435 \\u0431\\u0443\\u043A\\u0432\\u044B\",\r\nupper_roman:\"\\u0417\\u0430\\u0433\\u043B\\u0430\\u0432\\u043D\\u044B\\u0435 \\u0440\\u0438\\u043C\\u0441\\u043A\\u0438\\u0435 \\u0446\\u0438\\u0444\\u0440\\u044B\",\r\ncircle:\"\\u041A\\u0440\\u0443\\u0433\\u0438\",\r\ndisc:\"\\u041E\\u043A\\u0440\\u0443\\u0436\\u043D\\u043E\\u0441\\u0442\\u0438\",\r\nsquare:\"\\u041A\\u0432\\u0430\\u0434\\u0440\\u0430\\u0442\\u044B\"\r\n}}});/**\r\n * editor_template_src.js\r\n *\r\n * Copyright 2009, Moxiecode Systems AB\r\n * Released under LGPL License.\r\n *\r\n * License: http://tinymce.moxiecode.com/license\r\n * Contributing: http://tinymce.moxiecode.com/contributing\r\n */\r\n\r\n(function(tinymce) {\r\n\tvar DOM = tinymce.DOM, Event = tinymce.dom.Event, extend = tinymce.extend, each = tinymce.each, Cookie = tinymce.util.Cookie, lastExtID, explode = tinymce.explode;\r\n\r\n\t// Tell it to load theme specific language pack(s)\r\n\ttinymce.ThemeManager.requireLangPack('advanced');\r\n\r\n\ttinymce.create('tinymce.themes.AdvancedTheme', {\r\n\t\tsizes : [8, 10, 12, 14, 18, 24, 36],\r\n\r\n\t\t// Control name lookup, format: title, command\r\n\t\tcontrols : {\r\n\t\t\tbold : ['bold_desc', 'Bold'],\r\n\t\t\titalic : ['italic_desc', 'Italic'],\r\n\t\t\tunderline : ['underline_desc', 'Underline'],\r\n\t\t\tstrikethrough : ['striketrough_desc', 'Strikethrough'],\r\n\t\t\tjustifyleft : ['justifyleft_desc', 'JustifyLeft'],\r\n\t\t\tjustifycenter : ['justifycenter_desc', 'JustifyCenter'],\r\n\t\t\tjustifyright : ['justifyright_desc', 'JustifyRight'],\r\n\t\t\tjustifyfull : ['justifyfull_desc', 'JustifyFull'],\r\n\t\t\tbullist : ['bullist_desc', 'InsertUnorderedList'],\r\n\t\t\tnumlist : ['numlist_desc', 'InsertOrderedList'],\r\n\t\t\toutdent : ['outdent_desc', 'Outdent'],\r\n\t\t\tindent : ['indent_desc', 'Indent'],\r\n\t\t\tcut : ['cut_desc', 'Cut'],\r\n\t\t\tcopy : ['copy_desc', 'Copy'],\r\n\t\t\tpaste : ['paste_desc', 'Paste'],\r\n\t\t\tundo : ['undo_desc', 'Undo'],\r\n\t\t\tredo : ['redo_desc', 'Redo'],\r\n\t\t\tlink : ['link_desc', 'mceLink'],\r\n\t\t\tunlink : ['unlink_desc', 'unlink'],\r\n\t\t\timage : ['image_desc', 'mceImage'],\r\n\t\t\tcleanup : ['cleanup_desc', 'mceCleanup'],\r\n\t\t\thelp : ['help_desc', 'mceHelp'],\r\n\t\t\tcode : ['code_desc', 'mceCodeEditor'],\r\n\t\t\thr : ['hr_desc', 'InsertHorizontalRule'],\r\n\t\t\tremoveformat : ['removeformat_desc', 'RemoveFormat'],\r\n\t\t\tsub : ['sub_desc', 'subscript'],\r\n\t\t\tsup : ['sup_desc', 'superscript'],\r\n\t\t\tforecolor : ['forecolor_desc', 'ForeColor'],\r\n\t\t\tforecolorpicker : ['forecolor_desc', 'mceForeColor'],\r\n\t\t\tbackcolor : ['backcolor_desc', 'HiliteColor'],\r\n\t\t\tbackcolorpicker : ['backcolor_desc', 'mceBackColor'],\r\n\t\t\tcharmap : ['charmap_desc', 'mceCharMap'],\r\n\t\t\tvisualaid : ['visualaid_desc', 'mceToggleVisualAid'],\r\n\t\t\tanchor : ['anchor_desc', 'mceInsertAnchor'],\r\n\t\t\tnewdocument : ['newdocument_desc', 'mceNewDocument'],\r\n\t\t\tblockquote : ['blockquote_desc', 'mceBlockQuote']\r\n\t\t},\r\n\r\n\t\tstateControls : ['bold', 'italic', 'underline', 'strikethrough', 'bullist', 'numlist', 'justifyleft', 'justifycenter', 'justifyright', 'justifyfull', 'sub', 'sup', 'blockquote'],\r\n\r\n\t\tinit : function(ed, url) {\r\n\t\t\tvar t = this, s, v, o;\r\n\t\r\n\t\t\tt.editor = ed;\r\n\t\t\tt.url = url;\r\n\t\t\tt.onResolveName = new tinymce.util.Dispatcher(this);\r\n\r\n\t\t\t// Default settings\r\n\t\t\tt.settings = s = extend({\r\n\t\t\t\ttheme_advanced_path : true,\r\n\t\t\t\ttheme_advanced_toolbar_location : 'bottom',\r\n\t\t\t\ttheme_advanced_buttons1 : \"bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,styleselect,formatselect\",\r\n\t\t\t\ttheme_advanced_buttons2 : \"bullist,numlist,|,outdent,indent,|,undo,redo,|,link,unlink,anchor,image,cleanup,help,code\",\r\n\t\t\t\ttheme_advanced_buttons3 : \"hr,removeformat,visualaid,|,sub,sup,|,charmap\",\r\n\t\t\t\ttheme_advanced_blockformats : \"p,address,pre,h1,h2,h3,h4,h5,h6\",\r\n\t\t\t\ttheme_advanced_toolbar_align : \"center\",\r\n\t\t\t\ttheme_advanced_fonts : \"Andale Mono=andale mono,times;Arial=arial,helvetica,sans-serif;Arial Black=arial black,avant garde;Book Antiqua=book antiqua,palatino;Comic Sans MS=comic sans ms,sans-serif;Courier New=courier new,courier;Georgia=georgia,palatino;Helvetica=helvetica;Impact=impact,chicago;Symbol=symbol;Tahoma=tahoma,arial,helvetica,sans-serif;Terminal=terminal,monaco;Times New Roman=times new roman,times;Trebuchet MS=trebuchet ms,geneva;Verdana=verdana,geneva;Webdings=webdings;Wingdings=wingdings,zapf dingbats\",\r\n\t\t\t\ttheme_advanced_more_colors : 1,\r\n\t\t\t\ttheme_advanced_row_height : 23,\r\n\t\t\t\ttheme_advanced_resize_horizontal : 1,\r\n\t\t\t\ttheme_advanced_resizing_use_cookie : 1,\r\n\t\t\t\ttheme_advanced_font_sizes : \"1,2,3,4,5,6,7\",\r\n\t\t\t\treadonly : ed.settings.readonly\r\n\t\t\t}, ed.settings);\r\n\r\n\t\t\t// Setup default font_size_style_values\r\n\t\t\tif (!s.font_size_style_values)\r\n\t\t\t\ts.font_size_style_values = \"8pt,10pt,12pt,14pt,18pt,24pt,36pt\";\r\n\r\n\t\t\tif (tinymce.is(s.theme_advanced_font_sizes, 'string')) {\r\n\t\t\t\ts.font_size_style_values = tinymce.explode(s.font_size_style_values);\r\n\t\t\t\ts.font_size_classes = tinymce.explode(s.font_size_classes || '');\r\n\r\n\t\t\t\t// Parse string value\r\n\t\t\t\to = {};\r\n\t\t\t\ted.settings.theme_advanced_font_sizes = s.theme_advanced_font_sizes;\r\n\t\t\t\teach(ed.getParam('theme_advanced_font_sizes', '', 'hash'), function(v, k) {\r\n\t\t\t\t\tvar cl;\r\n\r\n\t\t\t\t\tif (k == v && v >= 1 && v <= 7) {\r\n\t\t\t\t\t\tk = v + ' (' + t.sizes[v - 1] + 'pt)';\r\n\t\t\t\t\t\tcl = s.font_size_classes[v - 1];\r\n\t\t\t\t\t\tv = s.font_size_style_values[v - 1] || (t.sizes[v - 1] + 'pt');\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (/^\\s*\\./.test(v))\r\n\t\t\t\t\t\tcl = v.replace(/\\./g, '');\r\n\r\n\t\t\t\t\to[k] = cl ? {'class' : cl} : {fontSize : v};\r\n\t\t\t\t});\r\n\r\n\t\t\t\ts.theme_advanced_font_sizes = o;\r\n\t\t\t}\r\n\r\n\t\t\tif ((v = s.theme_advanced_path_location) && v != 'none')\r\n\t\t\t\ts.theme_advanced_statusbar_location = s.theme_advanced_path_location;\r\n\r\n\t\t\tif (s.theme_advanced_statusbar_location == 'none')\r\n\t\t\t\ts.theme_advanced_statusbar_location = 0;\r\n\r\n\t\t\t// Init editor\r\n\t\t\ted.onInit.add(function() {\r\n\t\t\t\tif (!ed.settings.readonly)\r\n\t\t\t\t\ted.onNodeChange.add(t._nodeChanged, t);\r\n\r\n\t\t\t\tif (ed.settings.content_css !== false)\r\n\t\t\t\t\ted.dom.loadCSS(ed.baseURI.toAbsolute(url + \"/skins/\" + ed.settings.skin + \"/content.css\"));\r\n\t\t\t});\r\n\r\n\t\t\ted.onSetProgressState.add(function(ed, b, ti) {\r\n\t\t\t\tvar co, id = ed.id, tb;\r\n\r\n\t\t\t\tif (b) {\r\n\t\t\t\t\tt.progressTimer = setTimeout(function() {\r\n\t\t\t\t\t\tco = ed.getContainer();\r\n\t\t\t\t\t\tco = co.insertBefore(DOM.create('DIV', {style : 'position:relative'}), co.firstChild);\r\n\t\t\t\t\t\ttb = DOM.get(ed.id + '_tbl');\r\n\r\n\t\t\t\t\t\tDOM.add(co, 'div', {id : id + '_blocker', 'class' : 'mceBlocker', style : {width : tb.clientWidth + 2, height : tb.clientHeight + 2}});\r\n\t\t\t\t\t\tDOM.add(co, 'div', {id : id + '_progress', 'class' : 'mceProgress', style : {left : tb.clientWidth / 2, top : tb.clientHeight / 2}});\r\n\t\t\t\t\t}, ti || 0);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tDOM.remove(id + '_blocker');\r\n\t\t\t\t\tDOM.remove(id + '_progress');\r\n\t\t\t\t\tclearTimeout(t.progressTimer);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tDOM.loadCSS(s.editor_css ? ed.documentBaseURI.toAbsolute(s.editor_css) : url + \"/skins/\" + ed.settings.skin + \"/ui.css\");\r\n\r\n\t\t\tif (s.skin_variant)\r\n\t\t\t\tDOM.loadCSS(url + \"/skins/\" + ed.settings.skin + \"/ui_\" + s.skin_variant + \".css\");\r\n\t\t},\r\n\r\n\t\tcreateControl : function(n, cf) {\r\n\t\t\tvar cd, c;\r\n\r\n\t\t\tif (c = cf.createControl(n))\r\n\t\t\t\treturn c;\r\n\r\n\t\t\tswitch (n) {\r\n\t\t\t\tcase \"styleselect\":\r\n\t\t\t\t\treturn this._createStyleSelect();\r\n\r\n\t\t\t\tcase \"formatselect\":\r\n\t\t\t\t\treturn this._createBlockFormats();\r\n\r\n\t\t\t\tcase \"fontselect\":\r\n\t\t\t\t\treturn this._createFontSelect();\r\n\r\n\t\t\t\tcase \"fontsizeselect\":\r\n\t\t\t\t\treturn this._createFontSizeSelect();\r\n\r\n\t\t\t\tcase \"forecolor\":\r\n\t\t\t\t\treturn this._createForeColorMenu();\r\n\r\n\t\t\t\tcase \"backcolor\":\r\n\t\t\t\t\treturn this._createBackColorMenu();\r\n\t\t\t}\r\n\r\n\t\t\tif ((cd = this.controls[n]))\r\n\t\t\t\treturn cf.createButton(n, {title : \"advanced.\" + cd[0], cmd : cd[1], ui : cd[2], value : cd[3]});\r\n\t\t},\r\n\r\n\t\texecCommand : function(cmd, ui, val) {\r\n\t\t\tvar f = this['_' + cmd];\r\n\r\n\t\t\tif (f) {\r\n\t\t\t\tf.call(this, ui, val);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\t_importClasses : function(e) {\r\n\t\t\tvar ed = this.editor, ctrl = ed.controlManager.get('styleselect');\r\n\r\n\t\t\tif (ctrl.getLength() == 0) {\r\n\t\t\t\teach(ed.dom.getClasses(), function(o, idx) {\r\n\t\t\t\t\tvar name = 'style_' + idx;\r\n\r\n\t\t\t\t\ted.formatter.register(name, {\r\n\t\t\t\t\t\tinline : 'span',\r\n\t\t\t\t\t\tattributes : {'class' : o['class']},\r\n\t\t\t\t\t\tselector : '*'\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tctrl.add(o['class'], name);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_createStyleSelect : function(n) {\r\n\t\t\tvar t = this, ed = t.editor, ctrlMan = ed.controlManager, ctrl;\r\n\r\n\t\t\t// Setup style select box\r\n\t\t\tctrl = ctrlMan.createListBox('styleselect', {\r\n\t\t\t\ttitle : 'advanced.style_select',\r\n\t\t\t\tonselect : function(name) {\r\n\t\t\t\t\tvar matches, formatNames = [];\r\n\r\n\t\t\t\t\teach(ctrl.items, function(item) {\r\n\t\t\t\t\t\tformatNames.push(item.value);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\ted.focus();\r\n\t\t\t\t\ted.undoManager.add();\r\n\r\n\t\t\t\t\t// Toggle off the current format\r\n\t\t\t\t\tmatches = ed.formatter.matchAll(formatNames);\r\n\t\t\t\t\tif (!name || matches[0] == name)\r\n\t\t\t\t\t\ted.formatter.remove(matches[0]);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\ted.formatter.apply(name);\r\n\r\n\t\t\t\t\ted.undoManager.add();\r\n\t\t\t\t\ted.nodeChanged();\r\n\r\n\t\t\t\t\treturn false; // No auto select\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Handle specified format\r\n\t\t\ted.onInit.add(function() {\r\n\t\t\t\tvar counter = 0, formats = ed.getParam('style_formats');\r\n\r\n\t\t\t\tif (formats) {\r\n\t\t\t\t\teach(formats, function(fmt) {\r\n\t\t\t\t\t\tvar name, keys = 0;\r\n\r\n\t\t\t\t\t\teach(fmt, function() {keys++;});\r\n\r\n\t\t\t\t\t\tif (keys > 1) {\r\n\t\t\t\t\t\t\tname = fmt.name = fmt.name || 'style_' + (counter++);\r\n\t\t\t\t\t\t\ted.formatter.register(name, fmt);\r\n\t\t\t\t\t\t\tctrl.add(fmt.title, name);\r\n\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\tctrl.add(fmt.title);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\teach(ed.getParam('theme_advanced_styles', '', 'hash'), function(val, key) {\r\n\t\t\t\t\t\tvar name;\r\n\r\n\t\t\t\t\t\tif (val) {\r\n\t\t\t\t\t\t\tname = 'style_' + (counter++);\r\n\r\n\t\t\t\t\t\t\ted.formatter.register(name, {\r\n\t\t\t\t\t\t\t\tinline : 'span',\r\n\t\t\t\t\t\t\t\tclasses : val,\r\n\t\t\t\t\t\t\t\tselector : '*'\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\tctrl.add(t.editor.translate(key), name);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Auto import classes if the ctrl box is empty\r\n\t\t\tif (ctrl.getLength() == 0) {\r\n\t\t\t\tctrl.onPostRender.add(function(ed, n) {\r\n\t\t\t\t\tif (!ctrl.NativeListBox) {\r\n\t\t\t\t\t\tEvent.add(n.id + '_text', 'focus', t._importClasses, t);\r\n\t\t\t\t\t\tEvent.add(n.id + '_text', 'mousedown', t._importClasses, t);\r\n\t\t\t\t\t\tEvent.add(n.id + '_open', 'focus', t._importClasses, t);\r\n\t\t\t\t\t\tEvent.add(n.id + '_open', 'mousedown', t._importClasses, t);\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\tEvent.add(n.id, 'focus', t._importClasses, t);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn ctrl;\r\n\t\t},\r\n\r\n\t\t_createFontSelect : function() {\r\n\t\t\tvar c, t = this, ed = t.editor;\r\n\r\n\t\t\tc = ed.controlManager.createListBox('fontselect', {\r\n\t\t\t\ttitle : 'advanced.fontdefault',\r\n\t\t\t\tonselect : function(v) {\r\n\t\t\t\t\tvar cur = c.items[c.selectedIndex];\r\n\r\n\t\t\t\t\tif (!v && cur) {\r\n\t\t\t\t\t\ted.execCommand('FontName', false, cur.value);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ted.execCommand('FontName', false, v);\r\n\r\n\t\t\t\t\t// Fake selection, execCommand will fire a nodeChange and update the selection\r\n\t\t\t\t\tc.select(function(sv) {\r\n\t\t\t\t\t\treturn v == sv;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\treturn false; // No auto select\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (c) {\r\n\t\t\t\teach(ed.getParam('theme_advanced_fonts', t.settings.theme_advanced_fonts, 'hash'), function(v, k) {\r\n\t\t\t\t\tc.add(ed.translate(k), v, {style : v.indexOf('dings') == -1 ? 'font-family:' + v : ''});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn c;\r\n\t\t},\r\n\r\n\t\t_createFontSizeSelect : function() {\r\n\t\t\tvar t = this, ed = t.editor, c, i = 0, cl = [];\r\n\r\n\t\t\tc = ed.controlManager.createListBox('fontsizeselect', {title : 'advanced.font_size', onselect : function(v) {\r\n\t\t\t\tvar cur = c.items[c.selectedIndex];\r\n\r\n\t\t\t\tif (!v && cur) {\r\n\t\t\t\t\tcur = cur.value;\r\n\r\n\t\t\t\t\tif (cur['class']) {\r\n\t\t\t\t\t\ted.formatter.toggle('fontsize_class', {value : cur['class']});\r\n\t\t\t\t\t\ted.undoManager.add();\r\n\t\t\t\t\t\ted.nodeChanged();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ted.execCommand('FontSize', false, cur.fontSize);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (v['class']) {\r\n\t\t\t\t\ted.focus();\r\n\t\t\t\t\ted.undoManager.add();\r\n\t\t\t\t\ted.formatter.toggle('fontsize_class', {value : v['class']});\r\n\t\t\t\t\ted.undoManager.add();\r\n\t\t\t\t\ted.nodeChanged();\r\n\t\t\t\t} else\r\n\t\t\t\t\ted.execCommand('FontSize', false, v.fontSize);\r\n\r\n\t\t\t\t// Fake selection, execCommand will fire a nodeChange and update the selection\r\n\t\t\t\tc.select(function(sv) {\r\n\t\t\t\t\treturn v == sv;\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn false; // No auto select\r\n\t\t\t}});\r\n\r\n\t\t\tif (c) {\r\n\t\t\t\teach(t.settings.theme_advanced_font_sizes, function(v, k) {\r\n\t\t\t\t\tvar fz = v.fontSize;\r\n\r\n\t\t\t\t\tif (fz >= 1 && fz <= 7)\r\n\t\t\t\t\t\tfz = t.sizes[parseInt(fz) - 1] + 'pt';\r\n\r\n\t\t\t\t\tc.add(k, v, {'style' : 'font-size:' + fz, 'class' : 'mceFontSize' + (i++) + (' ' + (v['class'] || ''))});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn c;\r\n\t\t},\r\n\r\n\t\t_createBlockFormats : function() {\r\n\t\t\tvar c, fmts = {\r\n\t\t\t\tp : 'advanced.paragraph',\r\n\t\t\t\taddress : 'advanced.address',\r\n\t\t\t\tpre : 'advanced.pre',\r\n\t\t\t\th1 : 'advanced.h1',\r\n\t\t\t\th2 : 'advanced.h2',\r\n\t\t\t\th3 : 'advanced.h3',\r\n\t\t\t\th4 : 'advanced.h4',\r\n\t\t\t\th5 : 'advanced.h5',\r\n\t\t\t\th6 : 'advanced.h6',\r\n\t\t\t\tdiv : 'advanced.div',\r\n\t\t\t\tblockquote : 'advanced.blockquote',\r\n\t\t\t\tcode : 'advanced.code',\r\n\t\t\t\tdt : 'advanced.dt',\r\n\t\t\t\tdd : 'advanced.dd',\r\n\t\t\t\tsamp : 'advanced.samp'\r\n\t\t\t}, t = this;\r\n\r\n\t\t\tc = t.editor.controlManager.createListBox('formatselect', {title : 'advanced.block', cmd : 'FormatBlock'});\r\n\t\t\tif (c) {\r\n\t\t\t\teach(t.editor.getParam('theme_advanced_blockformats', t.settings.theme_advanced_blockformats, 'hash'), function(v, k) {\r\n\t\t\t\t\tc.add(t.editor.translate(k != v ? k : fmts[v]), v, {'class' : 'mce_formatPreview mce_' + v});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn c;\r\n\t\t},\r\n\r\n\t\t_createForeColorMenu : function() {\r\n\t\t\tvar c, t = this, s = t.settings, o = {}, v;\r\n\r\n\t\t\tif (s.theme_advanced_more_colors) {\r\n\t\t\t\to.more_colors_func = function() {\r\n\t\t\t\t\tt._mceColorPicker(0, {\r\n\t\t\t\t\t\tcolor : c.value,\r\n\t\t\t\t\t\tfunc : function(co) {\r\n\t\t\t\t\t\t\tc.setColor(co);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tif (v = s.theme_advanced_text_colors)\r\n\t\t\t\to.colors = v;\r\n\r\n\t\t\tif (s.theme_advanced_default_foreground_color)\r\n\t\t\t\to.default_color = s.theme_advanced_default_foreground_color;\r\n\r\n\t\t\to.title = 'advanced.forecolor_desc';\r\n\t\t\to.cmd = 'ForeColor';\r\n\t\t\to.scope = this;\r\n\r\n\t\t\tc = t.editor.controlManager.createColorSplitButton('forecolor', o);\r\n\r\n\t\t\treturn c;\r\n\t\t},\r\n\r\n\t\t_createBackColorMenu : function() {\r\n\t\t\tvar c, t = this, s = t.settings, o = {}, v;\r\n\r\n\t\t\tif (s.theme_advanced_more_colors) {\r\n\t\t\t\to.more_colors_func = function() {\r\n\t\t\t\t\tt._mceColorPicker(0, {\r\n\t\t\t\t\t\tcolor : c.value,\r\n\t\t\t\t\t\tfunc : function(co) {\r\n\t\t\t\t\t\t\tc.setColor(co);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tif (v = s.theme_advanced_background_colors)\r\n\t\t\t\to.colors = v;\r\n\r\n\t\t\tif (s.theme_advanced_default_background_color)\r\n\t\t\t\to.default_color = s.theme_advanced_default_background_color;\r\n\r\n\t\t\to.title = 'advanced.backcolor_desc';\r\n\t\t\to.cmd = 'HiliteColor';\r\n\t\t\to.scope = this;\r\n\r\n\t\t\tc = t.editor.controlManager.createColorSplitButton('backcolor', o);\r\n\r\n\t\t\treturn c;\r\n\t\t},\r\n\r\n\t\trenderUI : function(o) {\r\n\t\t\tvar n, ic, tb, t = this, ed = t.editor, s = t.settings, sc, p, nl;\r\n\r\n\t\t\tn = p = DOM.create('span', {id : ed.id + '_parent', 'class' : 'mceEditor ' + ed.settings.skin + 'Skin' + (s.skin_variant ? ' ' + ed.settings.skin + 'Skin' + t._ufirst(s.skin_variant) : '')});\r\n\r\n\t\t\tif (!DOM.boxModel)\r\n\t\t\t\tn = DOM.add(n, 'div', {'class' : 'mceOldBoxModel'});\r\n\r\n\t\t\tn = sc = DOM.add(n, 'table', {id : ed.id + '_tbl', 'class' : 'mceLayout', cellSpacing : 0, cellPadding : 0});\r\n\t\t\tn = tb = DOM.add(n, 'tbody');\r\n\r\n\t\t\tswitch ((s.theme_advanced_layout_manager || '').toLowerCase()) {\r\n\t\t\t\tcase \"rowlayout\":\r\n\t\t\t\t\tic = t._rowLayout(s, tb, o);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"customlayout\":\r\n\t\t\t\t\tic = ed.execCallback(\"theme_advanced_custom_layout\", s, tb, o, p);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tic = t._simpleLayout(s, tb, o, p);\r\n\t\t\t}\r\n\r\n\t\t\tn = o.targetNode;\r\n\r\n\t\t\t// Add classes to first and last TRs\r\n\t\t\tnl = DOM.stdMode ? sc.getElementsByTagName('tr') : sc.rows; // Quick fix for IE 8\r\n\t\t\tDOM.addClass(nl[0], 'mceFirst');\r\n\t\t\tDOM.addClass(nl[nl.length - 1], 'mceLast');\r\n\r\n\t\t\t// Add classes to first and last TDs\r\n\t\t\teach(DOM.select('tr', tb), function(n) {\r\n\t\t\t\tDOM.addClass(n.firstChild, 'mceFirst');\r\n\t\t\t\tDOM.addClass(n.childNodes[n.childNodes.length - 1], 'mceLast');\r\n\t\t\t});\r\n\r\n\t\t\tif (DOM.get(s.theme_advanced_toolbar_container))\r\n\t\t\t\tDOM.get(s.theme_advanced_toolbar_container).appendChild(p);\r\n\t\t\telse\r\n\t\t\t\tDOM.insertAfter(p, n);\r\n\r\n\t\t\tEvent.add(ed.id + '_path_row', 'click', function(e) {\r\n\t\t\t\te = e.target;\r\n\r\n\t\t\t\tif (e.nodeName == 'A') {\r\n\t\t\t\t\tt._sel(e.className.replace(/^.*mcePath_([0-9]+).*$/, '$1'));\r\n\r\n\t\t\t\t\treturn Event.cancel(e);\r\n\t\t\t\t}\r\n\t\t\t});\r\n/*\r\n\t\t\tif (DOM.get(ed.id + '_path_row')) {\r\n\t\t\t\tEvent.add(ed.id + '_tbl', 'mouseover', function(e) {\r\n\t\t\t\t\tvar re;\r\n\t\r\n\t\t\t\t\te = e.target;\r\n\r\n\t\t\t\t\tif (e.nodeName == 'SPAN' && DOM.hasClass(e.parentNode, 'mceButton')) {\r\n\t\t\t\t\t\tre = DOM.get(ed.id + '_path_row');\r\n\t\t\t\t\t\tt.lastPath = re.innerHTML;\r\n\t\t\t\t\t\tDOM.setHTML(re, e.parentNode.title);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tEvent.add(ed.id + '_tbl', 'mouseout', function(e) {\r\n\t\t\t\t\tif (t.lastPath) {\r\n\t\t\t\t\t\tDOM.setHTML(ed.id + '_path_row', t.lastPath);\r\n\t\t\t\t\t\tt.lastPath = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n*/\r\n\r\n\t\t\tif (!ed.getParam('accessibility_focus'))\r\n\t\t\t\tEvent.add(DOM.add(p, 'a', {href : '#'}, '<!-- IE -->'), 'focus', function() {tinyMCE.get(ed.id).focus();});\r\n\r\n\t\t\tif (s.theme_advanced_toolbar_location == 'external')\r\n\t\t\t\to.deltaHeight = 0;\r\n\r\n\t\t\tt.deltaHeight = o.deltaHeight;\r\n\t\t\to.targetNode = null;\r\n\r\n\t\t\treturn {\r\n\t\t\t\tiframeContainer : ic,\r\n\t\t\t\teditorContainer : ed.id + '_parent',\r\n\t\t\t\tsizeContainer : sc,\r\n\t\t\t\tdeltaHeight : o.deltaHeight\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\tgetInfo : function() {\r\n\t\t\treturn {\r\n\t\t\t\tlongname : 'Advanced theme',\r\n\t\t\t\tauthor : 'Moxiecode Systems AB',\r\n\t\t\t\tauthorurl : 'http://tinymce.moxiecode.com',\r\n\t\t\t\tversion : tinymce.majorVersion + \".\" + tinymce.minorVersion\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tresizeBy : function(dw, dh) {\r\n\t\t\tvar e = DOM.get(this.editor.id + '_tbl');\r\n\r\n\t\t\tthis.resizeTo(e.clientWidth + dw, e.clientHeight + dh);\r\n\t\t},\r\n\r\n\t\tresizeTo : function(w, h) {\r\n\t\t\tvar ed = this.editor, s = this.settings, e = DOM.get(ed.id + '_tbl'), ifr = DOM.get(ed.id + '_ifr');\r\n\r\n\t\t\t// Boundery fix box\r\n\t\t\tw = Math.max(s.theme_advanced_resizing_min_width || 100, w);\r\n\t\t\th = Math.max(s.theme_advanced_resizing_min_height || 100, h);\r\n\t\t\tw = Math.min(s.theme_advanced_resizing_max_width || 0xFFFF, w);\r\n\t\t\th = Math.min(s.theme_advanced_resizing_max_height || 0xFFFF, h);\r\n\r\n\t\t\t// Resize iframe and container\r\n\t\t\tDOM.setStyle(e, 'height', '');\r\n\t\t\tDOM.setStyle(ifr, 'height', h);\r\n\r\n\t\t\tif (s.theme_advanced_resize_horizontal) {\r\n\t\t\t\tDOM.setStyle(e, 'width', '');\r\n\t\t\t\tDOM.setStyle(ifr, 'width', w);\r\n\r\n\t\t\t\t// Make sure that the size is never smaller than the over all ui\r\n\t\t\t\tif (w < e.clientWidth)\r\n\t\t\t\t\tDOM.setStyle(ifr, 'width', e.clientWidth);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tdestroy : function() {\r\n\t\t\tvar id = this.editor.id;\r\n\r\n\t\t\tEvent.clear(id + '_resize');\r\n\t\t\tEvent.clear(id + '_path_row');\r\n\t\t\tEvent.clear(id + '_external_close');\r\n\t\t},\r\n\r\n\t\t// Internal functions\r\n\r\n\t\t_simpleLayout : function(s, tb, o, p) {\r\n\t\t\tvar t = this, ed = t.editor, lo = s.theme_advanced_toolbar_location, sl = s.theme_advanced_statusbar_location, n, ic, etb, c;\r\n\r\n\t\t\tif (s.readonly) {\r\n\t\t\t\tn = DOM.add(tb, 'tr');\r\n\t\t\t\tn = ic = DOM.add(n, 'td', {'class' : 'mceIframeContainer'});\r\n\t\t\t\treturn ic;\r\n\t\t\t}\r\n\r\n\t\t\t// Create toolbar container at top\r\n\t\t\tif (lo == 'top')\r\n\t\t\t\tt._addToolbars(tb, o);\r\n\r\n\t\t\t// Create external toolbar\r\n\t\t\tif (lo == 'external') {\r\n\t\t\t\tn = c = DOM.create('div', {style : 'position:relative'});\r\n\t\t\t\tn = DOM.add(n, 'div', {id : ed.id + '_external', 'class' : 'mceExternalToolbar'});\r\n\t\t\t\tDOM.add(n, 'a', {id : ed.id + '_external_close', href : 'javascript:;', 'class' : 'mceExternalClose'});\r\n\t\t\t\tn = DOM.add(n, 'table', {id : ed.id + '_tblext', cellSpacing : 0, cellPadding : 0});\r\n\t\t\t\tetb = DOM.add(n, 'tbody');\r\n\r\n\t\t\t\tif (p.firstChild.className == 'mceOldBoxModel')\r\n\t\t\t\t\tp.firstChild.appendChild(c);\r\n\t\t\t\telse\r\n\t\t\t\t\tp.insertBefore(c, p.firstChild);\r\n\r\n\t\t\t\tt._addToolbars(etb, o);\r\n\r\n\t\t\t\ted.onMouseUp.add(function() {\r\n\t\t\t\t\tvar e = DOM.get(ed.id + '_external');\r\n\t\t\t\t\tDOM.show(e);\r\n\r\n\t\t\t\t\tDOM.hide(lastExtID);\r\n\r\n\t\t\t\t\tvar f = Event.add(ed.id + '_external_close', 'click', function() {\r\n\t\t\t\t\t\tDOM.hide(ed.id + '_external');\r\n\t\t\t\t\t\tEvent.remove(ed.id + '_external_close', 'click', f);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tDOM.show(e);\r\n\t\t\t\t\tDOM.setStyle(e, 'top', 0 - DOM.getRect(ed.id + '_tblext').h - 1);\r\n\r\n\t\t\t\t\t// Fixes IE rendering bug\r\n\t\t\t\t\tDOM.hide(e);\r\n\t\t\t\t\tDOM.show(e);\r\n\t\t\t\t\te.style.filter = '';\r\n\r\n\t\t\t\t\tlastExtID = ed.id + '_external';\r\n\r\n\t\t\t\t\te = null;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (sl == 'top')\r\n\t\t\t\tt._addStatusBar(tb, o);\r\n\r\n\t\t\t// Create iframe container\r\n\t\t\tif (!s.theme_advanced_toolbar_container) {\r\n\t\t\t\tn = DOM.add(tb, 'tr');\r\n\t\t\t\tn = ic = DOM.add(n, 'td', {'class' : 'mceIframeContainer'});\r\n\t\t\t}\r\n\r\n\t\t\t// Create toolbar container at bottom\r\n\t\t\tif (lo == 'bottom')\r\n\t\t\t\tt._addToolbars(tb, o);\r\n\r\n\t\t\tif (sl == 'bottom')\r\n\t\t\t\tt._addStatusBar(tb, o);\r\n\r\n\t\t\treturn ic;\r\n\t\t},\r\n\r\n\t\t_rowLayout : function(s, tb, o) {\r\n\t\t\tvar t = this, ed = t.editor, dc, da, cf = ed.controlManager, n, ic, to, a;\r\n\r\n\t\t\tdc = s.theme_advanced_containers_default_class || '';\r\n\t\t\tda = s.theme_advanced_containers_default_align || 'center';\r\n\r\n\t\t\teach(explode(s.theme_advanced_containers || ''), function(c, i) {\r\n\t\t\t\tvar v = s['theme_advanced_container_' + c] || '';\r\n\r\n\t\t\t\tswitch (v.toLowerCase()) {\r\n\t\t\t\t\tcase 'mceeditor':\r\n\t\t\t\t\t\tn = DOM.add(tb, 'tr');\r\n\t\t\t\t\t\tn = ic = DOM.add(n, 'td', {'class' : 'mceIframeContainer'});\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'mceelementpath':\r\n\t\t\t\t\t\tt._addStatusBar(tb, o);\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\ta = (s['theme_advanced_container_' + c + '_align'] || da).toLowerCase();\r\n\t\t\t\t\t\ta = 'mce' + t._ufirst(a);\r\n\r\n\t\t\t\t\t\tn = DOM.add(DOM.add(tb, 'tr'), 'td', {\r\n\t\t\t\t\t\t\t'class' : 'mceToolbar ' + (s['theme_advanced_container_' + c + '_class'] || dc) + ' ' + a || da\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tto = cf.createToolbar(\"toolbar\" + i);\r\n\t\t\t\t\t\tt._addControls(v, to);\r\n\t\t\t\t\t\tDOM.setHTML(n, to.renderHTML());\r\n\t\t\t\t\t\to.deltaHeight -= s.theme_advanced_row_height;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn ic;\r\n\t\t},\r\n\r\n\t\t_addControls : function(v, tb) {\r\n\t\t\tvar t = this, s = t.settings, di, cf = t.editor.controlManager;\r\n\r\n\t\t\tif (s.theme_advanced_disable && !t._disabled) {\r\n\t\t\t\tdi = {};\r\n\r\n\t\t\t\teach(explode(s.theme_advanced_disable), function(v) {\r\n\t\t\t\t\tdi[v] = 1;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tt._disabled = di;\r\n\t\t\t} else\r\n\t\t\t\tdi = t._disabled;\r\n\r\n\t\t\teach(explode(v), function(n) {\r\n\t\t\t\tvar c;\r\n\r\n\t\t\t\tif (di && di[n])\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t// Compatiblity with 2.x\r\n\t\t\t\tif (n == 'tablecontrols') {\r\n\t\t\t\t\teach([\"table\",\"|\",\"row_props\",\"cell_props\",\"|\",\"row_before\",\"row_after\",\"delete_row\",\"|\",\"col_before\",\"col_after\",\"delete_col\",\"|\",\"split_cells\",\"merge_cells\"], function(n) {\r\n\t\t\t\t\t\tn = t.createControl(n, cf);\r\n\r\n\t\t\t\t\t\tif (n)\r\n\t\t\t\t\t\t\ttb.add(n);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tc = t.createControl(n, cf);\r\n\r\n\t\t\t\tif (c)\r\n\t\t\t\t\ttb.add(c);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_addToolbars : function(c, o) {\r\n\t\t\tvar t = this, i, tb, ed = t.editor, s = t.settings, v, cf = ed.controlManager, di, n, h = [], a;\r\n\r\n\t\t\ta = s.theme_advanced_toolbar_align.toLowerCase();\r\n\t\t\ta = 'mce' + t._ufirst(a);\r\n\r\n\t\t\tn = DOM.add(DOM.add(c, 'tr'), 'td', {'class' : 'mceToolbar ' + a});\r\n\r\n\t\t\tif (!ed.getParam('accessibility_focus'))\r\n\t\t\t\th.push(DOM.createHTML('a', {href : '#', onfocus : 'tinyMCE.get(\\'' + ed.id + '\\').focus();'}, '<!-- IE -->'));\r\n\r\n\t\t\th.push(DOM.createHTML('a', {href : '#', accesskey : 'q', title : ed.getLang(\"advanced.toolbar_focus\")}, '<!-- IE -->'));\r\n\r\n\t\t\t// Create toolbar and add the controls\r\n\t\t\tfor (i=1; (v = s['theme_advanced_buttons' + i]); i++) {\r\n\t\t\t\ttb = cf.createToolbar(\"toolbar\" + i, {'class' : 'mceToolbarRow' + i});\r\n\r\n\t\t\t\tif (s['theme_advanced_buttons' + i + '_add'])\r\n\t\t\t\t\tv += ',' + s['theme_advanced_buttons' + i + '_add'];\r\n\r\n\t\t\t\tif (s['theme_advanced_buttons' + i + '_add_before'])\r\n\t\t\t\t\tv = s['theme_advanced_buttons' + i + '_add_before'] + ',' + v;\r\n\r\n\t\t\t\tt._addControls(v, tb);\r\n\r\n\t\t\t\t//n.appendChild(n = tb.render());\r\n\t\t\t\th.push(tb.renderHTML());\r\n\r\n\t\t\t\to.deltaHeight -= s.theme_advanced_row_height;\r\n\t\t\t}\r\n\r\n\t\t\th.push(DOM.createHTML('a', {href : '#', accesskey : 'z', title : ed.getLang(\"advanced.toolbar_focus\"), onfocus : 'tinyMCE.getInstanceById(\\'' + ed.id + '\\').focus();'}, '<!-- IE -->'));\r\n\t\t\tDOM.setHTML(n, h.join(''));\r\n\t\t},\r\n\r\n\t\t_addStatusBar : function(tb, o) {\r\n\t\t\tvar n, t = this, ed = t.editor, s = t.settings, r, mf, me, td;\r\n\r\n\t\t\tn = DOM.add(tb, 'tr');\r\n\t\t\tn = td = DOM.add(n, 'td', {'class' : 'mceStatusbar'});\r\n\t\t\tn = DOM.add(n, 'div', {id : ed.id + '_path_row'}, s.theme_advanced_path ? ed.translate('advanced.path') + ': ' : '&#160;');\r\n\t\t\tDOM.add(n, 'a', {href : '#', accesskey : 'x'});\r\n\r\n\t\t\tif (s.theme_advanced_resizing) {\r\n\t\t\t\tDOM.add(td, 'a', {id : ed.id + '_resize', href : 'javascript:;', onclick : \"return false;\", 'class' : 'mceResize'});\r\n\r\n\t\t\t\tif (s.theme_advanced_resizing_use_cookie) {\r\n\t\t\t\t\ted.onPostRender.add(function() {\r\n\t\t\t\t\t\tvar o = Cookie.getHash(\"TinyMCE_\" + ed.id + \"_size\"), c = DOM.get(ed.id + '_tbl');\r\n\r\n\t\t\t\t\t\tif (!o)\r\n\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\tt.resizeTo(o.cw, o.ch);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\ted.onPostRender.add(function() {\r\n\t\t\t\t\tEvent.add(ed.id + '_resize', 'mousedown', function(e) {\r\n\t\t\t\t\t\tvar mouseMoveHandler1, mouseMoveHandler2,\r\n\t\t\t\t\t\t\tmouseUpHandler1, mouseUpHandler2,\r\n\t\t\t\t\t\t\tstartX, startY, startWidth, startHeight, width, height, ifrElm;\r\n\r\n\t\t\t\t\t\tfunction resizeOnMove(e) {\r\n\t\t\t\t\t\t\twidth = startWidth + (e.screenX - startX);\r\n\t\t\t\t\t\t\theight = startHeight + (e.screenY - startY);\r\n\r\n\t\t\t\t\t\t\tt.resizeTo(width, height);\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tfunction endResize(e) {\r\n\t\t\t\t\t\t\t// Stop listening\r\n\t\t\t\t\t\t\tEvent.remove(DOM.doc, 'mousemove', mouseMoveHandler1);\r\n\t\t\t\t\t\t\tEvent.remove(ed.getDoc(), 'mousemove', mouseMoveHandler2);\r\n\t\t\t\t\t\t\tEvent.remove(DOM.doc, 'mouseup', mouseUpHandler1);\r\n\t\t\t\t\t\t\tEvent.remove(ed.getDoc(), 'mouseup', mouseUpHandler2);\r\n\r\n\t\t\t\t\t\t\t// Store away the size\r\n\t\t\t\t\t\t\tif (s.theme_advanced_resizing_use_cookie) {\r\n\t\t\t\t\t\t\t\tCookie.setHash(\"TinyMCE_\" + ed.id + \"_size\", {\r\n\t\t\t\t\t\t\t\t\tcw : width,\r\n\t\t\t\t\t\t\t\t\tch : height\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t// Get the current rect size\r\n\t\t\t\t\t\tstartX = e.screenX;\r\n\t\t\t\t\t\tstartY = e.screenY;\r\n\t\t\t\t\t\tifrElm = DOM.get(t.editor.id + '_ifr');\r\n\t\t\t\t\t\tstartWidth = width = ifrElm.clientWidth;\r\n\t\t\t\t\t\tstartHeight = height = ifrElm.clientHeight;\r\n\r\n\t\t\t\t\t\t// Register envent handlers\r\n\t\t\t\t\t\tmouseMoveHandler1 = Event.add(DOM.doc, 'mousemove', resizeOnMove);\r\n\t\t\t\t\t\tmouseMoveHandler2 = Event.add(ed.getDoc(), 'mousemove', resizeOnMove);\r\n\t\t\t\t\t\tmouseUpHandler1 = Event.add(DOM.doc, 'mouseup', endResize);\r\n\t\t\t\t\t\tmouseUpHandler2 = Event.add(ed.getDoc(), 'mouseup', endResize);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\to.deltaHeight -= 21;\r\n\t\t\tn = tb = null;\r\n\t\t},\r\n\r\n\t\t_nodeChanged : function(ed, cm, n, co, ob) {\r\n\t\t\tvar t = this, p, de = 0, v, c, s = t.settings, cl, fz, fn, formatNames, matches;\r\n\r\n\t\t\ttinymce.each(t.stateControls, function(c) {\r\n\t\t\t\tcm.setActive(c, ed.queryCommandState(t.controls[c][1]));\r\n\t\t\t});\r\n\r\n\t\t\tfunction getParent(name) {\r\n\t\t\t\tvar i, parents = ob.parents, func = name;\r\n\r\n\t\t\t\tif (typeof(name) == 'string') {\r\n\t\t\t\t\tfunc = function(node) {\r\n\t\t\t\t\t\treturn node.nodeName == name;\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (i = 0; i < parents.length; i++) {\r\n\t\t\t\t\tif (func(parents[i]))\r\n\t\t\t\t\t\treturn parents[i];\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tcm.setActive('visualaid', ed.hasVisual);\r\n\t\t\tcm.setDisabled('undo', !ed.undoManager.hasUndo() && !ed.typing);\r\n\t\t\tcm.setDisabled('redo', !ed.undoManager.hasRedo());\r\n\t\t\tcm.setDisabled('outdent', !ed.queryCommandState('Outdent'));\r\n\r\n\t\t\tp = getParent('A');\r\n\t\t\tif (c = cm.get('link')) {\r\n\t\t\t\tif (!p || !p.name) {\r\n\t\t\t\t\tc.setDisabled(!p && co);\r\n\t\t\t\t\tc.setActive(!!p);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (c = cm.get('unlink')) {\r\n\t\t\t\tc.setDisabled(!p && co);\r\n\t\t\t\tc.setActive(!!p && !p.name);\r\n\t\t\t}\r\n\r\n\t\t\tif (c = cm.get('anchor')) {\r\n\t\t\t\tc.setActive(!!p && p.name);\r\n\t\t\t}\r\n\r\n\t\t\tp = getParent('IMG');\r\n\t\t\tif (c = cm.get('image'))\r\n\t\t\t\tc.setActive(!!p && n.className.indexOf('mceItem') == -1);\r\n\r\n\t\t\tif (c = cm.get('styleselect')) {\r\n\t\t\t\tt._importClasses();\r\n\r\n\t\t\t\tformatNames = [];\r\n\t\t\t\teach(c.items, function(item) {\r\n\t\t\t\t\tformatNames.push(item.value);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tmatches = ed.formatter.matchAll(formatNames);\r\n\t\t\t\tc.select(matches[0]);\r\n\t\t\t}\r\n\r\n\t\t\tif (c = cm.get('formatselect')) {\r\n\t\t\t\tp = getParent(DOM.isBlock);\r\n\r\n\t\t\t\tif (p)\r\n\t\t\t\t\tc.select(p.nodeName.toLowerCase());\r\n\t\t\t}\r\n\r\n\t\t\t// Find out current fontSize, fontFamily and fontClass\r\n\t\t\tgetParent(function(n) {\r\n\t\t\t\tif (n.nodeName === 'SPAN') {\r\n\t\t\t\t\tif (!cl && n.className)\r\n\t\t\t\t\t\tcl = n.className;\r\n\r\n\t\t\t\t\tif (!fz && n.style.fontSize)\r\n\t\t\t\t\t\tfz = n.style.fontSize;\r\n\r\n\t\t\t\t\tif (!fn && n.style.fontFamily)\r\n\t\t\t\t\t\tfn = n.style.fontFamily.replace(/[\\\"\\']+/g, '').replace(/^([^,]+).*/, '$1').toLowerCase();\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn false;\r\n\t\t\t});\r\n\r\n\t\t\tif (c = cm.get('fontselect')) {\r\n\t\t\t\tc.select(function(v) {\r\n\t\t\t\t\treturn v.replace(/^([^,]+).*/, '$1').toLowerCase() == fn;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Select font size\r\n\t\t\tif (c = cm.get('fontsizeselect')) {\r\n\t\t\t\t// Use computed style\r\n\t\t\t\tif (s.theme_advanced_runtime_fontsize && !fz && !cl)\r\n\t\t\t\t\tfz = ed.dom.getStyle(n, 'fontSize', true);\r\n\r\n\t\t\t\tc.select(function(v) {\r\n\t\t\t\t\tif (v.fontSize && v.fontSize === fz)\r\n\t\t\t\t\t\treturn true;\r\n\r\n\t\t\t\t\tif (v['class'] && v['class'] === cl)\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (s.theme_advanced_path && s.theme_advanced_statusbar_location) {\r\n\t\t\t\tp = DOM.get(ed.id + '_path') || DOM.add(ed.id + '_path_row', 'span', {id : ed.id + '_path'});\r\n\t\t\t\tDOM.setHTML(p, '');\r\n\r\n\t\t\t\tgetParent(function(n) {\r\n\t\t\t\t\tvar na = n.nodeName.toLowerCase(), u, pi, ti = '';\r\n\r\n\t\t\t\t\t/*if (n.getAttribute('_mce_bogus'))\r\n\t\t\t\t\t\treturn;\r\n*/\r\n\t\t\t\t\t// Ignore non element and hidden elements\r\n\t\t\t\t\tif (n.nodeType != 1 || n.nodeName === 'BR' || (DOM.hasClass(n, 'mceItemHidden') || DOM.hasClass(n, 'mceItemRemoved')))\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t// Fake name\r\n\t\t\t\t\tif (v = DOM.getAttrib(n, 'mce_name'))\r\n\t\t\t\t\t\tna = v;\r\n\r\n\t\t\t\t\t// Handle prefix\r\n\t\t\t\t\tif (tinymce.isIE && n.scopeName !== 'HTML')\r\n\t\t\t\t\t\tna = n.scopeName + ':' + na;\r\n\r\n\t\t\t\t\t// Remove internal prefix\r\n\t\t\t\t\tna = na.replace(/mce\\:/g, '');\r\n\r\n\t\t\t\t\t// Handle node name\r\n\t\t\t\t\tswitch (na) {\r\n\t\t\t\t\t\tcase 'b':\r\n\t\t\t\t\t\t\tna = 'strong';\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 'i':\r\n\t\t\t\t\t\t\tna = 'em';\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 'img':\r\n\t\t\t\t\t\t\tif (v = DOM.getAttrib(n, 'src'))\r\n\t\t\t\t\t\t\t\tti += 'src: ' + v + ' ';\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 'a':\r\n\t\t\t\t\t\t\tif (v = DOM.getAttrib(n, 'name')) {\r\n\t\t\t\t\t\t\t\tti += 'name: ' + v + ' ';\r\n\t\t\t\t\t\t\t\tna += '#' + v;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (v = DOM.getAttrib(n, 'href'))\r\n\t\t\t\t\t\t\t\tti += 'href: ' + v + ' ';\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 'font':\r\n\t\t\t\t\t\t\tif (v = DOM.getAttrib(n, 'face'))\r\n\t\t\t\t\t\t\t\tti += 'font: ' + v + ' ';\r\n\r\n\t\t\t\t\t\t\tif (v = DOM.getAttrib(n, 'size'))\r\n\t\t\t\t\t\t\t\tti += 'size: ' + v + ' ';\r\n\r\n\t\t\t\t\t\t\tif (v = DOM.getAttrib(n, 'color'))\r\n\t\t\t\t\t\t\t\tti += 'color: ' + v + ' ';\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 'span':\r\n\t\t\t\t\t\t\tif (v = DOM.getAttrib(n, 'style'))\r\n\t\t\t\t\t\t\t\tti += 'style: ' + v + ' ';\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (v = DOM.getAttrib(n, 'id'))\r\n\t\t\t\t\t\tti += 'id: ' + v + ' ';\r\n\r\n\t\t\t\t\tif (v = n.className) {\r\n\t\t\t\t\t\tv = v.replace(/\\b\\s*(webkit|mce|Apple-)\\w+\\s*\\b/g, '')\r\n\r\n\t\t\t\t\t\tif (v) {\r\n\t\t\t\t\t\t\tti += 'class: ' + v + ' ';\r\n\r\n\t\t\t\t\t\t\tif (DOM.isBlock(n) || na == 'img' || na == 'span')\r\n\t\t\t\t\t\t\t\tna += '.' + v;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tna = na.replace(/(html:)/g, '');\r\n\t\t\t\t\tna = {name : na, node : n, title : ti};\r\n\t\t\t\t\tt.onResolveName.dispatch(t, na);\r\n\t\t\t\t\tti = na.title;\r\n\t\t\t\t\tna = na.name;\r\n\r\n\t\t\t\t\t//u = \"javascript:tinymce.EditorManager.get('\" + ed.id + \"').theme._sel('\" + (de++) + \"');\";\r\n\t\t\t\t\tpi = DOM.create('a', {'href' : \"javascript:;\", onmousedown : \"return false;\", title : ti, 'class' : 'mcePath_' + (de++)}, na);\r\n\r\n\t\t\t\t\tif (p.hasChildNodes()) {\r\n\t\t\t\t\t\tp.insertBefore(DOM.doc.createTextNode(' \\u00bb '), p.firstChild);\r\n\t\t\t\t\t\tp.insertBefore(pi, p.firstChild);\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\tp.appendChild(pi);\r\n\t\t\t\t}, ed.getBody());\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t// Commands gets called by execCommand\r\n\r\n\t\t_sel : function(v) {\r\n\t\t\tthis.editor.execCommand('mceSelectNodeDepth', false, v);\r\n\t\t},\r\n\r\n\t\t_mceInsertAnchor : function(ui, v) {\r\n\t\t\tvar ed = this.editor;\r\n\r\n\t\t\ted.windowManager.open({\r\n\t\t\t\turl : this.url + '/anchor.htm',\r\n\t\t\t\twidth : 320 + parseInt(ed.getLang('advanced.anchor_delta_width', 0)),\r\n\t\t\t\theight : 90 + parseInt(ed.getLang('advanced.anchor_delta_height', 0)),\r\n\t\t\t\tinline : true\r\n\t\t\t}, {\r\n\t\t\t\ttheme_url : this.url\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_mceCharMap : function() {\r\n\t\t\tvar ed = this.editor;\r\n\r\n\t\t\ted.windowManager.open({\r\n\t\t\t\turl : this.url + '/charmap.htm',\r\n\t\t\t\twidth : 550 + parseInt(ed.getLang('advanced.charmap_delta_width', 0)),\r\n\t\t\t\theight : 250 + parseInt(ed.getLang('advanced.charmap_delta_height', 0)),\r\n\t\t\t\tinline : true\r\n\t\t\t}, {\r\n\t\t\t\ttheme_url : this.url\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_mceHelp : function() {\r\n\t\t\tvar ed = this.editor;\r\n\r\n\t\t\ted.windowManager.open({\r\n\t\t\t\turl : this.url + '/about.htm',\r\n\t\t\t\twidth : 480,\r\n\t\t\t\theight : 380,\r\n\t\t\t\tinline : true\r\n\t\t\t}, {\r\n\t\t\t\ttheme_url : this.url\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_mceColorPicker : function(u, v) {\r\n\t\t\tvar ed = this.editor;\r\n\r\n\t\t\tv = v || {};\r\n\r\n\t\t\ted.windowManager.open({\r\n\t\t\t\turl : this.url + '/color_picker.htm',\r\n\t\t\t\twidth : 375 + parseInt(ed.getLang('advanced.colorpicker_delta_width', 0)),\r\n\t\t\t\theight : 250 + parseInt(ed.getLang('advanced.colorpicker_delta_height', 0)),\r\n\t\t\t\tclose_previous : false,\r\n\t\t\t\tinline : true\r\n\t\t\t}, {\r\n\t\t\t\tinput_color : v.color,\r\n\t\t\t\tfunc : v.func,\r\n\t\t\t\ttheme_url : this.url\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_mceCodeEditor : function(ui, val) {\r\n\t\t\tvar ed = this.editor;\r\n\r\n\t\t\ted.windowManager.open({\r\n\t\t\t\turl : this.url + '/source_editor.htm',\r\n\t\t\t\twidth : parseInt(ed.getParam(\"theme_advanced_source_editor_width\", 720)),\r\n\t\t\t\theight : parseInt(ed.getParam(\"theme_advanced_source_editor_height\", 580)),\r\n\t\t\t\tinline : true,\r\n\t\t\t\tresizable : true,\r\n\t\t\t\tmaximizable : true\r\n\t\t\t}, {\r\n\t\t\t\ttheme_url : this.url\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_mceImage : function(ui, val) {\r\n\t\t\tvar ed = this.editor;\r\n\r\n\t\t\t// Internal image object like a flash placeholder\r\n\t\t\tif (ed.dom.getAttrib(ed.selection.getNode(), 'class').indexOf('mceItem') != -1)\r\n\t\t\t\treturn;\r\n\r\n\t\t\ted.windowManager.open({\r\n\t\t\t\turl : this.url + '/image.htm',\r\n\t\t\t\twidth : 355 + parseInt(ed.getLang('advanced.image_delta_width', 0)),\r\n\t\t\t\theight : 275 + parseInt(ed.getLang('advanced.image_delta_height', 0)),\r\n\t\t\t\tinline : true\r\n\t\t\t}, {\r\n\t\t\t\ttheme_url : this.url\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_mceLink : function(ui, val) {\r\n\t\t\tvar ed = this.editor;\r\n\r\n\t\t\ted.windowManager.open({\r\n\t\t\t\turl : this.url + '/link.htm',\r\n\t\t\t\twidth : 310 + parseInt(ed.getLang('advanced.link_delta_width', 0)),\r\n\t\t\t\theight : 200 + parseInt(ed.getLang('advanced.link_delta_height', 0)),\r\n\t\t\t\tinline : true\r\n\t\t\t}, {\r\n\t\t\t\ttheme_url : this.url\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_mceNewDocument : function() {\r\n\t\t\tvar ed = this.editor;\r\n\r\n\t\t\ted.windowManager.confirm('advanced.newdocument', function(s) {\r\n\t\t\t\tif (s)\r\n\t\t\t\t\ted.execCommand('mceSetContent', false, '');\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_mceForeColor : function() {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tthis._mceColorPicker(0, {\r\n\t\t\t\tcolor: t.fgColor,\r\n\t\t\t\tfunc : function(co) {\r\n\t\t\t\t\tt.fgColor = co;\r\n\t\t\t\t\tt.editor.execCommand('ForeColor', false, co);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_mceBackColor : function() {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tthis._mceColorPicker(0, {\r\n\t\t\t\tcolor: t.bgColor,\r\n\t\t\t\tfunc : function(co) {\r\n\t\t\t\t\tt.bgColor = co;\r\n\t\t\t\t\tt.editor.execCommand('HiliteColor', false, co);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_ufirst : function(s) {\r\n\t\t\treturn s.substring(0, 1).toUpperCase() + s.substring(1);\r\n\t\t}\r\n\t});\r\n\r\n\ttinymce.ThemeManager.add('advanced', tinymce.themes.AdvancedTheme);\r\n}(tinymce));tinyMCE.addI18n('ru.advanced',{\r\nstyle_select:\"\\u0421\\u0442\\u0438\\u043B\\u044C\",\r\nfont_size:\"\\u0420\\u0430\\u0437\\u043C\\u0435\\u0440\",\r\nfontdefault:\"\\u0428\\u0440\\u0438\\u0444\\u0442\",\r\nblock:\"\\u0424\\u043E\\u0440\\u043C\\u0430\\u0442\",\r\nparagraph:\"\\u0410\\u0431\\u0437\\u0430\\u0446\",\r\ndiv:\"Div\",\r\naddress:\"\\u0410\\u0434\\u0440\\u0435\\u0441\",\r\npre:\"\\u041F\\u0440\\u0435\\u0444\\u043E\\u0440\\u043C\\u0430\\u0442\\u0438\\u0440\\u043E\\u0432\\u0430\\u043D\\u043D\\u044B\\u0439\",\r\nh1:\"\\u0417\\u0430\\u0433\\u043E\\u043B\\u043E\\u0432\\u043E\\u043A 1\",\r\nh2:\"\\u0417\\u0430\\u0433\\u043E\\u043B\\u043E\\u0432\\u043E\\u043A 2\",\r\nh3:\"\\u0417\\u0430\\u0433\\u043E\\u043B\\u043E\\u0432\\u043E\\u043A 3\",\r\nh4:\"\\u0417\\u0430\\u0433\\u043E\\u043B\\u043E\\u0432\\u043E\\u043A 4\",\r\nh5:\"\\u0417\\u0430\\u0433\\u043E\\u043B\\u043E\\u0432\\u043E\\u043A 5\",\r\nh6:\"\\u0417\\u0430\\u0433\\u043E\\u043B\\u043E\\u0432\\u043E\\u043A 6\",\r\nblockquote:\"\\u0426\\u0438\\u0442\\u0430\\u0442\\u0430\",\r\ncode:\"\\u041A\\u043E\\u0434\",\r\nsamp:\"\\u041F\\u0440\\u0438\\u043C\\u0435\\u0440 \\u043A\\u043E\\u0434\\u0430\",\r\ndt:\"\\u0422\\u0435\\u0440\\u043C\\u0438\\u043D \\u0441\\u043F\\u0440\\u0430\\u0432\\u043E\\u0447\\u043D\\u0438\\u043A\\u0430\",\r\ndd:\"\\u041E\\u043F\\u0438\\u0441\\u0430\\u043D\\u0438\\u0435 \\u0441\\u043F\\u0440\\u0430\\u0432\\u043E\\u0447\\u043D\\u0438\\u043A\\u0430\",\r\nbold_desc:\"\\u041F\\u043E\\u043B\\u0443\\u0436\\u0438\\u0440\\u043D\\u044B\\u0439 (Ctrl+B)\",\r\nitalic_desc:\"\\u041A\\u0443\\u0440\\u0441\\u0438\\u0432 (Ctrl+I)\",\r\nunderline_desc:\"\\u041F\\u043E\\u0434\\u0447\\u0435\\u0440\\u043A\\u043D\\u0443\\u0442\\u044B\\u0439 (Ctrl+U)\",\r\nstriketrough_desc:\"\\u0417\\u0430\\u0447\\u0435\\u0440\\u043A\\u043D\\u0443\\u0442\\u044B\\u0439\",\r\njustifyleft_desc:\"\\u041F\\u043E \\u043B\\u0435\\u0432\\u043E\\u043C\\u0443 \\u043A\\u0440\\u0430\\u044E\",\r\njustifycenter_desc:\"\\u041F\\u043E \\u0446\\u0435\\u043D\\u0442\\u0440\\u0443\",\r\njustifyright_desc:\"\\u041F\\u043E \\u043F\\u0440\\u0430\\u0432\\u043E\\u043C\\u0443 \\u043A\\u0440\\u0430\\u044E\",\r\njustifyfull_desc:\"\\u041F\\u043E \\u0448\\u0438\\u0440\\u0438\\u043D\\u0435\",\r\nbullist_desc:\"\\u041C\\u0430\\u0440\\u043A\\u0438\\u0440\\u043E\\u0432\\u0430\\u043D\\u043D\\u044B\\u0439 \\u0441\\u043F\\u0438\\u0441\\u043E\\u043A\",\r\nnumlist_desc:\"\\u041D\\u0443\\u043C\\u0435\\u0440\\u043E\\u0432\\u0430\\u043D\\u043D\\u044B\\u0439 \\u0441\\u043F\\u0438\\u0441\\u043E\\u043A\",\r\noutdent_desc:\"\\u0423\\u043C\\u0435\\u043D\\u044C\\u0448\\u0438\\u0442\\u044C \\u043E\\u0442\\u0441\\u0442\\u0443\\u043F\",\r\nindent_desc:\"\\u0423\\u0432\\u0435\\u043B\\u0438\\u0447\\u0438\\u0442\\u044C \\u043E\\u0442\\u0441\\u0442\\u0443\\u043F\",\r\nundo_desc:\"\\u041E\\u0442\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C (Ctrl+Z)\",\r\nredo_desc:\"\\u0412\\u0435\\u0440\\u043D\\u0443\\u0442\\u044C (Ctrl+Y)\",\r\nlink_desc:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C/\\u0418\\u0437\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C \\u0441\\u0441\\u044B\\u043B\\u043A\\u0443\",\r\nunlink_desc:\"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C \\u0441\\u0441\\u044B\\u043B\\u043A\\u0443\",\r\nimage_desc:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C/\\u0418\\u0437\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C \\u0438\\u0437\\u043E\\u0431\\u0440\\u0430\\u0436\\u0435\\u043D\\u0438\\u0435\",\r\ncleanup_desc:\"\\u041E\\u0447\\u0438\\u0441\\u0442\\u0438\\u0442\\u044C \\u043B\\u0438\\u0448\\u043D\\u0438\\u0439 \\u043A\\u043E\\u0434\",\r\ncode_desc:\"\\u0420\\u0435\\u0434\\u0430\\u043A\\u0442\\u0438\\u0440\\u043E\\u0432\\u0430\\u0442\\u044C HTML \\u043A\\u043E\\u0434\",\r\nsub_desc:\"\\u041F\\u043E\\u0434\\u0441\\u0442\\u0440\\u043E\\u0447\\u043D\\u044B\\u0439\",\r\nsup_desc:\"\\u041D\\u0430\\u0434\\u0441\\u0442\\u0440\\u043E\\u0447\\u043D\\u044B\\u0439\",\r\nhr_desc:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0447\\u0435\\u0440\\u0442\\u0443\",\r\nremoveformat_desc:\"\\u041E\\u0447\\u0438\\u0441\\u0442\\u0438\\u0442\\u044C \\u0444\\u043E\\u0440\\u043C\\u0430\\u0442\",\r\ncustom1_desc:\"\\u0421\\u043E\\u0431\\u0441\\u0442\\u0432\\u0435\\u043D\\u043D\\u043E\\u0435 \\u043E\\u043F\\u0438\\u0441\\u0430\\u043D\\u0438\\u0435\",\r\nforecolor_desc:\"\\u0426\\u0432\\u0435\\u0442 \\u0442\\u0435\\u043A\\u0441\\u0442\\u0430\",\r\nbackcolor_desc:\"\\u0426\\u0432\\u0435\\u0442 \\u0432\\u044B\\u0434\\u0435\\u043B\\u0435\\u043D\\u0438\\u044F \\u0442\\u0435\\u043A\\u0441\\u0442\\u0430\",\r\ncharmap_desc:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0441\\u0438\\u043C\\u0432\\u043E\\u043B\",\r\nvisualaid_desc:\"\\u0412\\u0441\\u0435 \\u0437\\u043D\\u0430\\u043A\\u0438\",\r\nanchor_desc:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C/\\u0418\\u0437\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C \\u044F\\u043A\\u043E\\u0440\\u044C\",\r\ncut_desc:\"\\u0412\\u044B\\u0440\\u0435\\u0437\\u0430\\u0442\\u044C\",\r\ncopy_desc:\"\\u041A\\u043E\\u043F\\u0438\\u0440\\u043E\\u0432\\u0430\\u0442\\u044C\",\r\npaste_desc:\"\\u0412\\u0441\\u0442\\u0430\\u0432\\u0438\\u0442\\u044C\",\r\nimage_props_desc:\"\\u041F\\u0430\\u0440\\u0430\\u043C\\u0435\\u0442\\u0440\\u044B \\u0438\\u0437\\u043E\\u0431\\u0440\\u0430\\u0436\\u0435\\u043D\\u0438\\u044F\",\r\nnewdocument_desc:\"\\u041D\\u043E\\u0432\\u044B\\u0439 \\u0434\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\",\r\nhelp_desc:\"\\u041F\\u043E\\u043C\\u043E\\u0449\\u044C\",\r\nblockquote_desc:\"\\u0426\\u0438\\u0442\\u0430\\u0442\\u0430\",\r\nclipboard_msg:\"\\u041A\\u043E\\u043F\\u0438\\u0440\\u043E\\u0432\\u0430\\u043D\\u0438\\u0435, \\u0432\\u044B\\u0440\\u0435\\u0437\\u043A\\u0430 \\u0438 \\u0432\\u0441\\u0442\\u0430\\u0432\\u043A\\u0430 \\u043D\\u0435 \\u0440\\u0430\\u0431\\u043E\\u0442\\u0430\\u044E\\u0442 \\u0432 Firefox.\\r\\n\\u0425\\u043E\\u0442\\u0438\\u0442\\u0435 \\u043F\\u043E\\u043B\\u0443\\u0447\\u0438\\u0442\\u044C \\u0431\\u043E\\u043B\\u0435\\u0435 \\u043F\\u043E\\u0434\\u0440\\u043E\\u0431\\u043D\\u0443\\u044E \\u0438\\u043D\\u0444\\u043E\\u0440\\u043C\\u0430\\u0446\\u0438\\u044E?\",\r\npath:\"\\u0422\\u0435\\u0433\\u0438\",\r\nnewdocument:\"\\u0412\\u044B \\u0443\\u0432\\u0435\\u0440\\u0435\\u043D\\u044B, \\u0447\\u0442\\u043E \\u0445\\u043E\\u0442\\u0438\\u0442\\u0435 \\u0432\\u0441\\u0435 \\u0443\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C?\",\r\ntoolbar_focus:\"\\u041F\\u0435\\u0440\\u0435\\u0439\\u0442\\u0438 \\u043D\\u0430 \\u043F\\u0430\\u043D\\u0435\\u043B\\u044C \\u043A\\u043D\\u043E\\u043F\\u043E\\u043A (Alt+Q). \\u041F\\u0435\\u0440\\u0435\\u0439\\u0442\\u0438 \\u043A \\u0440\\u0435\\u0434\\u0430\\u043A\\u0442\\u043E\\u0440\\u0443 (Alt+Z). \\u041F\\u0435\\u0440\\u0435\\u0439\\u0442\\u0438 \\u043A \\u044D\\u043B\\u0435\\u043C\\u0435\\u043D\\u0442\\u0443 \\u043F\\u0443\\u0442\\u0438 (Alt+X).\",\r\nmore_colors:\"\\u0414\\u0440\\u0443\\u0433\\u0438\\u0435 \\u0446\\u0432\\u0435\\u0442\\u0430...\"\r\n});/**\r\n * $Id: editor_plugin_src.js 264 2007-04-26 20:53:09Z spocke $\r\n *\r\n * @author Moxiecode\r\n * @copyright Copyright © 2004-2008, Moxiecode Systems AB, All rights reserved.\r\n */\r\n\r\n(function() {\r\n\tvar Event = tinymce.dom.Event, grep = tinymce.grep, each = tinymce.each, inArray = tinymce.inArray;\r\n\r\n\tfunction isEmpty(d, e, f) {\r\n\t\tvar w, n;\r\n\r\n\t\tw = d.createTreeWalker(e, NodeFilter.SHOW_ALL, null, false);\r\n\t\twhile (n = w.nextNode()) {\r\n\t\t\t// Filter func\r\n\t\t\tif (f) {\r\n\t\t\t\tif (!f(n))\r\n\t\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\t// Non whitespace text node\r\n\t\t\tif (n.nodeType == 3 && n.nodeValue && /[^\\s\\u00a0]+/.test(n.nodeValue))\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t// Is non text element byt still content\r\n\t\t\tif (n.nodeType == 1 && /^(HR|IMG|TABLE)$/.test(n.nodeName))\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t};\r\n\r\n\ttinymce.create('tinymce.plugins.Safari', {\r\n\t\tinit : function(ed) {\r\n\t\t\tvar t = this, dom;\r\n\r\n\t\t\t// Ignore on non webkit\r\n\t\t\tif (!tinymce.isWebKit)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tt.editor = ed;\r\n\t\t\tt.webKitFontSizes = ['x-small', 'small', 'medium', 'large', 'x-large', 'xx-large', '-webkit-xxx-large'];\r\n\t\t\tt.namedFontSizes = ['xx-small', 'x-small','small','medium','large','x-large', 'xx-large'];\r\n\r\n\t\t\t// Safari CreateLink command will not work correctly on images that is aligned\r\n\t\t\ted.addCommand('CreateLink', function(u, v) {\r\n\t\t\t\tvar n = ed.selection.getNode(), dom = ed.dom, a;\r\n\r\n\t\t\t\tif (n && (/^(left|right)$/i.test(dom.getStyle(n, 'float', 1)) || /^(left|right)$/i.test(dom.getAttrib(n, 'align')))) {\r\n\t\t\t\t\ta = dom.create('a', {href : v}, n.cloneNode());\r\n\t\t\t\t\tn.parentNode.replaceChild(a, n);\r\n\t\t\t\t\ted.selection.select(a);\r\n\t\t\t\t} else\r\n\t\t\t\t\ted.getDoc().execCommand(\"CreateLink\", false, v);\r\n\t\t\t});\r\n\r\n/*\r\n\t\t\t// WebKit generates spans out of thin air this patch used to remove them but it will also remove styles we want so it's disabled for now\r\n\t\t\ted.onPaste.add(function(ed, e) {\r\n\t\t\t\tfunction removeStyles(e) {\r\n\t\t\t\t\te = e.target;\r\n\r\n\t\t\t\t\tif (e.nodeType == 1) {\r\n\t\t\t\t\t\te.style.cssText = '';\r\n\r\n\t\t\t\t\t\teach(ed.dom.select('*', e), function(e) {\r\n\t\t\t\t\t\t\te.style.cssText = '';\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\tEvent.add(ed.getDoc(), 'DOMNodeInserted', removeStyles);\r\n\r\n\t\t\t\twindow.setTimeout(function() {\r\n\t\t\t\t\tEvent.remove(ed.getDoc(), 'DOMNodeInserted', removeStyles);\r\n\t\t\t\t}, 0);\r\n\t\t\t});\r\n*/\r\n\t\t\ted.onKeyUp.add(function(ed, e) {\r\n\t\t\t\tvar h, b, r, n, s;\r\n\r\n\t\t\t\t// If backspace or delete key\r\n\t\t\t\tif (e.keyCode == 46 || e.keyCode == 8) {\r\n\t\t\t\t\tb = ed.getBody();\r\n\t\t\t\t\th = b.innerHTML;\r\n\t\t\t\t\ts = ed.selection;\r\n\r\n\t\t\t\t\t// If there is no text content or images or hr elements then remove everything\r\n\t\t\t\t\tif (b.childNodes.length == 1 && !/<(img|hr)/.test(h) && tinymce.trim(h.replace(/<[^>]+>/g, '')).length == 0) {\r\n\t\t\t\t\t\t// Inject paragrah and bogus br\r\n\t\t\t\t\t\ted.setContent('<p><br mce_bogus=\"1\" /></p>', {format : 'raw'});\r\n\r\n\t\t\t\t\t\t// Move caret before bogus br\r\n\t\t\t\t\t\tn = b.firstChild;\r\n\t\t\t\t\t\tr = s.getRng();\r\n\t\t\t\t\t\tr.setStart(n, 0);\r\n\t\t\t\t\t\tr.setEnd(n, 0);\r\n\t\t\t\t\t\ts.setRng(r);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Workaround for FormatBlock bug, http://bugs.webkit.org/show_bug.cgi?id=16004\r\n\t\t\ted.addCommand('FormatBlock', function(u, v) {\r\n\t\t\t\tvar dom = ed.dom, e = dom.getParent(ed.selection.getNode(), dom.isBlock);\r\n\r\n\t\t\t\tif (e)\r\n\t\t\t\t\tdom.replace(dom.create(v), e, 1);\r\n\t\t\t\telse\r\n\t\t\t\t\ted.getDoc().execCommand(\"FormatBlock\", false, v);\r\n\t\t\t});\r\n\r\n\t\t\t// Workaround for InsertHTML bug, http://bugs.webkit.org/show_bug.cgi?id=16382\r\n\t\t\ted.addCommand('mceInsertContent', function(u, v) {\r\n\t\t\t\ted.getDoc().execCommand(\"InsertText\", false, 'mce_marker');\r\n\t\t\t\ted.getBody().innerHTML = ed.getBody().innerHTML.replace(/mce_marker/g, ed.dom.processHTML(v) + '<span id=\"_mce_tmp\">XX</span>');\r\n\t\t\t\ted.selection.select(ed.dom.get('_mce_tmp'));\r\n\t\t\t\ted.getDoc().execCommand(\"Delete\", false, ' ');\r\n\t\t\t});\r\n\t\r\n\t/*\t\ted.onKeyDown.add(function(ed, e) {\r\n\t\t\t\t// Ctrl+A select all will fail on WebKit since if you paste the contents you selected it will produce a odd div wrapper\r\n\t\t\t\tif ((e.ctrlKey || e.metaKey) && e.keyCode == 65) {\r\n\t\t\t\t\ted.selection.select(ed.getBody(), 1);\r\n\t\t\t\t\treturn Event.cancel(e);\r\n\t\t\t\t}\r\n\t\t\t});*/\r\n\r\n\t\t\ted.onKeyPress.add(function(ed, e) {\r\n\t\t\t\tvar se, li, lic, r1, r2, n, sel, doc, be, af, pa;\r\n\r\n\t\t\t\tif (e.keyCode == 13) {\r\n\t\t\t\t\tsel = ed.selection;\r\n\t\t\t\t\tse = sel.getNode();\r\n\r\n\t\t\t\t\t// Workaround for missing shift+enter support, http://bugs.webkit.org/show_bug.cgi?id=16973\r\n\t\t\t\t\tif (e.shiftKey || ed.settings.force_br_newlines && se.nodeName != 'LI') {\r\n\t\t\t\t\t\tt._insertBR(ed);\r\n\t\t\t\t\t\tEvent.cancel(e);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Workaround for DIV elements produced by Safari\r\n\t\t\t\t\tif (li = dom.getParent(se, 'LI')) {\r\n\t\t\t\t\t\tlic = dom.getParent(li, 'OL,UL');\r\n\t\t\t\t\t\tdoc = ed.getDoc();\r\n\r\n\t\t\t\t\t\tpa = dom.create('p');\r\n\t\t\t\t\t\tdom.add(pa, 'br', {mce_bogus : \"1\"});\r\n\r\n\t\t\t\t\t\tif (isEmpty(doc, li)) {\r\n\t\t\t\t\t\t\t// If list in list then use browser default behavior\r\n\t\t\t\t\t\t\tif (n = dom.getParent(lic.parentNode, 'LI,OL,UL'))\r\n\t\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\t\tn = dom.getParent(lic, 'p,h1,h2,h3,h4,h5,h6,div') || lic;\r\n\r\n\t\t\t\t\t\t\t// Create range from the start of block element to the list item\r\n\t\t\t\t\t\t\tr1 = doc.createRange();\r\n\t\t\t\t\t\t\tr1.setStartBefore(n);\r\n\t\t\t\t\t\t\tr1.setEndBefore(li);\r\n\r\n\t\t\t\t\t\t\t// Create range after the list to the end of block element\r\n\t\t\t\t\t\t\tr2 = doc.createRange();\r\n\t\t\t\t\t\t\tr2.setStartAfter(li);\r\n\t\t\t\t\t\t\tr2.setEndAfter(n);\r\n\r\n\t\t\t\t\t\t\tbe = r1.cloneContents();\r\n\t\t\t\t\t\t\taf = r2.cloneContents();\r\n\r\n\t\t\t\t\t\t\tif (!isEmpty(doc, af))\r\n\t\t\t\t\t\t\t\tdom.insertAfter(af, n);\r\n\r\n\t\t\t\t\t\t\tdom.insertAfter(pa, n);\r\n\r\n\t\t\t\t\t\t\tif (!isEmpty(doc, be))\r\n\t\t\t\t\t\t\t\tdom.insertAfter(be, n);\r\n\r\n\t\t\t\t\t\t\tdom.remove(n);\r\n\r\n\t\t\t\t\t\t\tn = pa.firstChild;\r\n\t\t\t\t\t\t\tr1 = doc.createRange();\r\n\t\t\t\t\t\t\tr1.setStartBefore(n);\r\n\t\t\t\t\t\t\tr1.setEndBefore(n);\r\n\t\t\t\t\t\t\tsel.setRng(r1);\r\n\r\n\t\t\t\t\t\t\treturn Event.cancel(e);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Safari doesn't place lists outside block elements\r\n\t\t\ted.onExecCommand.add(function(ed, cmd) {\r\n\t\t\t\tvar sel, dom, bl, bm;\r\n\r\n\t\t\t\tif (cmd == 'InsertUnorderedList' || cmd == 'InsertOrderedList') {\r\n\t\t\t\t\tsel = ed.selection;\r\n\t\t\t\t\tdom = ed.dom;\r\n\r\n\t\t\t\t\tif (bl = dom.getParent(sel.getNode(), function(n) {return /^(H[1-6]|P|ADDRESS|PRE)$/.test(n.nodeName);})) {\r\n\t\t\t\t\t\tbm = sel.getBookmark();\r\n\t\t\t\t\t\tdom.remove(bl, 1);\r\n\t\t\t\t\t\tsel.moveToBookmark(bm);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Workaround for bug, http://bugs.webkit.org/show_bug.cgi?id=12250\r\n\t\t\ted.onClick.add(function(ed, e) {\r\n\t\t\t\te = e.target;\r\n\r\n\t\t\t\tif (e.nodeName == 'IMG') {\r\n\t\t\t\t\tt.selElm = e;\r\n\t\t\t\t\ted.selection.select(e);\r\n\t\t\t\t} else\r\n\t\t\t\t\tt.selElm = null;\r\n\t\t\t});\r\n\r\n\t\t\ted.onInit.add(function() {\r\n\t\t\t\tt._fixWebKitSpans();\r\n\t\t\t});\r\n\r\n\t\t\ted.onSetContent.add(function() {\r\n\t\t\t\tdom = ed.dom;\r\n\r\n\t\t\t\t// Convert strong,b,em,u,strike to spans\r\n\t\t\t\teach(['strong','b','em','u','strike','sub','sup','a'], function(v) {\r\n\t\t\t\t\teach(grep(dom.select(v)).reverse(), function(n) {\r\n\t\t\t\t\t\tvar nn = n.nodeName.toLowerCase(), st;\r\n\r\n\t\t\t\t\t\t// Convert anchors into images\r\n\t\t\t\t\t\tif (nn == 'a') {\r\n\t\t\t\t\t\t\tif (n.name)\r\n\t\t\t\t\t\t\t\tdom.replace(dom.create('img', {mce_name : 'a', name : n.name, 'class' : 'mceItemAnchor'}), n);\r\n\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tswitch (nn) {\r\n\t\t\t\t\t\t\tcase 'b':\r\n\t\t\t\t\t\t\tcase 'strong':\r\n\t\t\t\t\t\t\t\tif (nn == 'b')\r\n\t\t\t\t\t\t\t\t\tnn = 'strong';\r\n\r\n\t\t\t\t\t\t\t\tst = 'font-weight: bold;';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase 'em':\r\n\t\t\t\t\t\t\t\tst = 'font-style: italic;';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase 'u':\r\n\t\t\t\t\t\t\t\tst = 'text-decoration: underline;';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase 'sub':\r\n\t\t\t\t\t\t\t\tst = 'vertical-align: sub;';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase 'sup':\r\n\t\t\t\t\t\t\t\tst = 'vertical-align: super;';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase 'strike':\r\n\t\t\t\t\t\t\t\tst = 'text-decoration: line-through;';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tdom.replace(dom.create('span', {mce_name : nn, style : st, 'class' : 'Apple-style-span'}), n, 1);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\ted.onPreProcess.add(function(ed, o) {\r\n\t\t\t\tdom = ed.dom;\r\n\r\n\t\t\t\teach(grep(o.node.getElementsByTagName('span')).reverse(), function(n) {\r\n\t\t\t\t\tvar v, bg;\r\n\r\n\t\t\t\t\tif (o.get) {\r\n\t\t\t\t\t\tif (dom.hasClass(n, 'Apple-style-span')) {\r\n\t\t\t\t\t\t\tbg = n.style.backgroundColor;\r\n\r\n\t\t\t\t\t\t\tswitch (dom.getAttrib(n, 'mce_name')) {\r\n\t\t\t\t\t\t\t\tcase 'font':\r\n\t\t\t\t\t\t\t\t\tif (!ed.settings.convert_fonts_to_spans)\r\n\t\t\t\t\t\t\t\t\t\tdom.setAttrib(n, 'style', '');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\tcase 'strong':\r\n\t\t\t\t\t\t\t\tcase 'em':\r\n\t\t\t\t\t\t\t\tcase 'sub':\r\n\t\t\t\t\t\t\t\tcase 'sup':\r\n\t\t\t\t\t\t\t\t\tdom.setAttrib(n, 'style', '');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\tcase 'strike':\r\n\t\t\t\t\t\t\t\tcase 'u':\r\n\t\t\t\t\t\t\t\t\tif (!ed.settings.inline_styles)\r\n\t\t\t\t\t\t\t\t\t\tdom.setAttrib(n, 'style', '');\r\n\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\tdom.setAttrib(n, 'mce_name', '');\r\n\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\tif (!ed.settings.inline_styles)\r\n\t\t\t\t\t\t\t\t\t\tdom.setAttrib(n, 'style', '');\r\n\t\t\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\t\t\tif (bg)\r\n\t\t\t\t\t\t\t\tn.style.backgroundColor = bg;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (dom.hasClass(n, 'mceItemRemoved'))\r\n\t\t\t\t\t\tdom.remove(n, 1);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\ted.onPostProcess.add(function(ed, o) {\r\n\t\t\t\t// Safari adds BR at end of all block elements\r\n\t\t\t\to.content = o.content.replace(/<br \\/><\\/(h[1-6]|div|p|address|pre)>/g, '</$1>');\r\n\r\n\t\t\t\t// Safari adds id=\"undefined\" to HR elements\r\n\t\t\t\to.content = o.content.replace(/ id=\\\"undefined\\\"/g, '');\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tgetInfo : function() {\r\n\t\t\treturn {\r\n\t\t\t\tlongname : 'Safari compatibility',\r\n\t\t\t\tauthor : 'Moxiecode Systems AB',\r\n\t\t\t\tauthorurl : 'http://tinymce.moxiecode.com',\r\n\t\t\t\tinfourl : 'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/safari',\r\n\t\t\t\tversion : tinymce.majorVersion + \".\" + tinymce.minorVersion\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\t// Internal methods\r\n\r\n\t\t_fixWebKitSpans : function() {\r\n\t\t\tvar t = this, ed = t.editor;\r\n\r\n\t\t\t// Use mutator events on new WebKit\r\n\t\t\tEvent.add(ed.getDoc(), 'DOMNodeInserted', function(e) {\r\n\t\t\t\te = e.target;\r\n\r\n\t\t\t\tif (e && e.nodeType == 1)\r\n\t\t\t\t\tt._fixAppleSpan(e);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_fixAppleSpan : function(e) {\r\n\t\t\tvar ed = this.editor, dom = ed.dom, fz = this.webKitFontSizes, fzn = this.namedFontSizes, s = ed.settings, st, p;\r\n\r\n\t\t\tif (dom.getAttrib(e, 'mce_fixed'))\r\n\t\t\t\treturn;\r\n\r\n\t\t\t// Handle Apple style spans\r\n\t\t\tif (e.nodeName == 'SPAN' && e.className == 'Apple-style-span') {\r\n\t\t\t\tst = e.style;\r\n\r\n\t\t\t\tif (!s.convert_fonts_to_spans) {\r\n\t\t\t\t\tif (st.fontSize) {\r\n\t\t\t\t\t\tdom.setAttrib(e, 'mce_name', 'font');\r\n\t\t\t\t\t\tdom.setAttrib(e, 'size', inArray(fz, st.fontSize) + 1);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (st.fontFamily) {\r\n\t\t\t\t\t\tdom.setAttrib(e, 'mce_name', 'font');\r\n\t\t\t\t\t\tdom.setAttrib(e, 'face', st.fontFamily);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (st.color) {\r\n\t\t\t\t\t\tdom.setAttrib(e, 'mce_name', 'font');\r\n\t\t\t\t\t\tdom.setAttrib(e, 'color', dom.toHex(st.color));\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (st.backgroundColor) {\r\n\t\t\t\t\t\tdom.setAttrib(e, 'mce_name', 'font');\r\n\t\t\t\t\t\tdom.setStyle(e, 'background-color', st.backgroundColor);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (st.fontSize)\r\n\t\t\t\t\t\tdom.setStyle(e, 'fontSize', fzn[inArray(fz, st.fontSize)]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (st.fontWeight == 'bold')\r\n\t\t\t\t\tdom.setAttrib(e, 'mce_name', 'strong');\r\n\r\n\t\t\t\tif (st.fontStyle == 'italic')\r\n\t\t\t\t\tdom.setAttrib(e, 'mce_name', 'em');\r\n\r\n\t\t\t\tif (st.textDecoration == 'underline')\r\n\t\t\t\t\tdom.setAttrib(e, 'mce_name', 'u');\r\n\r\n\t\t\t\tif (st.textDecoration == 'line-through')\r\n\t\t\t\t\tdom.setAttrib(e, 'mce_name', 'strike');\r\n\r\n\t\t\t\tif (st.verticalAlign == 'super')\r\n\t\t\t\t\tdom.setAttrib(e, 'mce_name', 'sup');\r\n\r\n\t\t\t\tif (st.verticalAlign == 'sub')\r\n\t\t\t\t\tdom.setAttrib(e, 'mce_name', 'sub');\r\n\r\n\t\t\t\tdom.setAttrib(e, 'mce_fixed', '1');\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_insertBR : function(ed) {\r\n\t\t\tvar dom = ed.dom, s = ed.selection, r = s.getRng(), br;\r\n\r\n\t\t\t// Insert BR element\r\n\t\t\tr.insertNode(br = dom.create('br'));\r\n\r\n\t\t\t// Place caret after BR\r\n\t\t\tr.setStartAfter(br);\r\n\t\t\tr.setEndAfter(br);\r\n\t\t\ts.setRng(r);\r\n\r\n\t\t\t// Could not place caret after BR then insert an nbsp entity and move the caret\r\n\t\t\tif (s.getSel().focusNode == br.previousSibling) {\r\n\t\t\t\ts.select(dom.insertAfter(dom.doc.createTextNode('\\u00a0'), br));\r\n\t\t\t\ts.collapse(1);\r\n\t\t\t}\r\n\r\n\t\t\t// Scroll to new position, scrollIntoView can't be used due to bug: http://bugs.webkit.org/show_bug.cgi?id=16117\r\n\t\t\ted.getWin().scrollTo(0, dom.getPos(s.getRng().startContainer).y);\r\n\t\t}\r\n\t});\r\n\r\n\t// Register plugin\r\n\ttinymce.PluginManager.add('safari', tinymce.plugins.Safari);\r\n})();\r\n\r\n/**\r\n * editor_plugin_src.js\r\n *\r\n * Copyright 2009, Moxiecode Systems AB\r\n * Released under LGPL License.\r\n *\r\n * License: http://tinymce.moxiecode.com/license\r\n * Contributing: http://tinymce.moxiecode.com/contributing\r\n */\r\n\r\n(function() {\r\n\ttinymce.create('tinymce.plugins.PageBreakPlugin', {\r\n\t\tinit : function(ed, url) {\r\n\t\t\tvar pb = '<img src=\"' + url + '/img/trans.gif\" class=\"mcePageBreak mceItemNoResize\" />', cls = 'mcePageBreak', sep = ed.getParam('pagebreak_separator', '<!-- pagebreak -->'), pbRE;\r\n\r\n\t\t\tpbRE = new RegExp(sep.replace(/[\\?\\.\\*\\[\\]\\(\\)\\{\\}\\+\\^\\$\\:]/g, function(a) {return '\\\\' + a;}), 'g');\r\n\r\n\t\t\t// Register commands\r\n\t\t\ted.addCommand('mcePageBreak', function() {\r\n\t\t\t\ted.execCommand('mceInsertContent', 0, pb);\r\n\t\t\t});\r\n\r\n\t\t\t// Register buttons\r\n\t\t\ted.addButton('pagebreak', {title : 'pagebreak.desc', cmd : cls});\r\n\r\n\t\t\ted.onInit.add(function() {\r\n\t\t\t\tif (ed.settings.content_css !== false)\r\n\t\t\t\t\ted.dom.loadCSS(url + \"/css/content.css\");\r\n\r\n\t\t\t\tif (ed.theme.onResolveName) {\r\n\t\t\t\t\ted.theme.onResolveName.add(function(th, o) {\r\n\t\t\t\t\t\tif (o.node.nodeName == 'IMG' && ed.dom.hasClass(o.node, cls))\r\n\t\t\t\t\t\t\to.name = 'pagebreak';\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\ted.onClick.add(function(ed, e) {\r\n\t\t\t\te = e.target;\r\n\r\n\t\t\t\tif (e.nodeName === 'IMG' && ed.dom.hasClass(e, cls))\r\n\t\t\t\t\ted.selection.select(e);\r\n\t\t\t});\r\n\r\n\t\t\ted.onNodeChange.add(function(ed, cm, n) {\r\n\t\t\t\tcm.setActive('pagebreak', n.nodeName === 'IMG' && ed.dom.hasClass(n, cls));\r\n\t\t\t});\r\n\r\n\t\t\ted.onBeforeSetContent.add(function(ed, o) {\r\n\t\t\t\to.content = o.content.replace(pbRE, pb);\r\n\t\t\t});\r\n\r\n\t\t\ted.onPostProcess.add(function(ed, o) {\r\n\t\t\t\tif (o.get)\r\n\t\t\t\t\to.content = o.content.replace(/<img[^>]+>/g, function(im) {\r\n\t\t\t\t\t\tif (im.indexOf('class=\"mcePageBreak') !== -1)\r\n\t\t\t\t\t\t\tim = sep;\r\n\r\n\t\t\t\t\t\treturn im;\r\n\t\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tgetInfo : function() {\r\n\t\t\treturn {\r\n\t\t\t\tlongname : 'PageBreak',\r\n\t\t\t\tauthor : 'Moxiecode Systems AB',\r\n\t\t\t\tauthorurl : 'http://tinymce.moxiecode.com',\r\n\t\t\t\tinfourl : 'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/pagebreak',\r\n\t\t\t\tversion : tinymce.majorVersion + \".\" + tinymce.minorVersion\r\n\t\t\t};\r\n\t\t}\r\n\t});\r\n\r\n\t// Register plugin\r\n\ttinymce.PluginManager.add('pagebreak', tinymce.plugins.PageBreakPlugin);\r\n})();/**\r\n * editor_plugin_src.js\r\n *\r\n * Copyright 2009, Moxiecode Systems AB\r\n * Released under LGPL License.\r\n *\r\n * License: http://tinymce.moxiecode.com/license\r\n * Contributing: http://tinymce.moxiecode.com/contributing\r\n */\r\n\r\n(function() {\r\n\ttinymce.create('tinymce.plugins.StylePlugin', {\r\n\t\tinit : function(ed, url) {\r\n\t\t\t// Register commands\r\n\t\t\ted.addCommand('mceStyleProps', function() {\r\n\t\t\t\ted.windowManager.open({\r\n\t\t\t\t\tfile : url + '/props.htm',\r\n\t\t\t\t\twidth : 480 + parseInt(ed.getLang('style.delta_width', 0)),\r\n\t\t\t\t\theight : 320 + parseInt(ed.getLang('style.delta_height', 0)),\r\n\t\t\t\t\tinline : 1\r\n\t\t\t\t}, {\r\n\t\t\t\t\tplugin_url : url,\r\n\t\t\t\t\tstyle_text : ed.selection.getNode().style.cssText\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\ted.addCommand('mceSetElementStyle', function(ui, v) {\r\n\t\t\t\tif (e = ed.selection.getNode()) {\r\n\t\t\t\t\ted.dom.setAttrib(e, 'style', v);\r\n\t\t\t\t\ted.execCommand('mceRepaint');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\ted.onNodeChange.add(function(ed, cm, n) {\r\n\t\t\t\tcm.setDisabled('styleprops', n.nodeName === 'BODY');\r\n\t\t\t});\r\n\r\n\t\t\t// Register buttons\r\n\t\t\ted.addButton('styleprops', {title : 'style.desc', cmd : 'mceStyleProps'});\r\n\t\t},\r\n\r\n\t\tgetInfo : function() {\r\n\t\t\treturn {\r\n\t\t\t\tlongname : 'Style',\r\n\t\t\t\tauthor : 'Moxiecode Systems AB',\r\n\t\t\t\tauthorurl : 'http://tinymce.moxiecode.com',\r\n\t\t\t\tinfourl : 'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/style',\r\n\t\t\t\tversion : tinymce.majorVersion + \".\" + tinymce.minorVersion\r\n\t\t\t};\r\n\t\t}\r\n\t});\r\n\r\n\t// Register plugin\r\n\ttinymce.PluginManager.add('style', tinymce.plugins.StylePlugin);\r\n})();/**\r\n * editor_plugin_src.js\r\n *\r\n * Copyright 2009, Moxiecode Systems AB\r\n * Released under LGPL License.\r\n *\r\n * License: http://tinymce.moxiecode.com/license\r\n * Contributing: http://tinymce.moxiecode.com/contributing\r\n */\r\n\r\n(function() {\r\n\ttinymce.create('tinymce.plugins.Layer', {\r\n\t\tinit : function(ed, url) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tt.editor = ed;\r\n\r\n\t\t\t// Register commands\r\n\t\t\ted.addCommand('mceInsertLayer', t._insertLayer, t);\r\n\r\n\t\t\ted.addCommand('mceMoveForward', function() {\r\n\t\t\t\tt._move(1);\r\n\t\t\t});\r\n\r\n\t\t\ted.addCommand('mceMoveBackward', function() {\r\n\t\t\t\tt._move(-1);\r\n\t\t\t});\r\n\r\n\t\t\ted.addCommand('mceMakeAbsolute', function() {\r\n\t\t\t\tt._toggleAbsolute();\r\n\t\t\t});\r\n\r\n\t\t\t// Register buttons\r\n\t\t\ted.addButton('moveforward', {title : 'layer.forward_desc', cmd : 'mceMoveForward'});\r\n\t\t\ted.addButton('movebackward', {title : 'layer.backward_desc', cmd : 'mceMoveBackward'});\r\n\t\t\ted.addButton('absolute', {title : 'layer.absolute_desc', cmd : 'mceMakeAbsolute'});\r\n\t\t\ted.addButton('insertlayer', {title : 'layer.insertlayer_desc', cmd : 'mceInsertLayer'});\r\n\r\n\t\t\ted.onInit.add(function() {\r\n\t\t\t\tif (tinymce.isIE)\r\n\t\t\t\t\ted.getDoc().execCommand('2D-Position', false, true);\r\n\t\t\t});\r\n\r\n\t\t\ted.onNodeChange.add(t._nodeChange, t);\r\n\t\t\ted.onVisualAid.add(t._visualAid, t);\r\n\t\t},\r\n\r\n\t\tgetInfo : function() {\r\n\t\t\treturn {\r\n\t\t\t\tlongname : 'Layer',\r\n\t\t\t\tauthor : 'Moxiecode Systems AB',\r\n\t\t\t\tauthorurl : 'http://tinymce.moxiecode.com',\r\n\t\t\t\tinfourl : 'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/layer',\r\n\t\t\t\tversion : tinymce.majorVersion + \".\" + tinymce.minorVersion\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\t// Private methods\r\n\r\n\t\t_nodeChange : function(ed, cm, n) {\r\n\t\t\tvar le, p;\r\n\r\n\t\t\tle = this._getParentLayer(n);\r\n\t\t\tp = ed.dom.getParent(n, 'DIV,P,IMG');\r\n\r\n\t\t\tif (!p) {\r\n\t\t\t\tcm.setDisabled('absolute', 1);\r\n\t\t\t\tcm.setDisabled('moveforward', 1);\r\n\t\t\t\tcm.setDisabled('movebackward', 1);\r\n\t\t\t} else {\r\n\t\t\t\tcm.setDisabled('absolute', 0);\r\n\t\t\t\tcm.setDisabled('moveforward', !le);\r\n\t\t\t\tcm.setDisabled('movebackward', !le);\r\n\t\t\t\tcm.setActive('absolute', le && le.style.position.toLowerCase() == \"absolute\");\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t// Private methods\r\n\r\n\t\t_visualAid : function(ed, e, s) {\r\n\t\t\tvar dom = ed.dom;\r\n\r\n\t\t\ttinymce.each(dom.select('div,p', e), function(e) {\r\n\t\t\t\tif (/^(absolute|relative|static)$/i.test(e.style.position)) {\r\n\t\t\t\t\tif (s)\r\n\t\t\t\t\t\tdom.addClass(e, 'mceItemVisualAid');\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tdom.removeClass(e, 'mceItemVisualAid');\t\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_move : function(d) {\r\n\t\t\tvar ed = this.editor, i, z = [], le = this._getParentLayer(ed.selection.getNode()), ci = -1, fi = -1, nl;\r\n\r\n\t\t\tnl = [];\r\n\t\t\ttinymce.walk(ed.getBody(), function(n) {\r\n\t\t\t\tif (n.nodeType == 1 && /^(absolute|relative|static)$/i.test(n.style.position))\r\n\t\t\t\t\tnl.push(n); \r\n\t\t\t}, 'childNodes');\r\n\r\n\t\t\t// Find z-indexes\r\n\t\t\tfor (i=0; i<nl.length; i++) {\r\n\t\t\t\tz[i] = nl[i].style.zIndex ? parseInt(nl[i].style.zIndex) : 0;\r\n\r\n\t\t\t\tif (ci < 0 && nl[i] == le)\r\n\t\t\t\t\tci = i;\r\n\t\t\t}\r\n\r\n\t\t\tif (d < 0) {\r\n\t\t\t\t// Move back\r\n\r\n\t\t\t\t// Try find a lower one\r\n\t\t\t\tfor (i=0; i<z.length; i++) {\r\n\t\t\t\t\tif (z[i] < z[ci]) {\r\n\t\t\t\t\t\tfi = i;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (fi > -1) {\r\n\t\t\t\t\tnl[ci].style.zIndex = z[fi];\r\n\t\t\t\t\tnl[fi].style.zIndex = z[ci];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (z[ci] > 0)\r\n\t\t\t\t\t\tnl[ci].style.zIndex = z[ci] - 1;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// Move forward\r\n\r\n\t\t\t\t// Try find a higher one\r\n\t\t\t\tfor (i=0; i<z.length; i++) {\r\n\t\t\t\t\tif (z[i] > z[ci]) {\r\n\t\t\t\t\t\tfi = i;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (fi > -1) {\r\n\t\t\t\t\tnl[ci].style.zIndex = z[fi];\r\n\t\t\t\t\tnl[fi].style.zIndex = z[ci];\r\n\t\t\t\t} else\r\n\t\t\t\t\tnl[ci].style.zIndex = z[ci] + 1;\r\n\t\t\t}\r\n\r\n\t\t\ted.execCommand('mceRepaint');\r\n\t\t},\r\n\r\n\t\t_getParentLayer : function(n) {\r\n\t\t\treturn this.editor.dom.getParent(n, function(n) {\r\n\t\t\t\treturn n.nodeType == 1 && /^(absolute|relative|static)$/i.test(n.style.position);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_insertLayer : function() {\r\n\t\t\tvar ed = this.editor, p = ed.dom.getPos(ed.dom.getParent(ed.selection.getNode(), '*'));\r\n\r\n\t\t\ted.dom.add(ed.getBody(), 'div', {\r\n\t\t\t\tstyle : {\r\n\t\t\t\t\tposition : 'absolute',\r\n\t\t\t\t\tleft : p.x,\r\n\t\t\t\t\ttop : (p.y > 20 ? p.y : 20),\r\n\t\t\t\t\twidth : 100,\r\n\t\t\t\t\theight : 100\r\n\t\t\t\t},\r\n\t\t\t\t'class' : 'mceItemVisualAid'\r\n\t\t\t}, ed.selection.getContent() || ed.getLang('layer.content'));\r\n\t\t},\r\n\r\n\t\t_toggleAbsolute : function() {\r\n\t\t\tvar ed = this.editor, le = this._getParentLayer(ed.selection.getNode());\r\n\r\n\t\t\tif (!le)\r\n\t\t\t\tle = ed.dom.getParent(ed.selection.getNode(), 'DIV,P,IMG');\r\n\r\n\t\t\tif (le) {\r\n\t\t\t\tif (le.style.position.toLowerCase() == \"absolute\") {\r\n\t\t\t\t\ted.dom.setStyles(le, {\r\n\t\t\t\t\t\tposition : '',\r\n\t\t\t\t\t\tleft : '',\r\n\t\t\t\t\t\ttop : '',\r\n\t\t\t\t\t\twidth : '',\r\n\t\t\t\t\t\theight : ''\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\ted.dom.removeClass(le, 'mceItemVisualAid');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (le.style.left == \"\")\r\n\t\t\t\t\t\tle.style.left = 20 + 'px';\r\n\r\n\t\t\t\t\tif (le.style.top == \"\")\r\n\t\t\t\t\t\tle.style.top = 20 + 'px';\r\n\r\n\t\t\t\t\tif (le.style.width == \"\")\r\n\t\t\t\t\t\tle.style.width = le.width ? (le.width + 'px') : '100px';\r\n\r\n\t\t\t\t\tif (le.style.height == \"\")\r\n\t\t\t\t\t\tle.style.height = le.height ? (le.height + 'px') : '100px';\r\n\r\n\t\t\t\t\tle.style.position = \"absolute\";\r\n\t\t\t\t\ted.addVisual(ed.getBody());\r\n\t\t\t\t}\r\n\r\n\t\t\t\ted.execCommand('mceRepaint');\r\n\t\t\t\ted.nodeChanged();\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t// Register plugin\r\n\ttinymce.PluginManager.add('layer', tinymce.plugins.Layer);\r\n})();/**\r\n * editor_plugin_src.js\r\n *\r\n * Copyright 2009, Moxiecode Systems AB\r\n * Released under LGPL License.\r\n *\r\n * License: http://tinymce.moxiecode.com/license\r\n * Contributing: http://tinymce.moxiecode.com/contributing\r\n */\r\n\r\n(function(tinymce) {\r\n\tvar each = tinymce.each;\r\n\r\n\t// Checks if the selection/caret is at the start of the specified block element\r\n\tfunction isAtStart(rng, par) {\r\n\t\tvar doc = par.ownerDocument, rng2 = doc.createRange(), elm;\r\n\r\n\t\trng2.setStartBefore(par);\r\n\t\trng2.setEnd(rng.endContainer, rng.endOffset);\r\n\r\n\t\telm = doc.createElement('body');\r\n\t\telm.appendChild(rng2.cloneContents());\r\n\r\n\t\t// Check for text characters of other elements that should be treated as content\r\n\t\treturn elm.innerHTML.replace(/<(br|img|object|embed|input|textarea)[^>]*>/gi, '-').replace(/<[^>]+>/g, '').length == 0;\r\n\t};\r\n\r\n\t/**\r\n\t * Table Grid class.\r\n\t */\r\n\tfunction TableGrid(table, dom, selection) {\r\n\t\tvar grid, startPos, endPos, selectedCell;\r\n\r\n\t\tbuildGrid();\r\n\t\tselectedCell = dom.getParent(selection.getStart(), 'th,td');\r\n\t\tif (selectedCell) {\r\n\t\t\tstartPos = getPos(selectedCell);\r\n\t\t\tendPos = findEndPos();\r\n\t\t\tselectedCell = getCell(startPos.x, startPos.y);\r\n\t\t}\r\n\r\n\t\tfunction cloneNode(node, children) {\r\n\t\t\tnode = node.cloneNode(children);\r\n\t\t\tnode.removeAttribute('id');\r\n\r\n\t\t\treturn node;\r\n\t\t}\r\n\r\n\t\tfunction buildGrid() {\r\n\t\t\tvar startY = 0;\r\n\r\n\t\t\tgrid = [];\r\n\r\n\t\t\teach(['thead', 'tbody', 'tfoot'], function(part) {\r\n\t\t\t\tvar rows = dom.select('> ' + part + ' tr', table);\r\n\r\n\t\t\t\teach(rows, function(tr, y) {\r\n\t\t\t\t\ty += startY;\r\n\r\n\t\t\t\t\teach(dom.select('> td, > th', tr), function(td, x) {\r\n\t\t\t\t\t\tvar x2, y2, rowspan, colspan;\r\n\r\n\t\t\t\t\t\t// Skip over existing cells produced by rowspan\r\n\t\t\t\t\t\tif (grid[y]) {\r\n\t\t\t\t\t\t\twhile (grid[y][x])\r\n\t\t\t\t\t\t\t\tx++;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Get col/rowspan from cell\r\n\t\t\t\t\t\trowspan = getSpanVal(td, 'rowspan');\r\n\t\t\t\t\t\tcolspan = getSpanVal(td, 'colspan');\r\n\r\n\t\t\t\t\t\t// Fill out rowspan/colspan right and down\r\n\t\t\t\t\t\tfor (y2 = y; y2 < y + rowspan; y2++) {\r\n\t\t\t\t\t\t\tif (!grid[y2])\r\n\t\t\t\t\t\t\t\tgrid[y2] = [];\r\n\r\n\t\t\t\t\t\t\tfor (x2 = x; x2 < x + colspan; x2++) {\r\n\t\t\t\t\t\t\t\tgrid[y2][x2] = {\r\n\t\t\t\t\t\t\t\t\tpart : part,\r\n\t\t\t\t\t\t\t\t\treal : y2 == y && x2 == x,\r\n\t\t\t\t\t\t\t\t\telm : td,\r\n\t\t\t\t\t\t\t\t\trowspan : rowspan,\r\n\t\t\t\t\t\t\t\t\tcolspan : colspan\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\t\t\t\tstartY += rows.length;\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tfunction getCell(x, y) {\r\n\t\t\tvar row;\r\n\r\n\t\t\trow = grid[y];\r\n\t\t\tif (row)\r\n\t\t\t\treturn row[x];\r\n\t\t};\r\n\r\n\t\tfunction getSpanVal(td, name) {\r\n\t\t\treturn parseInt(td.getAttribute(name) || 1);\r\n\t\t};\r\n\r\n\t\tfunction isCellSelected(cell) {\r\n\t\t\treturn dom.hasClass(cell.elm, 'mceSelected') || cell == selectedCell;\r\n\t\t};\r\n\r\n\t\tfunction getSelectedRows() {\r\n\t\t\tvar rows = [];\r\n\r\n\t\t\teach(table.rows, function(row) {\r\n\t\t\t\teach(row.cells, function(cell) {\r\n\t\t\t\t\tif (dom.hasClass(cell, 'mceSelected') || cell == selectedCell.elm) {\r\n\t\t\t\t\t\trows.push(row);\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\treturn rows;\r\n\t\t};\r\n\r\n\t\tfunction deleteTable() {\r\n\t\t\tvar rng = dom.createRng();\r\n\r\n\t\t\trng.setStartAfter(table);\r\n\t\t\trng.setEndAfter(table);\r\n\r\n\t\t\tselection.setRng(rng);\r\n\r\n\t\t\tdom.remove(table);\r\n\t\t};\r\n\r\n\t\tfunction cloneCell(cell) {\r\n\t\t\tvar formatNode;\r\n\r\n\t\t\t// Clone formats\r\n\t\t\ttinymce.walk(cell, function(node) {\r\n\t\t\t\tvar curNode;\r\n\r\n\t\t\t\tif (node.nodeType == 3) {\r\n\t\t\t\t\teach(dom.getParents(node.parentNode, null, cell).reverse(), function(node) {\r\n\t\t\t\t\t\tnode = cloneNode(node, false);\r\n\r\n\t\t\t\t\t\tif (!formatNode)\r\n\t\t\t\t\t\t\tformatNode = curNode = node;\r\n\t\t\t\t\t\telse if (curNode)\r\n\t\t\t\t\t\t\tcurNode.appendChild(node);\r\n\r\n\t\t\t\t\t\tcurNode = node;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Add something to the inner node\r\n\t\t\t\t\tif (curNode)\r\n\t\t\t\t\t\tcurNode.innerHTML = tinymce.isIE ? '&nbsp;' : '<br _mce_bogus=\"1\" />';\r\n\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}, 'childNodes');\r\n\r\n\t\t\tcell = cloneNode(cell, false);\r\n\t\t\tcell.rowSpan = cell.colSpan = 1;\r\n\r\n\t\t\tif (formatNode) {\r\n\t\t\t\tcell.appendChild(formatNode);\r\n\t\t\t} else {\r\n\t\t\t\tif (!tinymce.isIE)\r\n\t\t\t\t\tcell.innerHTML = '<br _mce_bogus=\"1\" />';\r\n\t\t\t}\r\n\r\n\t\t\treturn cell;\r\n\t\t};\r\n\r\n\t\tfunction cleanup() {\r\n\t\t\tvar rng = dom.createRng();\r\n\r\n\t\t\t// Empty rows\r\n\t\t\teach(dom.select('tr', table), function(tr) {\r\n\t\t\t\tif (tr.cells.length == 0)\r\n\t\t\t\t\tdom.remove(tr);\r\n\t\t\t});\r\n\r\n\t\t\t// Empty table\r\n\t\t\tif (dom.select('tr', table).length == 0) {\r\n\t\t\t\trng.setStartAfter(table);\r\n\t\t\t\trng.setEndAfter(table);\r\n\t\t\t\tselection.setRng(rng);\r\n\t\t\t\tdom.remove(table);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Empty header/body/footer\r\n\t\t\teach(dom.select('thead,tbody,tfoot', table), function(part) {\r\n\t\t\t\tif (part.rows.length == 0)\r\n\t\t\t\t\tdom.remove(part);\r\n\t\t\t});\r\n\r\n\t\t\t// Restore selection to start position if it still exists\r\n\t\t\tbuildGrid();\r\n\r\n\t\t\t// Restore the selection to the closest table position\r\n\t\t\trow = grid[Math.min(grid.length - 1, startPos.y)];\r\n\t\t\tif (row) {\r\n\t\t\t\tselection.select(row[Math.min(row.length - 1, startPos.x)].elm, true);\r\n\t\t\t\tselection.collapse(true);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction fillLeftDown(x, y, rows, cols) {\r\n\t\t\tvar tr, x2, r, c, cell;\r\n\r\n\t\t\ttr = grid[y][x].elm.parentNode;\r\n\t\t\tfor (r = 1; r <= rows; r++) {\r\n\t\t\t\ttr = dom.getNext(tr, 'tr');\r\n\r\n\t\t\t\tif (tr) {\r\n\t\t\t\t\t// Loop left to find real cell\r\n\t\t\t\t\tfor (x2 = x; x2 >= 0; x2--) {\r\n\t\t\t\t\t\tcell = grid[y + r][x2].elm;\r\n\r\n\t\t\t\t\t\tif (cell.parentNode == tr) {\r\n\t\t\t\t\t\t\t// Append clones after\r\n\t\t\t\t\t\t\tfor (c = 1; c <= cols; c++)\r\n\t\t\t\t\t\t\t\tdom.insertAfter(cloneCell(cell), cell);\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (x2 == -1) {\r\n\t\t\t\t\t\t// Insert nodes before first cell\r\n\t\t\t\t\t\tfor (c = 1; c <= cols; c++)\r\n\t\t\t\t\t\t\ttr.insertBefore(cloneCell(tr.cells[0]), tr.cells[0]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction split() {\r\n\t\t\teach(grid, function(row, y) {\r\n\t\t\t\teach(row, function(cell, x) {\r\n\t\t\t\t\tvar colSpan, rowSpan, newCell, i;\r\n\r\n\t\t\t\t\tif (isCellSelected(cell)) {\r\n\t\t\t\t\t\tcell = cell.elm;\r\n\t\t\t\t\t\tcolSpan = getSpanVal(cell, 'colspan');\r\n\t\t\t\t\t\trowSpan = getSpanVal(cell, 'rowspan');\r\n\r\n\t\t\t\t\t\tif (colSpan > 1 || rowSpan > 1) {\r\n\t\t\t\t\t\t\tcell.colSpan = cell.rowSpan = 1;\r\n\r\n\t\t\t\t\t\t\t// Insert cells right\r\n\t\t\t\t\t\t\tfor (i = 0; i < colSpan - 1; i++)\r\n\t\t\t\t\t\t\t\tdom.insertAfter(cloneCell(cell), cell);\r\n\r\n\t\t\t\t\t\t\tfillLeftDown(x, y, rowSpan - 1, colSpan);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tfunction merge(cell, cols, rows) {\r\n\t\t\tvar startX, startY, endX, endY, x, y, startCell, endCell, cell, children;\r\n\r\n\t\t\t// Use specified cell and cols/rows\r\n\t\t\tif (cell) {\r\n\t\t\t\tpos = getPos(cell);\r\n\t\t\t\tstartX = pos.x;\r\n\t\t\t\tstartY = pos.y;\r\n\t\t\t\tendX = startX + (cols - 1);\r\n\t\t\t\tendY = startY + (rows - 1);\r\n\t\t\t} else {\r\n\t\t\t\t// Use selection\r\n\t\t\t\tstartX = startPos.x;\r\n\t\t\t\tstartY = startPos.y;\r\n\t\t\t\tendX = endPos.x;\r\n\t\t\t\tendY = endPos.y;\r\n\t\t\t}\r\n\r\n\t\t\t// Find start/end cells\r\n\t\t\tstartCell = getCell(startX, startY);\r\n\t\t\tendCell = getCell(endX, endY);\r\n\r\n\t\t\t// Check if the cells exists and if they are of the same part for example tbody = tbody\r\n\t\t\tif (startCell && endCell && startCell.part == endCell.part) {\r\n\t\t\t\t// Split and rebuild grid\r\n\t\t\t\tsplit();\r\n\t\t\t\tbuildGrid();\r\n\r\n\t\t\t\t// Set row/col span to start cell\r\n\t\t\t\tstartCell = getCell(startX, startY).elm;\r\n\t\t\t\tstartCell.colSpan = (endX - startX) + 1;\r\n\t\t\t\tstartCell.rowSpan = (endY - startY) + 1;\r\n\r\n\t\t\t\t// Remove other cells and add it's contents to the start cell\r\n\t\t\t\tfor (y = startY; y <= endY; y++) {\r\n\t\t\t\t\tfor (x = startX; x <= endX; x++) {\r\n\t\t\t\t\t\tcell = grid[y][x].elm;\r\n\r\n\t\t\t\t\t\tif (cell != startCell) {\r\n\t\t\t\t\t\t\t// Move children to startCell\r\n\t\t\t\t\t\t\tchildren = tinymce.grep(cell.childNodes);\r\n\t\t\t\t\t\t\teach(children, function(node, i) {\r\n\t\t\t\t\t\t\t\t// Jump over last BR element\r\n\t\t\t\t\t\t\t\tif (node.nodeName != 'BR' || i != children.length - 1)\r\n\t\t\t\t\t\t\t\t\tstartCell.appendChild(node);\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t// Remove cell\r\n\t\t\t\t\t\t\tdom.remove(cell);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Remove empty rows etc and restore caret location\r\n\t\t\t\tcleanup();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction insertRow(before) {\r\n\t\t\tvar posY, cell, lastCell, x, rowElm, newRow, newCell, otherCell;\r\n\r\n\t\t\t// Find first/last row\r\n\t\t\teach(grid, function(row, y) {\r\n\t\t\t\teach(row, function(cell, x) {\r\n\t\t\t\t\tif (isCellSelected(cell)) {\r\n\t\t\t\t\t\tcell = cell.elm;\r\n\t\t\t\t\t\trowElm = cell.parentNode;\r\n\t\t\t\t\t\tnewRow = cloneNode(rowElm, false);\r\n\t\t\t\t\t\tposY = y;\r\n\r\n\t\t\t\t\t\tif (before)\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (before)\r\n\t\t\t\t\treturn !posY;\r\n\t\t\t});\r\n\r\n\t\t\tfor (x = 0; x < grid[0].length; x++) {\r\n\t\t\t\tcell = grid[posY][x].elm;\r\n\r\n\t\t\t\tif (cell != lastCell) {\r\n\t\t\t\t\tif (!before) {\r\n\t\t\t\t\t\trowSpan = getSpanVal(cell, 'rowspan');\r\n\t\t\t\t\t\tif (rowSpan > 1) {\r\n\t\t\t\t\t\t\tcell.rowSpan = rowSpan + 1;\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Check if cell above can be expanded\r\n\t\t\t\t\t\tif (posY > 0 && grid[posY - 1][x]) {\r\n\t\t\t\t\t\t\totherCell = grid[posY - 1][x].elm;\r\n\t\t\t\t\t\t\trowSpan = getSpanVal(otherCell, 'rowspan');\r\n\t\t\t\t\t\t\tif (rowSpan > 1) {\r\n\t\t\t\t\t\t\t\totherCell.rowSpan = rowSpan + 1;\r\n\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Insert new cell into new row\r\n\t\t\t\t\tnewCell = cloneCell(cell)\r\n\t\t\t\t\tnewCell.colSpan = cell.colSpan;\r\n\t\t\t\t\tnewRow.appendChild(newCell);\r\n\r\n\t\t\t\t\tlastCell = cell;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (newRow.hasChildNodes()) {\r\n\t\t\t\tif (!before)\r\n\t\t\t\t\tdom.insertAfter(newRow, rowElm);\r\n\t\t\t\telse\r\n\t\t\t\t\trowElm.parentNode.insertBefore(newRow, rowElm);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction insertCol(before) {\r\n\t\t\tvar posX, lastCell;\r\n\r\n\t\t\t// Find first/last column\r\n\t\t\teach(grid, function(row, y) {\r\n\t\t\t\teach(row, function(cell, x) {\r\n\t\t\t\t\tif (isCellSelected(cell)) {\r\n\t\t\t\t\t\tposX = x;\r\n\r\n\t\t\t\t\t\tif (before)\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (before)\r\n\t\t\t\t\treturn !posX;\r\n\t\t\t});\r\n\r\n\t\t\teach(grid, function(row, y) {\r\n\t\t\t\tvar cell = row[posX].elm, rowSpan, colSpan;\r\n\r\n\t\t\t\tif (cell != lastCell) {\r\n\t\t\t\t\tcolSpan = getSpanVal(cell, 'colspan');\r\n\t\t\t\t\trowSpan = getSpanVal(cell, 'rowspan');\r\n\r\n\t\t\t\t\tif (colSpan == 1) {\r\n\t\t\t\t\t\tif (!before) {\r\n\t\t\t\t\t\t\tdom.insertAfter(cloneCell(cell), cell);\r\n\t\t\t\t\t\t\tfillLeftDown(posX, y, rowSpan - 1, colSpan);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcell.parentNode.insertBefore(cloneCell(cell), cell);\r\n\t\t\t\t\t\t\tfillLeftDown(posX, y, rowSpan - 1, colSpan);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\tcell.colSpan++;\r\n\r\n\t\t\t\t\tlastCell = cell;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tfunction deleteCols() {\r\n\t\t\tvar cols = [];\r\n\r\n\t\t\t// Get selected column indexes\r\n\t\t\teach(grid, function(row, y) {\r\n\t\t\t\teach(row, function(cell, x) {\r\n\t\t\t\t\tif (isCellSelected(cell) && tinymce.inArray(cols, x) === -1) {\r\n\t\t\t\t\t\teach(grid, function(row) {\r\n\t\t\t\t\t\t\tvar cell = row[x].elm, colSpan;\r\n\r\n\t\t\t\t\t\t\tcolSpan = getSpanVal(cell, 'colspan');\r\n\r\n\t\t\t\t\t\t\tif (colSpan > 1)\r\n\t\t\t\t\t\t\t\tcell.colSpan = colSpan - 1;\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tdom.remove(cell);\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tcols.push(x);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\tcleanup();\r\n\t\t};\r\n\r\n\t\tfunction deleteRows() {\r\n\t\t\tvar rows;\r\n\r\n\t\t\tfunction deleteRow(tr) {\r\n\t\t\t\tvar nextTr, pos, lastCell;\r\n\r\n\t\t\t\tnextTr = dom.getNext(tr, 'tr');\r\n\r\n\t\t\t\t// Move down row spanned cells\r\n\t\t\t\teach(tr.cells, function(cell) {\r\n\t\t\t\t\tvar rowSpan = getSpanVal(cell, 'rowspan');\r\n\r\n\t\t\t\t\tif (rowSpan > 1) {\r\n\t\t\t\t\t\tcell.rowSpan = rowSpan - 1;\r\n\t\t\t\t\t\tpos = getPos(cell);\r\n\t\t\t\t\t\tfillLeftDown(pos.x, pos.y, 1, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Delete cells\r\n\t\t\t\tpos = getPos(tr.cells[0]);\r\n\t\t\t\teach(grid[pos.y], function(cell) {\r\n\t\t\t\t\tvar rowSpan;\r\n\r\n\t\t\t\t\tcell = cell.elm;\r\n\r\n\t\t\t\t\tif (cell != lastCell) {\r\n\t\t\t\t\t\trowSpan = getSpanVal(cell, 'rowspan');\r\n\r\n\t\t\t\t\t\tif (rowSpan <= 1)\r\n\t\t\t\t\t\t\tdom.remove(cell);\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tcell.rowSpan = rowSpan - 1;\r\n\r\n\t\t\t\t\t\tlastCell = cell;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\t// Get selected rows and move selection out of scope\r\n\t\t\trows = getSelectedRows();\r\n\r\n\t\t\t// Delete all selected rows\r\n\t\t\teach(rows.reverse(), function(tr) {\r\n\t\t\t\tdeleteRow(tr);\r\n\t\t\t});\r\n\r\n\t\t\tcleanup();\r\n\t\t};\r\n\r\n\t\tfunction cutRows() {\r\n\t\t\tvar rows = getSelectedRows();\r\n\r\n\t\t\tdom.remove(rows);\r\n\t\t\tcleanup();\r\n\r\n\t\t\treturn rows;\r\n\t\t};\r\n\r\n\t\tfunction copyRows() {\r\n\t\t\tvar rows = getSelectedRows();\r\n\r\n\t\t\teach(rows, function(row, i) {\r\n\t\t\t\trows[i] = cloneNode(row, true);\r\n\t\t\t});\r\n\r\n\t\t\treturn rows;\r\n\t\t};\r\n\r\n\t\tfunction pasteRows(rows, before) {\r\n\t\t\tvar selectedRows = getSelectedRows(),\r\n\t\t\t\ttargetRow = selectedRows[before ? 0 : selectedRows.length - 1],\r\n\t\t\t\ttargetCellCount = targetRow.cells.length;\r\n\r\n\t\t\t// Calc target cell count\r\n\t\t\teach(grid, function(row) {\r\n\t\t\t\tvar match;\r\n\r\n\t\t\t\ttargetCellCount = 0;\r\n\t\t\t\teach(row, function(cell, x) {\r\n\t\t\t\t\tif (cell.real)\r\n\t\t\t\t\t\ttargetCellCount += cell.colspan;\r\n\r\n\t\t\t\t\tif (cell.elm.parentNode == targetRow)\r\n\t\t\t\t\t\tmatch = 1;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (match)\r\n\t\t\t\t\treturn false;\r\n\t\t\t});\r\n\r\n\t\t\tif (!before)\r\n\t\t\t\trows.reverse();\r\n\r\n\t\t\teach(rows, function(row) {\r\n\t\t\t\tvar cellCount = row.cells.length, cell;\r\n\r\n\t\t\t\t// Remove col/rowspans\r\n\t\t\t\tfor (i = 0; i < cellCount; i++) {\r\n\t\t\t\t\tcell = row.cells[i];\r\n\t\t\t\t\tcell.colSpan = cell.rowSpan = 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Needs more cells\r\n\t\t\t\tfor (i = cellCount; i < targetCellCount; i++)\r\n\t\t\t\t\trow.appendChild(cloneCell(row.cells[cellCount - 1]));\r\n\r\n\t\t\t\t// Needs less cells\r\n\t\t\t\tfor (i = targetCellCount; i < cellCount; i++)\r\n\t\t\t\t\tdom.remove(row.cells[i]);\r\n\r\n\t\t\t\t// Add before/after\r\n\t\t\t\tif (before)\r\n\t\t\t\t\ttargetRow.parentNode.insertBefore(row, targetRow);\r\n\t\t\t\telse\r\n\t\t\t\t\tdom.insertAfter(row, targetRow);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tfunction getPos(target) {\r\n\t\t\tvar pos;\r\n\r\n\t\t\teach(grid, function(row, y) {\r\n\t\t\t\teach(row, function(cell, x) {\r\n\t\t\t\t\tif (cell.elm == target) {\r\n\t\t\t\t\t\tpos = {x : x, y : y};\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn !pos;\r\n\t\t\t});\r\n\r\n\t\t\treturn pos;\r\n\t\t};\r\n\r\n\t\tfunction setStartCell(cell) {\r\n\t\t\tstartPos = getPos(cell);\r\n\t\t};\r\n\r\n\t\tfunction findEndPos() {\r\n\t\t\tvar pos, maxX, maxY;\r\n\r\n\t\t\tmaxX = maxY = 0;\r\n\r\n\t\t\teach(grid, function(row, y) {\r\n\t\t\t\teach(row, function(cell, x) {\r\n\t\t\t\t\tvar colSpan, rowSpan;\r\n\r\n\t\t\t\t\tif (isCellSelected(cell)) {\r\n\t\t\t\t\t\tcell = grid[y][x];\r\n\r\n\t\t\t\t\t\tif (x > maxX)\r\n\t\t\t\t\t\t\tmaxX = x;\r\n\r\n\t\t\t\t\t\tif (y > maxY)\r\n\t\t\t\t\t\t\tmaxY = y;\r\n\r\n\t\t\t\t\t\tif (cell.real) {\r\n\t\t\t\t\t\t\tcolSpan = cell.colspan - 1;\r\n\t\t\t\t\t\t\trowSpan = cell.rowspan - 1;\r\n\r\n\t\t\t\t\t\t\tif (colSpan) {\r\n\t\t\t\t\t\t\t\tif (x + colSpan > maxX)\r\n\t\t\t\t\t\t\t\t\tmaxX = x + colSpan;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (rowSpan) {\r\n\t\t\t\t\t\t\t\tif (y + rowSpan > maxY)\r\n\t\t\t\t\t\t\t\t\tmaxY = y + rowSpan;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\treturn {x : maxX, y : maxY};\r\n\t\t};\r\n\r\n\t\tfunction setEndCell(cell) {\r\n\t\t\tvar startX, startY, endX, endY, maxX, maxY, colSpan, rowSpan;\r\n\r\n\t\t\tendPos = getPos(cell);\r\n\r\n\t\t\tif (startPos && endPos) {\r\n\t\t\t\t// Get start/end positions\r\n\t\t\t\tstartX = Math.min(startPos.x, endPos.x);\r\n\t\t\t\tstartY = Math.min(startPos.y, endPos.y);\r\n\t\t\t\tendX = Math.max(startPos.x, endPos.x);\r\n\t\t\t\tendY = Math.max(startPos.y, endPos.y);\r\n\r\n\t\t\t\t// Expand end positon to include spans\r\n\t\t\t\tmaxX = endX;\r\n\t\t\t\tmaxY = endY;\r\n\r\n\t\t\t\t// Expand startX\r\n\t\t\t\tfor (y = startY; y <= maxY; y++) {\r\n\t\t\t\t\tcell = grid[y][startX];\r\n\r\n\t\t\t\t\tif (!cell.real) {\r\n\t\t\t\t\t\tif (startX - (cell.colspan - 1) < startX)\r\n\t\t\t\t\t\t\tstartX -= cell.colspan - 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Expand startY\r\n\t\t\t\tfor (x = startX; x <= maxX; x++) {\r\n\t\t\t\t\tcell = grid[startY][x];\r\n\r\n\t\t\t\t\tif (!cell.real) {\r\n\t\t\t\t\t\tif (startY - (cell.rowspan - 1) < startY)\r\n\t\t\t\t\t\t\tstartY -= cell.rowspan - 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Find max X, Y\r\n\t\t\t\tfor (y = startY; y <= endY; y++) {\r\n\t\t\t\t\tfor (x = startX; x <= endX; x++) {\r\n\t\t\t\t\t\tcell = grid[y][x];\r\n\r\n\t\t\t\t\t\tif (cell.real) {\r\n\t\t\t\t\t\t\tcolSpan = cell.colspan - 1;\r\n\t\t\t\t\t\t\trowSpan = cell.rowspan - 1;\r\n\r\n\t\t\t\t\t\t\tif (colSpan) {\r\n\t\t\t\t\t\t\t\tif (x + colSpan > maxX)\r\n\t\t\t\t\t\t\t\t\tmaxX = x + colSpan;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (rowSpan) {\r\n\t\t\t\t\t\t\t\tif (y + rowSpan > maxY)\r\n\t\t\t\t\t\t\t\t\tmaxY = y + rowSpan;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Remove current selection\r\n\t\t\t\tdom.removeClass(dom.select('td.mceSelected,th.mceSelected'), 'mceSelected');\r\n\r\n\t\t\t\t// Add new selection\r\n\t\t\t\tfor (y = startY; y <= maxY; y++) {\r\n\t\t\t\t\tfor (x = startX; x <= maxX; x++)\r\n\t\t\t\t\t\tdom.addClass(grid[y][x].elm, 'mceSelected');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// Expose to public\r\n\t\ttinymce.extend(this, {\r\n\t\t\tdeleteTable : deleteTable,\r\n\t\t\tsplit : split,\r\n\t\t\tmerge : merge,\r\n\t\t\tinsertRow : insertRow,\r\n\t\t\tinsertCol : insertCol,\r\n\t\t\tdeleteCols : deleteCols,\r\n\t\t\tdeleteRows : deleteRows,\r\n\t\t\tcutRows : cutRows,\r\n\t\t\tcopyRows : copyRows,\r\n\t\t\tpasteRows : pasteRows,\r\n\t\t\tgetPos : getPos,\r\n\t\t\tsetStartCell : setStartCell,\r\n\t\t\tsetEndCell : setEndCell\r\n\t\t});\r\n\t};\r\n\r\n\ttinymce.create('tinymce.plugins.TablePlugin', {\r\n\t\tinit : function(ed, url) {\r\n\t\t\tvar winMan, clipboardRows;\r\n\r\n\t\t\tfunction createTableGrid(node) {\r\n\t\t\t\tvar selection = ed.selection, tblElm = ed.dom.getParent(node || selection.getNode(), 'table');\r\n\r\n\t\t\t\tif (tblElm)\r\n\t\t\t\t\treturn new TableGrid(tblElm, ed.dom, selection);\r\n\t\t\t};\r\n\r\n\t\t\tfunction cleanup() {\r\n\t\t\t\t// Restore selection possibilities\r\n\t\t\t\ted.getBody().style.webkitUserSelect = '';\r\n\t\t\t\ted.dom.removeClass(ed.dom.select('td.mceSelected,th.mceSelected'), 'mceSelected');\r\n\t\t\t};\r\n\r\n\t\t\t// Register buttons\r\n\t\t\teach([\r\n\t\t\t\t['table', 'table.desc', 'mceInsertTable', true],\r\n\t\t\t\t['delete_table', 'table.del', 'mceTableDelete'],\r\n\t\t\t\t['delete_col', 'table.delete_col_desc', 'mceTableDeleteCol'],\r\n\t\t\t\t['delete_row', 'table.delete_row_desc', 'mceTableDeleteRow'],\r\n\t\t\t\t['col_after', 'table.col_after_desc', 'mceTableInsertColAfter'],\r\n\t\t\t\t['col_before', 'table.col_before_desc', 'mceTableInsertColBefore'],\r\n\t\t\t\t['row_after', 'table.row_after_desc', 'mceTableInsertRowAfter'],\r\n\t\t\t\t['row_before', 'table.row_before_desc', 'mceTableInsertRowBefore'],\r\n\t\t\t\t['row_props', 'table.row_desc', 'mceTableRowProps', true],\r\n\t\t\t\t['cell_props', 'table.cell_desc', 'mceTableCellProps', true],\r\n\t\t\t\t['split_cells', 'table.split_cells_desc', 'mceTableSplitCells', true],\r\n\t\t\t\t['merge_cells', 'table.merge_cells_desc', 'mceTableMergeCells', true]\r\n\t\t\t], function(c) {\r\n\t\t\t\ted.addButton(c[0], {title : c[1], cmd : c[2], ui : c[3]});\r\n\t\t\t});\r\n\r\n\t\t\t// Select whole table is a table border is clicked\r\n\t\t\tif (!tinymce.isIE) {\r\n\t\t\t\ted.onClick.add(function(ed, e) {\r\n\t\t\t\t\te = e.target;\r\n\r\n\t\t\t\t\tif (e.nodeName === 'TABLE')\r\n\t\t\t\t\t\ted.selection.select(e);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Handle node change updates\r\n\t\t\ted.onNodeChange.add(function(ed, cm, n) {\r\n\t\t\t\tvar p;\r\n\r\n\t\t\t\tn = ed.selection.getStart();\r\n\t\t\t\tp = ed.dom.getParent(n, 'td,th,caption');\r\n\t\t\t\tcm.setActive('table', n.nodeName === 'TABLE' || !!p);\r\n\r\n\t\t\t\t// Disable table tools if we are in caption\r\n\t\t\t\tif (p && p.nodeName === 'CAPTION')\r\n\t\t\t\t\tp = 0;\r\n\r\n\t\t\t\tcm.setDisabled('delete_table', !p);\r\n\t\t\t\tcm.setDisabled('delete_col', !p);\r\n\t\t\t\tcm.setDisabled('delete_table', !p);\r\n\t\t\t\tcm.setDisabled('delete_row', !p);\r\n\t\t\t\tcm.setDisabled('col_after', !p);\r\n\t\t\t\tcm.setDisabled('col_before', !p);\r\n\t\t\t\tcm.setDisabled('row_after', !p);\r\n\t\t\t\tcm.setDisabled('row_before', !p);\r\n\t\t\t\tcm.setDisabled('row_props', !p);\r\n\t\t\t\tcm.setDisabled('cell_props', !p);\r\n\t\t\t\tcm.setDisabled('split_cells', !p);\r\n\t\t\t\tcm.setDisabled('merge_cells', !p);\r\n\t\t\t});\r\n\r\n\t\t\ted.onInit.add(function(ed) {\r\n\t\t\t\tvar startTable, startCell, dom = ed.dom, tableGrid;\r\n\r\n\t\t\t\twinMan = ed.windowManager;\r\n\r\n\t\t\t\t// Add cell selection logic\r\n\t\t\t\ted.onMouseDown.add(function(ed, e) {\r\n\t\t\t\t\tif (e.button != 2) {\r\n\t\t\t\t\t\tcleanup();\r\n\r\n\t\t\t\t\t\tstartCell = dom.getParent(e.target, 'td,th');\r\n\t\t\t\t\t\tstartTable = dom.getParent(startCell, 'table');\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tdom.bind(ed.getDoc(), 'mouseover', function(e) {\r\n\t\t\t\t\tvar sel, table, target = e.target;\r\n\r\n\t\t\t\t\tif (startCell && (tableGrid || target != startCell) && (target.nodeName == 'TD' || target.nodeName == 'TH')) {\r\n\t\t\t\t\t\ttable = dom.getParent(target, 'table');\r\n\t\t\t\t\t\tif (table == startTable) {\r\n\t\t\t\t\t\t\tif (!tableGrid) {\r\n\t\t\t\t\t\t\t\ttableGrid = createTableGrid(table);\r\n\t\t\t\t\t\t\t\ttableGrid.setStartCell(startCell);\r\n\r\n\t\t\t\t\t\t\t\ted.getBody().style.webkitUserSelect = 'none';\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\ttableGrid.setEndCell(target);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Remove current selection\r\n\t\t\t\t\t\tsel = ed.selection.getSel();\r\n\r\n\t\t\t\t\t\tif (sel.removeAllRanges)\r\n\t\t\t\t\t\t\tsel.removeAllRanges();\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tsel.empty();\r\n\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\ted.onMouseUp.add(function(ed, e) {\r\n\t\t\t\t\tvar rng, sel = ed.selection, selectedCells, nativeSel = sel.getSel(), walker, node, lastNode, endNode;\r\n\r\n\t\t\t\t\t// Move selection to startCell\r\n\t\t\t\t\tif (startCell) {\r\n\t\t\t\t\t\tif (tableGrid)\r\n\t\t\t\t\t\t\ted.getBody().style.webkitUserSelect = '';\r\n\r\n\t\t\t\t\t\tfunction setPoint(node, start) {\r\n\t\t\t\t\t\t\tvar walker = new tinymce.dom.TreeWalker(node, node);\r\n\r\n\t\t\t\t\t\t\tdo {\r\n\t\t\t\t\t\t\t\t// Text node\r\n\t\t\t\t\t\t\t\tif (node.nodeType == 3 && tinymce.trim(node.nodeValue).length != 0) {\r\n\t\t\t\t\t\t\t\t\tif (start)\r\n\t\t\t\t\t\t\t\t\t\trng.setStart(node, 0);\r\n\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\trng.setEnd(node, node.nodeValue.length);\r\n\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// BR element\r\n\t\t\t\t\t\t\t\tif (node.nodeName == 'BR') {\r\n\t\t\t\t\t\t\t\t\tif (start)\r\n\t\t\t\t\t\t\t\t\t\trng.setStartBefore(node);\r\n\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\trng.setEndBefore(node);\r\n\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} while (node = (start ? walker.next() : walker.prev()));\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t// Try to expand text selection as much as we can only Gecko supports cell selection\r\n\t\t\t\t\t\tselectedCells = dom.select('td.mceSelected,th.mceSelected');\r\n\t\t\t\t\t\tif (selectedCells.length > 0) {\r\n\t\t\t\t\t\t\trng = dom.createRng();\r\n\t\t\t\t\t\t\tnode = selectedCells[0];\r\n\t\t\t\t\t\t\tendNode = selectedCells[selectedCells.length - 1];\r\n\r\n\t\t\t\t\t\t\tsetPoint(node, 1);\r\n\t\t\t\t\t\t\twalker = new tinymce.dom.TreeWalker(node, dom.getParent(selectedCells[0], 'table'));\r\n\r\n\t\t\t\t\t\t\tdo {\r\n\t\t\t\t\t\t\t\tif (node.nodeName == 'TD' || node.nodeName == 'TH') {\r\n\t\t\t\t\t\t\t\t\tif (!dom.hasClass(node, 'mceSelected'))\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\t\tlastNode = node;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} while (node = walker.next());\r\n\r\n\t\t\t\t\t\t\tsetPoint(lastNode);\r\n\r\n\t\t\t\t\t\t\tsel.setRng(rng);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\ted.nodeChanged();\r\n\t\t\t\t\t\tstartCell = tableGrid = startTable = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\ted.onKeyUp.add(function(ed, e) {\r\n\t\t\t\t\tcleanup();\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Add context menu\r\n\t\t\t\tif (ed && ed.plugins.contextmenu) {\r\n\t\t\t\t\ted.plugins.contextmenu.onContextMenu.add(function(th, m, e) {\r\n\t\t\t\t\t\tvar sm, se = ed.selection, el = se.getNode() || ed.getBody();\r\n\r\n\t\t\t\t\t\tif (ed.dom.getParent(e, 'td') || ed.dom.getParent(e, 'th') || ed.dom.select('td.mceSelected,th.mceSelected').length) {\r\n\t\t\t\t\t\t\tm.removeAll();\r\n\r\n\t\t\t\t\t\t\tif (el.nodeName == 'A' && !ed.dom.getAttrib(el, 'name')) {\r\n\t\t\t\t\t\t\t\tm.add({title : 'advanced.link_desc', icon : 'link', cmd : ed.plugins.advlink ? 'mceAdvLink' : 'mceLink', ui : true});\r\n\t\t\t\t\t\t\t\tm.add({title : 'advanced.unlink_desc', icon : 'unlink', cmd : 'UnLink'});\r\n\t\t\t\t\t\t\t\tm.addSeparator();\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (el.nodeName == 'IMG' && el.className.indexOf('mceItem') == -1) {\r\n\t\t\t\t\t\t\t\tm.add({title : 'advanced.image_desc', icon : 'image', cmd : ed.plugins.advimage ? 'mceAdvImage' : 'mceImage', ui : true});\r\n\t\t\t\t\t\t\t\tm.addSeparator();\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tm.add({title : 'table.desc', icon : 'table', cmd : 'mceInsertTable', value : {action : 'insert'}});\r\n\t\t\t\t\t\t\tm.add({title : 'table.props_desc', icon : 'table_props', cmd : 'mceInsertTable'});\r\n\t\t\t\t\t\t\tm.add({title : 'table.del', icon : 'delete_table', cmd : 'mceTableDelete'});\r\n\t\t\t\t\t\t\tm.addSeparator();\r\n\r\n\t\t\t\t\t\t\t// Cell menu\r\n\t\t\t\t\t\t\tsm = m.addMenu({title : 'table.cell'});\r\n\t\t\t\t\t\t\tsm.add({title : 'table.cell_desc', icon : 'cell_props', cmd : 'mceTableCellProps'});\r\n\t\t\t\t\t\t\tsm.add({title : 'table.split_cells_desc', icon : 'split_cells', cmd : 'mceTableSplitCells'});\r\n\t\t\t\t\t\t\tsm.add({title : 'table.merge_cells_desc', icon : 'merge_cells', cmd : 'mceTableMergeCells'});\r\n\r\n\t\t\t\t\t\t\t// Row menu\r\n\t\t\t\t\t\t\tsm = m.addMenu({title : 'table.row'});\r\n\t\t\t\t\t\t\tsm.add({title : 'table.row_desc', icon : 'row_props', cmd : 'mceTableRowProps'});\r\n\t\t\t\t\t\t\tsm.add({title : 'table.row_before_desc', icon : 'row_before', cmd : 'mceTableInsertRowBefore'});\r\n\t\t\t\t\t\t\tsm.add({title : 'table.row_after_desc', icon : 'row_after', cmd : 'mceTableInsertRowAfter'});\r\n\t\t\t\t\t\t\tsm.add({title : 'table.delete_row_desc', icon : 'delete_row', cmd : 'mceTableDeleteRow'});\r\n\t\t\t\t\t\t\tsm.addSeparator();\r\n\t\t\t\t\t\t\tsm.add({title : 'table.cut_row_desc', icon : 'cut', cmd : 'mceTableCutRow'});\r\n\t\t\t\t\t\t\tsm.add({title : 'table.copy_row_desc', icon : 'copy', cmd : 'mceTableCopyRow'});\r\n\t\t\t\t\t\t\tsm.add({title : 'table.paste_row_before_desc', icon : 'paste', cmd : 'mceTablePasteRowBefore'}).setDisabled(!clipboardRows);\r\n\t\t\t\t\t\t\tsm.add({title : 'table.paste_row_after_desc', icon : 'paste', cmd : 'mceTablePasteRowAfter'}).setDisabled(!clipboardRows);\r\n\r\n\t\t\t\t\t\t\t// Column menu\r\n\t\t\t\t\t\t\tsm = m.addMenu({title : 'table.col'});\r\n\t\t\t\t\t\t\tsm.add({title : 'table.col_before_desc', icon : 'col_before', cmd : 'mceTableInsertColBefore'});\r\n\t\t\t\t\t\t\tsm.add({title : 'table.col_after_desc', icon : 'col_after', cmd : 'mceTableInsertColAfter'});\r\n\t\t\t\t\t\t\tsm.add({title : 'table.delete_col_desc', icon : 'delete_col', cmd : 'mceTableDeleteCol'});\r\n\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\tm.add({title : 'table.desc', icon : 'table', cmd : 'mceInsertTable'});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Fixes an issue on Gecko where it's impossible to place the caret behind a table\r\n\t\t\t\t// This fix will force a paragraph element after the table but only when the forced_root_block setting is enabled\r\n\t\t\t\tif (!tinymce.isIE) {\r\n\t\t\t\t\tfunction fixTableCaretPos() {\r\n\t\t\t\t\t\tvar last;\r\n\r\n\t\t\t\t\t\t// Skip empty text nodes form the end\r\n\t\t\t\t\t\tfor (last = ed.getBody().lastChild; last && last.nodeType == 3 && !last.nodeValue.length; last = last.previousSibling) ;\r\n\r\n\t\t\t\t\t\tif (last && last.nodeName == 'TABLE')\r\n\t\t\t\t\t\t\ted.dom.add(ed.getBody(), 'p', null, '<br mce_bogus=\"1\" />');\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\t// Fixes an bug where it's impossible to place the caret before a table in Gecko\r\n\t\t\t\t\t// this fix solves it by detecting when the caret is at the beginning of such a table\r\n\t\t\t\t\t// and then manually moves the caret infront of the table\r\n\t\t\t\t\tif (tinymce.isGecko) {\r\n\t\t\t\t\t\ted.onKeyDown.add(function(ed, e) {\r\n\t\t\t\t\t\t\tvar rng, table, dom = ed.dom;\r\n\r\n\t\t\t\t\t\t\t// On gecko it's not possible to place the caret before a table\r\n\t\t\t\t\t\t\tif (e.keyCode == 37 || e.keyCode == 38) {\r\n\t\t\t\t\t\t\t\trng = ed.selection.getRng();\r\n\t\t\t\t\t\t\t\ttable = dom.getParent(rng.startContainer, 'table');\r\n\r\n\t\t\t\t\t\t\t\tif (table && ed.getBody().firstChild == table) {\r\n\t\t\t\t\t\t\t\t\tif (isAtStart(rng, table)) {\r\n\t\t\t\t\t\t\t\t\t\trng = dom.createRng();\r\n\r\n\t\t\t\t\t\t\t\t\t\trng.setStartBefore(table);\r\n\t\t\t\t\t\t\t\t\t\trng.setEndBefore(table);\r\n\r\n\t\t\t\t\t\t\t\t\t\ted.selection.setRng(rng);\r\n\r\n\t\t\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ted.onKeyUp.add(fixTableCaretPos);\r\n\t\t\t\t\ted.onSetContent.add(fixTableCaretPos);\r\n\t\t\t\t\ted.onVisualAid.add(fixTableCaretPos);\r\n\r\n\t\t\t\t\ted.onPreProcess.add(function(ed, o) {\r\n\t\t\t\t\t\tvar last = o.node.lastChild;\r\n\r\n\t\t\t\t\t\tif (last && last.childNodes.length == 1 && last.firstChild.nodeName == 'BR')\r\n\t\t\t\t\t\t\ted.dom.remove(last);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tfixTableCaretPos();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Register action commands\r\n\t\t\teach({\r\n\t\t\t\tmceTableSplitCells : function(grid) {\r\n\t\t\t\t\tgrid.split();\r\n\t\t\t\t},\r\n\r\n\t\t\t\tmceTableMergeCells : function(grid) {\r\n\t\t\t\t\tvar rowSpan, colSpan, cell;\r\n\r\n\t\t\t\t\tcell = ed.dom.getParent(ed.selection.getNode(), 'th,td');\r\n\t\t\t\t\tif (cell) {\r\n\t\t\t\t\t\trowSpan = cell.rowSpan;\r\n\t\t\t\t\t\tcolSpan = cell.colSpan;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!ed.dom.select('td.mceSelected,th.mceSelected').length) {\r\n\t\t\t\t\t\twinMan.open({\r\n\t\t\t\t\t\t\turl : url + '/merge_cells.htm',\r\n\t\t\t\t\t\t\twidth : 240 + parseInt(ed.getLang('table.merge_cells_delta_width', 0)),\r\n\t\t\t\t\t\t\theight : 110 + parseInt(ed.getLang('table.merge_cells_delta_height', 0)),\r\n\t\t\t\t\t\t\tinline : 1\r\n\t\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\trows : rowSpan,\r\n\t\t\t\t\t\t\tcols : colSpan,\r\n\t\t\t\t\t\t\tonaction : function(data) {\r\n\t\t\t\t\t\t\t\tgrid.merge(cell, data.cols, data.rows);\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tplugin_url : url\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\tgrid.merge();\r\n\t\t\t\t},\r\n\r\n\t\t\t\tmceTableInsertRowBefore : function(grid) {\r\n\t\t\t\t\tgrid.insertRow(true);\r\n\t\t\t\t},\r\n\r\n\t\t\t\tmceTableInsertRowAfter : function(grid) {\r\n\t\t\t\t\tgrid.insertRow();\r\n\t\t\t\t},\r\n\r\n\t\t\t\tmceTableInsertColBefore : function(grid) {\r\n\t\t\t\t\tgrid.insertCol(true);\r\n\t\t\t\t},\r\n\r\n\t\t\t\tmceTableInsertColAfter : function(grid) {\r\n\t\t\t\t\tgrid.insertCol();\r\n\t\t\t\t},\r\n\r\n\t\t\t\tmceTableDeleteCol : function(grid) {\r\n\t\t\t\t\tgrid.deleteCols();\r\n\t\t\t\t},\r\n\r\n\t\t\t\tmceTableDeleteRow : function(grid) {\r\n\t\t\t\t\tgrid.deleteRows();\r\n\t\t\t\t},\r\n\r\n\t\t\t\tmceTableCutRow : function(grid) {\r\n\t\t\t\t\tclipboardRows = grid.cutRows();\r\n\t\t\t\t},\r\n\r\n\t\t\t\tmceTableCopyRow : function(grid) {\r\n\t\t\t\t\tclipboardRows = grid.copyRows();\r\n\t\t\t\t},\r\n\r\n\t\t\t\tmceTablePasteRowBefore : function(grid) {\r\n\t\t\t\t\tgrid.pasteRows(clipboardRows, true);\r\n\t\t\t\t},\r\n\r\n\t\t\t\tmceTablePasteRowAfter : function(grid) {\r\n\t\t\t\t\tgrid.pasteRows(clipboardRows);\r\n\t\t\t\t},\r\n\r\n\t\t\t\tmceTableDelete : function(grid) {\r\n\t\t\t\t\tgrid.deleteTable();\r\n\t\t\t\t}\r\n\t\t\t}, function(func, name) {\r\n\t\t\t\ted.addCommand(name, function() {\r\n\t\t\t\t\tvar grid = createTableGrid();\r\n\r\n\t\t\t\t\tif (grid) {\r\n\t\t\t\t\t\tfunc(grid);\r\n\t\t\t\t\t\ted.execCommand('mceRepaint');\r\n\t\t\t\t\t\tcleanup();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t// Register dialog commands\r\n\t\t\teach({\r\n\t\t\t\tmceInsertTable : function(val) {\r\n\t\t\t\t\twinMan.open({\r\n\t\t\t\t\t\turl : url + '/table.htm',\r\n\t\t\t\t\t\twidth : 400 + parseInt(ed.getLang('table.table_delta_width', 0)),\r\n\t\t\t\t\t\theight : 320 + parseInt(ed.getLang('table.table_delta_height', 0)),\r\n\t\t\t\t\t\tinline : 1\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\tplugin_url : url,\r\n\t\t\t\t\t\taction : val ? val.action : 0\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\r\n\t\t\t\tmceTableRowProps : function() {\r\n\t\t\t\t\twinMan.open({\r\n\t\t\t\t\t\turl : url + '/row.htm',\r\n\t\t\t\t\t\twidth : 400 + parseInt(ed.getLang('table.rowprops_delta_width', 0)),\r\n\t\t\t\t\t\theight : 295 + parseInt(ed.getLang('table.rowprops_delta_height', 0)),\r\n\t\t\t\t\t\tinline : 1\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\tplugin_url : url\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\r\n\t\t\t\tmceTableCellProps : function() {\r\n\t\t\t\t\twinMan.open({\r\n\t\t\t\t\t\turl : url + '/cell.htm',\r\n\t\t\t\t\t\twidth : 400 + parseInt(ed.getLang('table.cellprops_delta_width', 0)),\r\n\t\t\t\t\t\theight : 295 + parseInt(ed.getLang('table.cellprops_delta_height', 0)),\r\n\t\t\t\t\t\tinline : 1\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\tplugin_url : url\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}, function(func, name) {\r\n\t\t\t\ted.addCommand(name, function(ui, val) {\r\n\t\t\t\t\tfunc(val);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\t// Register plugin\r\n\ttinymce.PluginManager.add('table', tinymce.plugins.TablePlugin);\r\n})(tinymce);/**\r\n * editor_plugin_src.js\r\n *\r\n * Copyright 2009, Moxiecode Systems AB\r\n * Released under LGPL License.\r\n *\r\n * License: http://tinymce.moxiecode.com/license\r\n * Contributing: http://tinymce.moxiecode.com/contributing\r\n */\r\n\r\n(function() {\r\n\ttinymce.create('tinymce.plugins.Save', {\r\n\t\tinit : function(ed, url) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tt.editor = ed;\r\n\r\n\t\t\t// Register commands\r\n\t\t\ted.addCommand('mceSave', t._save, t);\r\n\t\t\ted.addCommand('mceCancel', t._cancel, t);\r\n\r\n\t\t\t// Register buttons\r\n\t\t\ted.addButton('save', {title : 'save.save_desc', cmd : 'mceSave'});\r\n\t\t\ted.addButton('cancel', {title : 'save.cancel_desc', cmd : 'mceCancel'});\r\n\r\n\t\t\ted.onNodeChange.add(t._nodeChange, t);\r\n\t\t\ted.addShortcut('ctrl+s', ed.getLang('save.save_desc'), 'mceSave');\r\n\t\t},\r\n\r\n\t\tgetInfo : function() {\r\n\t\t\treturn {\r\n\t\t\t\tlongname : 'Save',\r\n\t\t\t\tauthor : 'Moxiecode Systems AB',\r\n\t\t\t\tauthorurl : 'http://tinymce.moxiecode.com',\r\n\t\t\t\tinfourl : 'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/save',\r\n\t\t\t\tversion : tinymce.majorVersion + \".\" + tinymce.minorVersion\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\t// Private methods\r\n\r\n\t\t_nodeChange : function(ed, cm, n) {\r\n\t\t\tvar ed = this.editor;\r\n\r\n\t\t\tif (ed.getParam('save_enablewhendirty')) {\r\n\t\t\t\tcm.setDisabled('save', !ed.isDirty());\r\n\t\t\t\tcm.setDisabled('cancel', !ed.isDirty());\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t// Private methods\r\n\r\n\t\t_save : function() {\r\n\t\t\tvar ed = this.editor, formObj, os, i, elementId;\r\n\r\n\t\t\tformObj = tinymce.DOM.get(ed.id).form || tinymce.DOM.getParent(ed.id, 'form');\r\n\r\n\t\t\tif (ed.getParam(\"save_enablewhendirty\") && !ed.isDirty())\r\n\t\t\t\treturn;\r\n\r\n\t\t\ttinyMCE.triggerSave();\r\n\r\n\t\t\t// Use callback instead\r\n\t\t\tif (os = ed.getParam(\"save_onsavecallback\")) {\r\n\t\t\t\tif (ed.execCallback('save_onsavecallback', ed)) {\r\n\t\t\t\t\ted.startContent = tinymce.trim(ed.getContent({format : 'raw'}));\r\n\t\t\t\t\ted.nodeChanged();\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (formObj) {\r\n\t\t\t\ted.isNotDirty = true;\r\n\r\n\t\t\t\tif (formObj.onsubmit == null || formObj.onsubmit() != false)\r\n\t\t\t\t\tformObj.submit();\r\n\r\n\t\t\t\ted.nodeChanged();\r\n\t\t\t} else\r\n\t\t\t\ted.windowManager.alert(\"Error: No form element found.\");\r\n\t\t},\r\n\r\n\t\t_cancel : function() {\r\n\t\t\tvar ed = this.editor, os, h = tinymce.trim(ed.startContent);\r\n\r\n\t\t\t// Use callback instead\r\n\t\t\tif (os = ed.getParam(\"save_oncancelcallback\")) {\r\n\t\t\t\ted.execCallback('save_oncancelcallback', ed);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\ted.setContent(h);\r\n\t\t\ted.undoManager.clear();\r\n\t\t\ted.nodeChanged();\r\n\t\t}\r\n\t});\r\n\r\n\t// Register plugin\r\n\ttinymce.PluginManager.add('save', tinymce.plugins.Save);\r\n})();/**\r\n * editor_plugin_src.js\r\n *\r\n * Copyright 2009, Moxiecode Systems AB\r\n * Released under LGPL License.\r\n *\r\n * License: http://tinymce.moxiecode.com/license\r\n * Contributing: http://tinymce.moxiecode.com/contributing\r\n */\r\n\r\n(function() {\r\n\ttinymce.create('tinymce.plugins.AdvancedHRPlugin', {\r\n\t\tinit : function(ed, url) {\r\n\t\t\t// Register commands\r\n\t\t\ted.addCommand('mceAdvancedHr', function() {\r\n\t\t\t\ted.windowManager.open({\r\n\t\t\t\t\tfile : url + '/rule.htm',\r\n\t\t\t\t\twidth : 250 + parseInt(ed.getLang('advhr.delta_width', 0)),\r\n\t\t\t\t\theight : 160 + parseInt(ed.getLang('advhr.delta_height', 0)),\r\n\t\t\t\t\tinline : 1\r\n\t\t\t\t}, {\r\n\t\t\t\t\tplugin_url : url\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t// Register buttons\r\n\t\t\ted.addButton('advhr', {\r\n\t\t\t\ttitle : 'advhr.advhr_desc',\r\n\t\t\t\tcmd : 'mceAdvancedHr'\r\n\t\t\t});\r\n\r\n\t\t\ted.onNodeChange.add(function(ed, cm, n) {\r\n\t\t\t\tcm.setActive('advhr', n.nodeName == 'HR');\r\n\t\t\t});\r\n\r\n\t\t\ted.onClick.add(function(ed, e) {\r\n\t\t\t\te = e.target;\r\n\r\n\t\t\t\tif (e.nodeName === 'HR')\r\n\t\t\t\t\ted.selection.select(e);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tgetInfo : function() {\r\n\t\t\treturn {\r\n\t\t\t\tlongname : 'Advanced HR',\r\n\t\t\t\tauthor : 'Moxiecode Systems AB',\r\n\t\t\t\tauthorurl : 'http://tinymce.moxiecode.com',\r\n\t\t\t\tinfourl : 'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/advhr',\r\n\t\t\t\tversion : tinymce.majorVersion + \".\" + tinymce.minorVersion\r\n\t\t\t};\r\n\t\t}\r\n\t});\r\n\r\n\t// Register plugin\r\n\ttinymce.PluginManager.add('advhr', tinymce.plugins.AdvancedHRPlugin);\r\n})();/**\r\n * editor_plugin_src.js\r\n *\r\n * Copyright 2009, Moxiecode Systems AB\r\n * Released under LGPL License.\r\n *\r\n * License: http://tinymce.moxiecode.com/license\r\n * Contributing: http://tinymce.moxiecode.com/contributing\r\n */\r\n\r\n(function() {\r\n\ttinymce.create('tinymce.plugins.AdvancedImagePlugin', {\r\n\t\tinit : function(ed, url) {\r\n\t\t\t// Register commands\r\n\t\t\ted.addCommand('mceAdvImage', function() {\r\n\t\t\t\t// Internal image object like a flash placeholder\r\n\t\t\t\tif (ed.dom.getAttrib(ed.selection.getNode(), 'class').indexOf('mceItem') != -1)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\ted.windowManager.open({\r\n\t\t\t\t\tfile : url + '/image.htm',\r\n\t\t\t\t\twidth : 480 + parseInt(ed.getLang('advimage.delta_width', 0)),\r\n\t\t\t\t\theight : 385 + parseInt(ed.getLang('advimage.delta_height', 0)),\r\n\t\t\t\t\tinline : 1\r\n\t\t\t\t}, {\r\n\t\t\t\t\tplugin_url : url\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t// Register buttons\r\n\t\t\ted.addButton('image', {\r\n\t\t\t\ttitle : 'advimage.image_desc',\r\n\t\t\t\tcmd : 'mceAdvImage'\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tgetInfo : function() {\r\n\t\t\treturn {\r\n\t\t\t\tlongname : 'Advanced image',\r\n\t\t\t\tauthor : 'Moxiecode Systems AB',\r\n\t\t\t\tauthorurl : 'http://tinymce.moxiecode.com',\r\n\t\t\t\tinfourl : 'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/advimage',\r\n\t\t\t\tversion : tinymce.majorVersion + \".\" + tinymce.minorVersion\r\n\t\t\t};\r\n\t\t}\r\n\t});\r\n\r\n\t// Register plugin\r\n\ttinymce.PluginManager.add('advimage', tinymce.plugins.AdvancedImagePlugin);\r\n})();/**\r\n * editor_plugin_src.js\r\n *\r\n * Copyright 2009, Moxiecode Systems AB\r\n * Released under LGPL License.\r\n *\r\n * License: http://tinymce.moxiecode.com/license\r\n * Contributing: http://tinymce.moxiecode.com/contributing\r\n */\r\n\r\n(function() {\r\n\ttinymce.create('tinymce.plugins.AdvancedLinkPlugin', {\r\n\t\tinit : function(ed, url) {\r\n\t\t\tthis.editor = ed;\r\n\r\n\t\t\t// Register commands\r\n\t\t\ted.addCommand('mceAdvLink', function() {\r\n\t\t\t\tvar se = ed.selection;\r\n\r\n\t\t\t\t// No selection and not in link\r\n\t\t\t\tif (se.isCollapsed() && !ed.dom.getParent(se.getNode(), 'A'))\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\ted.windowManager.open({\r\n\t\t\t\t\tfile : url + '/link.htm',\r\n\t\t\t\t\twidth : 480 + parseInt(ed.getLang('advlink.delta_width', 0)),\r\n\t\t\t\t\theight : 400 + parseInt(ed.getLang('advlink.delta_height', 0)),\r\n\t\t\t\t\tinline : 1\r\n\t\t\t\t}, {\r\n\t\t\t\t\tplugin_url : url\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t// Register buttons\r\n\t\t\ted.addButton('link', {\r\n\t\t\t\ttitle : 'advlink.link_desc',\r\n\t\t\t\tcmd : 'mceAdvLink'\r\n\t\t\t});\r\n\r\n\t\t\ted.addShortcut('ctrl+k', 'advlink.advlink_desc', 'mceAdvLink');\r\n\r\n\t\t\ted.onNodeChange.add(function(ed, cm, n, co) {\r\n\t\t\t\tcm.setDisabled('link', co && n.nodeName != 'A');\r\n\t\t\t\tcm.setActive('link', n.nodeName == 'A' && !n.name);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tgetInfo : function() {\r\n\t\t\treturn {\r\n\t\t\t\tlongname : 'Advanced link',\r\n\t\t\t\tauthor : 'Moxiecode Systems AB',\r\n\t\t\t\tauthorurl : 'http://tinymce.moxiecode.com',\r\n\t\t\t\tinfourl : 'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/advlink',\r\n\t\t\t\tversion : tinymce.majorVersion + \".\" + tinymce.minorVersion\r\n\t\t\t};\r\n\t\t}\r\n\t});\r\n\r\n\t// Register plugin\r\n\ttinymce.PluginManager.add('advlink', tinymce.plugins.AdvancedLinkPlugin);\r\n})();/**\r\n * editor_plugin_src.js\r\n *\r\n * Copyright 2009, Moxiecode Systems AB\r\n * Released under LGPL License.\r\n *\r\n * License: http://tinymce.moxiecode.com/license\r\n * Contributing: http://tinymce.moxiecode.com/contributing\r\n */\r\n\r\n(function(tinymce) {\r\n\ttinymce.create('tinymce.plugins.EmotionsPlugin', {\r\n\t\tinit : function(ed, url) {\r\n\t\t\t// Register commands\r\n\t\t\ted.addCommand('mceEmotion', function() {\r\n\t\t\t\ted.windowManager.open({\r\n\t\t\t\t\tfile : url + '/emotions.htm',\r\n\t\t\t\t\twidth : 250 + parseInt(ed.getLang('emotions.delta_width', 0)),\r\n\t\t\t\t\theight : 160 + parseInt(ed.getLang('emotions.delta_height', 0)),\r\n\t\t\t\t\tinline : 1\r\n\t\t\t\t}, {\r\n\t\t\t\t\tplugin_url : url\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t// Register buttons\r\n\t\t\ted.addButton('emotions', {title : 'emotions.emotions_desc', cmd : 'mceEmotion'});\r\n\t\t},\r\n\r\n\t\tgetInfo : function() {\r\n\t\t\treturn {\r\n\t\t\t\tlongname : 'Emotions',\r\n\t\t\t\tauthor : 'Moxiecode Systems AB',\r\n\t\t\t\tauthorurl : 'http://tinymce.moxiecode.com',\r\n\t\t\t\tinfourl : 'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/emotions',\r\n\t\t\t\tversion : tinymce.majorVersion + \".\" + tinymce.minorVersion\r\n\t\t\t};\r\n\t\t}\r\n\t});\r\n\r\n\t// Register plugin\r\n\ttinymce.PluginManager.add('emotions', tinymce.plugins.EmotionsPlugin);\r\n})(tinymce);/**\r\n * editor_plugin_src.js\r\n *\r\n * Copyright 2009, Moxiecode Systems AB\r\n * Released under LGPL License.\r\n *\r\n * License: http://tinymce.moxiecode.com/license\r\n * Contributing: http://tinymce.moxiecode.com/contributing\r\n */\r\n\r\n(function() {\r\n\ttinymce.create('tinymce.plugins.IESpell', {\r\n\t\tinit : function(ed, url) {\r\n\t\t\tvar t = this, sp;\r\n\r\n\t\t\tif (!tinymce.isIE)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tt.editor = ed;\r\n\r\n\t\t\t// Register commands\r\n\t\t\ted.addCommand('mceIESpell', function() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tsp = new ActiveXObject(\"ieSpell.ieSpellExtension\");\r\n\t\t\t\t\tsp.CheckDocumentNode(ed.getDoc().documentElement);\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tif (e.number == -2146827859) {\r\n\t\t\t\t\t\ted.windowManager.confirm(ed.getLang(\"iespell.download\"), function(s) {\r\n\t\t\t\t\t\t\tif (s)\r\n\t\t\t\t\t\t\t\twindow.open('http://www.iespell.com/download.php', 'ieSpellDownload', '');\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\ted.windowManager.alert(\"Error Loading ieSpell: Exception \" + e.number);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Register buttons\r\n\t\t\ted.addButton('iespell', {title : 'iespell.iespell_desc', cmd : 'mceIESpell'});\r\n\t\t},\r\n\r\n\t\tgetInfo : function() {\r\n\t\t\treturn {\r\n\t\t\t\tlongname : 'IESpell (IE Only)',\r\n\t\t\t\tauthor : 'Moxiecode Systems AB',\r\n\t\t\t\tauthorurl : 'http://tinymce.moxiecode.com',\r\n\t\t\t\tinfourl : 'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/iespell',\r\n\t\t\t\tversion : tinymce.majorVersion + \".\" + tinymce.minorVersion\r\n\t\t\t};\r\n\t\t}\r\n\t});\r\n\r\n\t// Register plugin\r\n\ttinymce.PluginManager.add('iespell', tinymce.plugins.IESpell);\r\n})();/**\r\n * editor_plugin_src.js\r\n *\r\n * Copyright 2009, Moxiecode Systems AB\r\n * Released under LGPL License.\r\n *\r\n * License: http://tinymce.moxiecode.com/license\r\n * Contributing: http://tinymce.moxiecode.com/contributing\r\n */\r\n\r\n(function() {\r\n\ttinymce.create('tinymce.plugins.InsertDateTime', {\r\n\t\tinit : function(ed, url) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tt.editor = ed;\r\n\r\n\t\t\ted.addCommand('mceInsertDate', function() {\r\n\t\t\t\tvar str = t._getDateTime(new Date(), ed.getParam(\"plugin_insertdate_dateFormat\", ed.getLang('insertdatetime.date_fmt')));\r\n\r\n\t\t\t\ted.execCommand('mceInsertContent', false, str);\r\n\t\t\t});\r\n\r\n\t\t\ted.addCommand('mceInsertTime', function() {\r\n\t\t\t\tvar str = t._getDateTime(new Date(), ed.getParam(\"plugin_insertdate_timeFormat\", ed.getLang('insertdatetime.time_fmt')));\r\n\r\n\t\t\t\ted.execCommand('mceInsertContent', false, str);\r\n\t\t\t});\r\n\r\n\t\t\ted.addButton('insertdate', {title : 'insertdatetime.insertdate_desc', cmd : 'mceInsertDate'});\r\n\t\t\ted.addButton('inserttime', {title : 'insertdatetime.inserttime_desc', cmd : 'mceInsertTime'});\r\n\t\t},\r\n\r\n\t\tgetInfo : function() {\r\n\t\t\treturn {\r\n\t\t\t\tlongname : 'Insert date/time',\r\n\t\t\t\tauthor : 'Moxiecode Systems AB',\r\n\t\t\t\tauthorurl : 'http://tinymce.moxiecode.com',\r\n\t\t\t\tinfourl : 'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/insertdatetime',\r\n\t\t\t\tversion : tinymce.majorVersion + \".\" + tinymce.minorVersion\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\t// Private methods\r\n\r\n\t\t_getDateTime : function(d, fmt) {\r\n\t\t\tvar ed = this.editor;\r\n\r\n\t\t\tfunction addZeros(value, len) {\r\n\t\t\t\tvalue = \"\" + value;\r\n\r\n\t\t\t\tif (value.length < len) {\r\n\t\t\t\t\tfor (var i=0; i<(len-value.length); i++)\r\n\t\t\t\t\t\tvalue = \"0\" + value;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn value;\r\n\t\t\t};\r\n\r\n\t\t\tfmt = fmt.replace(\"%D\", \"%m/%d/%y\");\r\n\t\t\tfmt = fmt.replace(\"%r\", \"%I:%M:%S %p\");\r\n\t\t\tfmt = fmt.replace(\"%Y\", \"\" + d.getFullYear());\r\n\t\t\tfmt = fmt.replace(\"%y\", \"\" + d.getYear());\r\n\t\t\tfmt = fmt.replace(\"%m\", addZeros(d.getMonth()+1, 2));\r\n\t\t\tfmt = fmt.replace(\"%d\", addZeros(d.getDate(), 2));\r\n\t\t\tfmt = fmt.replace(\"%H\", \"\" + addZeros(d.getHours(), 2));\r\n\t\t\tfmt = fmt.replace(\"%M\", \"\" + addZeros(d.getMinutes(), 2));\r\n\t\t\tfmt = fmt.replace(\"%S\", \"\" + addZeros(d.getSeconds(), 2));\r\n\t\t\tfmt = fmt.replace(\"%I\", \"\" + ((d.getHours() + 11) % 12 + 1));\r\n\t\t\tfmt = fmt.replace(\"%p\", \"\" + (d.getHours() < 12 ? \"AM\" : \"PM\"));\r\n\t\t\tfmt = fmt.replace(\"%B\", \"\" + ed.getLang(\"insertdatetime.months_long\").split(',')[d.getMonth()]);\r\n\t\t\tfmt = fmt.replace(\"%b\", \"\" + ed.getLang(\"insertdatetime.months_short\").split(',')[d.getMonth()]);\r\n\t\t\tfmt = fmt.replace(\"%A\", \"\" + ed.getLang(\"insertdatetime.day_long\").split(',')[d.getDay()]);\r\n\t\t\tfmt = fmt.replace(\"%a\", \"\" + ed.getLang(\"insertdatetime.day_short\").split(',')[d.getDay()]);\r\n\t\t\tfmt = fmt.replace(\"%%\", \"%\");\r\n\r\n\t\t\treturn fmt;\r\n\t\t}\r\n\t});\r\n\r\n\t// Register plugin\r\n\ttinymce.PluginManager.add('insertdatetime', tinymce.plugins.InsertDateTime);\r\n})();/**\n * editor_plugin_src.js\n *\n * Copyright 2009, Moxiecode Systems AB\n * Released under LGPL License.\n *\n * License: http://tinymce.moxiecode.com/license\n * Contributing: http://tinymce.moxiecode.com/contributing\n */\n\n(function() {\n\ttinymce.create('tinymce.plugins.Preview', {\n\t\tinit : function(ed, url) {\n\t\t\tvar t = this, css = tinymce.explode(ed.settings.content_css);\n\n\t\t\tt.editor = ed;\n\n\t\t\t// Force absolute CSS urls\t\n\t\t\ttinymce.each(css, function(u, k) {\n\t\t\t\tcss[k] = ed.documentBaseURI.toAbsolute(u);\n\t\t\t});\n\n\t\t\ted.addCommand('mcePreview', function() {\n\t\t\t\ted.windowManager.open({\n\t\t\t\t\tfile : ed.getParam(\"plugin_preview_pageurl\", url + \"/preview.html\"),\n\t\t\t\t\twidth : parseInt(ed.getParam(\"plugin_preview_width\", \"550\")),\n\t\t\t\t\theight : parseInt(ed.getParam(\"plugin_preview_height\", \"600\")),\n\t\t\t\t\tresizable : \"yes\",\n\t\t\t\t\tscrollbars : \"yes\",\n\t\t\t\t\tpopup_css : css ? css.join(',') : ed.baseURI.toAbsolute(\"themes/\" + ed.settings.theme + \"/skins/\" + ed.settings.skin + \"/content.css\"),\n\t\t\t\t\tinline : ed.getParam(\"plugin_preview_inline\", 1)\n\t\t\t\t}, {\n\t\t\t\t\tbase : ed.documentBaseURI.getURI()\n\t\t\t\t});\n\t\t\t});\n\n\t\t\ted.addButton('preview', {title : 'preview.preview_desc', cmd : 'mcePreview'});\n\t\t},\n\n\t\tgetInfo : function() {\n\t\t\treturn {\n\t\t\t\tlongname : 'Preview',\n\t\t\t\tauthor : 'Moxiecode Systems AB',\n\t\t\t\tauthorurl : 'http://tinymce.moxiecode.com',\n\t\t\t\tinfourl : 'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/preview',\n\t\t\t\tversion : tinymce.majorVersion + \".\" + tinymce.minorVersion\n\t\t\t};\n\t\t}\n\t});\n\n\t// Register plugin\n\ttinymce.PluginManager.add('preview', tinymce.plugins.Preview);\n})();/**\r\n * editor_plugin_src.js\r\n *\r\n * Copyright 2009, Moxiecode Systems AB\r\n * Released under LGPL License.\r\n *\r\n * License: http://tinymce.moxiecode.com/license\r\n * Contributing: http://tinymce.moxiecode.com/contributing\r\n */\r\n\r\n(function() {\r\n\tvar each = tinymce.each;\r\n\r\n\ttinymce.create('tinymce.plugins.MediaPlugin', {\r\n\t\tinit : function(ed, url) {\r\n\t\t\tvar t = this;\r\n\t\t\t\r\n\t\t\tt.editor = ed;\r\n\t\t\tt.url = url;\r\n\r\n\t\t\tfunction isMediaElm(n) {\r\n\t\t\t\treturn /^(mceItemFlash|mceItemShockWave|mceItemWindowsMedia|mceItemQuickTime|mceItemRealMedia)$/.test(n.className);\r\n\t\t\t};\r\n\r\n\t\t\ted.onPreInit.add(function() {\r\n\t\t\t\t// Force in _value parameter this extra parameter is required for older Opera versions\r\n\t\t\t\ted.serializer.addRules('param[name|value|_mce_value]');\r\n\t\t\t});\r\n\r\n\t\t\t// Register commands\r\n\t\t\ted.addCommand('mceMedia', function() {\r\n\t\t\t\ted.windowManager.open({\r\n\t\t\t\t\tfile : url + '/media.htm',\r\n\t\t\t\t\twidth : 430 + parseInt(ed.getLang('media.delta_width', 0)),\r\n\t\t\t\t\theight : 470 + parseInt(ed.getLang('media.delta_height', 0)),\r\n\t\t\t\t\tinline : 1\r\n\t\t\t\t}, {\r\n\t\t\t\t\tplugin_url : url\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t// Register buttons\r\n\t\t\ted.addButton('media', {title : 'media.desc', cmd : 'mceMedia'});\r\n\r\n\t\t\ted.onNodeChange.add(function(ed, cm, n) {\r\n\t\t\t\tcm.setActive('media', n.nodeName == 'IMG' && isMediaElm(n));\r\n\t\t\t});\r\n\r\n\t\t\ted.onInit.add(function() {\r\n\t\t\t\tvar lo = {\r\n\t\t\t\t\tmceItemFlash : 'flash',\r\n\t\t\t\t\tmceItemShockWave : 'shockwave',\r\n\t\t\t\t\tmceItemWindowsMedia : 'windowsmedia',\r\n\t\t\t\t\tmceItemQuickTime : 'quicktime',\r\n\t\t\t\t\tmceItemRealMedia : 'realmedia'\r\n\t\t\t\t};\r\n\r\n\t\t\t\ted.selection.onSetContent.add(function() {\r\n\t\t\t\t\tt._spansToImgs(ed.getBody());\r\n\t\t\t\t});\r\n\r\n\t\t\t\ted.selection.onBeforeSetContent.add(t._objectsToSpans, t);\r\n\r\n\t\t\t\tif (ed.settings.content_css !== false)\r\n\t\t\t\t\ted.dom.loadCSS(url + \"/css/content.css\");\r\n\r\n\t\t\t\tif (ed.theme && ed.theme.onResolveName) {\r\n\t\t\t\t\ted.theme.onResolveName.add(function(th, o) {\r\n\t\t\t\t\t\tif (o.name == 'img') {\r\n\t\t\t\t\t\t\teach(lo, function(v, k) {\r\n\t\t\t\t\t\t\t\tif (ed.dom.hasClass(o.node, k)) {\r\n\t\t\t\t\t\t\t\t\to.name = v;\r\n\t\t\t\t\t\t\t\t\to.title = ed.dom.getAttrib(o.node, 'title');\r\n\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (ed && ed.plugins.contextmenu) {\r\n\t\t\t\t\ted.plugins.contextmenu.onContextMenu.add(function(th, m, e) {\r\n\t\t\t\t\t\tif (e.nodeName == 'IMG' && /mceItem(Flash|ShockWave|WindowsMedia|QuickTime|RealMedia)/.test(e.className)) {\r\n\t\t\t\t\t\t\tm.add({title : 'media.edit', icon : 'media', cmd : 'mceMedia'});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\ted.onBeforeSetContent.add(t._objectsToSpans, t);\r\n\r\n\t\t\ted.onSetContent.add(function() {\r\n\t\t\t\tt._spansToImgs(ed.getBody());\r\n\t\t\t});\r\n\r\n\t\t\ted.onPreProcess.add(function(ed, o) {\r\n\t\t\t\tvar dom = ed.dom;\r\n\r\n\t\t\t\tif (o.set) {\r\n\t\t\t\t\tt._spansToImgs(o.node);\r\n\r\n\t\t\t\t\teach(dom.select('IMG', o.node), function(n) {\r\n\t\t\t\t\t\tvar p;\r\n\r\n\t\t\t\t\t\tif (isMediaElm(n)) {\r\n\t\t\t\t\t\t\tp = t._parse(n.title);\r\n\t\t\t\t\t\t\tdom.setAttrib(n, 'width', dom.getAttrib(n, 'width', p.width || 100));\r\n\t\t\t\t\t\t\tdom.setAttrib(n, 'height', dom.getAttrib(n, 'height', p.height || 100));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (o.get) {\r\n\t\t\t\t\teach(dom.select('IMG', o.node), function(n) {\r\n\t\t\t\t\t\tvar ci, cb, mt;\r\n\r\n\t\t\t\t\t\tif (ed.getParam('media_use_script')) {\r\n\t\t\t\t\t\t\tif (isMediaElm(n))\r\n\t\t\t\t\t\t\t\tn.className = n.className.replace(/mceItem/g, 'mceTemp');\r\n\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tswitch (n.className) {\r\n\t\t\t\t\t\t\tcase 'mceItemFlash':\r\n\t\t\t\t\t\t\t\tci = 'd27cdb6e-ae6d-11cf-96b8-444553540000';\r\n\t\t\t\t\t\t\t\tcb = 'http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0';\r\n\t\t\t\t\t\t\t\tmt = 'application/x-shockwave-flash';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase 'mceItemShockWave':\r\n\t\t\t\t\t\t\t\tci = '166b1bca-3f9c-11cf-8075-444553540000';\r\n\t\t\t\t\t\t\t\tcb = 'http://download.macromedia.com/pub/shockwave/cabs/director/sw.cab#version=8,5,1,0';\r\n\t\t\t\t\t\t\t\tmt = 'application/x-director';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase 'mceItemWindowsMedia':\r\n\t\t\t\t\t\t\t\tci = ed.getParam('media_wmp6_compatible') ? '05589fa1-c356-11ce-bf01-00aa0055595a' : '6bf52a52-394a-11d3-b153-00c04f79faa6';\r\n\t\t\t\t\t\t\t\tcb = 'http://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=5,1,52,701';\r\n\t\t\t\t\t\t\t\tmt = 'application/x-mplayer2';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase 'mceItemQuickTime':\r\n\t\t\t\t\t\t\t\tci = '02bf25d5-8c17-4b23-bc80-d3488abddc6b';\r\n\t\t\t\t\t\t\t\tcb = 'http://www.apple.com/qtactivex/qtplugin.cab#version=6,0,2,0';\r\n\t\t\t\t\t\t\t\tmt = 'video/quicktime';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase 'mceItemRealMedia':\r\n\t\t\t\t\t\t\t\tci = 'cfcdaa03-8be4-11cf-b84b-0020afbbccfa';\r\n\t\t\t\t\t\t\t\tcb = 'http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0';\r\n\t\t\t\t\t\t\t\tmt = 'audio/x-pn-realaudio-plugin';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (ci) {\r\n\t\t\t\t\t\t\tdom.replace(t._buildObj({\r\n\t\t\t\t\t\t\t\tclassid : ci,\r\n\t\t\t\t\t\t\t\tcodebase : cb,\r\n\t\t\t\t\t\t\t\ttype : mt\r\n\t\t\t\t\t\t\t}, n), n);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\ted.onPostProcess.add(function(ed, o) {\r\n\t\t\t\to.content = o.content.replace(/_mce_value=/g, 'value=');\r\n\t\t\t});\r\n\r\n\t\t\tfunction getAttr(s, n) {\r\n\t\t\t\tn = new RegExp(n + '=\\\"([^\\\"]+)\\\"', 'g').exec(s);\r\n\r\n\t\t\t\treturn n ? ed.dom.decode(n[1]) : '';\r\n\t\t\t};\r\n\r\n\t\t\ted.onPostProcess.add(function(ed, o) {\r\n\t\t\t\tif (ed.getParam('media_use_script')) {\r\n\t\t\t\t\to.content = o.content.replace(/<img[^>]+>/g, function(im) {\r\n\t\t\t\t\t\tvar cl = getAttr(im, 'class');\r\n\r\n\t\t\t\t\t\tif (/^(mceTempFlash|mceTempShockWave|mceTempWindowsMedia|mceTempQuickTime|mceTempRealMedia)$/.test(cl)) {\r\n\t\t\t\t\t\t\tat = t._parse(getAttr(im, 'title'));\r\n\t\t\t\t\t\t\tat.width = getAttr(im, 'width');\r\n\t\t\t\t\t\t\tat.height = getAttr(im, 'height');\r\n\t\t\t\t\t\t\tim = '<script type=\"text/javascript\">write' + cl.substring(7) + '({' + t._serialize(at) + '});</script>';\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn im;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tgetInfo : function() {\r\n\t\t\treturn {\r\n\t\t\t\tlongname : 'Media',\r\n\t\t\t\tauthor : 'Moxiecode Systems AB',\r\n\t\t\t\tauthorurl : 'http://tinymce.moxiecode.com',\r\n\t\t\t\tinfourl : 'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/media',\r\n\t\t\t\tversion : tinymce.majorVersion + \".\" + tinymce.minorVersion\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\t// Private methods\r\n\t\t_objectsToSpans : function(ed, o) {\r\n\t\t\tvar t = this, h = o.content;\r\n\r\n\t\t\th = h.replace(/<script[^>]*>\\s*write(Flash|ShockWave|WindowsMedia|QuickTime|RealMedia)\\(\\{([^\\)]*)\\}\\);\\s*<\\/script>/gi, function(a, b, c) {\r\n\t\t\t\tvar o = t._parse(c);\r\n\r\n\t\t\t\treturn '<img class=\"mceItem' + b + '\" title=\"' + ed.dom.encode(c) + '\" src=\"' + t.url + '/img/trans.gif\" width=\"' + o.width + '\" height=\"' + o.height + '\" />'\r\n\t\t\t});\r\n\r\n\t\t\th = h.replace(/<object([^>]*)>/gi, '<span class=\"mceItemObject\" $1>');\r\n\t\t\th = h.replace(/<embed([^>]*)\\/?>/gi, '<span class=\"mceItemEmbed\" $1></span>');\r\n\t\t\th = h.replace(/<embed([^>]*)>/gi, '<span class=\"mceItemEmbed\" $1>');\r\n\t\t\th = h.replace(/<\\/(object)([^>]*)>/gi, '</span>');\r\n\t\t\th = h.replace(/<\\/embed>/gi, '');\r\n\t\t\th = h.replace(/<param([^>]*)>/gi, function(a, b) {return '<span ' + b.replace(/value=/gi, '_mce_value=') + ' class=\"mceItemParam\"></span>'});\r\n\t\t\th = h.replace(/\\/ class=\\\"mceItemParam\\\"><\\/span>/gi, 'class=\"mceItemParam\"></span>');\r\n\r\n\t\t\to.content = h;\r\n\t\t},\r\n\r\n\t\t_buildObj : function(o, n) {\r\n\t\t\tvar ob, ed = this.editor, dom = ed.dom, p = this._parse(n.title), stc;\r\n\t\t\t\r\n\t\t\tstc = ed.getParam('media_strict', true) && o.type == 'application/x-shockwave-flash';\r\n\r\n\t\t\tp.width = o.width = dom.getAttrib(n, 'width') || 100;\r\n\t\t\tp.height = o.height = dom.getAttrib(n, 'height') || 100;\r\n\r\n\t\t\tif (p.src)\r\n\t\t\t\tp.src = ed.convertURL(p.src, 'src', n);\r\n\r\n\t\t\tif (stc) {\r\n\t\t\t\tob = dom.create('span', {\r\n\t\t\t\t\tid : p.id,\r\n\t\t\t\t\t_mce_name : 'object',\r\n\t\t\t\t\ttype : 'application/x-shockwave-flash',\r\n\t\t\t\t\tdata : p.src,\r\n\t\t\t\t\tstyle : dom.getAttrib(n, 'style'),\r\n\t\t\t\t\twidth : o.width,\r\n\t\t\t\t\theight : o.height\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tob = dom.create('span', {\r\n\t\t\t\t\tid : p.id,\r\n\t\t\t\t\t_mce_name : 'object',\r\n\t\t\t\t\tclassid : \"clsid:\" + o.classid,\r\n\t\t\t\t\tstyle : dom.getAttrib(n, 'style'),\r\n\t\t\t\t\tcodebase : o.codebase,\r\n\t\t\t\t\twidth : o.width,\r\n\t\t\t\t\theight : o.height\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\teach (p, function(v, k) {\r\n\t\t\t\tif (!/^(width|height|codebase|classid|id|_cx|_cy)$/.test(k)) {\r\n\t\t\t\t\t// Use url instead of src in IE for Windows media\r\n\t\t\t\t\tif (o.type == 'application/x-mplayer2' && k == 'src' && !p.url)\r\n\t\t\t\t\t\tk = 'url';\r\n\r\n\t\t\t\t\tif (v)\r\n\t\t\t\t\t\tdom.add(ob, 'span', {_mce_name : 'param', name : k, '_mce_value' : v});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (!stc)\r\n\t\t\t\tdom.add(ob, 'span', tinymce.extend({_mce_name : 'embed', type : o.type, style : dom.getAttrib(n, 'style')}, p));\r\n\r\n\t\t\treturn ob;\r\n\t\t},\r\n\r\n\t\t_spansToImgs : function(p) {\r\n\t\t\tvar t = this, dom = t.editor.dom, im, ci;\r\n\r\n\t\t\teach(dom.select('span', p), function(n) {\r\n\t\t\t\t// Convert object into image\r\n\t\t\t\tif (dom.getAttrib(n, 'class') == 'mceItemObject') {\r\n\t\t\t\t\tci = dom.getAttrib(n, \"classid\").toLowerCase().replace(/\\s+/g, '');\r\n\r\n\t\t\t\t\tswitch (ci) {\r\n\t\t\t\t\t\tcase 'clsid:d27cdb6e-ae6d-11cf-96b8-444553540000':\r\n\t\t\t\t\t\t\tdom.replace(t._createImg('mceItemFlash', n), n);\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 'clsid:166b1bca-3f9c-11cf-8075-444553540000':\r\n\t\t\t\t\t\t\tdom.replace(t._createImg('mceItemShockWave', n), n);\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 'clsid:6bf52a52-394a-11d3-b153-00c04f79faa6':\r\n\t\t\t\t\t\tcase 'clsid:22d6f312-b0f6-11d0-94ab-0080c74c7e95':\r\n\t\t\t\t\t\tcase 'clsid:05589fa1-c356-11ce-bf01-00aa0055595a':\r\n\t\t\t\t\t\t\tdom.replace(t._createImg('mceItemWindowsMedia', n), n);\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 'clsid:02bf25d5-8c17-4b23-bc80-d3488abddc6b':\r\n\t\t\t\t\t\t\tdom.replace(t._createImg('mceItemQuickTime', n), n);\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 'clsid:cfcdaa03-8be4-11cf-b84b-0020afbbccfa':\r\n\t\t\t\t\t\t\tdom.replace(t._createImg('mceItemRealMedia', n), n);\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tdom.replace(t._createImg('mceItemFlash', n), n);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Convert embed into image\r\n\t\t\t\tif (dom.getAttrib(n, 'class') == 'mceItemEmbed') {\r\n\t\t\t\t\tswitch (dom.getAttrib(n, 'type')) {\r\n\t\t\t\t\t\tcase 'application/x-shockwave-flash':\r\n\t\t\t\t\t\t\tdom.replace(t._createImg('mceItemFlash', n), n);\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 'application/x-director':\r\n\t\t\t\t\t\t\tdom.replace(t._createImg('mceItemShockWave', n), n);\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 'application/x-mplayer2':\r\n\t\t\t\t\t\t\tdom.replace(t._createImg('mceItemWindowsMedia', n), n);\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 'video/quicktime':\r\n\t\t\t\t\t\t\tdom.replace(t._createImg('mceItemQuickTime', n), n);\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 'audio/x-pn-realaudio-plugin':\r\n\t\t\t\t\t\t\tdom.replace(t._createImg('mceItemRealMedia', n), n);\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tdom.replace(t._createImg('mceItemFlash', n), n);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\t\t\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_createImg : function(cl, n) {\r\n\t\t\tvar im, dom = this.editor.dom, pa = {}, ti = '', args;\r\n\r\n\t\t\targs = ['id', 'name', 'width', 'height', 'bgcolor', 'align', 'flashvars', 'src', 'wmode', 'allowfullscreen', 'quality', 'data'];\t\r\n\r\n\t\t\t// Create image\r\n\t\t\tim = dom.create('img', {\r\n\t\t\t\tsrc : this.url + '/img/trans.gif',\r\n\t\t\t\twidth : dom.getAttrib(n, 'width') || 100,\r\n\t\t\t\theight : dom.getAttrib(n, 'height') || 100,\r\n\t\t\t\tstyle : dom.getAttrib(n, 'style'),\r\n\t\t\t\t'class' : cl\r\n\t\t\t});\r\n\r\n\t\t\t// Setup base parameters\r\n\t\t\teach(args, function(na) {\r\n\t\t\t\tvar v = dom.getAttrib(n, na);\r\n\r\n\t\t\t\tif (v)\r\n\t\t\t\t\tpa[na] = v;\r\n\t\t\t});\r\n\r\n\t\t\t// Add optional parameters\r\n\t\t\teach(dom.select('span', n), function(n) {\r\n\t\t\t\tif (dom.hasClass(n, 'mceItemParam'))\r\n\t\t\t\t\tpa[dom.getAttrib(n, 'name')] = dom.getAttrib(n, '_mce_value');\r\n\t\t\t});\r\n\r\n\t\t\t// Use src not movie\r\n\t\t\tif (pa.movie) {\r\n\t\t\t\tpa.src = pa.movie;\r\n\t\t\t\tdelete pa.movie;\r\n\t\t\t}\r\n\r\n\t\t\t// No src try data\r\n\t\t\tif (!pa.src) {\r\n\t\t\t\tpa.src = pa.data;\r\n\t\t\t\tdelete pa.data;\r\n\t\t\t}\r\n\r\n\t\t\t// Merge with embed args\r\n\t\t\tn = dom.select('.mceItemEmbed', n)[0];\r\n\t\t\tif (n) {\r\n\t\t\t\teach(args, function(na) {\r\n\t\t\t\t\tvar v = dom.getAttrib(n, na);\r\n\r\n\t\t\t\t\tif (v && !pa[na])\r\n\t\t\t\t\t\tpa[na] = v;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tdelete pa.width;\r\n\t\t\tdelete pa.height;\r\n\r\n\t\t\tim.title = this._serialize(pa);\r\n\r\n\t\t\treturn im;\r\n\t\t},\r\n\r\n\t\t_parse : function(s) {\r\n\t\t\treturn tinymce.util.JSON.parse('{' + s + '}');\r\n\t\t},\r\n\r\n\t\t_serialize : function(o) {\r\n\t\t\treturn tinymce.util.JSON.serialize(o).replace(/[{}]/g, '');\r\n\t\t}\r\n\t});\r\n\r\n\t// Register plugin\r\n\ttinymce.PluginManager.add('media', tinymce.plugins.MediaPlugin);\r\n})();/**\r\n * editor_plugin_src.js\r\n *\r\n * Copyright 2009, Moxiecode Systems AB\r\n * Released under LGPL License.\r\n *\r\n * License: http://tinymce.moxiecode.com/license\r\n * Contributing: http://tinymce.moxiecode.com/contributing\r\n */\r\n\r\n(function() {\r\n\ttinymce.create('tinymce.plugins.SearchReplacePlugin', {\r\n\t\tinit : function(ed, url) {\r\n\t\t\tfunction open(m) {\r\n\t\t\t\ted.windowManager.open({\r\n\t\t\t\t\tfile : url + '/searchreplace.htm',\r\n\t\t\t\t\twidth : 420 + parseInt(ed.getLang('searchreplace.delta_width', 0)),\r\n\t\t\t\t\theight : 170 + parseInt(ed.getLang('searchreplace.delta_height', 0)),\r\n\t\t\t\t\tinline : 1,\r\n\t\t\t\t\tauto_focus : 0\r\n\t\t\t\t}, {\r\n\t\t\t\t\tmode : m,\r\n\t\t\t\t\tsearch_string : ed.selection.getContent({format : 'text'}),\r\n\t\t\t\t\tplugin_url : url\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\t// Register commands\r\n\t\t\ted.addCommand('mceSearch', function() {\r\n\t\t\t\topen('search');\r\n\t\t\t});\r\n\r\n\t\t\ted.addCommand('mceReplace', function() {\r\n\t\t\t\topen('replace');\r\n\t\t\t});\r\n\r\n\t\t\t// Register buttons\r\n\t\t\ted.addButton('search', {title : 'searchreplace.search_desc', cmd : 'mceSearch'});\r\n\t\t\ted.addButton('replace', {title : 'searchreplace.replace_desc', cmd : 'mceReplace'});\r\n\r\n\t\t\ted.addShortcut('ctrl+f', 'searchreplace.search_desc', 'mceSearch');\r\n\t\t},\r\n\r\n\t\tgetInfo : function() {\r\n\t\t\treturn {\r\n\t\t\t\tlongname : 'Search/Replace',\r\n\t\t\t\tauthor : 'Moxiecode Systems AB',\r\n\t\t\t\tauthorurl : 'http://tinymce.moxiecode.com',\r\n\t\t\t\tinfourl : 'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/searchreplace',\r\n\t\t\t\tversion : tinymce.majorVersion + \".\" + tinymce.minorVersion\r\n\t\t\t};\r\n\t\t}\r\n\t});\r\n\r\n\t// Register plugin\r\n\ttinymce.PluginManager.add('searchreplace', tinymce.plugins.SearchReplacePlugin);\r\n})();/**\r\n * editor_plugin_src.js\r\n *\r\n * Copyright 2009, Moxiecode Systems AB\r\n * Released under LGPL License.\r\n *\r\n * License: http://tinymce.moxiecode.com/license\r\n * Contributing: http://tinymce.moxiecode.com/contributing\r\n */\r\n\r\n(function() {\r\n\ttinymce.create('tinymce.plugins.Print', {\r\n\t\tinit : function(ed, url) {\r\n\t\t\ted.addCommand('mcePrint', function() {\r\n\t\t\t\ted.getWin().print();\r\n\t\t\t});\r\n\r\n\t\t\ted.addButton('print', {title : 'print.print_desc', cmd : 'mcePrint'});\r\n\t\t},\r\n\r\n\t\tgetInfo : function() {\r\n\t\t\treturn {\r\n\t\t\t\tlongname : 'Print',\r\n\t\t\t\tauthor : 'Moxiecode Systems AB',\r\n\t\t\t\tauthorurl : 'http://tinymce.moxiecode.com',\r\n\t\t\t\tinfourl : 'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/print',\r\n\t\t\t\tversion : tinymce.majorVersion + \".\" + tinymce.minorVersion\r\n\t\t\t};\r\n\t\t}\r\n\t});\r\n\r\n\t// Register plugin\r\n\ttinymce.PluginManager.add('print', tinymce.plugins.Print);\r\n})();\r\n/**\r\n * editor_plugin_src.js\r\n *\r\n * Copyright 2009, Moxiecode Systems AB\r\n * Released under LGPL License.\r\n *\r\n * License: http://tinymce.moxiecode.com/license\r\n * Contributing: http://tinymce.moxiecode.com/contributing\r\n */\r\n\r\n(function() {\r\n\tvar Event = tinymce.dom.Event, each = tinymce.each, DOM = tinymce.DOM;\r\n\r\n\t/**\r\n\t * This plugin a context menu to TinyMCE editor instances.\r\n\t *\r\n\t * @class tinymce.plugins.ContextMenu\r\n\t */\r\n\ttinymce.create('tinymce.plugins.ContextMenu', {\r\n\t\t/**\r\n\t\t * Initializes the plugin, this will be executed after the plugin has been created.\r\n\t\t * This call is done before the editor instance has finished it's initialization so use the onInit event\r\n\t\t * of the editor instance to intercept that event.\r\n\t\t *\r\n\t\t * @method init\r\n\t\t * @param {tinymce.Editor} ed Editor instance that the plugin is initialized in.\r\n\t\t * @param {string} url Absolute URL to where the plugin is located.\r\n\t\t */\r\n\t\tinit : function(ed) {\r\n\t\t\tvar t = this, lastRng;\r\n\r\n\t\t\tt.editor = ed;\r\n\r\n\t\t\t/**\r\n\t\t\t * This event gets fired when the context menu is shown.\r\n\t\t\t *\r\n\t\t\t * @event onContextMenu\r\n\t\t\t * @param {tinymce.plugins.ContextMenu} sender Plugin instance sending the event.\r\n\t\t\t * @param {tinymce.ui.DropMenu} menu Drop down menu to fill with more items if needed.\r\n\t\t\t */\r\n\t\t\tt.onContextMenu = new tinymce.util.Dispatcher(this);\r\n\r\n\t\t\ted.onContextMenu.add(function(ed, e) {\r\n\t\t\t\tif (!e.ctrlKey) {\r\n\t\t\t\t\t// Restore the last selection since it was removed\r\n\t\t\t\t\tif (lastRng)\r\n\t\t\t\t\t\ted.selection.setRng(lastRng);\r\n\r\n\t\t\t\t\tt._getMenu(ed).showMenu(e.clientX, e.clientY);\r\n\t\t\t\t\tEvent.add(ed.getDoc(), 'click', function(e) {\r\n\t\t\t\t\t\thide(ed, e);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tEvent.cancel(e);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\ted.onRemove.add(function() {\r\n\t\t\t\tif (t._menu)\r\n\t\t\t\t\tt._menu.removeAll();\r\n\t\t\t});\r\n\r\n\t\t\tfunction hide(ed, e) {\r\n\t\t\t\tlastRng = null;\r\n\r\n\t\t\t\t// Since the contextmenu event moves\r\n\t\t\t\t// the selection we need to store it away\r\n\t\t\t\tif (e && e.button == 2) {\r\n\t\t\t\t\tlastRng = ed.selection.getRng();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (t._menu) {\r\n\t\t\t\t\tt._menu.removeAll();\r\n\t\t\t\t\tt._menu.destroy();\r\n\t\t\t\t\tEvent.remove(ed.getDoc(), 'click', hide);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\ted.onMouseDown.add(hide);\r\n\t\t\ted.onKeyDown.add(hide);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns information about the plugin as a name/value array.\r\n\t\t * The current keys are longname, author, authorurl, infourl and version.\r\n\t\t *\r\n\t\t * @method getInfo\r\n\t\t * @return {Object} Name/value array containing information about the plugin.\r\n\t\t */\r\n\t\tgetInfo : function() {\r\n\t\t\treturn {\r\n\t\t\t\tlongname : 'Contextmenu',\r\n\t\t\t\tauthor : 'Moxiecode Systems AB',\r\n\t\t\t\tauthorurl : 'http://tinymce.moxiecode.com',\r\n\t\t\t\tinfourl : 'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/contextmenu',\r\n\t\t\t\tversion : tinymce.majorVersion + \".\" + tinymce.minorVersion\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\t_getMenu : function(ed) {\r\n\t\t\tvar t = this, m = t._menu, se = ed.selection, col = se.isCollapsed(), el = se.getNode() || ed.getBody(), am, p1, p2;\r\n\r\n\t\t\tif (m) {\r\n\t\t\t\tm.removeAll();\r\n\t\t\t\tm.destroy();\r\n\t\t\t}\r\n\r\n\t\t\tp1 = DOM.getPos(ed.getContentAreaContainer());\r\n\t\t\tp2 = DOM.getPos(ed.getContainer());\r\n\r\n\t\t\tm = ed.controlManager.createDropMenu('contextmenu', {\r\n\t\t\t\toffset_x : p1.x + ed.getParam('contextmenu_offset_x', 0),\r\n\t\t\t\toffset_y : p1.y + ed.getParam('contextmenu_offset_y', 0),\r\n\t\t\t\tconstrain : 1\r\n\t\t\t});\r\n\r\n\t\t\tt._menu = m;\r\n\r\n\t\t\tm.add({title : 'advanced.cut_desc', icon : 'cut', cmd : 'Cut'}).setDisabled(col);\r\n\t\t\tm.add({title : 'advanced.copy_desc', icon : 'copy', cmd : 'Copy'}).setDisabled(col);\r\n\t\t\tm.add({title : 'advanced.paste_desc', icon : 'paste', cmd : 'Paste'});\r\n\r\n\t\t\tif ((el.nodeName == 'A' && !ed.dom.getAttrib(el, 'name')) || !col) {\r\n\t\t\t\tm.addSeparator();\r\n\t\t\t\tm.add({title : 'advanced.link_desc', icon : 'link', cmd : ed.plugins.advlink ? 'mceAdvLink' : 'mceLink', ui : true});\r\n\t\t\t\tm.add({title : 'advanced.unlink_desc', icon : 'unlink', cmd : 'UnLink'});\r\n\t\t\t}\r\n\r\n\t\t\tm.addSeparator();\r\n\t\t\tm.add({title : 'advanced.image_desc', icon : 'image', cmd : ed.plugins.advimage ? 'mceAdvImage' : 'mceImage', ui : true});\r\n\r\n\t\t\tm.addSeparator();\r\n\t\t\tam = m.addMenu({title : 'contextmenu.align'});\r\n\t\t\tam.add({title : 'contextmenu.left', icon : 'justifyleft', cmd : 'JustifyLeft'});\r\n\t\t\tam.add({title : 'contextmenu.center', icon : 'justifycenter', cmd : 'JustifyCenter'});\r\n\t\t\tam.add({title : 'contextmenu.right', icon : 'justifyright', cmd : 'JustifyRight'});\r\n\t\t\tam.add({title : 'contextmenu.full', icon : 'justifyfull', cmd : 'JustifyFull'});\r\n\r\n\t\t\tt.onContextMenu.dispatch(t, m, el, col);\r\n\r\n\t\t\treturn m;\r\n\t\t}\r\n\t});\r\n\r\n\t// Register plugin\r\n\ttinymce.PluginManager.add('contextmenu', tinymce.plugins.ContextMenu);\r\n})();/**\r\n * editor_plugin_src.js\r\n *\r\n * Copyright 2009, Moxiecode Systems AB\r\n * Released under LGPL License.\r\n *\r\n * License: http://tinymce.moxiecode.com/license\r\n * Contributing: http://tinymce.moxiecode.com/contributing\r\n */\r\n\r\n(function() {\r\n\tvar each = tinymce.each,\r\n\t\tentities = null,\r\n\t\tdefs = {\r\n\t\t\tpaste_auto_cleanup_on_paste : true,\r\n\t\t\tpaste_block_drop : false,\r\n\t\t\tpaste_retain_style_properties : \"none\",\r\n\t\t\tpaste_strip_class_attributes : \"mso\",\r\n\t\t\tpaste_remove_spans : false,\r\n\t\t\tpaste_remove_styles : false,\r\n\t\t\tpaste_remove_styles_if_webkit : true,\r\n\t\t\tpaste_convert_middot_lists : true,\r\n\t\t\tpaste_convert_headers_to_strong : false,\r\n\t\t\tpaste_dialog_width : \"450\",\r\n\t\t\tpaste_dialog_height : \"400\",\r\n\t\t\tpaste_text_use_dialog : false,\r\n\t\t\tpaste_text_sticky : false,\r\n\t\t\tpaste_text_notifyalways : false,\r\n\t\t\tpaste_text_linebreaktype : \"p\",\r\n\t\t\tpaste_text_replacements : [\r\n\t\t\t\t[/\\u2026/g, \"...\"],\r\n\t\t\t\t[/[\\x93\\x94\\u201c\\u201d]/g, '\"'],\r\n\t\t\t\t[/[\\x60\\x91\\x92\\u2018\\u2019]/g, \"'\"]\r\n\t\t\t]\r\n\t\t};\r\n\r\n\tfunction getParam(ed, name) {\r\n\t\treturn ed.getParam(name, defs[name]);\r\n\t}\r\n\r\n\ttinymce.create('tinymce.plugins.PastePlugin', {\r\n\t\tinit : function(ed, url) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tt.editor = ed;\r\n\t\t\tt.url = url;\r\n\r\n\t\t\t// Setup plugin events\r\n\t\t\tt.onPreProcess = new tinymce.util.Dispatcher(t);\r\n\t\t\tt.onPostProcess = new tinymce.util.Dispatcher(t);\r\n\r\n\t\t\t// Register default handlers\r\n\t\t\tt.onPreProcess.add(t._preProcess);\r\n\t\t\tt.onPostProcess.add(t._postProcess);\r\n\r\n\t\t\t// Register optional preprocess handler\r\n\t\t\tt.onPreProcess.add(function(pl, o) {\r\n\t\t\t\ted.execCallback('paste_preprocess', pl, o);\r\n\t\t\t});\r\n\r\n\t\t\t// Register optional postprocess\r\n\t\t\tt.onPostProcess.add(function(pl, o) {\r\n\t\t\t\ted.execCallback('paste_postprocess', pl, o);\r\n\t\t\t});\r\n\r\n\t\t\t// Initialize plain text flag\r\n\t\t\ted.pasteAsPlainText = false;\r\n\r\n\t\t\t// This function executes the process handlers and inserts the contents\r\n\t\t\t// force_rich overrides plain text mode set by user, important for pasting with execCommand\r\n\t\t\tfunction process(o, force_rich) {\r\n\t\t\t\tvar dom = ed.dom;\r\n\r\n\t\t\t\t// Execute pre process handlers\r\n\t\t\t\tt.onPreProcess.dispatch(t, o);\r\n\r\n\t\t\t\t// Create DOM structure\r\n\t\t\t\to.node = dom.create('div', 0, o.content);\r\n\r\n\t\t\t\t// Execute post process handlers\r\n\t\t\t\tt.onPostProcess.dispatch(t, o);\r\n\r\n\t\t\t\t// Serialize content\r\n\t\t\t\to.content = ed.serializer.serialize(o.node, {getInner : 1});\r\n\r\n\t\t\t\t// Plain text option active?\r\n\t\t\t\tif ((!force_rich) && (ed.pasteAsPlainText)) {\r\n\t\t\t\t\tt._insertPlainText(ed, dom, o.content);\r\n\r\n\t\t\t\t\tif (!getParam(ed, \"paste_text_sticky\")) {\r\n\t\t\t\t\t\ted.pasteAsPlainText = false;\r\n\t\t\t\t\t\ted.controlManager.setActive(\"pastetext\", false);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (/<(p|h[1-6]|ul|ol)/.test(o.content)) {\r\n\t\t\t\t\t// Handle insertion of contents containing block elements separately\r\n\t\t\t\t\tt._insertBlockContent(ed, dom, o.content);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tt._insert(o.content);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Add command for external usage\r\n\t\t\ted.addCommand('mceInsertClipboardContent', function(u, o) {\r\n\t\t\t\tprocess(o, true);\r\n\t\t\t});\r\n\r\n\t\t\tif (!getParam(ed, \"paste_text_use_dialog\")) {\r\n\t\t\t\ted.addCommand('mcePasteText', function(u, v) {\r\n\t\t\t\t\tvar cookie = tinymce.util.Cookie;\r\n\r\n\t\t\t\t\ted.pasteAsPlainText = !ed.pasteAsPlainText;\r\n\t\t\t\t\ted.controlManager.setActive('pastetext', ed.pasteAsPlainText);\r\n\r\n\t\t\t\t\tif ((ed.pasteAsPlainText) && (!cookie.get(\"tinymcePasteText\"))) {\r\n\t\t\t\t\t\tif (getParam(ed, \"paste_text_sticky\")) {\r\n\t\t\t\t\t\t\ted.windowManager.alert(ed.translate('paste.plaintext_mode_sticky'));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ted.windowManager.alert(ed.translate('paste.plaintext_mode_sticky'));\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (!getParam(ed, \"paste_text_notifyalways\")) {\r\n\t\t\t\t\t\t\tcookie.set(\"tinymcePasteText\", \"1\", new Date(new Date().getFullYear() + 1, 12, 31))\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\ted.addButton('pastetext', {title: 'paste.paste_text_desc', cmd: 'mcePasteText'});\r\n\t\t\ted.addButton('selectall', {title: 'paste.selectall_desc', cmd: 'selectall'});\r\n\r\n\t\t\t// This function grabs the contents from the clipboard by adding a\r\n\t\t\t// hidden div and placing the caret inside it and after the browser paste\r\n\t\t\t// is done it grabs that contents and processes that\r\n\t\t\tfunction grabContent(e) {\r\n\t\t\t\tvar n, or, rng, sel = ed.selection, dom = ed.dom, body = ed.getBody(), posY;\r\n\r\n\t\t\t\t// Check if browser supports direct plaintext access\r\n\t\t\t\tif (ed.pasteAsPlainText && (e.clipboardData || dom.doc.dataTransfer)) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tprocess({content : (e.clipboardData || dom.doc.dataTransfer).getData('Text')}, true);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (dom.get('_mcePaste'))\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t// Create container to paste into\r\n\t\t\t\tn = dom.add(body, 'div', {id : '_mcePaste', 'class' : 'mcePaste'}, '\\uFEFF<br _mce_bogus=\"1\">');\r\n\r\n\t\t\t\t// If contentEditable mode we need to find out the position of the closest element\r\n\t\t\t\tif (body != ed.getDoc().body)\r\n\t\t\t\t\tposY = dom.getPos(ed.selection.getStart(), body).y;\r\n\t\t\t\telse\r\n\t\t\t\t\tposY = body.scrollTop;\r\n\r\n\t\t\t\t// Styles needs to be applied after the element is added to the document since WebKit will otherwise remove all styles\r\n\t\t\t\tdom.setStyles(n, {\r\n\t\t\t\t\tposition : 'absolute',\r\n\t\t\t\t\tleft : -10000,\r\n\t\t\t\t\ttop : posY,\r\n\t\t\t\t\twidth : 1,\r\n\t\t\t\t\theight : 1,\r\n\t\t\t\t\toverflow : 'hidden'\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (tinymce.isIE) {\r\n\t\t\t\t\t// Select the container\r\n\t\t\t\t\trng = dom.doc.body.createTextRange();\r\n\t\t\t\t\trng.moveToElementText(n);\r\n\t\t\t\t\trng.execCommand('Paste');\r\n\r\n\t\t\t\t\t// Remove container\r\n\t\t\t\t\tdom.remove(n);\r\n\r\n\t\t\t\t\t// Check if the contents was changed, if it wasn't then clipboard extraction failed probably due\r\n\t\t\t\t\t// to IE security settings so we pass the junk though better than nothing right\r\n\t\t\t\t\tif (n.innerHTML === '\\uFEFF') {\r\n\t\t\t\t\t\ted.execCommand('mcePasteWord');\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Process contents\r\n\t\t\t\t\tprocess({content : n.innerHTML});\r\n\r\n\t\t\t\t\t// Block the real paste event\r\n\t\t\t\t\treturn tinymce.dom.Event.cancel(e);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfunction block(e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\t// Block mousedown and click to prevent selection change\r\n\t\t\t\t\tdom.bind(ed.getDoc(), 'mousedown', block);\r\n\t\t\t\t\tdom.bind(ed.getDoc(), 'keydown', block);\r\n\r\n\t\t\t\t\tor = ed.selection.getRng();\r\n\r\n\t\t\t\t\t// Move caret into hidden div\r\n\t\t\t\t\tn = n.firstChild;\r\n\t\t\t\t\trng = ed.getDoc().createRange();\r\n\t\t\t\t\trng.setStart(n, 0);\r\n\t\t\t\t\trng.setEnd(n, 1);\r\n\t\t\t\t\tsel.setRng(rng);\r\n\r\n\t\t\t\t\t// Wait a while and grab the pasted contents\r\n\t\t\t\t\twindow.setTimeout(function() {\r\n\t\t\t\t\t\tvar h = '', nl = dom.select('div.mcePaste');\r\n\r\n\t\t\t\t\t\t// WebKit will split the div into multiple ones so this will loop through then all and join them to get the whole HTML string\r\n\t\t\t\t\t\teach(nl, function(n) {\r\n\t\t\t\t\t\t\tvar child = n.firstChild;\r\n\r\n\t\t\t\t\t\t\t// WebKit inserts a DIV container with lots of odd styles\r\n\t\t\t\t\t\t\tif (child && child.nodeName == 'DIV' && child.style.marginTop && child.style.backgroundColor) {\r\n\t\t\t\t\t\t\t\tdom.remove(child, 1);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// WebKit duplicates the divs so we need to remove them\r\n\t\t\t\t\t\t\teach(dom.select('div.mcePaste', n), function(n) {\r\n\t\t\t\t\t\t\t\tdom.remove(n, 1);\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t// Remove apply style spans\r\n\t\t\t\t\t\t\teach(dom.select('span.Apple-style-span', n), function(n) {\r\n\t\t\t\t\t\t\t\tdom.remove(n, 1);\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t// Remove bogus br elements\r\n\t\t\t\t\t\t\teach(dom.select('br[_mce_bogus]', n), function(n) {\r\n\t\t\t\t\t\t\t\tdom.remove(n);\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\th += n.innerHTML;\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t// Remove the nodes\r\n\t\t\t\t\t\teach(nl, function(n) {\r\n\t\t\t\t\t\t\tdom.remove(n);\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t// Restore the old selection\r\n\t\t\t\t\t\tif (or)\r\n\t\t\t\t\t\t\tsel.setRng(or);\r\n\r\n\t\t\t\t\t\tprocess({content : h});\r\n\r\n\t\t\t\t\t\t// Unblock events ones we got the contents\r\n\t\t\t\t\t\tdom.unbind(ed.getDoc(), 'mousedown', block);\r\n\t\t\t\t\t\tdom.unbind(ed.getDoc(), 'keydown', block);\r\n\t\t\t\t\t}, 0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Check if we should use the new auto process method\t\t\t\r\n\t\t\tif (getParam(ed, \"paste_auto_cleanup_on_paste\")) {\r\n\t\t\t\t// Is it's Opera or older FF use key handler\r\n\t\t\t\tif (tinymce.isOpera || /Firefox\\/2/.test(navigator.userAgent)) {\r\n\t\t\t\t\ted.onKeyDown.add(function(ed, e) {\r\n\t\t\t\t\t\tif (((tinymce.isMac ? e.metaKey : e.ctrlKey) && e.keyCode == 86) || (e.shiftKey && e.keyCode == 45))\r\n\t\t\t\t\t\t\tgrabContent(e);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Grab contents on paste event on Gecko and WebKit\r\n\t\t\t\t\ted.onPaste.addToTop(function(ed, e) {\r\n\t\t\t\t\t\treturn grabContent(e);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Block all drag/drop events\r\n\t\t\tif (getParam(ed, \"paste_block_drop\")) {\r\n\t\t\t\ted.onInit.add(function() {\r\n\t\t\t\t\ted.dom.bind(ed.getBody(), ['dragend', 'dragover', 'draggesture', 'dragdrop', 'drop', 'drag'], function(e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\te.stopPropagation();\r\n\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Add legacy support\r\n\t\t\tt._legacySupport();\r\n\t\t},\r\n\r\n\t\tgetInfo : function() {\r\n\t\t\treturn {\r\n\t\t\t\tlongname : 'Paste text/word',\r\n\t\t\t\tauthor : 'Moxiecode Systems AB',\r\n\t\t\t\tauthorurl : 'http://tinymce.moxiecode.com',\r\n\t\t\t\tinfourl : 'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/paste',\r\n\t\t\t\tversion : tinymce.majorVersion + \".\" + tinymce.minorVersion\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\t_preProcess : function(pl, o) {\r\n\t\t\t//console.log('Before preprocess:' + o.content);\r\n\r\n\t\t\tvar ed = this.editor,\r\n\t\t\t\th = o.content,\r\n\t\t\t\tgrep = tinymce.grep,\r\n\t\t\t\texplode = tinymce.explode,\r\n\t\t\t\ttrim = tinymce.trim,\r\n\t\t\t\tlen, stripClass;\r\n\r\n\t\t\tfunction process(items) {\r\n\t\t\t\teach(items, function(v) {\r\n\t\t\t\t\t// Remove or replace\r\n\t\t\t\t\tif (v.constructor == RegExp)\r\n\t\t\t\t\t\th = h.replace(v, '');\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\th = h.replace(v[0], v[1]);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Detect Word content and process it more aggressive\r\n\t\t\tif (/class=\"?Mso|style=\"[^\"]*\\bmso-|w:WordDocument/i.test(h) || o.wordContent) {\r\n\t\t\t\to.wordContent = true;\t\t\t// Mark the pasted contents as word specific content\r\n\t\t\t\t//console.log('Word contents detected.');\r\n\r\n\t\t\t\t// Process away some basic content\r\n\t\t\t\tprocess([\r\n\t\t\t\t\t/^\\s*(&nbsp;)+/gi,\t\t\t\t// &nbsp; entities at the start of contents\r\n\t\t\t\t\t/(&nbsp;|<br[^>]*>)+\\s*$/gi\t\t// &nbsp; entities at the end of contents\r\n\t\t\t\t]);\r\n\r\n\t\t\t\tif (getParam(ed, \"paste_convert_headers_to_strong\")) {\r\n\t\t\t\t\th = h.replace(/<p [^>]*class=\"?MsoHeading\"?[^>]*>(.*?)<\\/p>/gi, \"<p><strong>$1</strong></p>\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (getParam(ed, \"paste_convert_middot_lists\")) {\r\n\t\t\t\t\tprocess([\r\n\t\t\t\t\t\t[/<!--\\[if !supportLists\\]-->/gi, '$&__MCE_ITEM__'],\t\t\t\t\t// Convert supportLists to a list item marker\r\n\t\t\t\t\t\t[/(<span[^>]+(?:mso-list:|:\\s*symbol)[^>]+>)/gi, '$1__MCE_ITEM__']\t\t// Convert mso-list and symbol spans to item markers\r\n\t\t\t\t\t]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tprocess([\r\n\t\t\t\t\t// Word comments like conditional comments etc\r\n\t\t\t\t\t/<!--[\\s\\S]+?-->/gi,\r\n\r\n\t\t\t\t\t// Remove comments, scripts (e.g., msoShowComment), XML tag, VML content, MS Office namespaced tags, and a few other tags\r\n\t\t\t\t\t/<(!|script[^>]*>.*?<\\/script(?=[>\\s])|\\/?(\\?xml(:\\w+)?|img|meta|link|style|\\w:\\w+)(?=[\\s\\/>]))[^>]*>/gi,\r\n\r\n\t\t\t\t\t// Convert <s> into <strike> for line-though\r\n\t\t\t\t\t[/<(\\/?)s>/gi, \"<$1strike>\"],\r\n\r\n\t\t\t\t\t// Replace nsbp entites to char since it's easier to handle\r\n\t\t\t\t\t[/&nbsp;/gi, \"\\u00a0\"]\r\n\t\t\t\t]);\r\n\r\n\t\t\t\t// Remove bad attributes, with or without quotes, ensuring that attribute text is really inside a tag.\r\n\t\t\t\t// If JavaScript had a RegExp look-behind, we could have integrated this with the last process() array and got rid of the loop. But alas, it does not, so we cannot.\r\n\t\t\t\tdo {\r\n\t\t\t\t\tlen = h.length;\r\n\t\t\t\t\th = h.replace(/(<[a-z][^>]*\\s)(?:id|name|language|type|on\\w+|\\w+:\\w+)=(?:\"[^\"]*\"|\\w+)\\s?/gi, \"$1\");\r\n\t\t\t\t} while (len != h.length);\r\n\r\n\t\t\t\t// Remove all spans if no styles is to be retained\r\n\t\t\t\tif (getParam(ed, \"paste_retain_style_properties\").replace(/^none$/i, \"\").length == 0) {\r\n\t\t\t\t\th = h.replace(/<\\/?span[^>]*>/gi, \"\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// We're keeping styles, so at least clean them up.\r\n\t\t\t\t\t// CSS Reference: http://msdn.microsoft.com/en-us/library/aa155477.aspx\r\n\r\n\t\t\t\t\tprocess([\r\n\t\t\t\t\t\t// Convert <span style=\"mso-spacerun:yes\">___</span> to string of alternating breaking/non-breaking spaces of same length\r\n\t\t\t\t\t\t[/<span\\s+style\\s*=\\s*\"\\s*mso-spacerun\\s*:\\s*yes\\s*;?\\s*\"\\s*>([\\s\\u00a0]*)<\\/span>/gi,\r\n\t\t\t\t\t\t\tfunction(str, spaces) {\r\n\t\t\t\t\t\t\t\treturn (spaces.length > 0)? spaces.replace(/./, \" \").slice(Math.floor(spaces.length/2)).split(\"\").join(\"\\u00a0\") : \"\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t],\r\n\r\n\t\t\t\t\t\t// Examine all styles: delete junk, transform some, and keep the rest\r\n\t\t\t\t\t\t[/(<[a-z][^>]*)\\sstyle=\"([^\"]*)\"/gi,\r\n\t\t\t\t\t\t\tfunction(str, tag, style) {\r\n\t\t\t\t\t\t\t\tvar n = [],\r\n\t\t\t\t\t\t\t\t\ti = 0,\r\n\t\t\t\t\t\t\t\t\ts = explode(trim(style).replace(/&quot;/gi, \"'\"), \";\");\r\n\r\n\t\t\t\t\t\t\t\t// Examine each style definition within the tag's style attribute\r\n\t\t\t\t\t\t\t\teach(s, function(v) {\r\n\t\t\t\t\t\t\t\t\tvar name, value,\r\n\t\t\t\t\t\t\t\t\t\tparts = explode(v, \":\");\r\n\r\n\t\t\t\t\t\t\t\t\tfunction ensureUnits(v) {\r\n\t\t\t\t\t\t\t\t\t\treturn v + ((v !== \"0\") && (/\\d$/.test(v)))? \"px\" : \"\";\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tif (parts.length == 2) {\r\n\t\t\t\t\t\t\t\t\t\tname = parts[0].toLowerCase();\r\n\t\t\t\t\t\t\t\t\t\tvalue = parts[1].toLowerCase();\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Translate certain MS Office styles into their CSS equivalents\r\n\t\t\t\t\t\t\t\t\t\tswitch (name) {\r\n\t\t\t\t\t\t\t\t\t\t\tcase \"mso-padding-alt\":\r\n\t\t\t\t\t\t\t\t\t\t\tcase \"mso-padding-top-alt\":\r\n\t\t\t\t\t\t\t\t\t\t\tcase \"mso-padding-right-alt\":\r\n\t\t\t\t\t\t\t\t\t\t\tcase \"mso-padding-bottom-alt\":\r\n\t\t\t\t\t\t\t\t\t\t\tcase \"mso-padding-left-alt\":\r\n\t\t\t\t\t\t\t\t\t\t\tcase \"mso-margin-alt\":\r\n\t\t\t\t\t\t\t\t\t\t\tcase \"mso-margin-top-alt\":\r\n\t\t\t\t\t\t\t\t\t\t\tcase \"mso-margin-right-alt\":\r\n\t\t\t\t\t\t\t\t\t\t\tcase \"mso-margin-bottom-alt\":\r\n\t\t\t\t\t\t\t\t\t\t\tcase \"mso-margin-left-alt\":\r\n\t\t\t\t\t\t\t\t\t\t\tcase \"mso-table-layout-alt\":\r\n\t\t\t\t\t\t\t\t\t\t\tcase \"mso-height\":\r\n\t\t\t\t\t\t\t\t\t\t\tcase \"mso-width\":\r\n\t\t\t\t\t\t\t\t\t\t\tcase \"mso-vertical-align-alt\":\r\n\t\t\t\t\t\t\t\t\t\t\t\tn[i++] = name.replace(/^mso-|-alt$/g, \"\") + \":\" + ensureUnits(value);\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tcase \"horiz-align\":\r\n\t\t\t\t\t\t\t\t\t\t\t\tn[i++] = \"text-align:\" + value;\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tcase \"vert-align\":\r\n\t\t\t\t\t\t\t\t\t\t\t\tn[i++] = \"vertical-align:\" + value;\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tcase \"font-color\":\r\n\t\t\t\t\t\t\t\t\t\t\tcase \"mso-foreground\":\r\n\t\t\t\t\t\t\t\t\t\t\t\tn[i++] = \"color:\" + value;\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tcase \"mso-background\":\r\n\t\t\t\t\t\t\t\t\t\t\tcase \"mso-highlight\":\r\n\t\t\t\t\t\t\t\t\t\t\t\tn[i++] = \"background:\" + value;\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tcase \"mso-default-height\":\r\n\t\t\t\t\t\t\t\t\t\t\t\tn[i++] = \"min-height:\" + ensureUnits(value);\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tcase \"mso-default-width\":\r\n\t\t\t\t\t\t\t\t\t\t\t\tn[i++] = \"min-width:\" + ensureUnits(value);\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tcase \"mso-padding-between-alt\":\r\n\t\t\t\t\t\t\t\t\t\t\t\tn[i++] = \"border-collapse:separate;border-spacing:\" + ensureUnits(value);\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tcase \"text-line-through\":\r\n\t\t\t\t\t\t\t\t\t\t\t\tif ((value == \"single\") || (value == \"double\")) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tn[i++] = \"text-decoration:line-through\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tcase \"mso-zero-height\":\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (value == \"yes\") {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tn[i++] = \"display:none\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Eliminate all MS Office style definitions that have no CSS equivalent by examining the first characters in the name\r\n\t\t\t\t\t\t\t\t\t\tif (/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?!align|decor|indent|trans)|top-bar|version|vnd|word-break)/.test(name)) {\r\n\t\t\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t// If it reached this point, it must be a valid CSS style\r\n\t\t\t\t\t\t\t\t\t\tn[i++] = name + \":\" + parts[1];\t\t// Lower-case name, but keep value case\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t// If style attribute contained any valid styles the re-write it; otherwise delete style attribute.\r\n\t\t\t\t\t\t\t\tif (i > 0) {\r\n\t\t\t\t\t\t\t\t\treturn tag + ' style=\"' + n.join(';') + '\"';\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\treturn tag;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Replace headers with <strong>\r\n\t\t\tif (getParam(ed, \"paste_convert_headers_to_strong\")) {\r\n\t\t\t\tprocess([\r\n\t\t\t\t\t[/<h[1-6][^>]*>/gi, \"<p><strong>\"],\r\n\t\t\t\t\t[/<\\/h[1-6][^>]*>/gi, \"</strong></p>\"]\r\n\t\t\t\t]);\r\n\t\t\t}\r\n\r\n\t\t\t// Class attribute options are: leave all as-is (\"none\"), remove all (\"all\"), or remove only those starting with mso (\"mso\").\r\n\t\t\t// Note:-  paste_strip_class_attributes: \"none\", verify_css_classes: true is also a good variation.\r\n\t\t\tstripClass = getParam(ed, \"paste_strip_class_attributes\");\r\n\r\n\t\t\tif (stripClass !== \"none\") {\r\n\t\t\t\tfunction removeClasses(match, g1) {\r\n\t\t\t\t\t\tif (stripClass === \"all\")\r\n\t\t\t\t\t\t\treturn '';\r\n\r\n\t\t\t\t\t\tvar cls = grep(explode(g1.replace(/^([\"'])(.*)\\1$/, \"$2\"), \" \"),\r\n\t\t\t\t\t\t\tfunction(v) {\r\n\t\t\t\t\t\t\t\treturn (/^(?!mso)/i.test(v));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\treturn cls.length ? ' class=\"' + cls.join(\" \") + '\"' : '';\r\n\t\t\t\t};\r\n\r\n\t\t\t\th = h.replace(/ class=\"([^\"]+)\"/gi, removeClasses);\r\n\t\t\t\th = h.replace(/ class=(\\w+)/gi, removeClasses);\r\n\t\t\t}\r\n\r\n\t\t\t// Remove spans option\r\n\t\t\tif (getParam(ed, \"paste_remove_spans\")) {\r\n\t\t\t\th = h.replace(/<\\/?span[^>]*>/gi, \"\");\r\n\t\t\t}\r\n\r\n\t\t\t//console.log('After preprocess:' + h);\r\n\r\n\t\t\to.content = h;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Various post process items.\r\n\t\t */\r\n\t\t_postProcess : function(pl, o) {\r\n\t\t\tvar t = this, ed = t.editor, dom = ed.dom, styleProps;\r\n\r\n\t\t\tif (o.wordContent) {\r\n\t\t\t\t// Remove named anchors or TOC links\r\n\t\t\t\teach(dom.select('a', o.node), function(a) {\r\n\t\t\t\t\tif (!a.href || a.href.indexOf('#_Toc') != -1)\r\n\t\t\t\t\t\tdom.remove(a, 1);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (getParam(ed, \"paste_convert_middot_lists\")) {\r\n\t\t\t\t\tt._convertLists(pl, o);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Process styles\r\n\t\t\t\tstyleProps = getParam(ed, \"paste_retain_style_properties\"); // retained properties\r\n\r\n\t\t\t\t// Process only if a string was specified and not equal to \"all\" or \"*\"\r\n\t\t\t\tif ((tinymce.is(styleProps, \"string\")) && (styleProps !== \"all\") && (styleProps !== \"*\")) {\r\n\t\t\t\t\tstyleProps = tinymce.explode(styleProps.replace(/^none$/i, \"\"));\r\n\r\n\t\t\t\t\t// Retains some style properties\r\n\t\t\t\t\teach(dom.select('*', o.node), function(el) {\r\n\t\t\t\t\t\tvar newStyle = {}, npc = 0, i, sp, sv;\r\n\r\n\t\t\t\t\t\t// Store a subset of the existing styles\r\n\t\t\t\t\t\tif (styleProps) {\r\n\t\t\t\t\t\t\tfor (i = 0; i < styleProps.length; i++) {\r\n\t\t\t\t\t\t\t\tsp = styleProps[i];\r\n\t\t\t\t\t\t\t\tsv = dom.getStyle(el, sp);\r\n\r\n\t\t\t\t\t\t\t\tif (sv) {\r\n\t\t\t\t\t\t\t\t\tnewStyle[sp] = sv;\r\n\t\t\t\t\t\t\t\t\tnpc++;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Remove all of the existing styles\r\n\t\t\t\t\t\tdom.setAttrib(el, 'style', '');\r\n\r\n\t\t\t\t\t\tif (styleProps && npc > 0)\r\n\t\t\t\t\t\t\tdom.setStyles(el, newStyle); // Add back the stored subset of styles\r\n\t\t\t\t\t\telse // Remove empty span tags that do not have class attributes\r\n\t\t\t\t\t\t\tif (el.nodeName == 'SPAN' && !el.className)\r\n\t\t\t\t\t\t\t\tdom.remove(el, true);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Remove all style information or only specifically on WebKit to avoid the style bug on that browser\r\n\t\t\tif (getParam(ed, \"paste_remove_styles\") || (getParam(ed, \"paste_remove_styles_if_webkit\") && tinymce.isWebKit)) {\r\n\t\t\t\teach(dom.select('*[style]', o.node), function(el) {\r\n\t\t\t\t\tel.removeAttribute('style');\r\n\t\t\t\t\tel.removeAttribute('_mce_style');\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tif (tinymce.isWebKit) {\r\n\t\t\t\t\t// We need to compress the styles on WebKit since if you paste <img border=\"0\" /> it will become <img border=\"0\" style=\"... lots of junk ...\" />\r\n\t\t\t\t\t// Removing the mce_style that contains the real value will force the Serializer engine to compress the styles\r\n\t\t\t\t\teach(dom.select('*', o.node), function(el) {\r\n\t\t\t\t\t\tel.removeAttribute('_mce_style');\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Converts the most common bullet and number formats in Office into a real semantic UL/LI list.\r\n\t\t */\r\n\t\t_convertLists : function(pl, o) {\r\n\t\t\tvar dom = pl.editor.dom, listElm, li, lastMargin = -1, margin, levels = [], lastType, html;\r\n\r\n\t\t\t// Convert middot lists into real semantic lists\r\n\t\t\teach(dom.select('p', o.node), function(p) {\r\n\t\t\t\tvar sib, val = '', type, html, idx, parents;\r\n\r\n\t\t\t\t// Get text node value at beginning of paragraph\r\n\t\t\t\tfor (sib = p.firstChild; sib && sib.nodeType == 3; sib = sib.nextSibling)\r\n\t\t\t\t\tval += sib.nodeValue;\r\n\r\n\t\t\t\tval = p.innerHTML.replace(/<\\/?\\w+[^>]*>/gi, '').replace(/&nbsp;/g, '\\u00a0');\r\n\r\n\t\t\t\t// Detect unordered lists look for bullets\r\n\t\t\t\tif (/^(__MCE_ITEM__)+[\\u2022\\u00b7\\u00a7\\u00d8o]\\s*\\u00a0*/.test(val))\r\n\t\t\t\t\ttype = 'ul';\r\n\r\n\t\t\t\t// Detect ordered lists 1., a. or ixv.\r\n\t\t\t\tif (/^__MCE_ITEM__\\s*\\w+\\.\\s*\\u00a0{2,}/.test(val))\r\n\t\t\t\t\ttype = 'ol';\r\n\r\n\t\t\t\t// Check if node value matches the list pattern: o&nbsp;&nbsp;\r\n\t\t\t\tif (type) {\r\n\t\t\t\t\tmargin = parseFloat(p.style.marginLeft || 0);\r\n\r\n\t\t\t\t\tif (margin > lastMargin)\r\n\t\t\t\t\t\tlevels.push(margin);\r\n\r\n\t\t\t\t\tif (!listElm || type != lastType) {\r\n\t\t\t\t\t\tlistElm = dom.create(type);\r\n\t\t\t\t\t\tdom.insertAfter(listElm, p);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Nested list element\r\n\t\t\t\t\t\tif (margin > lastMargin) {\r\n\t\t\t\t\t\t\tlistElm = li.appendChild(dom.create(type));\r\n\t\t\t\t\t\t} else if (margin < lastMargin) {\r\n\t\t\t\t\t\t\t// Find parent level based on margin value\r\n\t\t\t\t\t\t\tidx = tinymce.inArray(levels, margin);\r\n\t\t\t\t\t\t\tparents = dom.getParents(listElm.parentNode, type);\r\n\t\t\t\t\t\t\tlistElm = parents[parents.length - 1 - idx] || listElm;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Remove middot or number spans if they exists\r\n\t\t\t\t\teach(dom.select('span', p), function(span) {\r\n\t\t\t\t\t\tvar html = span.innerHTML.replace(/<\\/?\\w+[^>]*>/gi, '');\r\n\r\n\t\t\t\t\t\t// Remove span with the middot or the number\r\n\t\t\t\t\t\tif (type == 'ul' && /^[\\u2022\\u00b7\\u00a7\\u00d8o]/.test(html))\r\n\t\t\t\t\t\t\tdom.remove(span);\r\n\t\t\t\t\t\telse if (/^[\\s\\S]*\\w+\\.(&nbsp;|\\u00a0)*\\s*/.test(html))\r\n\t\t\t\t\t\t\tdom.remove(span);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\thtml = p.innerHTML;\r\n\r\n\t\t\t\t\t// Remove middot/list items\r\n\t\t\t\t\tif (type == 'ul')\r\n\t\t\t\t\t\thtml = p.innerHTML.replace(/__MCE_ITEM__/g, '').replace(/^[\\u2022\\u00b7\\u00a7\\u00d8o]\\s*(&nbsp;|\\u00a0)+\\s*/, '');\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\thtml = p.innerHTML.replace(/__MCE_ITEM__/g, '').replace(/^\\s*\\w+\\.(&nbsp;|\\u00a0)+\\s*/, '');\r\n\r\n\t\t\t\t\t// Create li and add paragraph data into the new li\r\n\t\t\t\t\tli = listElm.appendChild(dom.create('li', 0, html));\r\n\t\t\t\t\tdom.remove(p);\r\n\r\n\t\t\t\t\tlastMargin = margin;\r\n\t\t\t\t\tlastType = type;\r\n\t\t\t\t} else\r\n\t\t\t\t\tlistElm = lastMargin = 0; // End list element\r\n\t\t\t});\r\n\r\n\t\t\t// Remove any left over makers\r\n\t\t\thtml = o.node.innerHTML;\r\n\t\t\tif (html.indexOf('__MCE_ITEM__') != -1)\r\n\t\t\t\to.node.innerHTML = html.replace(/__MCE_ITEM__/g, '');\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * This method will split the current block parent and insert the contents inside the split position.\r\n\t\t * This logic can be improved so text nodes at the start/end remain in the start/end block elements\r\n\t\t */\r\n\t\t_insertBlockContent : function(ed, dom, content) {\r\n\t\t\tvar parentBlock, marker, sel = ed.selection, last, elm, vp, y, elmHeight, markerId = 'mce_marker';\r\n\r\n\t\t\tfunction select(n) {\r\n\t\t\t\tvar r;\r\n\r\n\t\t\t\tif (tinymce.isIE) {\r\n\t\t\t\t\tr = ed.getDoc().body.createTextRange();\r\n\t\t\t\t\tr.moveToElementText(n);\r\n\t\t\t\t\tr.collapse(false);\r\n\t\t\t\t\tr.select();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsel.select(n, 1);\r\n\t\t\t\t\tsel.collapse(false);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Insert a marker for the caret position\r\n\t\t\tthis._insert('<span id=\"' + markerId + '\"></span>', 1);\r\n\t\t\tmarker = dom.get(markerId);\r\n\t\t\tparentBlock = dom.getParent(marker, 'p,h1,h2,h3,h4,h5,h6,ul,ol,th,td');\r\n\r\n\t\t\t// If it's a parent block but not a table cell\r\n\t\t\tif (parentBlock && !/TD|TH/.test(parentBlock.nodeName)) {\r\n\t\t\t\t// Split parent block\r\n\t\t\t\tmarker = dom.split(parentBlock, marker);\r\n\r\n\t\t\t\t// Insert nodes before the marker\r\n\t\t\t\teach(dom.create('div', 0, content).childNodes, function(n) {\r\n\t\t\t\t\tlast = marker.parentNode.insertBefore(n.cloneNode(true), marker);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Move caret after marker\r\n\t\t\t\tselect(last);\r\n\t\t\t} else {\r\n\t\t\t\tdom.setOuterHTML(marker, content);\r\n\t\t\t\tsel.select(ed.getBody(), 1);\r\n\t\t\t\tsel.collapse(0);\r\n\t\t\t}\r\n\r\n\t\t\t// Remove marker if it's left\r\n\t\t\twhile (elm = dom.get(markerId))\r\n\t\t\t\tdom.remove(elm);\r\n\r\n\t\t\t// Get element, position and height\r\n\t\t\telm = sel.getStart();\r\n\t\t\tvp = dom.getViewPort(ed.getWin());\r\n\t\t\ty = ed.dom.getPos(elm).y;\r\n\t\t\telmHeight = elm.clientHeight;\r\n\r\n\t\t\t// Is element within viewport if not then scroll it into view\r\n\t\t\tif (y < vp.y || y + elmHeight > vp.y + vp.h)\r\n\t\t\t\ted.getDoc().body.scrollTop = y < vp.y ? y : y - vp.h + 25;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Inserts the specified contents at the caret position.\r\n\t\t */\r\n\t\t_insert : function(h, skip_undo) {\r\n\t\t\tvar ed = this.editor, r = ed.selection.getRng();\r\n\r\n\t\t\t// First delete the contents seems to work better on WebKit when the selection spans multiple list items or multiple table cells.\r\n\t\t\tif (!ed.selection.isCollapsed() && r.startContainer != r.endContainer)\r\n\t\t\t\ted.getDoc().execCommand('Delete', false, null);\r\n\r\n\t\t\t// It's better to use the insertHTML method on Gecko since it will combine paragraphs correctly before inserting the contents\r\n\t\t\ted.execCommand(tinymce.isGecko ? 'insertHTML' : 'mceInsertContent', false, h, {skip_undo : skip_undo});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Instead of the old plain text method which tried to re-create a paste operation, the\r\n\t\t * new approach adds a plain text mode toggle switch that changes the behavior of paste.\r\n\t\t * This function is passed the same input that the regular paste plugin produces.\r\n\t\t * It performs additional scrubbing and produces (and inserts) the plain text.\r\n\t\t * This approach leverages all of the great existing functionality in the paste\r\n\t\t * plugin, and requires minimal changes to add the new functionality.\r\n\t\t * Speednet - June 2009\r\n\t\t */\r\n\t\t_insertPlainText : function(ed, dom, h) {\r\n\t\t\tvar i, len, pos, rpos, node, breakElms, before, after,\r\n\t\t\t\tw = ed.getWin(),\r\n\t\t\t\td = ed.getDoc(),\r\n\t\t\t\tsel = ed.selection,\r\n\t\t\t\tis = tinymce.is,\r\n\t\t\t\tinArray = tinymce.inArray,\r\n\t\t\t\tlinebr = getParam(ed, \"paste_text_linebreaktype\"),\r\n\t\t\t\trl = getParam(ed, \"paste_text_replacements\");\r\n\r\n\t\t\tfunction process(items) {\r\n\t\t\t\teach(items, function(v) {\r\n\t\t\t\t\tif (v.constructor == RegExp)\r\n\t\t\t\t\t\th = h.replace(v, \"\");\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\th = h.replace(v[0], v[1]);\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\tif ((typeof(h) === \"string\") && (h.length > 0)) {\r\n\t\t\t\tif (!entities)\r\n\t\t\t\t\tentities = (\"34,quot,38,amp,39,apos,60,lt,62,gt,\" + ed.serializer.settings.entities).split(\",\");\r\n\r\n\t\t\t\t// If HTML content with line-breaking tags, then remove all cr/lf chars because only tags will break a line\r\n\t\t\t\tif (/<(?:p|br|h[1-6]|ul|ol|dl|table|t[rdh]|div|blockquote|fieldset|pre|address|center)[^>]*>/i.test(h)) {\r\n\t\t\t\t\tprocess([\r\n\t\t\t\t\t\t/[\\n\\r]+/g\r\n\t\t\t\t\t]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Otherwise just get rid of carriage returns (only need linefeeds)\r\n\t\t\t\t\tprocess([\r\n\t\t\t\t\t\t/\\r+/g\r\n\t\t\t\t\t]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tprocess([\r\n\t\t\t\t\t[/<\\/(?:p|h[1-6]|ul|ol|dl|table|div|blockquote|fieldset|pre|address|center)>/gi, \"\\n\\n\"],\t\t// Block tags get a blank line after them\r\n\t\t\t\t\t[/<br[^>]*>|<\\/tr>/gi, \"\\n\"],\t\t\t\t// Single linebreak for <br /> tags and table rows\r\n\t\t\t\t\t[/<\\/t[dh]>\\s*<t[dh][^>]*>/gi, \"\\t\"],\t\t// Table cells get tabs betweem them\r\n\t\t\t\t\t/<[a-z!\\/?][^>]*>/gi,\t\t\t\t\t\t// Delete all remaining tags\r\n\t\t\t\t\t[/&nbsp;/gi, \" \"],\t\t\t\t\t\t\t// Convert non-break spaces to regular spaces (remember, *plain text*)\r\n\t\t\t\t\t[\r\n\t\t\t\t\t\t// HTML entity\r\n\t\t\t\t\t\t/&(#\\d+|[a-z0-9]{1,10});/gi,\r\n\r\n\t\t\t\t\t\t// Replace with actual character\r\n\t\t\t\t\t\tfunction(e, s) {\r\n\t\t\t\t\t\t\tif (s.charAt(0) === \"#\") {\r\n\t\t\t\t\t\t\t\treturn String.fromCharCode(s.slice(1));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\treturn ((e = inArray(entities, s)) > 0)? String.fromCharCode(entities[e-1]) : \" \";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t],\r\n\t\t\t\t\t[/(?:(?!\\n)\\s)*(\\n+)(?:(?!\\n)\\s)*/gi, \"$1\"],\t// Cool little RegExp deletes whitespace around linebreak chars.\r\n\t\t\t\t\t[/\\n{3,}/g, \"\\n\\n\"],\t\t\t\t\t\t\t// Max. 2 consecutive linebreaks\r\n\t\t\t\t\t/^\\s+|\\s+$/g\t\t\t\t\t\t\t\t\t// Trim the front & back\r\n\t\t\t\t]);\r\n\r\n\t\t\t\th = dom.encode(h);\r\n\r\n\t\t\t\t// Delete any highlighted text before pasting\r\n\t\t\t\tif (!sel.isCollapsed()) {\r\n\t\t\t\t\td.execCommand(\"Delete\", false, null);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Perform default or custom replacements\r\n\t\t\t\tif (is(rl, \"array\") || (is(rl, \"array\"))) {\r\n\t\t\t\t\tprocess(rl);\r\n\t\t\t\t}\r\n\t\t\t\telse if (is(rl, \"string\")) {\r\n\t\t\t\t\tprocess(new RegExp(rl, \"gi\"));\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Treat paragraphs as specified in the config\r\n\t\t\t\tif (linebr == \"none\") {\r\n\t\t\t\t\tprocess([\r\n\t\t\t\t\t\t[/\\n+/g, \" \"]\r\n\t\t\t\t\t]);\r\n\t\t\t\t}\r\n\t\t\t\telse if (linebr == \"br\") {\r\n\t\t\t\t\tprocess([\r\n\t\t\t\t\t\t[/\\n/g, \"<br />\"]\r\n\t\t\t\t\t]);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tprocess([\r\n\t\t\t\t\t\t/^\\s+|\\s+$/g,\r\n\t\t\t\t\t\t[/\\n\\n/g, \"</p><p>\"],\r\n\t\t\t\t\t\t[/\\n/g, \"<br />\"]\r\n\t\t\t\t\t]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// This next piece of code handles the situation where we're pasting more than one paragraph of plain\r\n\t\t\t\t// text, and we are pasting the content into the middle of a block node in the editor.  The block\r\n\t\t\t\t// node gets split at the selection point into \"Para A\" and \"Para B\" (for the purposes of explaining).\r\n\t\t\t\t// The first paragraph of the pasted text is appended to \"Para A\", and the last paragraph of the\r\n\t\t\t\t// pasted text is prepended to \"Para B\".  Any other paragraphs of pasted text are placed between\r\n\t\t\t\t// \"Para A\" and \"Para B\".  This code solves a host of problems with the original plain text plugin and\r\n\t\t\t\t// now handles styles correctly.  (Pasting plain text into a styled paragraph is supposed to make the\r\n\t\t\t\t// plain text take the same style as the existing paragraph.)\r\n\t\t\t\tif ((pos = h.indexOf(\"</p><p>\")) != -1) {\r\n\t\t\t\t\trpos = h.lastIndexOf(\"</p><p>\");\r\n\t\t\t\t\tnode = sel.getNode(); \r\n\t\t\t\t\tbreakElms = [];\t\t// Get list of elements to break \r\n\r\n\t\t\t\t\tdo {\r\n\t\t\t\t\t\tif (node.nodeType == 1) {\r\n\t\t\t\t\t\t\t// Don't break tables and break at body\r\n\t\t\t\t\t\t\tif (node.nodeName == \"TD\" || node.nodeName == \"BODY\") {\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tbreakElms[breakElms.length] = node;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} while (node = node.parentNode);\r\n\r\n\t\t\t\t\t// Are we in the middle of a block node?\r\n\t\t\t\t\tif (breakElms.length > 0) {\r\n\t\t\t\t\t\tbefore = h.substring(0, pos);\r\n\t\t\t\t\t\tafter = \"\";\r\n\r\n\t\t\t\t\t\tfor (i=0, len=breakElms.length; i<len; i++) {\r\n\t\t\t\t\t\t\tbefore += \"</\" + breakElms[i].nodeName.toLowerCase() + \">\";\r\n\t\t\t\t\t\t\tafter += \"<\" + breakElms[breakElms.length-i-1].nodeName.toLowerCase() + \">\";\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (pos == rpos) {\r\n\t\t\t\t\t\t\th = before + after + h.substring(pos+7);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\th = before + h.substring(pos+4, rpos+4) + after + h.substring(rpos+7);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Insert content at the caret, plus add a marker for repositioning the caret\r\n\t\t\t\ted.execCommand(\"mceInsertRawHTML\", false, h + '<span id=\"_plain_text_marker\">&nbsp;</span>');\r\n\r\n\t\t\t\t// Reposition the caret to the marker, which was placed immediately after the inserted content.\r\n\t\t\t\t// Needs to be done asynchronously (in window.setTimeout) or else it doesn't work in all browsers.\r\n\t\t\t\t// The second part of the code scrolls the content up if the caret is positioned off-screen.\r\n\t\t\t\t// This is only necessary for WebKit browsers, but it doesn't hurt to use for all.\r\n\t\t\t\twindow.setTimeout(function() {\r\n\t\t\t\t\tvar marker = dom.get('_plain_text_marker'),\r\n\t\t\t\t\t\telm, vp, y, elmHeight;\r\n\r\n\t\t\t\t\tsel.select(marker, false);\r\n\t\t\t\t\td.execCommand(\"Delete\", false, null);\r\n\t\t\t\t\tmarker = null;\r\n\r\n\t\t\t\t\t// Get element, position and height\r\n\t\t\t\t\telm = sel.getStart();\r\n\t\t\t\t\tvp = dom.getViewPort(w);\r\n\t\t\t\t\ty = dom.getPos(elm).y;\r\n\t\t\t\t\telmHeight = elm.clientHeight;\r\n\r\n\t\t\t\t\t// Is element within viewport if not then scroll it into view\r\n\t\t\t\t\tif ((y < vp.y) || (y + elmHeight > vp.y + vp.h)) {\r\n\t\t\t\t\t\td.body.scrollTop = y < vp.y ? y : y - vp.h + 25;\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 0);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * This method will open the old style paste dialogs. Some users might want the old behavior but still use the new cleanup engine.\r\n\t\t */\r\n\t\t_legacySupport : function() {\r\n\t\t\tvar t = this, ed = t.editor;\r\n\r\n\t\t\t// Register command(s) for backwards compatibility\r\n\t\t\ted.addCommand(\"mcePasteWord\", function() {\r\n\t\t\t\ted.windowManager.open({\r\n\t\t\t\t\tfile: t.url + \"/pasteword.htm\",\r\n\t\t\t\t\twidth: parseInt(getParam(ed, \"paste_dialog_width\")),\r\n\t\t\t\t\theight: parseInt(getParam(ed, \"paste_dialog_height\")),\r\n\t\t\t\t\tinline: 1\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\tif (getParam(ed, \"paste_text_use_dialog\")) {\r\n\t\t\t\ted.addCommand(\"mcePasteText\", function() {\r\n\t\t\t\t\ted.windowManager.open({\r\n\t\t\t\t\t\tfile : t.url + \"/pastetext.htm\",\r\n\t\t\t\t\t\twidth: parseInt(getParam(ed, \"paste_dialog_width\")),\r\n\t\t\t\t\t\theight: parseInt(getParam(ed, \"paste_dialog_height\")),\r\n\t\t\t\t\t\tinline : 1\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Register button for backwards compatibility\r\n\t\t\ted.addButton(\"pasteword\", {title : \"paste.paste_word_desc\", cmd : \"mcePasteWord\"});\r\n\t\t}\r\n\t});\r\n\r\n\t// Register plugin\r\n\ttinymce.PluginManager.add(\"paste\", tinymce.plugins.PastePlugin);\r\n})();\r\n/**\r\n * editor_plugin_src.js\r\n *\r\n * Copyright 2009, Moxiecode Systems AB\r\n * Released under LGPL License.\r\n *\r\n * License: http://tinymce.moxiecode.com/license\r\n * Contributing: http://tinymce.moxiecode.com/contributing\r\n */\r\n\r\n(function() {\r\n\ttinymce.create('tinymce.plugins.Directionality', {\r\n\t\tinit : function(ed, url) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tt.editor = ed;\r\n\r\n\t\t\ted.addCommand('mceDirectionLTR', function() {\r\n\t\t\t\tvar e = ed.dom.getParent(ed.selection.getNode(), ed.dom.isBlock);\r\n\r\n\t\t\t\tif (e) {\r\n\t\t\t\t\tif (ed.dom.getAttrib(e, \"dir\") != \"ltr\")\r\n\t\t\t\t\t\ted.dom.setAttrib(e, \"dir\", \"ltr\");\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\ted.dom.setAttrib(e, \"dir\", \"\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\ted.nodeChanged();\r\n\t\t\t});\r\n\r\n\t\t\ted.addCommand('mceDirectionRTL', function() {\r\n\t\t\t\tvar e = ed.dom.getParent(ed.selection.getNode(), ed.dom.isBlock);\r\n\r\n\t\t\t\tif (e) {\r\n\t\t\t\t\tif (ed.dom.getAttrib(e, \"dir\") != \"rtl\")\r\n\t\t\t\t\t\ted.dom.setAttrib(e, \"dir\", \"rtl\");\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\ted.dom.setAttrib(e, \"dir\", \"\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\ted.nodeChanged();\r\n\t\t\t});\r\n\r\n\t\t\ted.addButton('ltr', {title : 'directionality.ltr_desc', cmd : 'mceDirectionLTR'});\r\n\t\t\ted.addButton('rtl', {title : 'directionality.rtl_desc', cmd : 'mceDirectionRTL'});\r\n\r\n\t\t\ted.onNodeChange.add(t._nodeChange, t);\r\n\t\t},\r\n\r\n\t\tgetInfo : function() {\r\n\t\t\treturn {\r\n\t\t\t\tlongname : 'Directionality',\r\n\t\t\t\tauthor : 'Moxiecode Systems AB',\r\n\t\t\t\tauthorurl : 'http://tinymce.moxiecode.com',\r\n\t\t\t\tinfourl : 'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/directionality',\r\n\t\t\t\tversion : tinymce.majorVersion + \".\" + tinymce.minorVersion\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\t// Private methods\r\n\r\n\t\t_nodeChange : function(ed, cm, n) {\r\n\t\t\tvar dom = ed.dom, dir;\r\n\r\n\t\t\tn = dom.getParent(n, dom.isBlock);\r\n\t\t\tif (!n) {\r\n\t\t\t\tcm.setDisabled('ltr', 1);\r\n\t\t\t\tcm.setDisabled('rtl', 1);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tdir = dom.getAttrib(n, 'dir');\r\n\t\t\tcm.setActive('ltr', dir == \"ltr\");\r\n\t\t\tcm.setDisabled('ltr', 0);\r\n\t\t\tcm.setActive('rtl', dir == \"rtl\");\r\n\t\t\tcm.setDisabled('rtl', 0);\r\n\t\t}\r\n\t});\r\n\r\n\t// Register plugin\r\n\ttinymce.PluginManager.add('directionality', tinymce.plugins.Directionality);\r\n})();/**\r\n * editor_plugin_src.js\r\n *\r\n * Copyright 2009, Moxiecode Systems AB\r\n * Released under LGPL License.\r\n *\r\n * License: http://tinymce.moxiecode.com/license\r\n * Contributing: http://tinymce.moxiecode.com/contributing\r\n */\r\n\r\n(function() {\r\n\tvar DOM = tinymce.DOM;\r\n\r\n\ttinymce.create('tinymce.plugins.FullScreenPlugin', {\r\n\t\tinit : function(ed, url) {\r\n\t\t\tvar t = this, s = {}, vp;\r\n\r\n\t\t\tt.editor = ed;\r\n\r\n\t\t\t// Register commands\r\n\t\t\ted.addCommand('mceFullScreen', function() {\r\n\t\t\t\tvar win, de = DOM.doc.documentElement;\r\n\r\n\t\t\t\tif (ed.getParam('fullscreen_is_enabled')) {\r\n\t\t\t\t\tif (ed.getParam('fullscreen_new_window'))\r\n\t\t\t\t\t\tcloseFullscreen(); // Call to close in new window\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tDOM.win.setTimeout(function() {\r\n\t\t\t\t\t\t\ttinymce.dom.Event.remove(DOM.win, 'resize', t.resizeFunc);\r\n\t\t\t\t\t\t\ttinyMCE.get(ed.getParam('fullscreen_editor_id')).setContent(ed.getContent({format : 'raw'}), {format : 'raw'});\r\n\t\t\t\t\t\t\ttinyMCE.remove(ed);\r\n\t\t\t\t\t\t\tDOM.remove('mce_fullscreen_container');\r\n\t\t\t\t\t\t\tde.style.overflow = ed.getParam('fullscreen_html_overflow');\r\n\t\t\t\t\t\t\tDOM.setStyle(DOM.doc.body, 'overflow', ed.getParam('fullscreen_overflow'));\r\n\t\t\t\t\t\t\tDOM.win.scrollTo(ed.getParam('fullscreen_scrollx'), ed.getParam('fullscreen_scrolly'));\r\n\t\t\t\t\t\t\ttinyMCE.settings = tinyMCE.oldSettings; // Restore old settings\r\n\t\t\t\t\t\t}, 10);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (ed.getParam('fullscreen_new_window')) {\r\n\t\t\t\t\twin = DOM.win.open(url + \"/fullscreen.htm\", \"mceFullScreenPopup\", \"fullscreen=yes,menubar=no,toolbar=no,scrollbars=no,resizable=yes,left=0,top=0,width=\" + screen.availWidth + \",height=\" + screen.availHeight);\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\twin.resizeTo(screen.availWidth, screen.availHeight);\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t// Ignore\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttinyMCE.oldSettings = tinyMCE.settings; // Store old settings\r\n\t\t\t\t\ts.fullscreen_overflow = DOM.getStyle(DOM.doc.body, 'overflow', 1) || 'auto';\r\n\t\t\t\t\ts.fullscreen_html_overflow = DOM.getStyle(de, 'overflow', 1);\r\n\t\t\t\t\tvp = DOM.getViewPort();\r\n\t\t\t\t\ts.fullscreen_scrollx = vp.x;\r\n\t\t\t\t\ts.fullscreen_scrolly = vp.y;\r\n\r\n\t\t\t\t\t// Fixes an Opera bug where the scrollbars doesn't reappear\r\n\t\t\t\t\tif (tinymce.isOpera && s.fullscreen_overflow == 'visible')\r\n\t\t\t\t\t\ts.fullscreen_overflow = 'auto';\r\n\r\n\t\t\t\t\t// Fixes an IE bug where horizontal scrollbars would appear\r\n\t\t\t\t\tif (tinymce.isIE && s.fullscreen_overflow == 'scroll')\r\n\t\t\t\t\t\ts.fullscreen_overflow = 'auto';\r\n\r\n\t\t\t\t\t// Fixes an IE bug where the scrollbars doesn't reappear\r\n\t\t\t\t\tif (tinymce.isIE && (s.fullscreen_html_overflow == 'visible' || s.fullscreen_html_overflow == 'scroll'))\r\n\t\t\t\t\t\ts.fullscreen_html_overflow = 'auto'; \r\n\r\n\t\t\t\t\tif (s.fullscreen_overflow == '0px')\r\n\t\t\t\t\t\ts.fullscreen_overflow = '';\r\n\r\n\t\t\t\t\tDOM.setStyle(DOM.doc.body, 'overflow', 'hidden');\r\n\t\t\t\t\tde.style.overflow = 'hidden'; //Fix for IE6/7\r\n\t\t\t\t\tvp = DOM.getViewPort();\r\n\t\t\t\t\tDOM.win.scrollTo(0, 0);\r\n\r\n\t\t\t\t\tif (tinymce.isIE)\r\n\t\t\t\t\t\tvp.h -= 1;\r\n\r\n\t\t\t\t\tn = DOM.add(DOM.doc.body, 'div', {id : 'mce_fullscreen_container', style : 'position:' + (tinymce.isIE6 || (tinymce.isIE && !DOM.boxModel) ? 'absolute' : 'fixed') + ';top:0;left:0;width:' + vp.w + 'px;height:' + vp.h + 'px;z-index:200000;'});\r\n\t\t\t\t\tDOM.add(n, 'div', {id : 'mce_fullscreen'});\r\n\r\n\t\t\t\t\ttinymce.each(ed.settings, function(v, n) {\r\n\t\t\t\t\t\ts[n] = v;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\ts.id = 'mce_fullscreen';\r\n\t\t\t\t\ts.width = n.clientWidth;\r\n\t\t\t\t\ts.height = n.clientHeight - 15;\r\n\t\t\t\t\ts.fullscreen_is_enabled = true;\r\n\t\t\t\t\ts.fullscreen_editor_id = ed.id;\r\n\t\t\t\t\ts.theme_advanced_resizing = false;\r\n\t\t\t\t\ts.save_onsavecallback = function() {\r\n\t\t\t\t\t\ted.setContent(tinyMCE.get(s.id).getContent({format : 'raw'}), {format : 'raw'});\r\n\t\t\t\t\t\ted.execCommand('mceSave');\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\ttinymce.each(ed.getParam('fullscreen_settings'), function(v, k) {\r\n\t\t\t\t\t\ts[k] = v;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (s.theme_advanced_toolbar_location === 'external')\r\n\t\t\t\t\t\ts.theme_advanced_toolbar_location = 'top';\r\n\r\n\t\t\t\t\tt.fullscreenEditor = new tinymce.Editor('mce_fullscreen', s);\r\n\t\t\t\t\tt.fullscreenEditor.onInit.add(function() {\r\n\t\t\t\t\t\tt.fullscreenEditor.setContent(ed.getContent());\r\n\t\t\t\t\t\tt.fullscreenEditor.focus();\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tt.fullscreenEditor.render();\r\n\r\n\t\t\t\t\tt.fullscreenElement = new tinymce.dom.Element('mce_fullscreen_container');\r\n\t\t\t\t\tt.fullscreenElement.update();\r\n\t\t\t\t\t//document.body.overflow = 'hidden';\r\n\r\n\t\t\t\t\tt.resizeFunc = tinymce.dom.Event.add(DOM.win, 'resize', function() {\r\n\t\t\t\t\t\tvar vp = tinymce.DOM.getViewPort(), fed = t.fullscreenEditor, outerSize, innerSize;\r\n\r\n\t\t\t\t\t\t// Get outer/inner size to get a delta size that can be used to calc the new iframe size\r\n\t\t\t\t\t\touterSize = fed.dom.getSize(fed.getContainer().firstChild);\r\n\t\t\t\t\t\tinnerSize = fed.dom.getSize(fed.getContainer().getElementsByTagName('iframe')[0]);\r\n\r\n\t\t\t\t\t\tfed.theme.resizeTo(vp.w - outerSize.w + innerSize.w, vp.h - outerSize.h + innerSize.h);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Register buttons\r\n\t\t\ted.addButton('fullscreen', {title : 'fullscreen.desc', cmd : 'mceFullScreen'});\r\n\r\n\t\t\ted.onNodeChange.add(function(ed, cm) {\r\n\t\t\t\tcm.setActive('fullscreen', ed.getParam('fullscreen_is_enabled'));\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tgetInfo : function() {\r\n\t\t\treturn {\r\n\t\t\t\tlongname : 'Fullscreen',\r\n\t\t\t\tauthor : 'Moxiecode Systems AB',\r\n\t\t\t\tauthorurl : 'http://tinymce.moxiecode.com',\r\n\t\t\t\tinfourl : 'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/fullscreen',\r\n\t\t\t\tversion : tinymce.majorVersion + \".\" + tinymce.minorVersion\r\n\t\t\t};\r\n\t\t}\r\n\t});\r\n\r\n\t// Register plugin\r\n\ttinymce.PluginManager.add('fullscreen', tinymce.plugins.FullScreenPlugin);\r\n})();/**\r\n * editor_plugin_src.js\r\n *\r\n * Copyright 2009, Moxiecode Systems AB\r\n * Released under LGPL License.\r\n *\r\n * License: http://tinymce.moxiecode.com/license\r\n * Contributing: http://tinymce.moxiecode.com/contributing\r\n */\r\n\r\n(function() {\r\n\tvar Event = tinymce.dom.Event;\r\n\r\n\ttinymce.create('tinymce.plugins.NonEditablePlugin', {\r\n\t\tinit : function(ed, url) {\r\n\t\t\tvar t = this, editClass, nonEditClass;\r\n\r\n\t\t\tt.editor = ed;\r\n\t\t\teditClass = ed.getParam(\"noneditable_editable_class\", \"mceEditable\");\r\n\t\t\tnonEditClass = ed.getParam(\"noneditable_noneditable_class\", \"mceNonEditable\");\r\n\r\n\t\t\ted.onNodeChange.addToTop(function(ed, cm, n) {\r\n\t\t\t\tvar sc, ec;\r\n\r\n\t\t\t\t// Block if start or end is inside a non editable element\r\n\t\t\t\tsc = ed.dom.getParent(ed.selection.getStart(), function(n) {\r\n\t\t\t\t\treturn ed.dom.hasClass(n, nonEditClass);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tec = ed.dom.getParent(ed.selection.getEnd(), function(n) {\r\n\t\t\t\t\treturn ed.dom.hasClass(n, nonEditClass);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Block or unblock\r\n\t\t\t\tif (sc || ec) {\r\n\t\t\t\t\tt._setDisabled(1);\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t} else\r\n\t\t\t\t\tt._setDisabled(0);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tgetInfo : function() {\r\n\t\t\treturn {\r\n\t\t\t\tlongname : 'Non editable elements',\r\n\t\t\t\tauthor : 'Moxiecode Systems AB',\r\n\t\t\t\tauthorurl : 'http://tinymce.moxiecode.com',\r\n\t\t\t\tinfourl : 'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/noneditable',\r\n\t\t\t\tversion : tinymce.majorVersion + \".\" + tinymce.minorVersion\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\t_block : function(ed, e) {\r\n\t\t\tvar k = e.keyCode;\r\n\r\n\t\t\t// Don't block arrow keys, pg up/down, and F1-F12\r\n\t\t\tif ((k > 32 && k < 41) || (k > 111 && k < 124))\r\n\t\t\t\treturn;\r\n\r\n\t\t\treturn Event.cancel(e);\r\n\t\t},\r\n\r\n\t\t_setDisabled : function(s) {\r\n\t\t\tvar t = this, ed = t.editor;\r\n\r\n\t\t\ttinymce.each(ed.controlManager.controls, function(c) {\r\n\t\t\t\tc.setDisabled(s);\r\n\t\t\t});\r\n\r\n\t\t\tif (s !== t.disabled) {\r\n\t\t\t\tif (s) {\r\n\t\t\t\t\ted.onKeyDown.addToTop(t._block);\r\n\t\t\t\t\ted.onKeyPress.addToTop(t._block);\r\n\t\t\t\t\ted.onKeyUp.addToTop(t._block);\r\n\t\t\t\t\ted.onPaste.addToTop(t._block);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ted.onKeyDown.remove(t._block);\r\n\t\t\t\t\ted.onKeyPress.remove(t._block);\r\n\t\t\t\t\ted.onKeyUp.remove(t._block);\r\n\t\t\t\t\ted.onPaste.remove(t._block);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tt.disabled = s;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t// Register plugin\r\n\ttinymce.PluginManager.add('noneditable', tinymce.plugins.NonEditablePlugin);\r\n})();/**\r\n * editor_plugin_src.js\r\n *\r\n * Copyright 2009, Moxiecode Systems AB\r\n * Released under LGPL License.\r\n *\r\n * License: http://tinymce.moxiecode.com/license\r\n * Contributing: http://tinymce.moxiecode.com/contributing\r\n */\r\n\r\n(function() {\r\n\ttinymce.create('tinymce.plugins.VisualChars', {\r\n\t\tinit : function(ed, url) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tt.editor = ed;\r\n\r\n\t\t\t// Register commands\r\n\t\t\ted.addCommand('mceVisualChars', t._toggleVisualChars, t);\r\n\r\n\t\t\t// Register buttons\r\n\t\t\ted.addButton('visualchars', {title : 'visualchars.desc', cmd : 'mceVisualChars'});\r\n\r\n\t\t\ted.onBeforeGetContent.add(function(ed, o) {\r\n\t\t\t\tif (t.state && o.format != 'raw' && !o.draft) {\r\n\t\t\t\t\tt.state = true;\r\n\t\t\t\t\tt._toggleVisualChars(false);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tgetInfo : function() {\r\n\t\t\treturn {\r\n\t\t\t\tlongname : 'Visual characters',\r\n\t\t\t\tauthor : 'Moxiecode Systems AB',\r\n\t\t\t\tauthorurl : 'http://tinymce.moxiecode.com',\r\n\t\t\t\tinfourl : 'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/visualchars',\r\n\t\t\t\tversion : tinymce.majorVersion + \".\" + tinymce.minorVersion\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\t// Private methods\r\n\r\n\t\t_toggleVisualChars : function(bookmark) {\r\n\t\t\tvar t = this, ed = t.editor, nl, i, h, d = ed.getDoc(), b = ed.getBody(), nv, s = ed.selection, bo, div, bm;\r\n\r\n\t\t\tt.state = !t.state;\r\n\t\t\ted.controlManager.setActive('visualchars', t.state);\r\n\r\n\t\t\tif (bookmark)\r\n\t\t\t\tbm = s.getBookmark();\r\n\r\n\t\t\tif (t.state) {\r\n\t\t\t\tnl = [];\r\n\t\t\t\ttinymce.walk(b, function(n) {\r\n\t\t\t\t\tif (n.nodeType == 3 && n.nodeValue && n.nodeValue.indexOf('\\u00a0') != -1)\r\n\t\t\t\t\t\tnl.push(n);\r\n\t\t\t\t}, 'childNodes');\r\n\r\n\t\t\t\tfor (i = 0; i < nl.length; i++) {\r\n\t\t\t\t\tnv = nl[i].nodeValue;\r\n\t\t\t\t\tnv = nv.replace(/(\\u00a0)/g, '<span _mce_bogus=\"1\" class=\"mceItemHidden mceItemNbsp\">$1</span>');\r\n\r\n\t\t\t\t\tdiv = ed.dom.create('div', null, nv);\r\n\t\t\t\t\twhile (node = div.lastChild)\r\n\t\t\t\t\t\ted.dom.insertAfter(node, nl[i]);\r\n\r\n\t\t\t\t\ted.dom.remove(nl[i]);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tnl = ed.dom.select('span.mceItemNbsp', b);\r\n\r\n\t\t\t\tfor (i = nl.length - 1; i >= 0; i--)\r\n\t\t\t\t\ted.dom.remove(nl[i], 1);\r\n\t\t\t}\r\n\r\n\t\t\ts.moveToBookmark(bm);\r\n\t\t}\r\n\t});\r\n\r\n\t// Register plugin\r\n\ttinymce.PluginManager.add('visualchars', tinymce.plugins.VisualChars);\r\n})();/**\r\n * editor_plugin_src.js\r\n *\r\n * Copyright 2009, Moxiecode Systems AB\r\n * Released under LGPL License.\r\n *\r\n * License: http://tinymce.moxiecode.com/license\r\n * Contributing: http://tinymce.moxiecode.com/contributing\r\n */\r\n\r\n(function() {\r\n\ttinymce.create('tinymce.plugins.Nonbreaking', {\r\n\t\tinit : function(ed, url) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tt.editor = ed;\r\n\r\n\t\t\t// Register commands\r\n\t\t\ted.addCommand('mceNonBreaking', function() {\r\n\t\t\t\ted.execCommand('mceInsertContent', false, (ed.plugins.visualchars && ed.plugins.visualchars.state) ? '<span _mce_bogus=\"1\" class=\"mceItemHidden mceItemNbsp\">&nbsp;</span>' : '&nbsp;');\r\n\t\t\t});\r\n\r\n\t\t\t// Register buttons\r\n\t\t\ted.addButton('nonbreaking', {title : 'nonbreaking.nonbreaking_desc', cmd : 'mceNonBreaking'});\r\n\r\n\t\t\tif (ed.getParam('nonbreaking_force_tab')) {\r\n\t\t\t\ted.onKeyDown.add(function(ed, e) {\r\n\t\t\t\t\tif (tinymce.isIE && e.keyCode == 9) {\r\n\t\t\t\t\t\ted.execCommand('mceNonBreaking');\r\n\t\t\t\t\t\ted.execCommand('mceNonBreaking');\r\n\t\t\t\t\t\ted.execCommand('mceNonBreaking');\r\n\t\t\t\t\t\ttinymce.dom.Event.cancel(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetInfo : function() {\r\n\t\t\treturn {\r\n\t\t\t\tlongname : 'Nonbreaking space',\r\n\t\t\t\tauthor : 'Moxiecode Systems AB',\r\n\t\t\t\tauthorurl : 'http://tinymce.moxiecode.com',\r\n\t\t\t\tinfourl : 'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/nonbreaking',\r\n\t\t\t\tversion : tinymce.majorVersion + \".\" + tinymce.minorVersion\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// Private methods\r\n\t});\r\n\r\n\t// Register plugin\r\n\ttinymce.PluginManager.add('nonbreaking', tinymce.plugins.Nonbreaking);\r\n})();/**\r\n * editor_plugin_src.js\r\n *\r\n * Copyright 2009, Moxiecode Systems AB\r\n * Released under LGPL License.\r\n *\r\n * License: http://tinymce.moxiecode.com/license\r\n * Contributing: http://tinymce.moxiecode.com/contributing\r\n */\r\n\r\n(function() {\r\n\ttinymce.create('tinymce.plugins.XHTMLXtrasPlugin', {\r\n\t\tinit : function(ed, url) {\r\n\t\t\t// Register commands\r\n\t\t\ted.addCommand('mceCite', function() {\r\n\t\t\t\ted.windowManager.open({\r\n\t\t\t\t\tfile : url + '/cite.htm',\r\n\t\t\t\t\twidth : 350 + parseInt(ed.getLang('xhtmlxtras.cite_delta_width', 0)),\r\n\t\t\t\t\theight : 250 + parseInt(ed.getLang('xhtmlxtras.cite_delta_height', 0)),\r\n\t\t\t\t\tinline : 1\r\n\t\t\t\t}, {\r\n\t\t\t\t\tplugin_url : url\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\ted.addCommand('mceAcronym', function() {\r\n\t\t\t\ted.windowManager.open({\r\n\t\t\t\t\tfile : url + '/acronym.htm',\r\n\t\t\t\t\twidth : 350 + parseInt(ed.getLang('xhtmlxtras.acronym_delta_width', 0)),\r\n\t\t\t\t\theight : 250 + parseInt(ed.getLang('xhtmlxtras.acronym_delta_width', 0)),\r\n\t\t\t\t\tinline : 1\r\n\t\t\t\t}, {\r\n\t\t\t\t\tplugin_url : url\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\ted.addCommand('mceAbbr', function() {\r\n\t\t\t\ted.windowManager.open({\r\n\t\t\t\t\tfile : url + '/abbr.htm',\r\n\t\t\t\t\twidth : 350 + parseInt(ed.getLang('xhtmlxtras.abbr_delta_width', 0)),\r\n\t\t\t\t\theight : 250 + parseInt(ed.getLang('xhtmlxtras.abbr_delta_width', 0)),\r\n\t\t\t\t\tinline : 1\r\n\t\t\t\t}, {\r\n\t\t\t\t\tplugin_url : url\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\ted.addCommand('mceDel', function() {\r\n\t\t\t\ted.windowManager.open({\r\n\t\t\t\t\tfile : url + '/del.htm',\r\n\t\t\t\t\twidth : 340 + parseInt(ed.getLang('xhtmlxtras.del_delta_width', 0)),\r\n\t\t\t\t\theight : 310 + parseInt(ed.getLang('xhtmlxtras.del_delta_width', 0)),\r\n\t\t\t\t\tinline : 1\r\n\t\t\t\t}, {\r\n\t\t\t\t\tplugin_url : url\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\ted.addCommand('mceIns', function() {\r\n\t\t\t\ted.windowManager.open({\r\n\t\t\t\t\tfile : url + '/ins.htm',\r\n\t\t\t\t\twidth : 340 + parseInt(ed.getLang('xhtmlxtras.ins_delta_width', 0)),\r\n\t\t\t\t\theight : 310 + parseInt(ed.getLang('xhtmlxtras.ins_delta_width', 0)),\r\n\t\t\t\t\tinline : 1\r\n\t\t\t\t}, {\r\n\t\t\t\t\tplugin_url : url\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\ted.addCommand('mceAttributes', function() {\r\n\t\t\t\ted.windowManager.open({\r\n\t\t\t\t\tfile : url + '/attributes.htm',\r\n\t\t\t\t\twidth : 380,\r\n\t\t\t\t\theight : 370,\r\n\t\t\t\t\tinline : 1\r\n\t\t\t\t}, {\r\n\t\t\t\t\tplugin_url : url\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t// Register buttons\r\n\t\t\ted.addButton('cite', {title : 'xhtmlxtras.cite_desc', cmd : 'mceCite'});\r\n\t\t\ted.addButton('acronym', {title : 'xhtmlxtras.acronym_desc', cmd : 'mceAcronym'});\r\n\t\t\ted.addButton('abbr', {title : 'xhtmlxtras.abbr_desc', cmd : 'mceAbbr'});\r\n\t\t\ted.addButton('del', {title : 'xhtmlxtras.del_desc', cmd : 'mceDel'});\r\n\t\t\ted.addButton('ins', {title : 'xhtmlxtras.ins_desc', cmd : 'mceIns'});\r\n\t\t\ted.addButton('attribs', {title : 'xhtmlxtras.attribs_desc', cmd : 'mceAttributes'});\r\n\r\n\t\t\ted.onNodeChange.add(function(ed, cm, n, co) {\r\n\t\t\t\tn = ed.dom.getParent(n, 'CITE,ACRONYM,ABBR,DEL,INS');\r\n\r\n\t\t\t\tcm.setDisabled('cite', co);\r\n\t\t\t\tcm.setDisabled('acronym', co);\r\n\t\t\t\tcm.setDisabled('abbr', co);\r\n\t\t\t\tcm.setDisabled('del', co);\r\n\t\t\t\tcm.setDisabled('ins', co);\r\n\t\t\t\tcm.setDisabled('attribs', n && n.nodeName == 'BODY');\r\n\t\t\t\tcm.setActive('cite', 0);\r\n\t\t\t\tcm.setActive('acronym', 0);\r\n\t\t\t\tcm.setActive('abbr', 0);\r\n\t\t\t\tcm.setActive('del', 0);\r\n\t\t\t\tcm.setActive('ins', 0);\r\n\r\n\t\t\t\t// Activate all\r\n\t\t\t\tif (n) {\r\n\t\t\t\t\tdo {\r\n\t\t\t\t\t\tcm.setDisabled(n.nodeName.toLowerCase(), 0);\r\n\t\t\t\t\t\tcm.setActive(n.nodeName.toLowerCase(), 1);\r\n\t\t\t\t\t} while (n = n.parentNode);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\ted.onPreInit.add(function() {\r\n\t\t\t\t// Fixed IE issue where it can't handle these elements correctly\r\n\t\t\t\ted.dom.create('abbr');\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tgetInfo : function() {\r\n\t\t\treturn {\r\n\t\t\t\tlongname : 'XHTML Xtras Plugin',\r\n\t\t\t\tauthor : 'Moxiecode Systems AB',\r\n\t\t\t\tauthorurl : 'http://tinymce.moxiecode.com',\r\n\t\t\t\tinfourl : 'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/xhtmlxtras',\r\n\t\t\t\tversion : tinymce.majorVersion + \".\" + tinymce.minorVersion\r\n\t\t\t};\r\n\t\t}\r\n\t});\r\n\r\n\t// Register plugin\r\n\ttinymce.PluginManager.add('xhtmlxtras', tinymce.plugins.XHTMLXtrasPlugin);\r\n})();/**\r\n * editor_plugin_src.js\r\n *\r\n * Copyright 2009, Moxiecode Systems AB\r\n * Released under LGPL License.\r\n *\r\n * License: http://tinymce.moxiecode.com/license\r\n * Contributing: http://tinymce.moxiecode.com/contributing\r\n */\r\n\r\n(function() {\r\n\tvar each = tinymce.each;\r\n\r\n\ttinymce.create('tinymce.plugins.TemplatePlugin', {\r\n\t\tinit : function(ed, url) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tt.editor = ed;\r\n\r\n\t\t\t// Register commands\r\n\t\t\ted.addCommand('mceTemplate', function(ui) {\r\n\t\t\t\ted.windowManager.open({\r\n\t\t\t\t\tfile : url + '/template.htm',\r\n\t\t\t\t\twidth : ed.getParam('template_popup_width', 750),\r\n\t\t\t\t\theight : ed.getParam('template_popup_height', 600),\r\n\t\t\t\t\tinline : 1\r\n\t\t\t\t}, {\r\n\t\t\t\t\tplugin_url : url\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\ted.addCommand('mceInsertTemplate', t._insertTemplate, t);\r\n\r\n\t\t\t// Register buttons\r\n\t\t\ted.addButton('template', {title : 'template.desc', cmd : 'mceTemplate'});\r\n\r\n\t\t\ted.onPreProcess.add(function(ed, o) {\r\n\t\t\t\tvar dom = ed.dom;\r\n\r\n\t\t\t\teach(dom.select('div', o.node), function(e) {\r\n\t\t\t\t\tif (dom.hasClass(e, 'mceTmpl')) {\r\n\t\t\t\t\t\teach(dom.select('*', e), function(e) {\r\n\t\t\t\t\t\t\tif (dom.hasClass(e, ed.getParam('template_mdate_classes', 'mdate').replace(/\\s+/g, '|')))\r\n\t\t\t\t\t\t\t\te.innerHTML = t._getDateTime(new Date(), ed.getParam(\"template_mdate_format\", ed.getLang(\"template.mdate_format\")));\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tt._replaceVals(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tgetInfo : function() {\r\n\t\t\treturn {\r\n\t\t\t\tlongname : 'Template plugin',\r\n\t\t\t\tauthor : 'Moxiecode Systems AB',\r\n\t\t\t\tauthorurl : 'http://www.moxiecode.com',\r\n\t\t\t\tinfourl : 'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/template',\r\n\t\t\t\tversion : tinymce.majorVersion + \".\" + tinymce.minorVersion\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\t_insertTemplate : function(ui, v) {\r\n\t\t\tvar t = this, ed = t.editor, h, el, dom = ed.dom, sel = ed.selection.getContent();\r\n\r\n\t\t\th = v.content;\r\n\r\n\t\t\teach(t.editor.getParam('template_replace_values'), function(v, k) {\r\n\t\t\t\tif (typeof(v) != 'function')\r\n\t\t\t\t\th = h.replace(new RegExp('\\\\{\\\\$' + k + '\\\\}', 'g'), v);\r\n\t\t\t});\r\n\r\n\t\t\tel = dom.create('div', null, h);\r\n\r\n\t\t\t// Find template element within div\r\n\t\t\tn = dom.select('.mceTmpl', el);\r\n\t\t\tif (n && n.length > 0) {\r\n\t\t\t\tel = dom.create('div', null);\r\n\t\t\t\tel.appendChild(n[0].cloneNode(true));\r\n\t\t\t}\r\n\r\n\t\t\tfunction hasClass(n, c) {\r\n\t\t\t\treturn new RegExp('\\\\b' + c + '\\\\b', 'g').test(n.className);\r\n\t\t\t};\r\n\r\n\t\t\teach(dom.select('*', el), function(n) {\r\n\t\t\t\t// Replace cdate\r\n\t\t\t\tif (hasClass(n, ed.getParam('template_cdate_classes', 'cdate').replace(/\\s+/g, '|')))\r\n\t\t\t\t\tn.innerHTML = t._getDateTime(new Date(), ed.getParam(\"template_cdate_format\", ed.getLang(\"template.cdate_format\")));\r\n\r\n\t\t\t\t// Replace mdate\r\n\t\t\t\tif (hasClass(n, ed.getParam('template_mdate_classes', 'mdate').replace(/\\s+/g, '|')))\r\n\t\t\t\t\tn.innerHTML = t._getDateTime(new Date(), ed.getParam(\"template_mdate_format\", ed.getLang(\"template.mdate_format\")));\r\n\r\n\t\t\t\t// Replace selection\r\n\t\t\t\tif (hasClass(n, ed.getParam('template_selected_content_classes', 'selcontent').replace(/\\s+/g, '|')))\r\n\t\t\t\t\tn.innerHTML = sel;\r\n\t\t\t});\r\n\r\n\t\t\tt._replaceVals(el);\r\n\r\n\t\t\ted.execCommand('mceInsertContent', false, el.innerHTML);\r\n\t\t\ted.addVisual();\r\n\t\t},\r\n\r\n\t\t_replaceVals : function(e) {\r\n\t\t\tvar dom = this.editor.dom, vl = this.editor.getParam('template_replace_values');\r\n\r\n\t\t\teach(dom.select('*', e), function(e) {\r\n\t\t\t\teach(vl, function(v, k) {\r\n\t\t\t\t\tif (dom.hasClass(e, k)) {\r\n\t\t\t\t\t\tif (typeof(vl[k]) == 'function')\r\n\t\t\t\t\t\t\tvl[k](e);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_getDateTime : function(d, fmt) {\r\n\t\t\t\tif (!fmt)\r\n\t\t\t\t\treturn \"\";\r\n\r\n\t\t\t\tfunction addZeros(value, len) {\r\n\t\t\t\t\tvar i;\r\n\r\n\t\t\t\t\tvalue = \"\" + value;\r\n\r\n\t\t\t\t\tif (value.length < len) {\r\n\t\t\t\t\t\tfor (i=0; i<(len-value.length); i++)\r\n\t\t\t\t\t\t\tvalue = \"0\" + value;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn value;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfmt = fmt.replace(\"%D\", \"%m/%d/%y\");\r\n\t\t\t\tfmt = fmt.replace(\"%r\", \"%I:%M:%S %p\");\r\n\t\t\t\tfmt = fmt.replace(\"%Y\", \"\" + d.getFullYear());\r\n\t\t\t\tfmt = fmt.replace(\"%y\", \"\" + d.getYear());\r\n\t\t\t\tfmt = fmt.replace(\"%m\", addZeros(d.getMonth()+1, 2));\r\n\t\t\t\tfmt = fmt.replace(\"%d\", addZeros(d.getDate(), 2));\r\n\t\t\t\tfmt = fmt.replace(\"%H\", \"\" + addZeros(d.getHours(), 2));\r\n\t\t\t\tfmt = fmt.replace(\"%M\", \"\" + addZeros(d.getMinutes(), 2));\r\n\t\t\t\tfmt = fmt.replace(\"%S\", \"\" + addZeros(d.getSeconds(), 2));\r\n\t\t\t\tfmt = fmt.replace(\"%I\", \"\" + ((d.getHours() + 11) % 12 + 1));\r\n\t\t\t\tfmt = fmt.replace(\"%p\", \"\" + (d.getHours() < 12 ? \"AM\" : \"PM\"));\r\n\t\t\t\tfmt = fmt.replace(\"%B\", \"\" + this.editor.getLang(\"template_months_long\").split(',')[d.getMonth()]);\r\n\t\t\t\tfmt = fmt.replace(\"%b\", \"\" + this.editor.getLang(\"template_months_short\").split(',')[d.getMonth()]);\r\n\t\t\t\tfmt = fmt.replace(\"%A\", \"\" + this.editor.getLang(\"template_day_long\").split(',')[d.getDay()]);\r\n\t\t\t\tfmt = fmt.replace(\"%a\", \"\" + this.editor.getLang(\"template_day_short\").split(',')[d.getDay()]);\r\n\t\t\t\tfmt = fmt.replace(\"%%\", \"%\");\r\n\r\n\t\t\t\treturn fmt;\r\n\t\t}\r\n\t});\r\n\r\n\t// Register plugin\r\n\ttinymce.PluginManager.add('template', tinymce.plugins.TemplatePlugin);\r\n})();/**\r\n * editor_plugin_src.js\r\n *\r\n * Copyright 2009, Moxiecode Systems AB\r\n * Released under LGPL License.\r\n *\r\n * License: http://tinymce.moxiecode.com/license\r\n * Contributing: http://tinymce.moxiecode.com/contributing\r\n */\r\n\r\n(function() {\r\n\tvar DOM = tinymce.DOM, Element = tinymce.dom.Element, Event = tinymce.dom.Event, each = tinymce.each, is = tinymce.is;\r\n\r\n\ttinymce.create('tinymce.plugins.InlinePopups', {\r\n\t\tinit : function(ed, url) {\r\n\t\t\t// Replace window manager\r\n\t\t\ted.onBeforeRenderUI.add(function() {\r\n\t\t\t\ted.windowManager = new tinymce.InlineWindowManager(ed);\r\n\t\t\t\tDOM.loadCSS(url + '/skins/' + (ed.settings.inlinepopups_skin || 'clearlooks2') + \"/window.css\");\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tgetInfo : function() {\r\n\t\t\treturn {\r\n\t\t\t\tlongname : 'InlinePopups',\r\n\t\t\t\tauthor : 'Moxiecode Systems AB',\r\n\t\t\t\tauthorurl : 'http://tinymce.moxiecode.com',\r\n\t\t\t\tinfourl : 'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/inlinepopups',\r\n\t\t\t\tversion : tinymce.majorVersion + \".\" + tinymce.minorVersion\r\n\t\t\t};\r\n\t\t}\r\n\t});\r\n\r\n\ttinymce.create('tinymce.InlineWindowManager:tinymce.WindowManager', {\r\n\t\tInlineWindowManager : function(ed) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tt.parent(ed);\r\n\t\t\tt.zIndex = 300000;\r\n\t\t\tt.count = 0;\r\n\t\t\tt.windows = {};\r\n\t\t},\r\n\r\n\t\topen : function(f, p) {\r\n\t\t\tvar t = this, id, opt = '', ed = t.editor, dw = 0, dh = 0, vp, po, mdf, clf, we, w, u;\r\n\r\n\t\t\tf = f || {};\r\n\t\t\tp = p || {};\r\n\r\n\t\t\t// Run native windows\r\n\t\t\tif (!f.inline)\r\n\t\t\t\treturn t.parent(f, p);\r\n\r\n\t\t\t// Only store selection if the type is a normal window\r\n\t\t\tif (!f.type)\r\n\t\t\t\tt.bookmark = ed.selection.getBookmark(1);\r\n\r\n\t\t\tid = DOM.uniqueId();\r\n\t\t\tvp = DOM.getViewPort();\r\n\t\t\tf.width = parseInt(f.width || 320);\r\n\t\t\tf.height = parseInt(f.height || 240) + (tinymce.isIE ? 8 : 0);\r\n\t\t\tf.min_width = parseInt(f.min_width || 150);\r\n\t\t\tf.min_height = parseInt(f.min_height || 100);\r\n\t\t\tf.max_width = parseInt(f.max_width || 2000);\r\n\t\t\tf.max_height = parseInt(f.max_height || 2000);\r\n\t\t\tf.left = f.left || Math.round(Math.max(vp.x, vp.x + (vp.w / 2.0) - (f.width / 2.0)));\r\n\t\t\tf.top = f.top || Math.round(Math.max(vp.y, vp.y + (vp.h / 2.0) - (f.height / 2.0)));\r\n\t\t\tf.movable = f.resizable = true;\r\n\t\t\tp.mce_width = f.width;\r\n\t\t\tp.mce_height = f.height;\r\n\t\t\tp.mce_inline = true;\r\n\t\t\tp.mce_window_id = id;\r\n\t\t\tp.mce_auto_focus = f.auto_focus;\r\n\r\n\t\t\t// Transpose\r\n//\t\t\tpo = DOM.getPos(ed.getContainer());\r\n//\t\t\tf.left -= po.x;\r\n//\t\t\tf.top -= po.y;\r\n\r\n\t\t\tt.features = f;\r\n\t\t\tt.params = p;\r\n\t\t\tt.onOpen.dispatch(t, f, p);\r\n\r\n\t\t\tif (f.type) {\r\n\t\t\t\topt += ' mceModal';\r\n\r\n\t\t\t\tif (f.type)\r\n\t\t\t\t\topt += ' mce' + f.type.substring(0, 1).toUpperCase() + f.type.substring(1);\r\n\r\n\t\t\t\tf.resizable = false;\r\n\t\t\t}\r\n\r\n\t\t\tif (f.statusbar)\r\n\t\t\t\topt += ' mceStatusbar';\r\n\r\n\t\t\tif (f.resizable)\r\n\t\t\t\topt += ' mceResizable';\r\n\r\n\t\t\tif (f.minimizable)\r\n\t\t\t\topt += ' mceMinimizable';\r\n\r\n\t\t\tif (f.maximizable)\r\n\t\t\t\topt += ' mceMaximizable';\r\n\r\n\t\t\tif (f.movable)\r\n\t\t\t\topt += ' mceMovable';\r\n\r\n\t\t\t// Create DOM objects\r\n\t\t\tt._addAll(DOM.doc.body, \r\n\t\t\t\t['div', {id : id, 'class' : ed.settings.inlinepopups_skin || 'clearlooks2', style : 'width:100px;height:100px'}, \r\n\t\t\t\t\t['div', {id : id + '_wrapper', 'class' : 'mceWrapper' + opt},\r\n\t\t\t\t\t\t['div', {id : id + '_top', 'class' : 'mceTop'}, \r\n\t\t\t\t\t\t\t['div', {'class' : 'mceLeft'}],\r\n\t\t\t\t\t\t\t['div', {'class' : 'mceCenter'}],\r\n\t\t\t\t\t\t\t['div', {'class' : 'mceRight'}],\r\n\t\t\t\t\t\t\t['span', {id : id + '_title'}, f.title || '']\r\n\t\t\t\t\t\t],\r\n\r\n\t\t\t\t\t\t['div', {id : id + '_middle', 'class' : 'mceMiddle'}, \r\n\t\t\t\t\t\t\t['div', {id : id + '_left', 'class' : 'mceLeft'}],\r\n\t\t\t\t\t\t\t['span', {id : id + '_content'}],\r\n\t\t\t\t\t\t\t['div', {id : id + '_right', 'class' : 'mceRight'}]\r\n\t\t\t\t\t\t],\r\n\r\n\t\t\t\t\t\t['div', {id : id + '_bottom', 'class' : 'mceBottom'},\r\n\t\t\t\t\t\t\t['div', {'class' : 'mceLeft'}],\r\n\t\t\t\t\t\t\t['div', {'class' : 'mceCenter'}],\r\n\t\t\t\t\t\t\t['div', {'class' : 'mceRight'}],\r\n\t\t\t\t\t\t\t['span', {id : id + '_status'}, 'Content']\r\n\t\t\t\t\t\t],\r\n\r\n\t\t\t\t\t\t['a', {'class' : 'mceMove', tabindex : '-1', href : 'javascript:;'}],\r\n\t\t\t\t\t\t['a', {'class' : 'mceMin', tabindex : '-1', href : 'javascript:;', onmousedown : 'return false;'}],\r\n\t\t\t\t\t\t['a', {'class' : 'mceMax', tabindex : '-1', href : 'javascript:;', onmousedown : 'return false;'}],\r\n\t\t\t\t\t\t['a', {'class' : 'mceMed', tabindex : '-1', href : 'javascript:;', onmousedown : 'return false;'}],\r\n\t\t\t\t\t\t['a', {'class' : 'mceClose', tabindex : '-1', href : 'javascript:;', onmousedown : 'return false;'}],\r\n\t\t\t\t\t\t['a', {id : id + '_resize_n', 'class' : 'mceResize mceResizeN', tabindex : '-1', href : 'javascript:;'}],\r\n\t\t\t\t\t\t['a', {id : id + '_resize_s', 'class' : 'mceResize mceResizeS', tabindex : '-1', href : 'javascript:;'}],\r\n\t\t\t\t\t\t['a', {id : id + '_resize_w', 'class' : 'mceResize mceResizeW', tabindex : '-1', href : 'javascript:;'}],\r\n\t\t\t\t\t\t['a', {id : id + '_resize_e', 'class' : 'mceResize mceResizeE', tabindex : '-1', href : 'javascript:;'}],\r\n\t\t\t\t\t\t['a', {id : id + '_resize_nw', 'class' : 'mceResize mceResizeNW', tabindex : '-1', href : 'javascript:;'}],\r\n\t\t\t\t\t\t['a', {id : id + '_resize_ne', 'class' : 'mceResize mceResizeNE', tabindex : '-1', href : 'javascript:;'}],\r\n\t\t\t\t\t\t['a', {id : id + '_resize_sw', 'class' : 'mceResize mceResizeSW', tabindex : '-1', href : 'javascript:;'}],\r\n\t\t\t\t\t\t['a', {id : id + '_resize_se', 'class' : 'mceResize mceResizeSE', tabindex : '-1', href : 'javascript:;'}]\r\n\t\t\t\t\t]\r\n\t\t\t\t]\r\n\t\t\t);\r\n\r\n\t\t\tDOM.setStyles(id, {top : -10000, left : -10000});\r\n\r\n\t\t\t// Fix gecko rendering bug, where the editors iframe messed with window contents\r\n\t\t\tif (tinymce.isGecko)\r\n\t\t\t\tDOM.setStyle(id, 'overflow', 'auto');\r\n\r\n\t\t\t// Measure borders\r\n\t\t\tif (!f.type) {\r\n\t\t\t\tdw += DOM.get(id + '_left').clientWidth;\r\n\t\t\t\tdw += DOM.get(id + '_right').clientWidth;\r\n\t\t\t\tdh += DOM.get(id + '_top').clientHeight;\r\n\t\t\t\tdh += DOM.get(id + '_bottom').clientHeight;\r\n\t\t\t}\r\n\r\n\t\t\t// Resize window\r\n\t\t\tDOM.setStyles(id, {top : f.top, left : f.left, width : f.width + dw, height : f.height + dh});\r\n\r\n\t\t\tu = f.url || f.file;\r\n\t\t\tif (u) {\r\n\t\t\t\tif (tinymce.relaxedDomain)\r\n\t\t\t\t\tu += (u.indexOf('?') == -1 ? '?' : '&') + 'mce_rdomain=' + tinymce.relaxedDomain;\r\n\r\n\t\t\t\tu = tinymce._addVer(u);\r\n\t\t\t}\r\n\r\n\t\t\tif (!f.type) {\r\n\t\t\t\tDOM.add(id + '_content', 'iframe', {id : id + '_ifr', src : 'javascript:\"\"', frameBorder : 0, style : 'border:0;width:10px;height:10px'});\r\n\t\t\t\tDOM.setStyles(id + '_ifr', {width : f.width, height : f.height});\r\n\t\t\t\tDOM.setAttrib(id + '_ifr', 'src', u);\r\n\t\t\t} else {\r\n\t\t\t\tDOM.add(id + '_wrapper', 'a', {id : id + '_ok', 'class' : 'mceButton mceOk', href : 'javascript:;', onmousedown : 'return false;'}, 'Ok');\r\n\r\n\t\t\t\tif (f.type == 'confirm')\r\n\t\t\t\t\tDOM.add(id + '_wrapper', 'a', {'class' : 'mceButton mceCancel', href : 'javascript:;', onmousedown : 'return false;'}, 'Cancel');\r\n\r\n\t\t\t\tDOM.add(id + '_middle', 'div', {'class' : 'mceIcon'});\r\n\t\t\t\tDOM.setHTML(id + '_content', f.content.replace('\\n', '<br />'));\r\n\t\t\t}\r\n\r\n\t\t\t// Register events\r\n\t\t\tmdf = Event.add(id, 'mousedown', function(e) {\r\n\t\t\t\tvar n = e.target, w, vp;\r\n\r\n\t\t\t\tw = t.windows[id];\r\n\t\t\t\tt.focus(id);\r\n\r\n\t\t\t\tif (n.nodeName == 'A' || n.nodeName == 'a') {\r\n\t\t\t\t\tif (n.className == 'mceMax') {\r\n\t\t\t\t\t\tw.oldPos = w.element.getXY();\r\n\t\t\t\t\t\tw.oldSize = w.element.getSize();\r\n\r\n\t\t\t\t\t\tvp = DOM.getViewPort();\r\n\r\n\t\t\t\t\t\t// Reduce viewport size to avoid scrollbars\r\n\t\t\t\t\t\tvp.w -= 2;\r\n\t\t\t\t\t\tvp.h -= 2;\r\n\r\n\t\t\t\t\t\tw.element.moveTo(vp.x, vp.y);\r\n\t\t\t\t\t\tw.element.resizeTo(vp.w, vp.h);\r\n\t\t\t\t\t\tDOM.setStyles(id + '_ifr', {width : vp.w - w.deltaWidth, height : vp.h - w.deltaHeight});\r\n\t\t\t\t\t\tDOM.addClass(id + '_wrapper', 'mceMaximized');\r\n\t\t\t\t\t} else if (n.className == 'mceMed') {\r\n\t\t\t\t\t\t// Reset to old size\r\n\t\t\t\t\t\tw.element.moveTo(w.oldPos.x, w.oldPos.y);\r\n\t\t\t\t\t\tw.element.resizeTo(w.oldSize.w, w.oldSize.h);\r\n\t\t\t\t\t\tw.iframeElement.resizeTo(w.oldSize.w - w.deltaWidth, w.oldSize.h - w.deltaHeight);\r\n\r\n\t\t\t\t\t\tDOM.removeClass(id + '_wrapper', 'mceMaximized');\r\n\t\t\t\t\t} else if (n.className == 'mceMove')\r\n\t\t\t\t\t\treturn t._startDrag(id, e, n.className);\r\n\t\t\t\t\telse if (DOM.hasClass(n, 'mceResize'))\r\n\t\t\t\t\t\treturn t._startDrag(id, e, n.className.substring(13));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tclf = Event.add(id, 'click', function(e) {\r\n\t\t\t\tvar n = e.target;\r\n\r\n\t\t\t\tt.focus(id);\r\n\r\n\t\t\t\tif (n.nodeName == 'A' || n.nodeName == 'a') {\r\n\t\t\t\t\tswitch (n.className) {\r\n\t\t\t\t\t\tcase 'mceClose':\r\n\t\t\t\t\t\t\tt.close(null, id);\r\n\t\t\t\t\t\t\treturn Event.cancel(e);\r\n\r\n\t\t\t\t\t\tcase 'mceButton mceOk':\r\n\t\t\t\t\t\tcase 'mceButton mceCancel':\r\n\t\t\t\t\t\t\tf.button_func(n.className == 'mceButton mceOk');\r\n\t\t\t\t\t\t\treturn Event.cancel(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Add window\r\n\t\t\tw = t.windows[id] = {\r\n\t\t\t\tid : id,\r\n\t\t\t\tmousedown_func : mdf,\r\n\t\t\t\tclick_func : clf,\r\n\t\t\t\telement : new Element(id, {blocker : 1, container : ed.getContainer()}),\r\n\t\t\t\tiframeElement : new Element(id + '_ifr'),\r\n\t\t\t\tfeatures : f,\r\n\t\t\t\tdeltaWidth : dw,\r\n\t\t\t\tdeltaHeight : dh\r\n\t\t\t};\r\n\r\n\t\t\tw.iframeElement.on('focus', function() {\r\n\t\t\t\tt.focus(id);\r\n\t\t\t});\r\n\r\n\t\t\t// Setup blocker\r\n\t\t\tif (t.count == 0 && t.editor.getParam('dialog_type', 'modal') == 'modal') {\r\n\t\t\t\tDOM.add(DOM.doc.body, 'div', {\r\n\t\t\t\t\tid : 'mceModalBlocker',\r\n\t\t\t\t\t'class' : (t.editor.settings.inlinepopups_skin || 'clearlooks2') + '_modalBlocker',\r\n\t\t\t\t\tstyle : {zIndex : t.zIndex - 1}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tDOM.show('mceModalBlocker'); // Reduces flicker in IE\r\n\t\t\t} else\r\n\t\t\t\tDOM.setStyle('mceModalBlocker', 'z-index', t.zIndex - 1);\r\n\r\n\t\t\tif (tinymce.isIE6 || /Firefox\\/2\\./.test(navigator.userAgent) || (tinymce.isIE && !DOM.boxModel))\r\n\t\t\t\tDOM.setStyles('mceModalBlocker', {position : 'absolute', left : vp.x, top : vp.y, width : vp.w - 2, height : vp.h - 2});\r\n\r\n\t\t\tt.focus(id);\r\n\t\t\tt._fixIELayout(id, 1);\r\n\r\n\t\t\t// Focus ok button\r\n\t\t\tif (DOM.get(id + '_ok'))\r\n\t\t\t\tDOM.get(id + '_ok').focus();\r\n\r\n\t\t\tt.count++;\r\n\r\n\t\t\treturn w;\r\n\t\t},\r\n\r\n\t\tfocus : function(id) {\r\n\t\t\tvar t = this, w;\r\n\r\n\t\t\tif (w = t.windows[id]) {\r\n\t\t\t\tw.zIndex = this.zIndex++;\r\n\t\t\t\tw.element.setStyle('zIndex', w.zIndex);\r\n\t\t\t\tw.element.update();\r\n\r\n\t\t\t\tid = id + '_wrapper';\r\n\t\t\t\tDOM.removeClass(t.lastId, 'mceFocus');\r\n\t\t\t\tDOM.addClass(id, 'mceFocus');\r\n\t\t\t\tt.lastId = id;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_addAll : function(te, ne) {\r\n\t\t\tvar i, n, t = this, dom = tinymce.DOM;\r\n\r\n\t\t\tif (is(ne, 'string'))\r\n\t\t\t\tte.appendChild(dom.doc.createTextNode(ne));\r\n\t\t\telse if (ne.length) {\r\n\t\t\t\tte = te.appendChild(dom.create(ne[0], ne[1]));\r\n\r\n\t\t\t\tfor (i=2; i<ne.length; i++)\r\n\t\t\t\t\tt._addAll(te, ne[i]);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_startDrag : function(id, se, ac) {\r\n\t\t\tvar t = this, mu, mm, d = DOM.doc, eb, w = t.windows[id], we = w.element, sp = we.getXY(), p, sz, ph, cp, vp, sx, sy, sex, sey, dx, dy, dw, dh;\r\n\r\n\t\t\t// Get positons and sizes\r\n//\t\t\tcp = DOM.getPos(t.editor.getContainer());\r\n\t\t\tcp = {x : 0, y : 0};\r\n\t\t\tvp = DOM.getViewPort();\r\n\r\n\t\t\t// Reduce viewport size to avoid scrollbars while dragging\r\n\t\t\tvp.w -= 2;\r\n\t\t\tvp.h -= 2;\r\n\r\n\t\t\tsex = se.screenX;\r\n\t\t\tsey = se.screenY;\r\n\t\t\tdx = dy = dw = dh = 0;\r\n\r\n\t\t\t// Handle mouse up\r\n\t\t\tmu = Event.add(d, 'mouseup', function(e) {\r\n\t\t\t\tEvent.remove(d, 'mouseup', mu);\r\n\t\t\t\tEvent.remove(d, 'mousemove', mm);\r\n\r\n\t\t\t\tif (eb)\r\n\t\t\t\t\teb.remove();\r\n\r\n\t\t\t\twe.moveBy(dx, dy);\r\n\t\t\t\twe.resizeBy(dw, dh);\r\n\t\t\t\tsz = we.getSize();\r\n\t\t\t\tDOM.setStyles(id + '_ifr', {width : sz.w - w.deltaWidth, height : sz.h - w.deltaHeight});\r\n\t\t\t\tt._fixIELayout(id, 1);\r\n\r\n\t\t\t\treturn Event.cancel(e);\r\n\t\t\t});\r\n\r\n\t\t\tif (ac != 'Move')\r\n\t\t\t\tstartMove();\r\n\r\n\t\t\tfunction startMove() {\r\n\t\t\t\tif (eb)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tt._fixIELayout(id, 0);\r\n\r\n\t\t\t\t// Setup event blocker\r\n\t\t\t\tDOM.add(d.body, 'div', {\r\n\t\t\t\t\tid : 'mceEventBlocker',\r\n\t\t\t\t\t'class' : 'mceEventBlocker ' + (t.editor.settings.inlinepopups_skin || 'clearlooks2'),\r\n\t\t\t\t\tstyle : {zIndex : t.zIndex + 1}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (tinymce.isIE6 || (tinymce.isIE && !DOM.boxModel))\r\n\t\t\t\t\tDOM.setStyles('mceEventBlocker', {position : 'absolute', left : vp.x, top : vp.y, width : vp.w - 2, height : vp.h - 2});\r\n\r\n\t\t\t\teb = new Element('mceEventBlocker');\r\n\t\t\t\teb.update();\r\n\r\n\t\t\t\t// Setup placeholder\r\n\t\t\t\tp = we.getXY();\r\n\t\t\t\tsz = we.getSize();\r\n\t\t\t\tsx = cp.x + p.x - vp.x;\r\n\t\t\t\tsy = cp.y + p.y - vp.y;\r\n\t\t\t\tDOM.add(eb.get(), 'div', {id : 'mcePlaceHolder', 'class' : 'mcePlaceHolder', style : {left : sx, top : sy, width : sz.w, height : sz.h}});\r\n\t\t\t\tph = new Element('mcePlaceHolder');\r\n\t\t\t};\r\n\r\n\t\t\t// Handle mouse move/drag\r\n\t\t\tmm = Event.add(d, 'mousemove', function(e) {\r\n\t\t\t\tvar x, y, v;\r\n\r\n\t\t\t\tstartMove();\r\n\r\n\t\t\t\tx = e.screenX - sex;\r\n\t\t\t\ty = e.screenY - sey;\r\n\r\n\t\t\t\tswitch (ac) {\r\n\t\t\t\t\tcase 'ResizeW':\r\n\t\t\t\t\t\tdx = x;\r\n\t\t\t\t\t\tdw = 0 - x;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'ResizeE':\r\n\t\t\t\t\t\tdw = x;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'ResizeN':\r\n\t\t\t\t\tcase 'ResizeNW':\r\n\t\t\t\t\tcase 'ResizeNE':\r\n\t\t\t\t\t\tif (ac == \"ResizeNW\") {\r\n\t\t\t\t\t\t\tdx = x;\r\n\t\t\t\t\t\t\tdw = 0 - x;\r\n\t\t\t\t\t\t} else if (ac == \"ResizeNE\")\r\n\t\t\t\t\t\t\tdw = x;\r\n\r\n\t\t\t\t\t\tdy = y;\r\n\t\t\t\t\t\tdh = 0 - y;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'ResizeS':\r\n\t\t\t\t\tcase 'ResizeSW':\r\n\t\t\t\t\tcase 'ResizeSE':\r\n\t\t\t\t\t\tif (ac == \"ResizeSW\") {\r\n\t\t\t\t\t\t\tdx = x;\r\n\t\t\t\t\t\t\tdw = 0 - x;\r\n\t\t\t\t\t\t} else if (ac == \"ResizeSE\")\r\n\t\t\t\t\t\t\tdw = x;\r\n\r\n\t\t\t\t\t\tdh = y;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'mceMove':\r\n\t\t\t\t\t\tdx = x;\r\n\t\t\t\t\t\tdy = y;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Boundary check\r\n\t\t\t\tif (dw < (v = w.features.min_width - sz.w)) {\r\n\t\t\t\t\tif (dx !== 0)\r\n\t\t\t\t\t\tdx += dw - v;\r\n\r\n\t\t\t\t\tdw = v;\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tif (dh < (v = w.features.min_height - sz.h)) {\r\n\t\t\t\t\tif (dy !== 0)\r\n\t\t\t\t\t\tdy += dh - v;\r\n\r\n\t\t\t\t\tdh = v;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdw = Math.min(dw, w.features.max_width - sz.w);\r\n\t\t\t\tdh = Math.min(dh, w.features.max_height - sz.h);\r\n\t\t\t\tdx = Math.max(dx, vp.x - (sx + vp.x));\r\n\t\t\t\tdy = Math.max(dy, vp.y - (sy + vp.y));\r\n\t\t\t\tdx = Math.min(dx, (vp.w + vp.x) - (sx + sz.w + vp.x));\r\n\t\t\t\tdy = Math.min(dy, (vp.h + vp.y) - (sy + sz.h + vp.y));\r\n\r\n\t\t\t\t// Move if needed\r\n\t\t\t\tif (dx + dy !== 0) {\r\n\t\t\t\t\tif (sx + dx < 0)\r\n\t\t\t\t\t\tdx = 0;\r\n\t\r\n\t\t\t\t\tif (sy + dy < 0)\r\n\t\t\t\t\t\tdy = 0;\r\n\r\n\t\t\t\t\tph.moveTo(sx + dx, sy + dy);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Resize if needed\r\n\t\t\t\tif (dw + dh !== 0)\r\n\t\t\t\t\tph.resizeTo(sz.w + dw, sz.h + dh);\r\n\r\n\t\t\t\treturn Event.cancel(e);\r\n\t\t\t});\r\n\r\n\t\t\treturn Event.cancel(se);\r\n\t\t},\r\n\r\n\t\tresizeBy : function(dw, dh, id) {\r\n\t\t\tvar w = this.windows[id];\r\n\r\n\t\t\tif (w) {\r\n\t\t\t\tw.element.resizeBy(dw, dh);\r\n\t\t\t\tw.iframeElement.resizeBy(dw, dh);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tclose : function(win, id) {\r\n\t\t\tvar t = this, w, d = DOM.doc, ix = 0, fw, id;\r\n\r\n\t\t\tid = t._findId(id || win);\r\n\r\n\t\t\t// Probably not inline\r\n\t\t\tif (!t.windows[id]) {\r\n\t\t\t\tt.parent(win);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tt.count--;\r\n\r\n\t\t\tif (t.count == 0)\r\n\t\t\t\tDOM.remove('mceModalBlocker');\r\n\r\n\t\t\tif (w = t.windows[id]) {\r\n\t\t\t\tt.onClose.dispatch(t);\r\n\t\t\t\tEvent.remove(d, 'mousedown', w.mousedownFunc);\r\n\t\t\t\tEvent.remove(d, 'click', w.clickFunc);\r\n\t\t\t\tEvent.clear(id);\r\n\t\t\t\tEvent.clear(id + '_ifr');\r\n\r\n\t\t\t\tDOM.setAttrib(id + '_ifr', 'src', 'javascript:\"\"'); // Prevent leak\r\n\t\t\t\tw.element.remove();\r\n\t\t\t\tdelete t.windows[id];\r\n\r\n\t\t\t\t// Find front most window and focus that\r\n\t\t\t\teach (t.windows, function(w) {\r\n\t\t\t\t\tif (w.zIndex > ix) {\r\n\t\t\t\t\t\tfw = w;\r\n\t\t\t\t\t\tix = w.zIndex;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (fw)\r\n\t\t\t\t\tt.focus(fw.id);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tsetTitle : function(w, ti) {\r\n\t\t\tvar e;\r\n\r\n\t\t\tw = this._findId(w);\r\n\r\n\t\t\tif (e = DOM.get(w + '_title'))\r\n\t\t\t\te.innerHTML = DOM.encode(ti);\r\n\t\t},\r\n\r\n\t\talert : function(txt, cb, s) {\r\n\t\t\tvar t = this, w;\r\n\r\n\t\t\tw = t.open({\r\n\t\t\t\ttitle : t,\r\n\t\t\t\ttype : 'alert',\r\n\t\t\t\tbutton_func : function(s) {\r\n\t\t\t\t\tif (cb)\r\n\t\t\t\t\t\tcb.call(s || t, s);\r\n\r\n\t\t\t\t\tt.close(null, w.id);\r\n\t\t\t\t},\r\n\t\t\t\tcontent : DOM.encode(t.editor.getLang(txt, txt)),\r\n\t\t\t\tinline : 1,\r\n\t\t\t\twidth : 400,\r\n\t\t\t\theight : 130\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tconfirm : function(txt, cb, s) {\r\n\t\t\tvar t = this, w;\r\n\r\n\t\t\tw = t.open({\r\n\t\t\t\ttitle : t,\r\n\t\t\t\ttype : 'confirm',\r\n\t\t\t\tbutton_func : function(s) {\r\n\t\t\t\t\tif (cb)\r\n\t\t\t\t\t\tcb.call(s || t, s);\r\n\r\n\t\t\t\t\tt.close(null, w.id);\r\n\t\t\t\t},\r\n\t\t\t\tcontent : DOM.encode(t.editor.getLang(txt, txt)),\r\n\t\t\t\tinline : 1,\r\n\t\t\t\twidth : 400,\r\n\t\t\t\theight : 130\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t// Internal functions\r\n\r\n\t\t_findId : function(w) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tif (typeof(w) == 'string')\r\n\t\t\t\treturn w;\r\n\r\n\t\t\teach(t.windows, function(wo) {\r\n\t\t\t\tvar ifr = DOM.get(wo.id + '_ifr');\r\n\r\n\t\t\t\tif (ifr && w == ifr.contentWindow) {\r\n\t\t\t\t\tw = wo.id;\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn w;\r\n\t\t},\r\n\r\n\t\t_fixIELayout : function(id, s) {\r\n\t\t\tvar w, img;\r\n\r\n\t\t\tif (!tinymce.isIE6)\r\n\t\t\t\treturn;\r\n\r\n\t\t\t// Fixes the bug where hover flickers and does odd things in IE6\r\n\t\t\teach(['n','s','w','e','nw','ne','sw','se'], function(v) {\r\n\t\t\t\tvar e = DOM.get(id + '_resize_' + v);\r\n\r\n\t\t\t\tDOM.setStyles(e, {\r\n\t\t\t\t\twidth : s ? e.clientWidth : '',\r\n\t\t\t\t\theight : s ? e.clientHeight : '',\r\n\t\t\t\t\tcursor : DOM.getStyle(e, 'cursor', 1)\r\n\t\t\t\t});\r\n\r\n\t\t\t\tDOM.setStyle(id + \"_bottom\", 'bottom', '-1px');\r\n\r\n\t\t\t\te = 0;\r\n\t\t\t});\r\n\r\n\t\t\t// Fixes graphics glitch\r\n\t\t\tif (w = this.windows[id]) {\r\n\t\t\t\t// Fixes rendering bug after resize\r\n\t\t\t\tw.element.hide();\r\n\t\t\t\tw.element.show();\r\n\r\n\t\t\t\t// Forced a repaint of the window\r\n\t\t\t\t//DOM.get(id).style.filter = '';\r\n\r\n\t\t\t\t// IE has a bug where images used in CSS won't get loaded\r\n\t\t\t\t// sometimes when the cache in the browser is disabled\r\n\t\t\t\t// This fix tries to solve it by loading the images using the image object\r\n\t\t\t\teach(DOM.select('div,a', id), function(e, i) {\r\n\t\t\t\t\tif (e.currentStyle.backgroundImage != 'none') {\r\n\t\t\t\t\t\timg = new Image();\r\n\t\t\t\t\t\timg.src = e.currentStyle.backgroundImage.replace(/url\\(\\\"(.+)\\\"\\)/, '$1');\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tDOM.get(id).style.filter = '';\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t// Register plugin\r\n\ttinymce.PluginManager.add('inlinepopups', tinymce.plugins.InlinePopups);\r\n})();\r\n\r\ntinyMCE_GZ.end();"
          },
          "redirectURL": "",
          "headersSize": 297,
          "bodySize": 144113
        },
        "cache": {},
        "timings": {
          "blocked": 1,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 16,
          "receive": 29
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:39.201+04:00",
        "time": 4,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/images/logo.gif",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "image/png,image/*;q=0.8,*/*;q=0.5"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Sat, 15 Mar 2008 08:15:38 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 731,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Sat, 15 Mar 2008 08:15:38 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Fri, 29 Jun 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=2592000"
            }
          ],
          "content": {
            "mimeType": "image/gif",
            "size": 1098
          },
          "redirectURL": "",
          "headersSize": 253,
          "bodySize": 1098
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-06-29T09:51:39.000Z",
            "lastAccess": "2012-05-30T09:51:39.000Z",
            "eTag": "",
            "hitCount": 14
          }
        },
        "timings": {
          "blocked": 0,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 4,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:39.201+04:00",
        "time": 5,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/images/language.gif",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "image/png,image/*;q=0.8,*/*;q=0.5"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Sat, 15 Mar 2008 08:15:38 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 735,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Sat, 15 Mar 2008 08:15:38 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Fri, 29 Jun 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=2592000"
            }
          ],
          "content": {
            "mimeType": "image/gif",
            "size": 612
          },
          "redirectURL": "",
          "headersSize": 253,
          "bodySize": 612
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-06-29T09:51:39.000Z",
            "lastAccess": "2012-05-30T09:51:39.000Z",
            "eTag": "",
            "hitCount": 13
          }
        },
        "timings": {
          "blocked": 0,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 5,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:39.201+04:00",
        "time": 5,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/images/sites.gif",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "image/png,image/*;q=0.8,*/*;q=0.5"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Sat, 15 Mar 2008 08:15:38 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 732,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Sat, 15 Mar 2008 08:15:38 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Fri, 29 Jun 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=2592000"
            }
          ],
          "content": {
            "mimeType": "image/gif",
            "size": 230
          },
          "redirectURL": "",
          "headersSize": 253,
          "bodySize": 230
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-06-29T09:51:39.000Z",
            "lastAccess": "2012-05-30T09:51:39.000Z",
            "eTag": "",
            "hitCount": 13
          }
        },
        "timings": {
          "blocked": 0,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 5,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:39.201+04:00",
        "time": 5,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/images/eye.gif",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "image/png,image/*;q=0.8,*/*;q=0.5"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Sat, 15 Mar 2008 08:15:38 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 730,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Sat, 15 Mar 2008 08:15:38 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Fri, 29 Jun 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=2592000"
            }
          ],
          "content": {
            "mimeType": "image/gif",
            "size": 1015
          },
          "redirectURL": "",
          "headersSize": 253,
          "bodySize": 1015
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-06-29T09:51:39.000Z",
            "lastAccess": "2012-05-30T09:51:39.000Z",
            "eTag": "",
            "hitCount": 13
          }
        },
        "timings": {
          "blocked": 0,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 5,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:39.201+04:00",
        "time": 5,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/images/superuser.gif",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "image/png,image/*;q=0.8,*/*;q=0.5"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Sat, 15 Mar 2008 08:15:38 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 736,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Sat, 15 Mar 2008 08:15:38 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Fri, 29 Jun 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=2592000"
            }
          ],
          "content": {
            "mimeType": "image/gif",
            "size": 1007
          },
          "redirectURL": "",
          "headersSize": 253,
          "bodySize": 1007
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-06-29T09:51:39.000Z",
            "lastAccess": "2012-05-30T09:51:39.000Z",
            "eTag": "",
            "hitCount": 13
          }
        },
        "timings": {
          "blocked": 0,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 5,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:39.201+04:00",
        "time": 5,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/images/exit.gif",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "image/png,image/*;q=0.8,*/*;q=0.5"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Sat, 15 Mar 2008 08:15:38 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 731,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Sat, 15 Mar 2008 08:15:38 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Fri, 29 Jun 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=2592000"
            }
          ],
          "content": {
            "mimeType": "image/gif",
            "size": 1037
          },
          "redirectURL": "",
          "headersSize": 253,
          "bodySize": 1037
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-06-29T09:51:39.000Z",
            "lastAccess": "2012-05-30T09:51:39.000Z",
            "eTag": "",
            "hitCount": 13
          }
        },
        "timings": {
          "blocked": 0,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 5,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:39.201+04:00",
        "time": 9,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/images/buy.gif",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "image/png,image/*;q=0.8,*/*;q=0.5"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Sat, 15 Mar 2008 08:15:38 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 730,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Sat, 15 Mar 2008 08:15:38 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Fri, 29 Jun 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=2592000"
            }
          ],
          "content": {
            "mimeType": "image/gif",
            "size": 1008
          },
          "redirectURL": "",
          "headersSize": 253,
          "bodySize": 1008
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-06-29T09:51:39.000Z",
            "lastAccess": "2012-05-30T09:51:39.000Z",
            "eTag": "",
            "hitCount": 13
          }
        },
        "timings": {
          "blocked": 4,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 5,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:39.201+04:00",
        "time": 56,
        "request": {
          "method": "GET",
          "url": "http://www.hostcms.ru/images/news/user-orders/img1.gif",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "hostmake",
              "value": "1"
            },
            {
              "name": "hostcounter",
              "value": "5045232"
            },
            {
              "name": "user_id",
              "value": "5045232"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "www.hostcms.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "image/png,image/*;q=0.8,*/*;q=0.5"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "hostmake=1; hostcounter=5045232; user_id=5045232"
            },
            {
              "name": "If-Modified-Since",
              "value": "Tue, 22 Jul 2008 11:07:20 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 459,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/0.8.53"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:12 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 22 Jul 2008 11:07:20 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            }
          ],
          "content": {
            "mimeType": "image/gif",
            "size": 8498
          },
          "redirectURL": "",
          "headersSize": 158,
          "bodySize": 8498
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-10-18T04:55:35.000Z",
            "lastAccess": "2012-05-30T09:51:39.000Z",
            "eTag": "",
            "hitCount": 14
          }
        },
        "timings": {
          "blocked": 0,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 56,
          "receive": 0
        },
        "serverIPAddress": "90.156.238.51",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:39.201+04:00",
        "time": 54,
        "request": {
          "method": "GET",
          "url": "http://www.hostcms.ru/images/keys/domain_list.gif",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "hostmake",
              "value": "1"
            },
            {
              "name": "hostcounter",
              "value": "5045232"
            },
            {
              "name": "user_id",
              "value": "5045232"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "www.hostcms.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "image/png,image/*;q=0.8,*/*;q=0.5"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "hostmake=1; hostcounter=5045232; user_id=5045232"
            },
            {
              "name": "If-Modified-Since",
              "value": "Tue, 22 Jul 2008 07:46:33 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 454,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/0.8.53"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:12 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 22 Jul 2008 07:46:33 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            }
          ],
          "content": {
            "mimeType": "image/gif",
            "size": 9563
          },
          "redirectURL": "",
          "headersSize": 158,
          "bodySize": 9563
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-10-18T05:15:39.000Z",
            "lastAccess": "2012-05-30T09:51:39.000Z",
            "eTag": "",
            "hitCount": 14
          }
        },
        "timings": {
          "blocked": 0,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 54,
          "receive": 0
        },
        "serverIPAddress": "90.156.238.51",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:39.263+04:00",
        "time": 5,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/images/shadow_tail.gif",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "image/png,image/*;q=0.8,*/*;q=0.5"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Fri, 04 Apr 2008 13:07:20 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 738,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Fri, 04 Apr 2008 13:07:20 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Fri, 29 Jun 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=2592000"
            }
          ],
          "content": {
            "mimeType": "image/gif",
            "size": 192
          },
          "redirectURL": "",
          "headersSize": 253,
          "bodySize": 192
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-06-29T09:51:39.000Z",
            "lastAccess": "2012-05-30T09:51:39.000Z",
            "eTag": "",
            "hitCount": 14
          }
        },
        "timings": {
          "blocked": 0,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 5,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:39.333+04:00",
        "time": 5,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/images/gray-lt.gif",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "image/png,image/*;q=0.8,*/*;q=0.5"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/admin/css/style.css?-936011871"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Sat, 15 Mar 2008 08:15:38 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 764,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Sat, 15 Mar 2008 08:15:38 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Fri, 29 Jun 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=2592000"
            }
          ],
          "content": {
            "mimeType": "image/gif",
            "size": 85
          },
          "redirectURL": "",
          "headersSize": 253,
          "bodySize": 85
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-06-29T09:51:39.000Z",
            "lastAccess": "2012-05-30T09:51:39.000Z",
            "eTag": "",
            "hitCount": 13
          }
        },
        "timings": {
          "blocked": 0,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 5,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:39.333+04:00",
        "time": 5,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/images/gray-lb.gif",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "image/png,image/*;q=0.8,*/*;q=0.5"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/admin/css/style.css?-936011871"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Sat, 15 Mar 2008 08:15:38 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 764,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Sat, 15 Mar 2008 08:15:38 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Fri, 29 Jun 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=2592000"
            }
          ],
          "content": {
            "mimeType": "image/gif",
            "size": 86
          },
          "redirectURL": "",
          "headersSize": 253,
          "bodySize": 86
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-06-29T09:51:39.000Z",
            "lastAccess": "2012-05-30T09:51:39.000Z",
            "eTag": "",
            "hitCount": 13
          }
        },
        "timings": {
          "blocked": 0,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 5,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:39.333+04:00",
        "time": 5,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/images/gray-rt.gif",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "image/png,image/*;q=0.8,*/*;q=0.5"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/admin/css/style.css?-936011871"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Sat, 15 Mar 2008 08:15:38 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 764,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Sat, 15 Mar 2008 08:15:38 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Fri, 29 Jun 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=2592000"
            }
          ],
          "content": {
            "mimeType": "image/gif",
            "size": 86
          },
          "redirectURL": "",
          "headersSize": 253,
          "bodySize": 86
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-06-29T09:51:39.000Z",
            "lastAccess": "2012-05-30T09:51:39.000Z",
            "eTag": "",
            "hitCount": 13
          }
        },
        "timings": {
          "blocked": 0,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 5,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:39.333+04:00",
        "time": 5,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/images/gray-rb.gif",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "image/png,image/*;q=0.8,*/*;q=0.5"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/admin/css/style.css?-936011871"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Sat, 15 Mar 2008 08:15:38 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 764,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Sat, 15 Mar 2008 08:15:38 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Fri, 29 Jun 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=2592000"
            }
          ],
          "content": {
            "mimeType": "image/gif",
            "size": 86
          },
          "redirectURL": "",
          "headersSize": 253,
          "bodySize": 86
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-06-29T09:51:39.000Z",
            "lastAccess": "2012-05-30T09:51:39.000Z",
            "eTag": "",
            "hitCount": 13
          }
        },
        "timings": {
          "blocked": 0,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 5,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      },
      {
        "pageref": "page_36651",
        "startedDateTime": "2012-05-30T13:51:39.364+04:00",
        "time": 5,
        "request": {
          "method": "GET",
          "url": "http://atceli.bget.ru/admin/images/wclose.gif",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "frontend",
              "value": "ea6035e65f61bc1e546bb9d2b08c10ab"
            },
            {
              "name": "abosid",
              "value": "2452906987"
            },
            {
              "name": "sid",
              "value": "513j23q8ec5lqn7ldb19atl431"
            },
            {
              "name": "QUICK_BAR_CLOSED",
              "value": "-1"
            },
            {
              "name": "has_js",
              "value": "1"
            },
            {
              "name": "vid",
              "value": "c35d2bc5b3a821edf94adfba0ee0a1a2"
            },
            {
              "name": "uh_prev_mod",
              "value": "pages"
            },
            {
              "name": "uh_prev_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "uh_curr_mod",
              "value": "pages"
            },
            {
              "name": "uh_curr_url",
              "value": "http%3A%2F%2Fatceli.bget.ru%2F"
            },
            {
              "name": "PHPSESSID",
              "value": "77483686e614acd01e96e81eb19dd652"
            }
          ],
          "headers": [
            {
              "name": "Host",
              "value": "atceli.bget.ru"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:12.0) Gecko/20100101 Firefox/12.0"
            },
            {
              "name": "Accept",
              "value": "image/png,image/*;q=0.8,*/*;q=0.5"
            },
            {
              "name": "Accept-Language",
              "value": "en-us,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Referer",
              "value": "http://atceli.bget.ru/"
            },
            {
              "name": "Cookie",
              "value": "frontend=ea6035e65f61bc1e546bb9d2b08c10ab; abosid=2452906987; sid=513j23q8ec5lqn7ldb19atl431; QUICK_BAR_CLOSED=-1; has_js=1; vid=c35d2bc5b3a821edf94adfba0ee0a1a2; uh_prev_mod=pages; uh_prev_url=http%3A%2F%2Fatceli.bget.ru%2F; uh_curr_mod=pages; uh_curr_url=http%3A%2F%2Fatceli.bget.ru%2F; PHPSESSID=77483686e614acd01e96e81eb19dd652"
            },
            {
              "name": "If-Modified-Since",
              "value": "Sat, 15 Mar 2008 08:15:38 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=0"
            }
          ],
          "queryString": [],
          "headersSize": 733,
          "bodySize": -1
        },
        "response": {
          "status": 304,
          "statusText": "Not Modified",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Server",
              "value": "nginx/1.1.0"
            },
            {
              "name": "Date",
              "value": "Wed, 30 May 2012 09:51:41 GMT"
            },
            {
              "name": "Last-Modified",
              "value": "Sat, 15 Mar 2008 08:15:38 GMT"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Keep-Alive",
              "value": "timeout=30"
            },
            {
              "name": "Expires",
              "value": "Fri, 29 Jun 2012 09:51:41 GMT"
            },
            {
              "name": "Cache-Control",
              "value": "max-age=2592000"
            }
          ],
          "content": {
            "mimeType": "image/gif",
            "size": 78
          },
          "redirectURL": "",
          "headersSize": 253,
          "bodySize": 78
        },
        "cache": {
          "afterRequest": {
            "expires": "2012-06-29T09:51:39.000Z",
            "lastAccess": "2012-05-30T09:51:39.000Z",
            "eTag": "",
            "hitCount": 15
          }
        },
        "timings": {
          "blocked": 0,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 5,
          "receive": 0
        },
        "serverIPAddress": "85.249.230.167",
        "connection": "80"
      }
    ]
  }
}